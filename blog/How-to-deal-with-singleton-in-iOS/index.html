<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Issue #18 A single singletonThere are many classes that designed to be used as singleton, like UserDefaults.standard, FileManager.default, NotificationCenter.default or even our own classes like UserM">
<meta name="keywords" content="ios, android,javascript, react">
<meta property="og:type" content="article">
<meta property="og:title" content="How to deal with singleton in iOS">
<meta property="og:url" content="https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/index.html">
<meta property="og:site_name" content="onmyway133">
<meta property="og:description" content="Issue #18 A single singletonThere are many classes that designed to be used as singleton, like UserDefaults.standard, FileManager.default, NotificationCenter.default or even our own classes like UserM">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-23T16:38:19.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to deal with singleton in iOS">
<meta name="twitter:description" content="Issue #18 A single singletonThere are many classes that designed to be used as singleton, like UserDefaults.standard, FileManager.default, NotificationCenter.default or even our own classes like UserM">
    
    
        
          
              <link rel="shortcut icon" href="/images/icon96.jpeg">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/icon96.jpeg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/icon96.jpeg">
          
        
    
    <!-- title -->
    <title>How to deal with singleton in iOS</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/speaking/">Speaking</a></li>
         
          <li><a href="/opensource/">Open Source</a></li>
         
          <li><a href="/gumroad/">Gumroad</a></li>
         
          <li><a href="/news/">News</a></li>
         
          <li><a href="/jobs/">Jobs</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/blog/How-to-hack-iOS-apps/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/blog/Swift-snippets/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&text=How to deal with singleton in iOS"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&is_video=false&description=How to deal with singleton in iOS"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=How to deal with singleton in iOS&body=Check out this article: https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&name=How to deal with singleton in iOS&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-single-singleton"><span class="toc-number">1.</span> <span class="toc-text">A single singleton</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AppConfig"><span class="toc-number">1.1.</span> <span class="toc-text">AppConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Navigator"><span class="toc-number">1.2.</span> <span class="toc-text">Navigator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inject-a-singleton"><span class="toc-number">2.</span> <span class="toc-text">Inject a singleton</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        How to deal with singleton in iOS
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">onmyway133</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2017-05-02T19:40:10.000Z" itemprop="datePublished">2017-05-02</time>
        
        (Updated: <time datetime="2019-05-23T16:38:19.000Z" itemprop="dateModified">2019-05-23</time>)
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/18" target="_blank" rel="noopener">#18</a></strong></p>
<h2 id="A-single-singleton"><a href="#A-single-singleton" class="headerlink" title="A single singleton"></a>A single singleton</h2><p>There are many classes that designed to be used as singleton, like <code>UserDefaults.standard</code>, <code>FileManager.default</code>, <code>NotificationCenter.default</code> or even our own classes like <code>UserManager</code>, <code>Storage</code>, … Singleton is a design patter and has its own use case, sometimes we still need to use it. But if we are to use singleton, we should just use 1, and group all other singleton under this single singleton. Thanks to <a href="https://github.com/vadymmarkov/" target="_blank" rel="noopener">Vadym</a> for showing this to me</p>
<p>Swift makes it extremely easy to make singleton, let name it <code>App</code> then we have a single point of control for all the singletons</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> model = <span class="type">AppModel</span>()</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> realmProvider = <span class="type">RealmProvider</span>()</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> networkingProvider = <span class="type">NetworkingProvider</span>()</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">var</span> navigator = <span class="type">Navigator</span>()</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> config = <span class="type">AppConfig</span>()</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> pushNotificationCenter = <span class="type">PushNotificationCenter</span>()</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> lifeCycle = <span class="type">LifeCycle</span>()</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="type">These</span> are use cases <span class="keyword">where</span> a single instance <span class="keyword">is</span> needed</span><br><span class="line"></span><br><span class="line">### <span class="type">AppModel</span></span><br><span class="line"><span class="type">This</span> <span class="keyword">is</span> <span class="keyword">where</span> we store model <span class="keyword">for</span> an app, that can be</span><br><span class="line">- <span class="keyword">is</span> onboarding shown</span><br><span class="line">- organization name</span><br><span class="line">- `<span class="type">Session</span>` that encapsulates token, current profile</span><br><span class="line"></span><br><span class="line">### <span class="type">LifeCycle</span></span><br><span class="line"><span class="type">This</span> <span class="keyword">is</span> <span class="keyword">where</span> we listen to app life cycle, <span class="type">I</span> use `rx` to make it easy, see https:<span class="comment">//github.com/onmyway133/blog/issues/12</span></span><br><span class="line"></span><br><span class="line">### <span class="type">RealmProvider</span></span><br><span class="line"><span class="type">I</span> prefer `<span class="type">Realm</span>` <span class="keyword">for</span> storing and caching, usually <span class="number">1</span> `<span class="type">Realm</span>` <span class="keyword">is</span> enough. <span class="type">This</span> <span class="keyword">is</span> <span class="keyword">where</span> we <span class="keyword">return</span> the a certain `<span class="type">Realm</span>` instance</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealmProvider</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">realm</span><span class="params">()</span></span> -&gt; <span class="type">Realm</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> configuration = <span class="type">Realm</span>.<span class="type">Configuration</span>(schemaVersion: <span class="type">App</span>.config.schemaVersion)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span>! <span class="type">Realm</span>(configuration: configuration)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AppConfig"><a href="#AppConfig" class="headerlink" title="AppConfig"></a>AppConfig</h3><p>This is where we have configurations for staging and production environment, those can be client key, <code>Firebase</code> configuration, analytics keys, …</p>
<h3 id="Navigator"><a href="#Navigator" class="headerlink" title="Navigator"></a>Navigator</h3><p>I use <a href="https://github.com/hyperoslo/Compass" target="_blank" rel="noopener">Compass</a> to do central navigation, and there should be 1 <code>Navigator</code> that does the job</p>
<h2 id="Inject-a-singleton"><a href="#Inject-a-singleton" class="headerlink" title="Inject a singleton"></a>Inject a singleton</h2><p>Sometime we rely on a singleton to do our job, to make dependencies clear and testing easier, we need to inject this singleton, and leverage Swift default parameter, thanks to <a href="https://github.com/JohnSundell" target="_blank" rel="noopener">John</a> for showing this to me</p>
<p>Here is an example of a <code>ViewModel</code> that relies on <code>networking</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileViewModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> networking: <span class="type">Networking</span>&lt;<span class="type">APIEndpoint</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(networking: <span class="type">Networking</span>&lt;<span class="type">APIEndpoint</span>&gt; = <span class="type">App</span>.networking) &#123;</span><br><span class="line">    <span class="keyword">self</span>.networking = networking</span><br><span class="line"></span><br><span class="line">    networking.rxRequest(<span class="type">APIEndpoint</span>.profile)</span><br><span class="line">      .bindNext(&#123; profile <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(profile)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/speaking/">Speaking</a></li>
         
          <li><a href="/opensource/">Open Source</a></li>
         
          <li><a href="/gumroad/">Gumroad</a></li>
         
          <li><a href="/news/">News</a></li>
         
          <li><a href="/jobs/">Jobs</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-single-singleton"><span class="toc-number">1.</span> <span class="toc-text">A single singleton</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AppConfig"><span class="toc-number">1.1.</span> <span class="toc-text">AppConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Navigator"><span class="toc-number">1.2.</span> <span class="toc-text">Navigator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inject-a-singleton"><span class="toc-number">2.</span> <span class="toc-text">Inject a singleton</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&text=How to deal with singleton in iOS"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&is_video=false&description=How to deal with singleton in iOS"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=How to deal with singleton in iOS&body=Check out this article: https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&title=How to deal with singleton in iOS"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/&name=How to deal with singleton in iOS&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Khoa Pham
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/speaking/">Speaking</a></li>
         
          <li><a href="/opensource/">Open Source</a></li>
         
          <li><a href="/gumroad/">Gumroad</a></li>
         
          <li><a href="/news/">News</a></li>
         
          <li><a href="/jobs/">Jobs</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-40119591-5', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
