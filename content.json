{"meta":{"title":"onmyway133","subtitle":"What you don't know is what you haven't learned","description":"What you don't know is what you haven't learned","author":"Khoa Pham","url":"https://onmyway133.github.io","root":"/"},"pages":[{"title":"Gumroad","date":"2019-09-03T13:21:20.000Z","updated":"2019-09-03T19:43:31.494Z","comments":true,"path":"gumroad/index.html","permalink":"https://onmyway133.github.io/gumroad/index.html","excerpt":"","text":""},{"title":"About","date":"2019-09-03T13:21:20.000Z","updated":"2019-10-16T07:07:10.219Z","comments":true,"path":"about/index.html","permalink":"https://onmyway133.github.io/about/index.html","excerpt":"","text":"Ohayou üëã Working GitHub (1.1k+ followers, 160+ repo) CocoaPods ‚òîÔ∏è (45k+ apps touched, 3.4m+ downloads) Stackoverflow ü§ò (9.1m+ people reached, 370+ answers) Gumroad ü§†‚ù§Ô∏è (60k+ views) Product Hunt üï∫ Writing Medium üèÑ (2k+ followers, 85k monthly views) Dev üë®‚Äçüíª (1.1k+ followers, 88k+ views) GitHub blog ü•Å (5k monthly views) Speaking SpeakerDeck üë®‚Äçüé§ Activity Twitter üê¶ Story üòá Client projects üçé 500px Linkedin üôÑ Reading list üìö Archives üçµ GitHub Sponsor Curation fantastic-android-animation üí¶ A collection of Android animation repos fantastic-android-architecture üè∞ Better ways to structure Android apps fantastic-ios-animation ‚òîÔ∏è A collection of iOS animation repos fantastic-ios-architecture üèØ Better ways to structure iOS apps fantastic-machine-learning üé∞ A curated list of machine learning resources, preferably in Swift fantastic-conference-videos üé∏ Conference videos Best resources for software engineering Learning VoIP, RTP and SIP (aka awesome pjsip) Getting to know some pragmatic programming language featu 20 recommended utility apps for macOS in 2018 Awesome resources to get started in learning blockchain and cryptocurrency Useful git commands for everyday use! Best places to learn iOS development"},{"title":"news","date":"2019-09-07T19:47:10.000Z","updated":"2019-09-22T19:54:53.847Z","comments":true,"path":"news/index.html","permalink":"https://onmyway133.github.io/news/index.html","excerpt":"","text":"Learn Talks - iOSDevWeeky 422 FinderGo - Mac Informer Active writer - freeCodeCamp - 40 Active Business Publications on Medium That You Must Follow Fritz ML Final - Announcing the Winners of the Fritz ML Grants PushNotifications - raywenderlich - Push Notifications Tutorial: Getting Started DeepDiff - Vipps - tweet A better way to update UICollectionView data in Swift with diff framework - number 1 - Learn Swift from Top 50 Articles for the Past Year (v.2019) kode24koden - 250 kodere knakk kode24-koden Top 25 GitHub Repos to Inspire Your Next Machine Learning Project - Heartbeat: Editors‚Äô Selections for October GifCapture - softpedia - GifCapture for Mac Snowflake - iOSDevWeekly 279 RoughSwift - iOSDevWeekly 397 Puma - iOSDevWeekly 418 Active contributor - Top Swift GitHub developers in Norway Speaker - Mobile Era Conference 2017 &amp; 2018 - Speakers How to structure your project and manage static resources in React Native - Lets React 39"},{"title":"projects","date":"2019-09-10T08:59:40.000Z","updated":"2019-10-18T08:57:17.683Z","comments":true,"path":"projects/index.html","permalink":"https://onmyway133.github.io/projects/index.html","excerpt":"","text":"AppsKey Fighter (macOS) Easy to remember keyboard shortcut Elegant Converter (macOS) Mac app to convert audio and videos to many formats Quick Access (macOS) Quick access to favorite files, folders and apps Frame Recorder (macOS) Recorder app with device frame in gif and movie format Video Downloader (macOS) Download video from many sources and save as mp3 Icon Generator (macOS) Generate app icons for iOS, macOS and support Icns format Push Notifications (macOS) Test push notifications for iOS asd Android apps Almighty (macOS) Powerful configurations for macOS Menu Launcher (macOS) Convenient app and status menu icon launcher for macOS Hacker Pad (macOS) Scratch pad for hackers Keyboard Locker (macOS) Lock and unlock keyboard for macOS Ease (iOS) Relax with gentle sound What Is This (iOS) Reverse Image Search WebFantageek.com archive Personal blog giupnhanh.com archive Question and answers board NSArticle.com archive Awesome tech articles curation LearnTalks.com Awesome conference and meetup talks https://www.kode24.no/kodenytt/jeg-samler-foredrag-pa-learntalkscom/70438060"},{"title":"Search","date":"2019-09-03T19:59:52.447Z","updated":"2019-09-03T19:59:52.447Z","comments":true,"path":"search/index.html","permalink":"https://onmyway133.github.io/search/index.html","excerpt":"","text":""},{"title":"speaking","date":"2019-09-03T13:21:16.000Z","updated":"2019-11-05T12:28:43.627Z","comments":true,"path":"speaking/index.html","permalink":"https://onmyway133.github.io/speaking/index.html","excerpt":"","text":"Here are the talks I‚Äôve made so far Objective C Runtime, at 2359 MediaUsing block in Objective C, at 2359 MediaDebugging using LLDB, at 2359 MediaA Taste of MVVM + RxSwift, at Mobile Era Conference 2017, OsloCollection Update, at Cocoaheads, Oslo- [Swift Talks at FINN.no (CoreML, Diffing Algorithms and iOS Architecture)](https://www.meetup.com/CocoaHeads-Oslo/events/244892347/)From Xcode plugin to Xcode extension at Mobile Era Conference 2018, OsloGetting started with Flutter, at ShortcutUnit Testing in iOS, at ShortcutPragmatic Machine Learning for mobile apps, at Mobile Era Community 2019- [Mobile Era 2019 for Community - Release Management Strategies for Mobile Devs](https://www.meetup.com/Mobile-Meetup-Oslo/events/265529228/)"},{"title":"support","date":"2019-10-06T20:39:31.000Z","updated":"2019-10-06T20:40:33.638Z","comments":true,"path":"support/index.html","permalink":"https://onmyway133.github.io/support/index.html","excerpt":"","text":"Thanks for downloading my app. For any inquiries, please contact me at onmyway133@gmail.com"},{"title":"writing","date":"2019-09-10T08:59:32.000Z","updated":"2019-10-08T19:15:03.698Z","comments":true,"path":"writing/index.html","permalink":"https://onmyway133.github.io/writing/index.html","excerpt":"","text":"Here are my articles on Medium and other publications Flawless Apps https://medium.com/flawless-app-stories/useful-git-commands-for-everyday-use-e1a4de64037d ‚≠êÔ∏è https://medium.com/flawless-app-stories/vision-in-ios-text-detection-and-tesseract-recognition-26bbcd735d8f https://medium.com/flawless-app-stories/machine-learning-in-ios-turi-create-and-coreml-5ddce0dc8e26 https://medium.com/flawless-app-stories/machine-learning-in-ios-azure-custom-vision-and-coreml-645e93f35eee https://medium.com/flawless-app-stories/detecting-avengers-superheroes-in-your-ios-app-with-ibm-watson-and-coreml-fe38e493a4d1 https://medium.com/flawless-app-stories/playground-driven-development-in-swift-cf167489fe7b ‚≠êÔ∏è https://medium.com/flawless-app-stories/a-better-way-to-update-uicollectionview-data-in-swift-with-diff-framework-924db158db86 ‚≠êÔ∏è‚≠êÔ∏è https://medium.com/flawless-app-stories/url-routing-with-compass-d59c0061e7e2 https://flawlessapp.io/blog/a-taste-of-mvvm-and-reactive-paradigm/ ‚≠êÔ∏è https://medium.com/flawless-app-stories/a-taste-of-mvvm-and-reactive-paradigm-5288a819cca1 ‚≠êÔ∏è https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è https://medium.com/flawless-app-stories/simplifying-communication-patterns-with-closure-in-swift-1938414468b3 Heartbeat https://heartbeat.fritz.ai/building-a-camera-calculator-with-vision-and-tesseract-ocr-in-ios-26f16240fe51 ‚≠êÔ∏è https://heartbeat.fritz.ai/25-open-source-machine-learning-repos-to-inspire-your-next-project-3b027a90155 ‚≠êÔ∏è React Native Training https://medium.com/react-native-training/facebook-sdk-with-login-for-react-native-apps-in-2018-196601804f66 ‚≠êÔ∏è https://medium.com/react-native-training/firebase-sdk-with-firestore-for-react-native-apps-in-2018-aa89a67d6934 ‚≠êÔ∏è https://medium.com/react-native-training/fixing-react-native-issues-and-happy-deploy-to-bitrise-fabric-circleci-44da4ab1487b ‚≠êÔ∏è https://medium.com/react-native-training/position-element-at-the-bottom-of-the-screen-using-flexbox-in-react-native-a00b3790ca42 ‚≠êÔ∏è https://medium.com/react-native-training/react-native-bridging-how-to-make-linear-gradient-view-83c3805373b7 ‚≠êÔ∏è https://medium.com/react-native-training/how-to-handle-background-app-refresh-with-healthkit-in-react-native-3a32704461fe ‚≠êÔ∏è https://medium.com/react-native-training/how-to-dismiss-keyboard-with-react-navigation-in-react-native-apps-4b987bbfdc48 The Startup https://medium.com/swlh/introducing-learn-talks-awesome-conference-and-meetup-talks-e97c8cf7e0f kode24.no https://www.kode24.no/kodenytt/jeg-samler-foredrag-pa-learntalkscom/70438060 ‚≠êÔ∏è https://www.kode24.no/kodenytt/my-favorite-wwdc-2019-sessions/71183503 https://www.kode24.no/koden-bak/lagde-sitt-eget-drommeverktoy-til-macos/71285295 AppCoda https://www.appcoda.com.tw/playground-driven-development/ Bitrise https://blog.bitrise.io/using-bitrise-ci-for-android-apps ‚≠êÔ∏è"},{"title":"opensource","date":"2019-09-03T13:21:12.000Z","updated":"2019-09-03T19:36:51.828Z","comments":true,"path":"opensource/index.html","permalink":"https://onmyway133.github.io/opensource/index.html","excerpt":"","text":"Here are open source projects I make and contribute Swift Snowflake ‚ùÑÔ∏è SVG in Swift üöÄ üöÄ Star Omnia üóø Everything your projects need to know Scale üéè Unit converter in Swift Star Smile üòÑ Emoji in Swift Star Arcane üî± CommonCrypto in Swift, and more Star SwiftHash üçï MD5 in pure Swift üöÄ üöÄ Star Farge üéàTell the name of hex color Reindeers ‚ùÑÔ∏è XML and HTML parser in Swift ISO8601 üéó Super lightweight ISO8601 Date Formatter in Swift Star Dust üöÄ Unofficial, simple push notification Runtime-Headers üíø iOS, macOS runtime headers Wave üåä Declarative chainable animations in Swift GitHub.swift :octocat: Unofficial GitHub API client in Swift Border üìê Make border for all views Paramount üóº Like Flipboard FLEX, but allows custom action Anchors ‚öìÔ∏è Declarative, extensible, powerful Auto Layout for iOS and macOS üöÄ üöÄ Star EasyClosure üç© Unified communication with easy closure in Swift Star Resolver üéä A simple resolver in Swift Then üèÉ Promise A+ in Swift Themes üëï Theme management in Swift Star TestTarget üê≥ Notes on configuring test targets Trackers üïµÔ∏è Trackers in Swift ComputerScienceSwift üë®‚Äçüíª Practice computer science in Swift ParticlePlayground üéä A Swift playground to play with CAEmitterLayer GifMagic üíà Gif maker and extractor in Swift DeepDiff ü¶Ä Diff in Swift üöÄ üöÄ üöÄ Star RxLifeCycle üêπ Easy life cycle observation CollectionUpdateExample üõ∂ Demo batch update in UITableView and UICollectionView UsingPlayground üë∂ Demo how to use Playground SwiftSnippets üçÆ A collection of Swift snippets to be used in Xcode Dropdowns üíß Dropdown in Swift Star Cheers üéä Fancy confetti effects in Swift Star Upstream ‚õ≤Ô∏è Adapted Data Source in Swift and a little bit more RoughSwift üéÉCreate hand-drawn, sketchy, comic shape in Swift üöÄ üöÄ Star EasyStash üó≥Easy data persistence in Swift Puma üõ≥ Build utilities in pure Swift FantasticDisplay üé¢ Fantastic HUD and toast in Swift Contributions to hyperoslo Cache üì¶ Nothing but Cache. ‚≠êÔ∏è Imaginary ü¶Ñ Remote images, as easy as one, two, three. ‚≠êÔ∏è Whisper üì£ Whisper is a component that will make the task of display messages and in-app notifications simple. It has three different views inside Tailor üëî A super fast &amp; convenient object mapper tailored for your needs SwiftPackage üèÜ Template to make a Swift package Lightbox üåå A convenient and easy to use image viewer for your iOS app Keychains üîë A keychain wrapper that is so easy to use that your cat could use it. Gallery üìπ Your next favorite image and video picker ‚≠êÔ∏è ImagePicker üì∑ Reinventing the way ImagePicker works. Flasker üç∂ Secure User Defaults OhMyAuth üîê Simple OAuth2 library with a support of multiple services. CleanDataSources ‚õ≤Ô∏è Make DataSource great again Tabby ‚õ© A fancy tabbar BarcodeScanner üîé A simple and beautiful barcode scanner PinFloyd MapKit annotations clustering for iOS Contributions to BlindAssist BlindAssist An iOS app which will support the blind in traffic ‚≠êÔ∏è Objective C MEDCategories Common categories Android SlidingMenu üéø Demo how to create sliding menu on Android android-architecture-components-kotlin ü•ã Samples for Android Architecture Components in Kotlin Flutter / Dart json_resolve üê∞Easy resolving deep json using keypath in Dart Windows Phone MarqueeTextBlock üå¥ How to make marquee TextBlock on Windows Phone Xcode plugin Xmas üéÖ üéÑ ‚õÑÔ∏è Xmas plugin for Xcode XcodeColorSense üéà An Xcode plugin that makes working with color easier Xcode extension XcodeWay ‚õµÔ∏è An Xcode Source Editor Extension that makes navigating to many places easier üöÄ üöÄ üöÄ Star XcodeColorSense2 üéà An Xcode source editor extension that makes working with color easier iOS app BigBigNumbers üî¢Say the number out loud AskBoard üôã Real time chat with Firebase MathSolver ‚å®Ô∏èMath solver with Vision PhotoFeed üõµ Instagram in Swift 4 Recipes üç£Making Recipes iOS app Xkcd ü¶Ñ Simple Xkcd iOS app macOS app GifCapture üèá Gif capture app for macOS Star FinderGo üê¢ Open terminal quickly from Finder Star YoutubeDownloader üêß Youtube downloader for macOS Simulator üì± Navigate to your app folders quickly FinderFrame üñº Create Finder style image and gif AddressGenerator üí∞ A macOS app to safely generate cryptocurrency address üöÄ üöÄ Electron Lyrics üìª An electron app to show the lyrics of the currently playing song PushNotifications üêâ A macOS app to test push notifications üöÄ üöÄ Star IconGenerator üç± A macOS app to generate app icons üöÄ üöÄ Star Javascript traffic_simulator üöó Traffic simulator using enchant.js chat_webrtc ‚å®Ô∏è Simple chat application using Node.js and WebRTC Data Channel github-changelogs-maker üçª Generate changelogs between 2 latest releases AutoLayoutConverter üêú Convert Cartography to NSLayoutAnchor C rtpproxy ü•Ç Forked from http://www.rtpproxy.org/ with IP handover support Browser extension github-extended :octocat: A Chrome extension to discover more repositories github-chat üí¨ A Chrome extension to enable chat within GitHub Sketch plugin Sketch-Action üîé A Sketch plugin to simulate Spotlight üöÄ üöÄ SketchHeaders üé® Headers from Sketch Slack bot slackbot-yoda üíç Slackbot Yod Misc Archives archived projects notes üìî Issues and solutions I found during development, mostly iOS DarkSide üåå My dark theme based on Atom One Dark emoji ‚ù§Ô∏è List of emojis setup üíª My macOS apps and tools"}],"posts":[{"title":"How to use Firebase RemoteConfig","slug":"How-to-use-Firebase-RemoteConfig","date":"2019-11-05T12:13:25.000Z","updated":"2019-11-05T12:14:46.000Z","comments":true,"path":"blog/How-to-use-Firebase-RemoteConfig/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Firebase-RemoteConfig/","excerpt":"","text":"Issue #493 Declare in Podfile 12pod 'Firebase/Core'pod 'Firebase/RemoteConfig' Use RemoteConfigHandler to encapsulate logic. We introduce Key with CaseIterable and defaultValue of type NSNumber to manage default values. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import Firebaseimport FirebaseRemoteConfigfinal class RemoteConfigHandler &#123; let remoteConfig: RemoteConfig enum Key: String, CaseIterable &#123; case interval = \"fetch_interval\" var defaultValue: NSNumber &#123; switch self &#123; case .periodicGetSalons: return NSNumber(value: 300) &#125; &#125; &#125; init() &#123; self.remoteConfig = RemoteConfig.remoteConfig() let settings = RemoteConfigSettings() settings.minimumFetchInterval = 0 self.remoteConfig.configSettings = settings let map = Key.allCases.reduce([String: NSObject](), &#123; map, key in var map = map map[key.rawValue] = key.defaultValue return map &#125;) self.remoteConfig.setDefaults(map) &#125; func update() &#123; self.remoteConfig.fetchAndActivate(completionHandler: &#123; status, error in print(status, error as Any) &#125;) &#125; var fetchInterval: TimeInterval &#123; return getValue(key: .interval, transform: &#123; $0.doubleValue &#125;) &#125; private func getValue&lt;T&gt;(key: Key, transform: (NSNumber) -&gt; T) -&gt; T &#123; let number = remoteConfig.configValue(forKey: key.rawValue).numberValue ?? key.defaultValue return transform(number) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"firebase","slug":"firebase","permalink":"https://onmyway133.github.io/tags/firebase/"}]},{"title":"How to apply translations to Localizable.strings","slug":"How-to-apply-translations-to-Localizable.strings","date":"2019-11-05T08:35:11.000Z","updated":"2019-11-05T08:48:19.000Z","comments":true,"path":"blog/How-to-apply-translations-to-Localizable.strings/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-apply-translations-to-Localizable.strings/","excerpt":"","text":"Issue #492 Suppose we have a base Localizable.strings 12&quot;open&quot; = &quot;Open&quot;;&quot;closed&quot; = &quot;Closed&quot;; After sending that file for translations, we get translated versions. 12&quot;open&quot; = &quot;√Öpen&quot;;&quot;closed&quot; = &quot;Stengt&quot;; Searching and copy pasting these to our Localizable.strings is tedious and time consuming. We can write a script to apply that. Remember that we need to be aware of smart and dump quotes 12.replace(/\\\"/g, '').replace(/\\\"/g, '') 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364const fs = require('fs')const originalFile = 'MyApp/Resources/nb.lproj/Localizable.strings'const translationString = `\"open\" = \"√Öpen\";\"closed\" = \"Stengt\";`class Translation &#123; constructor(key, value) &#123; this.key = key this.value = value &#125;&#125;Translation.make = function make(line) &#123; if (!line.endsWith(';')) &#123; return new Translation('', '') &#125; const parts = line .replace(';') .split(\" = \") const key = parts[0] .replace(/\\\"/g, '') .replace(/\\‚Äù/g, '') const value = parts[1] .replace(/\\\"/g, '') .replace(/\\‚Äù/g, '') .replace('undefined', '') return new Translation(key, value)&#125;function main() &#123; const translations = translationString .split(/\\r?\\n/) .map((line) =&gt; &#123; return Translation.make(line) &#125;) apply(translations, originalFile)&#125;function apply(translations, originalFile) &#123; try &#123; const originalData = fs.readFileSync(originalFile, 'utf8') const originalLines = originalData.split(/\\r?\\n/) const parsedLine = originalLines.map((originalLine) =&gt; &#123; const originalTranslation = Translation.make(originalLine) const find = translations.find((translation) =&gt; &#123; return translation.key === originalTranslation.key &#125;) if (originalLine !== \"\" &amp;&amp; find !== undefined &amp;&amp; find.key !== \"\") &#123; return `\"$&#123;find.key&#125;\" = \"$&#123;find.value&#125;\";` &#125; else &#123; return originalLine &#125; &#125;) const parsedData = parsedLine.join('\\n') fs.writeFileSync(originalFile, parsedData, &#123; overwrite: true &#125;) &#125; catch (err) &#123; console.error(err) &#125;&#125;main()","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"},{"name":"script","slug":"script","permalink":"https://onmyway133.github.io/tags/script/"}]},{"title":"How to use CreateML to classify images","slug":"How-to-use-CreateML-to-classify-images","date":"2019-11-04T12:14:50.000Z","updated":"2019-11-04T13:17:26.000Z","comments":true,"path":"blog/How-to-use-CreateML-to-classify-images/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-CreateML-to-classify-images/","excerpt":"","text":"Issue #491 CreateMLUI Playground Read more https://developer.apple.com/documentation/createml/creating_an_image_classifier_model https://captechconsulting.com/blogs/hands-on-with-the-all-new-create-ml-app-machine-learning-for-the-masses Training Sound Classification Models in Create ML - WWDC 2019 Building Activity Classification Models in Create ML - WWDC 2019 Create ML for Everyone","categories":[],"tags":[{"name":"machine learning","slug":"machine-learning","permalink":"https://onmyway133.github.io/tags/machine-learning/"}]},{"title":"How to use Firebase AutoML Vision Edge to classify images","slug":"How-to-use-Firebase-AutoML-Vision-Edge-to-classify-images","date":"2019-11-04T11:41:41.000Z","updated":"2019-11-04T12:17:54.000Z","comments":true,"path":"blog/How-to-use-Firebase-AutoML-Vision-Edge-to-classify-images/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Firebase-AutoML-Vision-Edge-to-classify-images/","excerpt":"","text":"Issue #490 Create project on Firebase and choose Vision EdgeVision Edge is part of MLKit, but for custom images training https://console.firebase.google.com/u/0/project/avengers-ad2ce/ml/ Model Avengers_dataset_2019114133437 is training and may take several hours. You will receive an email once training is complete.","categories":[],"tags":[{"name":"cloud","slug":"cloud","permalink":"https://onmyway133.github.io/tags/cloud/"},{"name":"firebase","slug":"firebase","permalink":"https://onmyway133.github.io/tags/firebase/"}]},{"title":"How to use Google AutoML to classify images","slug":"How-to-use-Google-AutoML-to-classify-images","date":"2019-11-04T11:40:28.000Z","updated":"2019-11-04T11:49:17.000Z","comments":true,"path":"blog/How-to-use-Google-AutoML-to-classify-images/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Google-AutoML-to-classify-images/","excerpt":"","text":"Issue #489 Create bucket on Google Cloud Storagehttps://console.cloud.google.com/storage Create dataset by uploading images to Google AutoML Visionhttps://console.cloud.google.com/vision","categories":[],"tags":[{"name":"machine learning","slug":"machine-learning","permalink":"https://onmyway133.github.io/tags/machine-learning/"},{"name":"cloud","slug":"cloud","permalink":"https://onmyway133.github.io/tags/cloud/"}]},{"title":"How to get Binding via dollar prefix in SwiftUI","slug":"How-to-get-Binding-via-dollar-prefix-in-SwiftUI","date":"2019-11-02T22:46:18.000Z","updated":"2019-11-02T22:48:18.000Z","comments":true,"path":"blog/How-to-get-Binding-via-dollar-prefix-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-Binding-via-dollar-prefix-in-SwiftUI/","excerpt":"","text":"Issue #488 The dollar is not a prefix, it seems to be a generated code for property wrapper, and each kind of property wrapper can determine which value it return via this dollar sign State and ObservedObject are popular property wrappers in SwiftUI StateRead State A persistent value of a given type, through which a view reads and monitors the value. If we have a simple State, we can access its 3 forms 1@State private var image: UIImage and here is what 123image // UIImage_image // State&lt;UIImage&gt;$image // Binding&lt;UIImage&gt; Also, with State, we can access Binding via projectedValue 1_image.projectedValue // Binding&lt;UIImage&gt; ObservableObjectRead ObservedObject For a simple ObservableObject, we can see its 3 forms 12345678class ViewModel: ObservableObject &#123; var objectWillChange = ObservableObjectPublisher() var image: UIImage? &#123; didSet &#123; objectWillChange.send() &#125; &#125; 1@ObservedObject var viewModel: ViewModel = ViewModel() 123viewModel // ViewModel_viewModel // ObservedObject&lt;ViewModel&gt;$viewModel // ObservedObject&lt;ViewModel&gt;.Wrapper If we view the source code of ObservableObject, we can see its Wrapper which uses dynamicMemberLookup to provide Binding 1234567891011121314151617181920212223@propertyWrapper public struct ObservedObject&lt;ObjectType&gt; : DynamicProperty where ObjectType : ObservableObject &#123; /// A wrapper of the underlying `ObservableObject` that can create /// `Binding`s to its properties using dynamic member lookup. @dynamicMemberLookup public struct Wrapper &#123; /// Creates a `Binding` to a value semantic property of a /// reference type. /// /// If `Value` is not value semantic, the updating behavior for /// any views that make use of the resulting `Binding` is /// unspecified. public subscript&lt;Subject&gt;(dynamicMember keyPath: ReferenceWritableKeyPath&lt;ObjectType, Subject&gt;) -&gt; Binding&lt;Subject&gt; &#123; get &#125; &#125; public init(initialValue: ObjectType) public init(wrappedValue: ObjectType) public var wrappedValue: ObjectType public var projectedValue: ObservedObject&lt;ObjectType&gt;.Wrapper &#123; get &#125;&#125; ConclusionSo now we know how to get Binding from State and ObservableObject, and the mysterious dollar sign. These are both convenient but confusing at first, but if we use it more, it will make more sense and hopefully we can learn to do the same for our own property wrappers","categories":[],"tags":[{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to modify state from state in SwiftUI","slug":"How-to-modify-state-from-state-in-SwiftUI","date":"2019-11-02T22:09:43.000Z","updated":"2019-11-02T22:13:53.000Z","comments":true,"path":"blog/How-to-modify-state-from-state-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-modify-state-from-state-in-SwiftUI/","excerpt":"","text":"Issue #487 In case we have to modify state when another state is known, we can encapsulate all those states in ObservableObject and use onReceive to check the state we want to act on. If we were to modify state from within body function call, we will get warnings Modifying state during view update, this will cause undefined behavior. This is similar to the warning when we change state inside render in React For example, when we get an image, we want to do some logic based on that image and modify result state. Here we use var objectWillChange = ObservableObjectPublisher() to notify state change, and because onReceive requires Publisher, we use let imagePublisher = PassthroughSubject&lt;UIImage, Never&gt;() Note that we use $ prefix from a variable to form Binding 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293import SwiftUIimport Combineclass ViewModel: ObservableObject &#123; var objectWillChange = ObservableObjectPublisher() let imagePublisher = PassthroughSubject&lt;UIImage, Never&gt;() var image: UIImage? &#123; didSet &#123; objectWillChange.send() if let image = image &#123; imagePublisher.send(image) &#125; &#125; &#125; var isDetecting: Bool = false &#123; didSet &#123; objectWillChange.send() &#125; &#125; var result: String? &#123; didSet &#123; objectWillChange.send() &#125; &#125;&#125;struct MainView: View &#123; @State private var showImagePicker: Bool = false @ObservedObject var viewModel: ViewModel = ViewModel() private let detector = Detector() var body: some View &#123; VStack &#123; makeImage() .styleFit() if viewModel.isDetecting &#123; ActivityIndicator( isAnimating: $viewModel.isDetecting, style: .large ) &#125; makeResult() Button(action: &#123; self.showImagePicker.toggle() &#125;, label: &#123; Text(\"Choose image\") &#125;) .sheet(isPresented: $showImagePicker, content: &#123; ImagePicker(image: self.$viewModel.image, isPresented: self.$showImagePicker) &#125;) &#125; .onReceive(viewModel.imagePublisher, perform: &#123; image in self.detect(image: image) &#125;) &#125; private func makeImage() -&gt; Image &#123; if let image = self.viewModel.image &#123; return Image(uiImage: image) &#125; else &#123; return Image(\"placeholder\") &#125; &#125; private func makeResult() -&gt; Text &#123; if let result = viewModel.result &#123; return Text(result) &#125; else &#123; return Text(\"\") &#125; &#125; private func detect(image: UIImage) &#123; viewModel.isDetecting = true try? detector.detect(image: image, completion: &#123; result in switch result &#123; case .success(let string): self.viewModel.result = string default: self.viewModel.result = \"\" &#125; self.viewModel.isDetecting = false &#125;) &#125;&#125; Read more https://www.freecodecamp.org/news/get-pro-with-react-setstate-in-10-minutes-d38251d1c781/ https://stackoverflow.com/questions/56551131/what-does-the-dollar-sign-do-in-this-example https://stackoverflow.com/questions/44037611/how-to-avoid-setstate-inside-render-when-state-depends-on-render?rq=1 https://stackoverflow.com/questions/44037611/how-to-avoid-setstate-inside-render-when-state-depends-on-render?rq=1","categories":[],"tags":[{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to show loading indicator in SwiftUI","slug":"How-to-show-loading-indicator-in-SwiftUI","date":"2019-11-02T21:02:33.000Z","updated":"2019-11-02T21:02:39.000Z","comments":true,"path":"blog/How-to-show-loading-indicator-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-loading-indicator-in-SwiftUI/","excerpt":"","text":"Issue #486 1234567891011121314151617181920import SwiftUIstruct ActivityIndicator: UIViewRepresentable &#123; @Binding var isAnimating: Bool let style: UIActivityIndicatorView.Style func makeUIView(context: UIViewRepresentableContext&lt;ActivityIndicator&gt;) -&gt; UIActivityIndicatorView &#123; return UIActivityIndicatorView(style: style) &#125; func updateUIView(_ uiView: UIActivityIndicatorView, context: UIViewRepresentableContext&lt;ActivityIndicator&gt;) &#123; isAnimating ? uiView.startAnimating() : uiView.stopAnimating() &#125;&#125;struct ActivityIndicator_Previews: PreviewProvider &#123; static var previews: some View &#123; ActivityIndicator(isAnimating: .constant(true), style: .large) &#125;&#125;","categories":[],"tags":[{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to show image picker in SwiftUI","slug":"How-to-show-image-picker-in-SwiftUI","date":"2019-11-02T20:41:52.000Z","updated":"2019-11-02T20:41:52.000Z","comments":true,"path":"blog/How-to-show-image-picker-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-image-picker-in-SwiftUI/","excerpt":"","text":"Issue #485 The easiest way to show image picker in iOS is to use UIImagePickerController, and we can bridge that to SwiftUI via UIViewControllerRepresentable First attempt, use EnvironmentWe conform to UIViewControllerRepresentable and make a Coordinator, which is the recommended way to manage the bridging with UIViewController. There‚Äôs some built in environment property we can use, one of those is presentationMode where we can call dismiss to dismiss the modal. My first attempt looks like below 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import SwiftUIimport UIKitpublic struct ImagePicker: UIViewControllerRepresentable &#123; @Environment(\\.presentationMode) private var presentationMode @Binding var image: UIImage? public func makeCoordinator() -&gt; ImagePicker.Coordinator &#123; return ImagePicker.Coordinator( presentationMode: presentationMode, image: $image ) &#125; public func makeUIViewController(context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;) -&gt; UIImagePickerController &#123; let controller = UIImagePickerController() controller.delegate = context.coordinator return controller &#125; public func updateUIViewController(_ uiViewController: UIImagePickerController, context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;) &#123; // No op &#125;&#125;public extension ImagePicker &#123; class Coordinator: NSObject, UINavigationControllerDelegate &#123; @Binding var presentationMode: PresentationMode @Binding var image: UIImage? public init(presentationMode: Binding&lt;PresentationMode&gt;, image: Binding&lt;UIImage?&gt;) &#123; self._presentationMode = presentationMode self._image = image &#125; &#125;&#125;extension ImagePicker.Coordinator: UIImagePickerControllerDelegate &#123; public func imagePickerController( _ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey: Any]) &#123; self.image = info[UIImagePickerController.InfoKey.originalImage] as? UIImage presentationMode.dismiss() &#125; public func imagePickerControllerDidCancel(_ picker: UIImagePickerController) &#123; presentationMode.dismiss() &#125;&#125; SignaturesWe need to be aware of the types of these property wrappers Where we declare environment, presentationMode is of type Binding&lt;PresentationMode&gt; 1@Environment(\\.presentationMode) private var presentationMode Given a Binding declaration, for example @Binding var image: UIImage?, image is of type UIImage? but $image is Binding&lt;UIImage?&gt; 123456public func makeCoordinator() -&gt; ImagePicker.Coordinator &#123; return ImagePicker.Coordinator( image: $image, isPresented: $isPresented )&#125; When we want to assign to variables in init, we use _image to use mutable Binding&lt;UIImage?&gt; because self.$image gives us immutable Binding&lt;UIImage?&gt; 123456789class Coordinator: NSObject, UINavigationControllerDelegate &#123; @Binding var presentationMode: PresentationMode @Binding var image: UIImage? public init(presentationMode: Binding&lt;PresentationMode&gt;, image: Binding&lt;UIImage?&gt;) &#123; self._presentationMode = presentationMode self._image = image &#125;&#125; How to useTo show modal, we use sheet and use a state @State var showImagePicker: Bool = false to control its presentation 12345678Button(action: &#123; self.showImagePicker.toggle()&#125;, label: &#123; Text(\"Choose image\")&#125;).sheet(isPresented: $showImagePicker, content: &#123; ImagePicker(image: self.$image)&#125;) Environment outside bodyIf we run the above code, it will crash because of we access environment value presentationMode in makeCoordinator and this is outside body Fatal error: Reading Environment&lt;Binding&gt; outside View.body 123456public func makeCoordinator() -&gt; ImagePicker.Coordinator &#123; return ImagePicker.Coordinator( presentationMode: presentationMode, image: $image )&#125; Second attempt, pass closureSo instead of passing environment presentationMode, we can pass closure, just like in React where we pass functions to child component. So ImagePicker can just accept a closure called onDone, and the component that uses it can do the dismissal. 12345678910Button(action: &#123; self.showImagePicker.toggle()&#125;, label: &#123; Text(\"Choose image\")&#125;).sheet(isPresented: $showImagePicker, content: &#123; ImagePicker(image: self.$image, onDone: &#123; self.presentationMode.wrappedValue.dismiss() &#125;)&#125;) Unfortunately, although the onDone gets called, the modal is not dismissed. Use Binding instead of EnvironmentMaybe there are betters way, but we can use Binding to replace usage of Environment. We can do that by accepting Binding and change the isPresented state 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import SwiftUIimport UIKitpublic struct ImagePicker: UIViewControllerRepresentable &#123; @Binding var image: UIImage? @Binding var isPresented: Bool public func makeCoordinator() -&gt; ImagePicker.Coordinator &#123; return ImagePicker.Coordinator( image: $image, isPresented: $isPresented ) &#125; public func makeUIViewController(context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;) -&gt; UIImagePickerController &#123; let controller = UIImagePickerController() controller.delegate = context.coordinator return controller &#125; public func updateUIViewController(_ uiViewController: UIImagePickerController, context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;) &#123; // No op &#125;&#125;public extension ImagePicker &#123; class Coordinator: NSObject, UINavigationControllerDelegate &#123; @Binding var isPresented: Bool @Binding var image: UIImage? public init(image: Binding&lt;UIImage?&gt;, isPresented: Binding&lt;Bool&gt;) &#123; self._image = image self._isPresented = isPresented &#125; &#125;&#125;extension ImagePicker.Coordinator: UIImagePickerControllerDelegate &#123; public func imagePickerController( _ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey: Any]) &#123; self.image = info[UIImagePickerController.InfoKey.originalImage] as? UIImage isPresented = false &#125; public func imagePickerControllerDidCancel(_ picker: UIImagePickerController) &#123; isPresented = false &#125;&#125; How to use it 12345678Button(action: &#123; self.showImagePicker.toggle()&#125;, label: &#123; Text(\"Choose image\")&#125;).sheet(isPresented: $showImagePicker, content: &#123; ImagePicker(image: self.$image, isPresented: self.$showImagePicker)&#125;)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to add monkey test to iOS apps","slug":"How-to-add-monkey-test-to-iOS-apps","date":"2019-11-01T08:48:43.000Z","updated":"2019-11-01T09:13:08.000Z","comments":true,"path":"blog/How-to-add-monkey-test-to-iOS-apps/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-monkey-test-to-iOS-apps/","excerpt":"","text":"Issue #484 Use SwiftMonkey which adds random UITests gestures Add to UITests target 1234target 'MyAppUITests' do pod 'R.swift', '~&gt; 5.0' pod 'SwiftMonkey', '~&gt; 2.1.0'end TroubleshootingFailed to determine hittability of Button Failed to determine hittability of Button: Unable to fetch parameterized attribute XC_kAXXCParameterizedAttributeConvertHostedViewPositionFromContext, remote interface does not have this capability. This happens when using SwiftMonkey and somewhere in our code uses isHittable, so best to avoid that by having isolated monkey test only 12345678910111213141516171819import XCTestimport SwiftMonkeyclass MonkeyTests: XCTestCase &#123; var app: XCUIApplication! override func setUp() &#123; continueAfterFailure = false app = XCUIApplication() app.launch() &#125; func testMonkey() &#123; let monkey = Monkey(frame: app.frame) monkey.addDefaultUIAutomationActions() monkey.addXCTestTapAlertAction(interval: 100, application: app) monkey.monkeyAround() &#125;&#125; Another workaround is possibly use addDefaultXCTestPublicActions other than addDefaultUIAutomationActions UI Test Activity: Assertion Failure: MonkeyXCTest.swift:33: Failed to get matching snapshots: Timed out while evaluating UI query. This seems related to SwiftMonkey trying to snapshot. Workaround is to remove 1monkey.addXCTestTapAlertAction(interval: 100, application: app)","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"testing","slug":"testing","permalink":"https://onmyway133.github.io/tags/testing/"}]},{"title":"How to use array of strings in ForEach in SwiftUI","slug":"How-to-use-array-of-strings-in-ForEach-in-SwiftUI","date":"2019-10-31T11:15:42.000Z","updated":"2019-10-31T11:15:54.000Z","comments":true,"path":"blog/How-to-use-array-of-strings-in-ForEach-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-array-of-strings-in-ForEach-in-SwiftUI/","excerpt":"","text":"Issue #483 Every item in list must be uniquely identifiable 123456789101112List &#123; ForEach(books, id: \\.bookId) &#123; book in NavigationLink(destination: BookView(book: book) .navigationBarTitle(book.name) ) &#123; VStack &#123; Text(book.name) &#125; &#125; &#125;&#125; In case of primitive, we can just provide id to conform to Identifiable 12345extension String: Identifiable &#123; public var id: String &#123; return self &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to make multiline Text in SwiftUI in watchOS","slug":"How-to-make-multiline-Text-in-SwiftUI-in-watchOS","date":"2019-10-31T10:24:54.000Z","updated":"2019-10-31T10:24:54.000Z","comments":true,"path":"blog/How-to-make-multiline-Text-in-SwiftUI-in-watchOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-multiline-Text-in-SwiftUI-in-watchOS/","excerpt":"","text":"Issue #482 lineLimit does not seem to work, use fixedSize instead Fixes this view at its ideal size. A view that fixes this view at its ideal size in the dimensions given in fixedDimensions. 123456789extension Text &#123; func styleText() -&gt; some View &#123; return self .font(.footnote) .foregroundColor(.gray) .lineLimit(10) .fixedSize(horizontal: false, vertical: true) &#125;&#125;","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to show documentations for GitHub projects","slug":"How-to-show-documentations-for-GitHub-projects","date":"2019-10-31T08:51:02.000Z","updated":"2019-10-31T08:51:30.000Z","comments":true,"path":"blog/How-to-show-documentations-for-GitHub-projects/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-documentations-for-GitHub-projects/","excerpt":"","text":"Issue #481 Use jazzy to generate documentation which the generated artifacts in docs folder GitHub has a nifty feature to use docs as GitHub pages","categories":[],"tags":[{"name":"github","slug":"github","permalink":"https://onmyway133.github.io/tags/github/"}]},{"title":"How to use CommonCrypto in iOS","slug":"How-to-use-CommonCrypto-in-iOS","date":"2019-10-29T13:08:00.000Z","updated":"2019-10-29T13:08:41.000Z","comments":true,"path":"blog/How-to-use-CommonCrypto-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-CommonCrypto-in-iOS/","excerpt":"","text":"Issue #480 Use modulemapmodulemap approachI use modulemap in my wrapper around CommonCrypto https://github.com/onmyway133/arcane, https://github.com/onmyway133/Reindeer For those getting header not found, please take a look https://github.com/onmyway133/Arcane/issues/4 or run xcode-select --install Make a folder CCommonCrypto containing module.modulemap module CCommonCrypto { header &quot;/usr/include/CommonCrypto/CommonCrypto.h&quot; export * } Go to Built Settings -&gt; Import Paths ${SRCROOT}/Sources/CCommonCryptoCocoapods with modulemap approach Here is the podspec https://github.com/onmyway133/Arcane/blob/master/Arcane.podspec s.source_files = &apos;Sources/**/*.swift&apos; s.xcconfig = { &apos;SWIFT_INCLUDE_PATHS&apos; =&gt; &apos;$(PODS_ROOT)/CommonCryptoSwift/Sources/CCommonCrypto&apos; } s.preserve_paths = &apos;Sources/CCommonCrypto/module.modulemap&apos; Using module_map does not work, see https://github.com/CocoaPods/CocoaPods/issues/5271 Using Local Development Pod with path does not work, see https://github.com/CocoaPods/CocoaPods/issues/809 That‚Äôs why you see that my Example Podfile https://github.com/onmyway133/CommonCrypto.swift/blob/master/Example/CommonCryptoSwiftDemo/Podfile points to the git repo target &apos;CommonCryptoSwiftDemo&apos; do pod &apos;CommonCryptoSwift&apos;, :git =&gt; &apos;https://github.com/onmyway133/CommonCrypto.swift&apos; end public header approach Ji is a wrapper around libxml2, and it uses public header approach It has a header file https://github.com/honghaoz/Ji/blob/master/Source/Ji.h with Target Membership set to Public It has a list of header files for libxml2 https://github.com/honghaoz/Ji/tree/master/Source/Ji-libxml It has Build Settings -&gt; Header Search Paths $(SDKROOT)/usr/include/libxml2 It has Build Settings -&gt; Other Linker Flags -lxml2 Cocoapods with public header approach Take a look at the podspec https://github.com/honghaoz/Ji/blob/master/Ji.podspec 12s.libraries = &quot;xml2&quot;s.xcconfig = &#123; &apos;HEADER_SEARCH_PATHS&apos; =&gt; &apos;$(SDKROOT)/usr/include/libxml2&apos;, &apos;OTHER_LDFLAGS&apos; =&gt; &apos;-lxml2&apos; &#125; üêù Interesting related posts https://stackoverflow.com/questions/24004732/how-to-call-c-from-swift https://spin.atomicobject.com/2015/02/23/c-libraries-swift/ CommonCrypto from Xcode 10From Xcode 10, we can just 1import CommonCrypto Code https://github.com/onmyway133/Arcane https://stackoverflow.com/questions/25248598/importing-commoncrypto-in-a-swift-framework/37125785#37125785","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make ISO 8601 date in Swift","slug":"How-to-make-ISO-8601-date-in-Swift","date":"2019-10-29T13:01:10.000Z","updated":"2019-10-29T13:05:32.000Z","comments":true,"path":"blog/How-to-make-ISO-8601-date-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-ISO-8601-date-in-Swift/","excerpt":"","text":"Issue #479 From ISO8601 spec, the problems are the representation and time zone 1234567ISO 8601 = year-month-day time timezoneFor date and time, there are basic (YYYYMMDD, hhmmss, ...) and extended format (YYYY-MM-DD, hh:mm:ss, ...)Time zone can be Zulu, offset or GMTSeparator for date and time can be space, or TThere are week format for date, but it is rarely usedTimezone can be a lot of spaces afterSecond is optional Here are some valid strings 123452016-04-08T10:25:30Z2016-04-08 11:25:30+01002016-04-08 202530GMT+100020160408 08:25:30-02:002016-04-08 11:25:30 +0100 SolutionsUse NSDateFormatter and normalize the date string. 12345678910111213141516171819202122232425public var stringToDateFormatter: DateFormatter = &#123; let formatter = Foundation.DateFormatter() formatter.locale = Locale(identifier: \"en_US_POSIX\") formatter.dateFormat = \"yyyyMMdd HHmmssZ\" return formatter&#125;()public func date(string: String) -&gt; Date? &#123; var basicString = string if let regex = try? NSRegularExpression(pattern: \"[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;\", options: []), let result = regex.firstMatch(in: string, options: .anchored, range: NSMakeRange(0, string.characters.count)) &#123; basicString = (basicString as NSString).replacingOccurrences(of: \"-\", with: \"\", options: [], range: result.range) &#125; basicString = basicString .replacingOccurrences(of: \":\", with: \"\") .replacingOccurrences(of: \"GMT\", with: \"\") .replacingOccurrences(of: \"T\", with: \" \") .replacingOccurrences(of: \",\", with: \".\") return stringToDateFormatter.date(from: basicString) ?? stringToDateMillisecondsFormatter.date(from: basicString)&#125; So here is the format that I‚Äôm using in my ISO8601 123let formatter = NSDateFormatter()formatter.locale = NSLocale(localeIdentifier: \"en_US_POSIX\")formatter.dateFormat = \"yyyyMMdd HHmmssZ\" About the Z identifier Date Field Symbol Table Z: The ISO8601 basic format with hours, minutes and optional seconds fields. The format is equivalent to RFC 822 zone format (when optional seconds field is absent) About locale Formatting Data Using the Locale Settings Locales represent the formatting choices for a particular user, not the user‚Äôs preferred language. These are often the same but can be different. For example, a native English speaker who lives in Germany might select English as the language and Germany as the region About en_US_POSIX Technical Q&amp;A QA1480 NSDateFormatter and Internet Dates On the other hand, if you‚Äôre working with fixed-format dates, you should first set the locale of the date formatter to something appropriate for your fixed format. In most cases the best locale to choose is ‚Äúen_US_POSIX‚Äù, a locale that‚Äôs specifically designed to yield US English results regardless of both user and system preferences. ‚Äúen_US_POSIX‚Äù is also invariant in time (if the US, at some point in the future, changes the way it formats dates, ‚Äúen_US‚Äù will change to reflect the new behaviour, but ‚Äúen_US_POSIX‚Äù will not), and between machines (‚Äúen_US_POSIX‚Äù works the same on iOS as it does on OS X, and as it it does on other platforms). NSISO8601DateFormatter from iOS 10From iOS 10, we can use NSISO8601DateFormatter The NSISO8601DateFormatter class generates and parses string representations of dates following the ISO 8601 standard. Use this class to create ISO 8601 representations of dates and create dates from text strings in ISO 8601 format. Code https://github.com/onmyway133/ISO8601 https://stackoverflow.com/questions/16254575/how-do-i-get-an-iso-8601-date-on-ios/37082414#37082414","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to configure test target in Xcode","slug":"How-to-configure-test-target-in-Xcode","date":"2019-10-29T12:57:33.000Z","updated":"2019-10-29T12:57:52.000Z","comments":true,"path":"blog/How-to-configure-test-target-in-Xcode/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-configure-test-target-in-Xcode/","excerpt":"","text":"Issue #478 This applies to Main targets App Framework Test targets Unit tests UI tests ExamplesDependencies used Main target: Sugar Test target: Nimble, Quick Examples Cocoapods Carthage Notes Make sure test target can link to all the frameworks it needs. This includes frameworks that Test targets use, and possibly frameworks that Main target uses ! Remember to ‚ÄúClean Build Folder‚Äù and ‚ÄúClear Derived Data‚Äù so that you‚Äôre sure it works. Sometimes Xcode caches. ErrorsErrors occur mostly due to linker error Test target X encountered an error (Early unexpected exit, operation never finished bootstrapping - no restart will be attempted Framework not found Cocoapods1. PodTest targets need to include pods that Main target uses ! or we‚Äôll get ‚ÄúFramework not found‚Äù 12345678910111213141516171819202122def app_pods pod 'Sugar', '~&gt; 1.0'enddef test_pods pod 'Nimble', '~&gt; 3.2' pod 'Quick', '~&gt; 0.9'endtarget 'TeaApp' do app_podsendtarget 'TeaAppTests' do app_pods test_podsendtarget 'TeaAppUITests' do app_pods test_podsend 2. Link Binaries with LibraryCocoapods builds a framework that contains all the frameworks the Test targets need, and configure it for us 3. Runpath Search Paths Go to Test target Build Settings Add $(FRAMEWORK_SEARCH_PATHS) Carthage1. CartfileWe usually have Cartfile for Main target 1github \"hyperoslo/Sugar\" ~&gt; 1.0 Cartfile.private for Test target 12github \"Quick/Nimble\"github \"Quick/Quick\" 2. Link Binaries with Libraries Go to Test target build phase Drag built frameworks from Carthage/Build In rare case, we need to drag frameworks that the Main target uses In rare case, we need to drag the Main target framework 3. Framework Search PathsConfigure correct path Go to Test target Built Settings Configure Framework Search Paths 4. Runpath Search Paths Go to Test target Build Settings Add $(FRAMEWORK_SEARCH_PATHS) 5. Copy Files (maybe)From Adding frameworks to unit tests or a framework In rare cases, you may want to also copy each dependency into the build product (e.g., to embed dependencies within the outer framework, or make sure dependencies are present in a test bundle). To do this, create a new ‚ÄúCopy Files‚Äù build phase with the ‚ÄúFrameworks‚Äù destination, then add the framework reference there as well. Runpath Search Paths and Install nameQuestion Why preconfigured run path ‚Äú@executable_path/Frameworks‚Äù and ‚Äú@loader_path/Frameworks‚Äù not work? Why configuring runpath to ‚Äú$(FRAMEWORK_SEARCH_PATHS)‚Äù works ? Why framework has install name ‚Äú@rpath/Sugar.framework/Sugar‚Äù ? Reference Run-Path Dependent Libraries Linking and Install Names Code https://github.com/onmyway133/TestTarget https://stackoverflow.com/questions/34990175/test-target-x-encountered-an-error-early-unexpected-exit-operation-never-finis/36343395#36343395","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"testing","slug":"testing","permalink":"https://onmyway133.github.io/tags/testing/"},{"name":"xcode","slug":"xcode","permalink":"https://onmyway133.github.io/tags/xcode/"}]},{"title":"How to check platform versions in Swift","slug":"How-to-check-platform-versions-in-Swift","date":"2019-10-29T11:23:07.000Z","updated":"2019-10-31T09:03:08.000Z","comments":true,"path":"blog/How-to-check-platform-versions-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-check-platform-versions-in-Swift/","excerpt":"","text":"Issue #477 Mark APIs availability1234@available(iOS 13.0, OSX 10.15, tvOS 13.0, watchOS 6.0, *)public extension View &#123;&#125; Check platform12345#if canImport(UIKit)import UIKit#elseif canImport(OSX)import AppKit#endif In watchOS app, it still can import UIKit, so for only iOS usage, we need to use os check 1#if canImport(UIKit) &amp;&amp; os(iOS)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use react-native link and CocoaPods","slug":"How-to-use-react-native-link-and-CocoaPods","date":"2019-10-29T08:20:23.000Z","updated":"2019-10-29T08:21:12.000Z","comments":true,"path":"blog/How-to-use-react-native-link-and-CocoaPods/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-react-native-link-and-CocoaPods/","excerpt":"","text":"Issue #476 React Native comes with a default React library, and most CocoaPods libraries for React Native has React as a dependency pod, which causes the conflict https://github.com/react-native-community/react-native-svg/issues/621 https://stackoverflow.com/questions/45296994/difference-between-react-native-link-and-cocoapods https://github.com/onmyway133/notes/issues/486 https://github.com/facebook/react-native/pull/23563","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"},{"name":"cocoapods","slug":"cocoapods","permalink":"https://onmyway133.github.io/tags/cocoapods/"}]},{"title":"How to flick using UIKit Dynamic in iOS","slug":"How-to-flick-using-UIKit-Dynamic-in-iOS","date":"2019-10-23T11:28:26.000Z","updated":"2019-10-23T11:28:26.000Z","comments":true,"path":"blog/How-to-flick-using-UIKit-Dynamic-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-flick-using-UIKit-Dynamic-in-iOS/","excerpt":"","text":"Issue #475 For a snack bar or image viewing, it‚Äôs handy to be able to just flick or toss to dismiss We can use UIKit Dynamic, which was introduced in iOS 7, to make this happen. Use UIPanGestureRecognizer to drag view around, UISnapBehavior to make view snap back to center if velocity is low, and UIPushBehavior to throw view in the direction of the gesture. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273import UIKitfinal class FlickHandler &#123; private let viewToMove: UIView private let referenceView: UIView private var panGR: UIPanGestureRecognizer! private let animator: UIDynamicAnimator private var snapBehavior: UISnapBehavior? private var pushBehavior: UIPushBehavior? private let debouncer = Debouncer(delay: 0.5) var onFlick: () -&gt; Void = &#123;&#125; init(viewToMove: UIView, referenceView: UIView) &#123; self.viewToMove = viewToMove self.referenceView = referenceView self.animator = UIDynamicAnimator(referenceView: referenceView) self.panGR = UIPanGestureRecognizer(target: self, action: #selector(handleGesture(_:))) viewToMove.addGestureRecognizer(panGR) &#125; @objc private func handleGesture(_ gr: UIPanGestureRecognizer) &#123; switch gr.state &#123; case .began: handleBegin() case .changed: handleChange(gr) default: handleEnd(gr) &#125; &#125; private func handleBegin() &#123; animator.removeAllBehaviors() &#125; private func handleChange(_ gr: UIPanGestureRecognizer) &#123; let translation = panGR.translation(in: referenceView) viewToMove.transform = CGAffineTransform( translationX: translation.x, y: translation.y ) &#125; private func handleEnd(_ gr: UIPanGestureRecognizer) &#123; let velocity = gr.velocity(in: gr.view) let magnitude = sqrt((velocity.x * velocity.x) + (velocity.y * velocity.y)) if magnitude &gt; 1000 &#123; animator.removeAllBehaviors() let pushBehavior = UIPushBehavior(items: [viewToMove], mode: .instantaneous) pushBehavior.pushDirection = CGVector(dx: velocity.x, dy: velocity.y) pushBehavior.magnitude = magnitude / 35 self.pushBehavior = pushBehavior animator.addBehavior(pushBehavior) onFlick() debouncer.run &#123; [weak self] in self?.animator.removeAllBehaviors() &#125; &#125; else &#123; let snapBehavior = UISnapBehavior( item: viewToMove, snapTo: viewToMove.center ) self.snapBehavior = snapBehavior animator.addBehavior(snapBehavior) &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use Swift package manager in watchOS","slug":"How-to-use-Swift-package-manager-in-watchOS","date":"2019-10-23T07:00:11.000Z","updated":"2019-10-23T07:21:50.000Z","comments":true,"path":"blog/How-to-use-Swift-package-manager-in-watchOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Swift-package-manager-in-watchOS/","excerpt":"","text":"Issue #474 SPMGo to Project -&gt; Swift Packages, add package. For example https://github.com/onmyway133/EasyStash Select your WatchKit Extension target, under Frameworks, Libraries and Embedded Content add the library CocoaPodsIf we use CocoaPods, then it needs to be in WatchKit Extension 1234target 'MyApp WatchKit Extension' do use_frameworks! pod 'EasyStash', :git =&gt; 'https://github.com/onmyway133/EasyStash'end","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"}]},{"title":"How to use external display in iOS","slug":"How-to-use-external-display-in-iOS","date":"2019-10-22T18:25:18.000Z","updated":"2019-10-22T18:26:46.000Z","comments":true,"path":"blog/How-to-use-external-display-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-external-display-in-iOS/","excerpt":"","text":"Issue #473 Before iOS 13Use UIScreen.didConnectNotification 12345678910111213141516NotificationCenter.default.addObserver(forName: UIScreen.didConnectNotification, object: nil, queue: nil) &#123; (notification) in // Get the new screen information. let newScreen = notification.object as! UIScreen let screenDimensions = newScreen.bounds // Configure a window for the screen. let newWindow = UIWindow(frame: screenDimensions) newWindow.screen = newScreen // Install a custom root view controller in the window. self.configureAuxilliaryInterface(with: newWindow) // You must show the window explicitly. newWindow.isHidden = false // Save a reference to the window in a local array. self.additionalWindows.append(newWindow)&#125; From iOS 13Handle configurationForConnecting 123456789101112131415161718192021222324252627282930@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123;var newWindow: UIWindow! // MARK: UISceneSession Lifecycle func application(_ application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions) -&gt; UISceneConfiguration &#123; // Called when a new scene session is being created. // Use this method to select a configuration to create the new scene with. print(UIApplication.shared.connectedScenes) let scene = UIWindowScene(session: connectingSceneSession, connectionOptions: options) // Configure a window for the screen. self.newWindow = UIWindow(frame: CGRect(x: 0, y: 0, width: 1000, height: 500)) // self.newWindow.backgroundColor = UIColor.yellow // Install a custom root view controller in the window. let viewController = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(identifier: \"other\") as! OtherViewController self.newWindow.rootViewController = viewController self.newWindow.windowScene = scene // You must show the window explicitly. self.newWindow.isHidden = false return UISceneConfiguration(name: \"External configuration\", sessionRole: connectingSceneSession.role) &#125;&#125; Or we can declare in plist 1234567891011121314151617181920212223242526272829&lt;dict&gt; &lt;key&gt;UIApplicationSupportsMultipleScenes&lt;/key&gt; &lt;false/&gt; &lt;key&gt;UISceneConfigurations&lt;/key&gt; &lt;dict&gt; &lt;key&gt;UIWindowSceneSessionRoleApplication&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;UISceneConfigurationName&lt;/key&gt; &lt;string&gt;Default Configuration&lt;/string&gt; &lt;key&gt;UISceneDelegateClassName&lt;/key&gt; &lt;string&gt;$(PRODUCT_MODULE_NAME).SceneDelegate&lt;/string&gt; &lt;key&gt;UISceneStoryboardFile&lt;/key&gt; &lt;string&gt;Main&lt;/string&gt; &lt;/dict&gt; &lt;/array&gt; &lt;key&gt;UIWindowSceneSessionRoleExternalDisplay&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;UISceneConfigurationName&lt;/key&gt; &lt;string&gt;External configuration&lt;/string&gt; &lt;key&gt;UISceneDelegateClassName&lt;/key&gt; &lt;string&gt;$(PRODUCT_MODULE_NAME).OtherSceneDelegate&lt;/string&gt; &lt;key&gt;UISceneStoryboardFile&lt;/key&gt; &lt;string&gt;Other&lt;/string&gt; &lt;/dict&gt; &lt;/array&gt; &lt;/dict&gt;&lt;/dict&gt; Read more External Display Support on iOS Supporting External Displays Building iPad Pro features in Swift How can I display different content on different screens in iOS 13? Displaying Content on a Connected Screen Adding External Display Support To Your iOS App Is Ridiculously Easy","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to show error message like Snack Bar in iOS","slug":"How-to-show-error-message-like-Snack-Bar-in-iOS","date":"2019-10-21T08:55:27.000Z","updated":"2019-10-23T11:53:15.000Z","comments":true,"path":"blog/How-to-show-error-message-like-Snack-Bar-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-error-message-like-Snack-Bar-in-iOS/","excerpt":"","text":"Issue #472 Build error viewUse convenient code from Omnia To make view height dynamic, pin UILabel to edges and center 12345678910111213141516171819202122232425262728293031323334353637383940414243import UIKitfinal class ErrorMessageView: UIView &#123; let box: UIView = &#123; let view = UIView() view.backgroundColor = R.color.primary view.layer.cornerRadius = 6 return view &#125;() let label: UILabel = &#123; let label = UILabel() label.styleAsText() label.textColor = R.color.darkText label.numberOfLines = 0 return label &#125;() override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; addSubviews([box, label]) NSLayoutConstraint.on([ box.pinEdges(view: self, inset: UIEdgeInsets.all(16)), label.pinEdges(view: box, inset: UIEdgeInsets.all(8)) ]) NSLayoutConstraint.on([ box.heightAnchor.constraint(greaterThanOrEqualToConstant: 48) ]) NSLayoutConstraint.on([ label.centerYAnchor.constraint(equalTo: centerYAnchor) ]) &#125;&#125; Show and hideUse Auto Layout and basic UIView animation. Use debouncer to avoid hide gets called for the new show. Use debouncer instead of DispatchQueue.main.asyncAfter because it can cancel the previous DispatchWorkItem 12345678910111213141516171819202122232425262728293031323334353637383940414243import UIKitfinal class ErrorMessageHandler &#123; let view: UIView let errorMessageView = ErrorMessageView() let debouncer = Debouncer(delay: 0.5) init(view: UIView) &#123; self.view = view &#125; func show(text: String) &#123; self.errorMessageView.label.text = text view.addSubview(errorMessageView) NSLayoutConstraint.on([ errorMessageView.leftAnchor.constraint(equalTo: view.leftAnchor), errorMessageView.rightAnchor.constraint(equalTo: view.rightAnchor), errorMessageView.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor) ]) toggle(shows: true) debouncer.run &#123; self.hide() &#125; &#125; func hide() &#123; toggle(shows: false) &#125; private func toggle(shows: Bool) &#123; self.errorMessageView.alpha = shows ? 0 : 1.0 UIView.animate(withDuration: 0.25, animations: &#123; self.errorMessageView.alpha = shows ? 1.0 : 0 &#125;, completion: &#123; _ in if shows &#123; self.view.bringSubviewToFront(self.errorMessageView) &#125; else &#123; self.errorMessageView.removeFromSuperview() &#125; &#125;) &#125;&#125; Handle keyboardIf we add this error message on UIView in ViewController and we use KeyboardHandler to scroll the entire view, then this snack bar will move up as well 12345678910final class ErrorMessageHandler &#123; private let errorMessageView = ErrorMessageView() private var view = UIView() private var bottomOffset: CGFloat = 0 func on(view: UIView, bottomOffset: CGFloat) &#123; self.view = view self.bottomOffset = bottomOffset &#125;&#125; UIView animation completionOne tricky thing is that if we call hide and then show immediately, the completion of hide will be called after and then remove the view. When we start animation again, the previous animation is not finished, so we need to check Read UIView.animate completionA block object to be executed when the animation sequence ends. This block has no return value and takes a single Boolean argument that indicates whether or not the animations actually finished before the completion handler was called. If the duration of the animation is 0, this block is performed at the beginning of the next run loop cycle. This parameter may be NULL. 1234567891011121314private func toggle(shows: Bool) &#123; self.errorMessageView.alpha = shows ? 0 : 1.0 UIView.animate(withDuration: 0.25, delay: 0, options: .curveEaseInOut, animations: &#123; self.errorMessageView.alpha = shows ? 1.0 : 0 &#125;, completion: &#123; finished in if shows &#123; self.view.bringSubviewToFront(self.errorMessageView) &#125; else if finished &#123; self.errorMessageView.removeFromSuperview() &#125; else &#123; // No op &#125; &#125;)&#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to hide tab bar when push in iOS","slug":"How-to-hide-tab-bar-when-push-in-iOS","date":"2019-10-18T11:26:07.000Z","updated":"2019-10-18T11:26:23.000Z","comments":true,"path":"blog/How-to-hide-tab-bar-when-push-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-hide-tab-bar-when-push-in-iOS/","excerpt":"","text":"Issue #471 12let navigationController = UINavigationController(rootViewController: viewControllerA)navigationController.pushViewController(viewControllerB, animated: true) In view controller B, need to set hidesBottomBarWhenPushed in init 1234567891011121314final class ViewControllerB: UIViewController &#123; let mainView = EditPaymentMethodView() var scenario: PaymentMethodScenario! init() &#123; super.init(nibName: nil, bundle: nil) hidesBottomBarWhenPushed = true &#125; required init?(coder: NSCoder) &#123; fatalError() &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to add trailing image to UILabel in iOS","slug":"How-to-add-trailing-image-to-UILabel-in-iOS","date":"2019-10-17T12:05:36.000Z","updated":"2019-10-17T12:05:43.000Z","comments":true,"path":"blog/How-to-add-trailing-image-to-UILabel-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-trailing-image-to-UILabel-in-iOS/","excerpt":"","text":"Issue #470 Use NSTextAttachment inside NSAttributedString 123456789101112extension UILabel &#123; func addTrailing(image: UIImage) &#123; let attachment = NSTextAttachment() attachment.image = image let attachmentString = NSAttributedString(attachment: attachment) let string = NSMutableAttributedString(string: self.text!, attributes: [:]) string.append(attachmentString) self.attributedText = string &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to handle different states in a screen in iOS","slug":"How-to-handle-different-states-in-a-screen-in-iOS","date":"2019-10-17T09:13:07.000Z","updated":"2019-10-17T09:18:39.000Z","comments":true,"path":"blog/How-to-handle-different-states-in-a-screen-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-different-states-in-a-screen-in-iOS/","excerpt":"","text":"Issue #469 If there are lots of logics and states inside a screen, it is best to introduce parent and child container, and switch child depends on state. Each child acts as a State handler. In less logic case, we can introduce a Scenario class that holds the state. So the ViewController can be very slim. The thing with State is that all possible scenarios are clear and required to be handled 1234567891011121314151617181920212223242526272829final class UserDetailScenario &#123; enum State &#123; case unknown case getUser(Email) case newUser(Email) case existingUser(User) case failure(Error) &#125; var state: State = .unknown(nil) &#123; didSet &#123; self.reload() &#125; &#125; private func reload() &#123; switch state &#123; case .unknown: handleUnknown() case .getUser(let email): handleGetUser(email: email) case .newUser(let email): handleNewUser(email: email) case .existingUser(let user): handleExistingUser(user: user case .failure(let error): logError(error) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to reload data without using onAppear in SwiftUI in watchOS","slug":"How-to-reload-data-without-using-onAppear-in-SwiftUI-in-watchOS","date":"2019-10-17T07:01:27.000Z","updated":"2019-10-17T07:02:53.000Z","comments":true,"path":"blog/How-to-reload-data-without-using-onAppear-in-SwiftUI-in-watchOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-reload-data-without-using-onAppear-in-SwiftUI-in-watchOS/","excerpt":"","text":"Issue #468 From onAppeear Adds an action to perform when the view appears. In theory, this should be triggered every time this view appears. But in practice, it is only called when it is pushed on navigation stack, not when we return to it. So if user goes to a bookmark in a bookmark list, unbookmark an item and go back to the bookmark list, onAppear is not called again and the list is not updated. 1234567891011121314151617import SwiftUIstruct BookmarksView: View &#123; let service: Service @State var items: [AnyItem] @EnvironmentObject var storeContainer: StoreContainer var body: some View &#123; List(items) &#123; item in makeItemRow(item: item) .padding([.top, .bottom], 4) &#125; .onAppear(perform: &#123; self.items = storeContainer.bookmarks(service: service).map(&#123; AnyItem(item: $0) &#125;) &#125;) &#125;&#125; So instead of relying on UI state, we should rely on data state, by listening to onReceive and update our local @State 12345678910111213141516171819202122struct BookmarksView: View &#123; let service: Service @State var items: [AnyItem] @EnvironmentObject var storeContainer: StoreContainer var body: some View &#123; List(items) &#123; item in makeItemRow(item: item) .padding([.top, .bottom], 4) &#125; .onAppear(perform: &#123; self.reload() &#125;) .onReceive(storeContainer.objectWillChange, perform: &#123; _ in self.reload() &#125;) &#125; private func reload() &#123; self.items = storeContainer.bookmarks(service: service).map(&#123; AnyItem(item: $0) &#125;) &#125;&#125; Inside our ObservableObject, we need to trigger changes notification 123456789101112131415final class StoreContainer: ObservableObject &#123; let objectWillChange = PassthroughSubject&lt;(), Never&gt;() func bookmark(item: ItemProtocol) &#123; defer &#123; objectWillChange.send(()) &#125; &#125; func unbookmark(item: ItemProtocol) &#123; defer &#123; objectWillChange.send(()) &#125; &#125;&#125;","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to use EnvironmentObject in SwiftUI for watchOS","slug":"How-to-use-EnvironmentObject-in-SwiftUI-for-watchOS","date":"2019-10-17T06:03:56.000Z","updated":"2019-10-17T06:03:56.000Z","comments":true,"path":"blog/How-to-use-EnvironmentObject-in-SwiftUI-for-watchOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-EnvironmentObject-in-SwiftUI-for-watchOS/","excerpt":"","text":"Issue #467 Declare top dependencies in ExtensionDelegate 1234567class ExtensionDelegate: NSObject, WKExtensionDelegate &#123; let storeContainer = StoreContainer() func applicationDidEnterBackground() &#123; storeContainer.save() &#125;&#125; Reference that in HostingController. Note that we need to change from generic MainView to WKHostingController&lt;AnyView&gt; as environmentObject returns View protocol 1234567891011121314class HostingController: WKHostingController&lt;AnyView&gt; &#123; var storeContainer: StoreContainer! override func awake(withContext context: Any?) &#123; super.awake(withContext: context) self.storeContainer = (WKExtension.shared().delegate as! ExtensionDelegate).storeContainer &#125; override var body: AnyView &#123; return AnyView(MainView() .environmentObject(storeContainer) ) &#125;&#125; In theory, the environment object will be propagated down the view hierarchy, but in practice it throws error. So a workaround now is to just pass that environment object down manually Fatal error: No ObservableObject of type SomeType foundA View.environmentObject(_:) for StoreContainer.Type may be missing as an ancestor of this view 12345678910111213141516171819202122232425struct MainView: View &#123; @EnvironmentObject var storeContainer: StoreContainer var body: some View &#123; VStack &#123; List(services.map(&#123; AnyService($0) &#125;)) &#123; anyService in NavigationLink(destination: ItemsView(service: anyService.service) .navigationBarTitle(anyService.service.name) .onDisappear(perform: &#123; anyService.service.requestCancellable?.cancel() &#125;) .environmentObject(storeContainer) ) &#123; HStack &#123; Image(anyService.service.name) .resizable() .frame(width: 30, height: 30, alignment: .leading) Text(anyService.service.name) &#125; &#125; &#125;.listStyle(CarouselListStyle()) &#125; &#125;&#125;","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to structure classes","slug":"How-to-structure-classes","date":"2019-10-16T06:05:05.000Z","updated":"2019-10-16T06:05:12.000Z","comments":true,"path":"blog/How-to-structure-classes/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-structure-classes/","excerpt":"","text":"Issue #466 iOS 1View Controller -&gt; View Model | Logic Handler -&gt; Data Handler -&gt; Repo Android 1Activity -&gt; Fragment -&gt; View Model | Logic Handler -&gt; Data Handler -&gt; Repo","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make generic store for Codable in Swift","slug":"How-to-make-generic-store-for-Codable-in-Swift","date":"2019-10-14T19:41:28.000Z","updated":"2019-10-14T19:57:41.000Z","comments":true,"path":"blog/How-to-make-generic-store-for-Codable-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-generic-store-for-Codable-in-Swift/","excerpt":"","text":"Issue #465 Use EasyStash 123456789101112131415161718192021import EasyStashfinal class Store&lt;T: Codable &amp; ItemProtocol&gt;: Codable &#123; var items = [T]() func bookmark(item: T) &#123; items.append(item) &#125; func unbookmark(item: T) &#123; guard let index = items.firstIndex(where: &#123; $0.itemId == item.itemId &#125;) else &#123; return &#125; items.remove(at: index) &#125; func isBookmark(item: T) -&gt; Bool &#123; return items.contains(where: &#123; $0.itemId == item.itemId &#125;) &#125;&#125; 123456789101112import EasyStashfinal class StoreContainer &#123; var food: Store&lt;Food&gt; static var shared = StoreContainer() let storage = try! Storage(options: Options()) init() &#123; food = try? storage.load(forKey: \"food\", as: Store&lt;Food&gt;.self) ?? Store&lt;Food&gt;() &#125;&#125; If Swift has problem compiling because of generic, use try catch to declare in multiple steps in stead of ?? 1234567init() &#123; do &#123; self.food = try storage.load(forKey: \"food\", as: Store&lt;Food&gt;.self) &#125; catch &#123; self.food = Store&lt;Food&gt;() &#125; &#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to declare escaping in completion in callback in Swift","slug":"How-to-declare-escaping-in-completion-in-callback-in-Swift","date":"2019-10-14T11:57:55.000Z","updated":"2019-10-14T11:58:00.000Z","comments":true,"path":"blog/How-to-declare-escaping-in-completion-in-callback-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-declare-escaping-in-completion-in-callback-in-Swift/","excerpt":"","text":"Issue #464 123typealias Completion = (Result&lt;User, Error&gt;) -&gt; Voidfunc validate(completion: @escaping Completion, then: (String, String, @escaping Completion) -&gt; Void) &#123;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to zoom to fit many coordinates in Google Maps in iOS","slug":"How-to-zoom-to-fit-many-coordinates-in-Google-Maps-in-iOS","date":"2019-10-14T06:49:31.000Z","updated":"2019-10-14T06:49:38.000Z","comments":true,"path":"blog/How-to-zoom-to-fit-many-coordinates-in-Google-Maps-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-zoom-to-fit-many-coordinates-in-Google-Maps-in-iOS/","excerpt":"","text":"Issue #463 12345func zoom(location1: CLLocation, location2: CLLocation) &#123; let bounds = GMSCoordinateBounds(coordinate: location1.coordinate, coordinate: location2.coordinate) let update = GMSCameraUpdate.fit(bounds, withPadding: 16) mapView.animate(with: update)&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use Codable to store preferences in Swift","slug":"How-to-use-Codable-to-store-preferences-in-Swift","date":"2019-10-11T11:22:09.000Z","updated":"2019-10-11T11:25:30.000Z","comments":true,"path":"blog/How-to-use-Codable-to-store-preferences-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Codable-to-store-preferences-in-Swift/","excerpt":"","text":"Issue #462 Using object, we don‚Äôt need to care about nil vs false like in UserDefaults, our object is the source of truth 1234567891011121314151617181920212223class StoringHandler&lt;T: Codable&gt; &#123; private let key: Storage.Keys private let storage = Deps.storage init(key: Storage.Keys) &#123; self.key = key load() &#125; var object: T? &#123; didSet &#123; if let object = object &#123; try? storage.save(object: object, key: key) &#125; else &#123; try? storage.clear(key: key) &#125; &#125; &#125; private func load() &#123; self.object = try? storage.load(key: key, as: T.self) &#125;&#125; Then subclass StoringHandler 12345678910111213141516struct OnboardInfo: Codable &#123; let hasOnboarded: Bool&#125;final class OnboardingHandler: StoringHandler&lt;OnboardInfo&gt; &#123; let storage = Deps.storage var hasOnboarded: Bool &#123; get &#123; return object?.hasOnboarded ?? false &#125; set &#123; object = OnboardInfo(hasOnboarded: newValue) &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to custom UIAlertController in iOS","slug":"How-to-custom-UIAlertController-in-iOS","date":"2019-10-11T11:17:14.000Z","updated":"2019-10-11T11:19:40.000Z","comments":true,"path":"blog/How-to-custom-UIAlertController-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-custom-UIAlertController-in-iOS/","excerpt":"","text":"Issue #461 With UIAlertController we can add buttons and textfields, and just that 12func addAction(UIAlertAction)func addTextField(configurationHandler: ((UITextField) -&gt; Void)?) To add custom content to UIAlertController, there are some workarounds Add content onto UITextFieldRestyle UITextField and add custom content Subclass UIAlertController and handle UI in viewWillAppearBy subclassing we can tweak the whole view hierarchy and listen to events like layout subviews, but this can be very fragile. Make custom UIViewController that looks like UIAlertControllerThis is the correct way but takes too much time to imitate UIAlertController, and have to deal with UIVisualEffectView, resize view for different screen sizes and dark mode Add view to UIAlertController viewWe can detect UILabel to add our custom view below it, using How to find subview recursively in Swift But a less work approach is to add it above buttons, this is easily achieved by offsetting bottom. The trick is here is to have line breaks in message to leave space for our custom view. 1234567891011121314151617181920212223242526let controller = UIAlertController( title: title, message: message + String(repeating: \"\\n\", count: 10), preferredStyle: .alert)let continueAction = UIAlertAction( title: R.string.localizable.continue(), style: .default) &#123; _ in action()&#125;let cancelAction = UIAlertAction(title: R.string.localizable.cancel(), style: .cancel)controller.addAction(cancelAction)controller.addAction(continueAction)let customView = UIView()customView.backgroundColor = UIColor.greencontroller.view.addSubview(customView)NSLayoutConstraint.on([ customView.leftAnchor.constraint(equalTo: controller.view.leftAnchor), customView.rightAnchor.constraint(equalTo: controller.view.rightAnchor), customView.bottomAnchor.constraint(equalTo: controller.view.bottomAnchor, constant: -50), customView.heightAnchor.constraint(equalToConstant: 100)])","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to find subview recursively in Swift","slug":"How-to-find-subview-recursively-in-Swift","date":"2019-10-11T09:06:50.000Z","updated":"2019-10-11T09:14:24.000Z","comments":true,"path":"blog/How-to-find-subview-recursively-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-find-subview-recursively-in-Swift/","excerpt":"","text":"Issue #460 12345678910111213extension UIView &#123; func findRecursively&lt;T: UIView&gt;(type: T.Type, match: (T) -&gt; Bool) -&gt; T? &#123; for view in subviews &#123; if let subview = view as? T, match(subview) &#123; return subview &#125; else &#123; return view.findRecursively(type: type, match: match) &#125; &#125; return nil &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to deal with multiple scenarios with Push Notification in iOS","slug":"How-to-deal-with-multiple-scenarios-with-Push-Notification-in-iOS","date":"2019-10-11T06:54:23.000Z","updated":"2019-10-11T07:18:00.000Z","comments":true,"path":"blog/How-to-deal-with-multiple-scenarios-with-Push-Notification-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-multiple-scenarios-with-Push-Notification-in-iOS/","excerpt":"","text":"Issue #459 Here are my notes when working with Push Notification How to registerRegister to receive push notification registerForRemoteNotificationTypes is deprecated in iOS 8+ 1UIApplication.sharedApplication().registerForRemoteNotifications() Register to alert user through UI If your app displays alerts, play sounds, or badges its icon, you must call this method during your launch cycle to request permission to alert the user in these ways 12345let types: UIUserNotificationType = [.Badge, .Sound, .Alert]let categories = Set&lt;UIUserNotificationCategory&gt;()let settings = UIUserNotificationSettings(forTypes: types, categories: categories)UIApplication.sharedApplication().registerUserNotificationSettings(settings) You don‚Äôt need to wait for registerUserNotificationSettings to callback before calling registerForRemoteNotifications From iOS 10, use UNNotifications framework https://onmyway133.github.io/blog/How-to-register-for-alert-push-notification-in-iOS/ When to registerFrom Registering, Scheduling, and Handling User Notifications Never cache a device token; always get the token from the system whenever you need it. If your app previously registered for remote notifications, calling the registerForRemoteNotifications method again does not incur any additional overhead, and iOS returns the existing device token to your app delegate immediately. In addition, iOS calls your delegate method any time the device token changes, not just in response to your app registering or re-registeringThe user can change the notification settings for your app at any time using the Settings app. Because settings can change, always call the registerUserNotificationSettings: at launch time and use the application:didRegisterUserNotificationSettings: method to get the response. If the user disallows specific notification types, avoid using those types when configuring local and remote notifications for your app. didReceiveRemoteNotification About application:didReceiveRemoteNotification: Implement the application:didReceiveRemoteNotification:fetchCompletionHandler: method instead of this one whenever possible. If your delegate implements both methods, the app object calls the application:didReceiveRemoteNotification:fetchCompletionHandler: method.If the app is not running when a remote notification arrives, the method launches the app and provides the appropriate information in the launch options dictionary. The app does not call this method to handle that remote notification. Instead, your implementation of the application:willFinishLaunchingWithOptions: or application:didFinishLaunchingWithOptions: method needs to get the remote notification payload data and respond appropriately. About application:didReceiveRemoteNotification:fetchCompletionHandler: This is for silent push notification with content-available Unlike the application:didReceiveRemoteNotification: method, which is called only when your app is running in the foreground, the system calls this method when your app is running in the foreground or backgroundIn addition, if you enabled the remote notifications background mode, the system launches your app (or wakes it from the suspended state) and puts it in the background state when a push notification arrives. However, the system does not automatically launch your app if the user has force-quit it. In that situation, the user must relaunch your app or restart the device before the system attempts to launch your app automatically again.If the user opens your app from the system-displayed alert, the system may call this method again when your app is about to enter the foreground so that you can update your user interface and display information pertaining to the notification. How to handleUsually, the use of push notification is to display a specific article, a specific DetailViewControllerin your app. So the good practices are When the app is in foreground: Gently display some kind of alert view and ask the user whether he would like to go to that specific page or not When user is brought from background to foreground, or from terminated to foreground: Just navigate to that specific page. For example, if you use UINavigationController, you can set that specific page the top most ViewController, if you use UITabBarController, you can set that specific page the selected tab, something like that 1234567891011- func handlePushNotification(userInfo: NSDictionary) &#123; // Check applicationState if (applicationState == UIApplicationStateActive) &#123; // Application is running in foreground showAlertForPushNotification(userInfo) &#125; else if (applicationState == UIApplicationStateBackground || applicationState == UIApplicationStateInactive) &#123; // Application is brought from background or launched after terminated handlePushNotification(userInfo) &#125;&#125; Here we create another method handlePushNotification to handle push notification. When you receive push notification, 3 cases can occur Case 1: ForegroundLoud push No system alert application:didReceiveRemoteNotification:fetchCompletionHandler: is called Silent push No system alert application:didReceiveRemoteNotification:fetchCompletionHandler: is called Case 2: BackgroundLoud push System alert No method called Tap notification and application:didReceiveRemoteNotification:fetchCompletionHandler: is called Tap on App Icon and nothing is called Silent push No system alert application:didReceiveRemoteNotification:fetchCompletionHandler: is called. If app is suspended, its state changed to UIApplicationStateBackground Tap notification and application:didReceiveRemoteNotification:fetchCompletionHandler: is called Tap on App Icon and nothing is called Case 3: TerminatedLoud push System alert No method called Tap notification and application:didFinishLaunchingWithOptions: with launchOptions, application:didReceiveRemoteNotification:fetchCompletionHandler: is called Tap on App Icon and application:didFinishLaunchingWithOptions: is called with launchOptions set to nil Silent push No system alert application:didReceiveRemoteNotification:fetchCompletionHandler: is called. If app was not killed by user, it is woke up and state changed to UIApplicationStateInactive. Tap notification and application:didFinishLaunchingWithOptions: with launchOptions, application:didReceiveRemoteNotification:fetchCompletionHandler: is called Tap on App Icon and application:didFinishLaunchingWithOptions: is called with launchOptions set to nil System alertSystem alert only show if the payload contains alert 123456789101112&#123; \"aps\" : &#123; \"alert\" : &#123; \"title\" : \"Game Request\", \"body\" : \"Bob wants to play poker\", \"action-loc-key\" : \"PLAY\" &#125;, \"badge\" : 5 &#125;, \"param1\" : \"bar\", \"param2\" : [ \"bang\", \"whiz\" ]&#125; Silent push payloadFor now I see that silent push must contain sound for application:didReceiveRemoteNotification:fetchCompletionHandler: to be called when app is in background 123456789&#123; ‚Äúaps‚Äù: &#123; ‚Äúcontent-available‚Äù: 1, ‚Äúalert‚Äù: ‚Äúhello‚Äù // include this if we want to show alert ‚Äúsound‚Äù: ‚Äú‚Äù // this does the trick &#125;, ‚Äúparam1‚Äù: 1, ‚Äúparam2‚Äù: ‚Äútext‚Äù&#125; Read Pushing Background Updates to Your App If your app‚Äôs server-based content changes infrequently or at irregular intervals, you can use background notifications to notify your app when new content becomes available. A background notification is a remote notification that doesn‚Äôt display an alert, play a sound, or badge your app‚Äôs icon. It wakes your app in the background and gives it time to initiate downloads from your server and update its content. The system treats background notifications as low-priority: you can use them to refresh your app‚Äôs content, but the system doesn‚Äôt guarantee their delivery. In addition, the system may throttle the delivery of background notifications if the total number becomes excessive. The number of background notifications allowed by the system depends on current conditions, but don‚Äôt try to send more than two or three per hour. How to test Push notificationI built a macOS app called PushNotification for you to test push notification. It works with certificate and the new key authentication with APNS. Please give it a try Tutorials that use PushNotifications https://itnext.io/introductory-push-notifications-fa6f68ace251 https://www.raywenderlich.com/8164-push-notifications-tutorial-getting-started TroubleshootingSilent notification with push notification enabledIn theory, if user disables push notification then silent notification still goes through https://stackoverflow.com/questions/31450403/didreceiveremotenotification-not-working-in-the-background but sound key should be present 123456&#123; aps = &#123; \"content-available\" : 1, sound : \"\" &#125;;&#125; When open the app, didReceiveRemoteNotification is called immediately with the silent push message Where to go from hereI hope you find this article useful. iOS changes fast so some the things I mention may be outdated by the time you read, if so please let me know. Here are some more interesting links Scheduling, Registering, and Handling Notifications Handle push notifications when arrived in iOS application How to respond to push notification view if app is already running in the background didReceiveRemoteNotification when in background How to handle remote notification with background mode enabled Remote notification method called twice Original post https://medium.com/fantageek/push-notification-in-ios-46d979e5f7ec","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use Apple certificate in Xcode 11","slug":"How-to-use-Apple-certificate-in-Xcode-11","date":"2019-10-11T06:04:26.000Z","updated":"2019-10-11T06:10:51.000Z","comments":true,"path":"blog/How-to-use-Apple-certificate-in-Xcode-11/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Apple-certificate-in-Xcode-11/","excerpt":"","text":"Issue #458 For push notification, we can now use just Production Certificate for 2 environments (production and sandbox) instead of Development and Production certificates. Now for code signing, with Xcode 11 https://developer.apple.com/documentation/xcode_release_notes/xcode_11_release_notes we can just use Apple Development and Apple Distribution certificate for multiple platforms Signing and capabilities settings are now combined within a new Signing &amp; Capabilities tab in the Project Editor. The new tab enables using different app capabilities across multiple build configurations. The new capabilities library makes it possible to search for available capabilities Xcode 11 supports the new Apple Development and Apple Distribution certificate types. These certificates support building, running, and distributing apps on any Apple platform. Preexisting iOS and macOS development and distribution certificates continue to work, however, new certificates you create in Xcode 11 use the new types. Previous versions of Xcode don‚Äôt support these certificates","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"xcode","slug":"xcode","permalink":"https://onmyway133.github.io/tags/xcode/"}]},{"title":"How to create watch only watchOS app","slug":"How-to-create-watch-only-watchOS-app","date":"2019-10-10T17:19:20.000Z","updated":"2019-10-10T17:19:25.000Z","comments":true,"path":"blog/How-to-create-watch-only-watchOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-create-watch-only-watchOS-app/","excerpt":"","text":"Issue #457 From Creating Independent watchOS Apps The root target is a stub, and acts as a wrapper for your project, so that you can submit it to the App Store. The other two are identical to the targets found in a traditional watchOS project. They represent your WatchKit app and WatchKit extension, respectively.","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"}]},{"title":"How to use provisional notification in iOS  12","slug":"How-to-use-provisional-notification-in-iOS-12","date":"2019-10-10T11:14:20.000Z","updated":"2019-10-10T11:15:01.000Z","comments":true,"path":"blog/How-to-use-provisional-notification-in-iOS-12/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-provisional-notification-in-iOS-12/","excerpt":"","text":"Issue #456 From WWDC 2018 What‚Äôs New in User Notifications Instead, the notifications from your app will automatically start getting delivered. Notifications that are delivered with provisional authorization will have a prompt like this on the notification itself. And this will help the users decide after having received a few notifications whether they want to keep getting these notifications or whether they want to turn them off It‚Äôs an automatic trial of the notifications from your app to help your users make a more informed decision about whether they want these notifications. 123notificationCenter.requestAuthorization( options:[.badge, .sound, .alert, .provisional]) &#123; &#125; From http://info.localytics.com/blog/ios-12-brings-new-power-to-push-notifications Provisional Authorization takes advantage of another new feature in iOS 12: the ability for messages to be ‚Äúdelivered quietly.‚Äù When a notification is delivered quietly, it can only be seen in the iOS Notification Center, which the user accesses by swiping down from the top of their phone. They don‚Äôt appear as banners or show up on the lock screen. As you might have guessed, quiet notifications also don‚Äôt make a sound. If a user taps the ‚ÄúKeep‚Äù button, they can decide whether they want your app‚Äôs notifications to start getting delivered prominently (i.e. fully opt-in to push notifications) or continue to receive them quietly (i.e. pushes continue to get sent directly to the Notification Center). The intent of Provisional Authorization is to give users a trial run with your app‚Äôs notifications. Apple created Provisional Authorization because it realized that it‚Äôs impossible for users to make an informed choice about whether or not they want to receive push notifications from an app until they‚Äôve seen what kinds of messages the app is going to send them.","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to check if push notification is actually enabled in iOS","slug":"How-to-check-if-push-notification-is-actually-enabled-in-iOS","date":"2019-10-10T10:50:26.000Z","updated":"2019-10-10T10:50:26.000Z","comments":true,"path":"blog/How-to-check-if-push-notification-is-actually-enabled-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-check-if-push-notification-is-actually-enabled-in-iOS/","excerpt":"","text":"Issue #455 There are times we want to log if user can receive push notification. We may be tempted to merely use isRegisteredForRemoteNotifications but that is not enough. From a user ‚Äòs point of view, they can either receive push notification or not. But behind the scene, many factors are in the game. It can be that user has disabled push notification in app settings or in iOS Settings. It can also be that user enables push notification but disables all sound or banner display mechanism. isRegisteredForRemoteNotifications is that your app has connected to APNS and get device token, this can be for silent push notificationcurrentUserNotificationSettings is for user permissions, without this, there is no alert, banner or sound push notification delivered to the appHere is the check 123456789static var isPushNotificationEnabled: Bool &#123; guard let settings = UIApplication.shared.currentUserNotificationSettings else &#123; return false &#125; return UIApplication.shared.isRegisteredForRemoteNotifications &amp;&amp; !settings.types.isEmpty&#125; For iOS 10, with the introduction of UserNotifications framework, instead of checking for currentUserNotificationSettings, you should use UserNotifications framework 12345678910center.getNotificationSettings(completionHandler: &#123; settings in switch settings.authorizationStatus &#123; case .authorized, .provisional: print(\"authorized\") case .denied: print(\"denied\") case .notDetermined: print(\"not determined, ask user for permission now\") &#125;&#125;) Push notification can be delivered to our apps in many ways, and we can ask for that 12UNUserNotificationCenter.current() .requestAuthorization(options: [.alert, .sound, .badge]) User can go to Settings app and turn off any of those at any time, so it‚Äôs best to check for that in the settings object 123456789101112131415open class UNNotificationSettings : NSObject, NSCopying, NSSecureCoding &#123; open var authorizationStatus: UNAuthorizationStatus &#123; get &#125; open var soundSetting: UNNotificationSetting &#123; get &#125; open var badgeSetting: UNNotificationSetting &#123; get &#125; open var alertSetting: UNNotificationSetting &#123; get &#125; open var notificationCenterSetting: UNNotificationSetting &#123; get &#125;&#125; Original answer https://stackoverflow.com/a/44407710/1418457","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use UserNotificationsUI in iOS","slug":"How-to-use-UserNotificationsUI-in-iOS","date":"2019-10-10T10:45:29.000Z","updated":"2019-10-10T10:46:19.000Z","comments":true,"path":"blog/How-to-use-UserNotificationsUI-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-UserNotificationsUI-in-iOS/","excerpt":"","text":"Issue #454 From documentation https://developer.apple.com/documentation/usernotificationsui Customize how local and remote notifications appear on the user‚Äôs device by adding a notification content app extension to the bundle of your iOS app. Your extension manages a custom view controller, which you use to present the content from incoming notifications. When a notification arrives, the system displays your view controller in addition to, or in place of, the default system interface. https://developer.apple.com/documentation/usernotificationsui/customizing_the_appearance_of_notifications When an iOS device receives a notification containing an alert, the system displays the contents of the alert in two stages. Initially, it displays an abbreviated banner with the title, subtitle, and two to four lines of body text from the notification. If the user presses the abbreviated banner, iOS displays the full notification interface, including any notification-related actions. The system provides the interface for the abbreviated banner, but you can customize the full interface using a notification content app extension. Use Notification Content Extension 1234func didReceive(_ notification: UNNotification) &#123; self.bodyText?.text = notification.request.content.body self.headlineText?.text = notification.request.content.title&#125;","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use AnyHashable in Swift","slug":"How-to-use-AnyHashable-in-Swift","date":"2019-10-10T08:17:42.000Z","updated":"2019-10-10T08:17:48.000Z","comments":true,"path":"blog/How-to-use-AnyHashable-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-AnyHashable-in-Swift/","excerpt":"","text":"Issue #453 From documentation A type-erased hashable value. DiscussionThe AnyHashable type forwards equality comparisons and hashing operations to an underlying hashable value, hiding its specific underlying type.You can store mixed-type keys in dictionaries and other collections that require Hashable conformance by wrapping mixed-type keys in AnyHashable instances 12345678910let descriptions: [AnyHashable: Any] = [ AnyHashable(\"üòÑ\"): \"emoji\", AnyHashable(42): \"an Int\", AnyHashable(Int8(43)): \"an Int8\", AnyHashable(Set([\"a\", \"b\"])): \"a set of strings\"]print(descriptions[AnyHashable(42)]!) // prints \"an Int\"print(descriptions[AnyHashable(43)]) // prints \"nil\"print(descriptions[AnyHashable(Int8(43))]!) // prints \"an Int8\"print(descriptions[AnyHashable(Set([\"a\", \"b\"]))]!) // prints \"a set of strings\" We don‚Äôt necessarily need to map from [AnyHashable: Any] to [String: Any], we can just access via string key 1userInfo[\"aps\"]","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to  register for alert push notification in iOS","slug":"How-to-register-for-alert-push-notification-in-iOS","date":"2019-10-10T07:57:27.000Z","updated":"2019-10-10T08:16:55.000Z","comments":true,"path":"blog/How-to-register-for-alert-push-notification-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-register-for-alert-push-notification-in-iOS/","excerpt":"","text":"Issue #452 Use UserNotifications framework 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import FirebaseMessagingimport UserNotificationsfinal class PushHandler: NSObject &#123; private let center = UNUserNotificationCenter.current() private let options: UNAuthorizationOptions = [.alert] func setup() &#123; Messaging.messaging().delegate = self &#125; func register() &#123; center.requestAuthorization(options: options, completionHandler: &#123; granted, error in print(granted, error) self.getSettings() &#125;) &#125; func getSettings() &#123; center.getNotificationSettings(completionHandler: &#123; settings in guard case let .authorized = settings.authorizationStatus, case let .enabled = settings.alertSetting, settings.alertStyle != .none else &#123; return &#125; // TODO &#125;) &#125; func handle(userInfo: [AnyHashable: Any]) &#123; &#125;&#125;extension PushHandler: MessagingDelegate &#123; func messaging(_ messaging: Messaging, didReceiveRegistrationToken fcmToken: String) &#123; print(fcmToken) &#125; func messaging(_ messaging: Messaging, didReceive remoteMessage: MessagingRemoteMessage) &#123; print(remoteMessage) &#125;&#125; 1234567891011@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123; func application( _ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -&gt; Void) &#123; completionHandler(.noData) Deps.pushHandler.handle(userInfo: userInfo) &#125;&#125; A test message from Firebase looks like 123456[AnyHashable(&quot;google.c.a.e&quot;): 1, AnyHashable(&quot;google.c.a.ts&quot;): 1570701857, AnyHashable(&quot;aps&quot;): &#123; alert = &#123; body = Test; title = Test; &#125;;&#125;, AnyHashable(&quot;google.c.a.udt&quot;): 0, AnyHashable(&quot;google.c.a.c_l&quot;): Test, AnyHashable(&quot;gcm.message_id&quot;): 1570701857965182, AnyHashable(&quot;google.c.a.c_id&quot;): 1257698497812622975, AnyHashable(&quot;gcm.n.e&quot;): 1]","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to flat map publisher of publishers in Combine","slug":"How-to-flat-map-publisher-of-publishers-in-Combine","date":"2019-10-09T12:41:25.000Z","updated":"2019-10-09T12:42:28.000Z","comments":true,"path":"blog/How-to-flat-map-publisher-of-publishers-in-Combine/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-flat-map-publisher-of-publishers-in-Combine/","excerpt":"","text":"Issue #451 For some services, we need to deal with separated APIs for getting ids and getting detail based on id. To chain requests, we can use flatMap and Sequence, then collect to wait and get all elements in a single publish FlatMap Transforms all elements from an upstream publisher into a new or existing publisher. 1struct FlatMap&lt;NewPublisher, Upstream&gt; where NewPublisher : Publisher, Upstream : Publisher, NewPublisher.Failure == Upstream.Failure Publishers.Sequence A publisher that publishes a given sequence of elements. 1struct Sequence&lt;Elements, Failure&gt; where Elements : Sequence, Failure : Error 123456789101112131415161718192021222324252627282930313233343536func fetchItems(completion: @escaping ([ItemProtocol]) -&gt; Void) &#123; requestCancellable = URLSession.shared .dataTaskPublisher(for: topStoriesUrl()) .map(&#123; $0.data &#125;) .decode(type: [Int].self, decoder: JSONDecoder()) .flatMap(&#123; (ids: [Int]) -&gt; AnyPublisher&lt;[HackerNews.Item], Error&gt; in let publishers = ids.prefix(10).map(&#123; id in return URLSession.shared .dataTaskPublisher(for: self.storyUrl(id: id)) .map(&#123; $0.data &#125;) .decode(type: HackerNews.Item.self, decoder: JSONDecoder()) .eraseToAnyPublisher() &#125;) return Publishers.Sequence&lt;[AnyPublisher&lt;HackerNews.Item, Error&gt;], Error&gt;(sequence: publishers) // Publishers.Sequence&lt;[AnyPublisher&lt;HackerNews.Item, Error&gt;], Error&gt; .flatMap(&#123; $0 &#125;) // Publishers.FlatMap&lt;AnyPublisher&lt;HackerNews.Item, Error&gt;, Publishers.Sequence&lt;[AnyPublisher&lt;HackerNews.Item, Error&gt;], Error&gt;&gt; .collect() // Publishers.Collect&lt;Publishers.FlatMap&lt;AnyPublisher&lt;HackerNews.Item, Error&gt;, Publishers.Sequence&lt;[AnyPublisher&lt;HackerNews.Item, Error&gt;], Error&gt;&gt;&gt; .eraseToAnyPublisher() // AnyPublisher&lt;[HackerNews.Item], Error&gt; &#125;) .receive(on: RunLoop.main) .eraseToAnyPublisher() .sink(receiveCompletion: &#123; completionStatus in switch completionStatus &#123; case .finished: break case .failure(let error): print(error) &#125; &#125;, receiveValue: &#123; items in completion(items) &#125;)&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"combine","slug":"combine","permalink":"https://onmyway133.github.io/tags/combine/"}]},{"title":"How to make container view in SwiftUI","slug":"How-to-make-container-view-in-SwiftUI","date":"2019-10-09T06:28:41.000Z","updated":"2019-10-09T06:40:55.000Z","comments":true,"path":"blog/How-to-make-container-view-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-container-view-in-SwiftUI/","excerpt":"","text":"Issue #450 Following the signatures of ScrollView and Group, we can create our own container 123456public struct ScrollView&lt;Content&gt; : View where Content : View &#123; /// The content of the scroll view. public var content: Content&#125; 12345678910extension Group : View where Content : View &#123; /// The type of view representing the body of this view. /// /// When you create a custom view, Swift infers this type from your /// implementation of the required `body` property. public typealias Body = Never @inlinable public init(@ViewBuilder content: () -&gt; Content)&#125; For example, below is a FullWidth that encapsulate a child element and make it full width 12345678910111213141516171819202122232425import SwiftUIstruct FullWidth&lt;Content&gt;: View where Content: View &#123; let content: Content var body: some View &#123; GeometryReader &#123; geometry in self.content .frame(width: geometry.size.width, height: geometry.size.width, alignment: .center) .padding(.bottom, geometry.size.width) &#125; &#125; @inlinable public init(@ViewBuilder content: () -&gt; Content) &#123; self.content = content() &#125;&#125;struct FullWidth_Previews: PreviewProvider &#123; static var previews: some View &#123; FullWidth &#123; Text(\"\") &#125; &#125;&#125; One problem with GeometryReader is that the size of the children can‚Äôt affect the size of its container. We need to apply Geometry at the root level 123456789101112var body: some View &#123; GeometryReader &#123; geometry in ScrollView &#123; VStack(alignment: .leading, spacing: 8) &#123; Text(\"title\") RemoteImage(url: self.item.url) .frame(width: geometry.size.width, height: geometry.size.height, alignment: .center) Text(\"footer\") &#125; &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to show web content as QR code in SwiftUI in watchOS","slug":"How-to-show-web-content-as-QR-code-in-SwiftUI-in-watchOS","date":"2019-10-08T11:41:16.000Z","updated":"2019-10-08T12:02:39.000Z","comments":true,"path":"blog/How-to-show-web-content-as-QR-code-in-SwiftUI-in-watchOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-web-content-as-QR-code-in-SwiftUI-in-watchOS/","excerpt":"","text":"Issue #449 WatchKit does not have Web component, despite the fact that we can view web content https://www.imore.com/how-view-web-pages-apple-watch-watchos-5 A workaround is to show url as QR code 1234567891011121314151617181920212223import SwiftUIstruct QRCodeView: View &#123; let title: String let url: URL var body: some View &#123; GeometryReader &#123; geometry in VStack &#123; self.makeImage(size: geometry.size) .padding(.top, 10) Text(\"Scan to open\") .font(.system(.footnote)) &#125;.navigationBarTitle(self.title) &#125; &#125; private func makeImage(size: CGSize) -&gt; some View &#123; let value = size.height - 30 return RemoteImage(url: self.url) .frame(width: value, height: value, alignment: .center) &#125;&#125;","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to load remote image in SwiftUI","slug":"How-to-load-remote-image-in-SwiftUI","date":"2019-10-08T11:37:48.000Z","updated":"2019-10-08T11:56:39.000Z","comments":true,"path":"blog/How-to-load-remote-image-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-load-remote-image-in-SwiftUI/","excerpt":"","text":"Issue #448 Use ObservableObject and onReceive to receive event. URLSession.dataTask reports in background queue, so need to .receive(on: RunLoop.main) to receive events on main queue. For better dependency injection, need to use ImageLoader from Environment There should be a way to propagate event from Publisher to another Publisher, for now we use sink ImageLoader.swift 123456789101112131415161718192021222324import Combineimport WatchKitclass ImageLoader: ObservableObject &#123; private var cancellable: AnyCancellable? let objectWillChange = PassthroughSubject&lt;UIImage?, Never&gt;() func load(url: URL) &#123; self.cancellable = URLSession.shared .dataTaskPublisher(for: url) .map(&#123; $0.data &#125;) .eraseToAnyPublisher() .receive(on: RunLoop.main) .map(&#123; UIImage(data: $0) &#125;) .replaceError(with: nil) .sink(receiveValue: &#123; image in self.objectWillChange.send(image) &#125;) &#125; func cancel() &#123; cancellable?.cancel() &#125;&#125; RemoteImage.swift 1234567891011121314151617181920212223242526272829303132333435import SwiftUIimport WatchKitstruct RemoteImage: View &#123; let url: URL let imageLoader = ImageLoader() @State var image: UIImage? = nil var body: some View &#123; Group &#123; makeContent() &#125; .onReceive(imageLoader.objectWillChange, perform: &#123; image in self.image = image &#125;) .onAppear(perform: &#123; self.imageLoader.load(url: self.url) &#125;) .onDisappear(perform: &#123; self.imageLoader.cancel() &#125;) &#125; private func makeContent() -&gt; some View &#123; if let image = image &#123; return AnyView( Image(uiImage: image) .resizable() .aspectRatio(contentMode: .fit) ) &#125; else &#123; return AnyView(Text(\"üò¢\")) &#125; &#125;&#125;","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to do navigation in SwiftUI in watchOS","slug":"How-to-do-navigation-in-SwiftUI-in-watchOS","date":"2019-10-08T11:35:51.000Z","updated":"2019-10-08T11:48:34.000Z","comments":true,"path":"blog/How-to-do-navigation-in-SwiftUI-in-watchOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-navigation-in-SwiftUI-in-watchOS/","excerpt":"","text":"Issue #447 NavigationView is not available on WatchKit, but we can just use NavigationLink 12345678910111213141516List(services.map(&#123; AnyService($0) &#125;)) &#123; anyService in NavigationLink(destination: ItemsView(service: anyService.service) .navigationBarTitle(anyService.service.name) .onDisappear(perform: &#123; anyService.service.requestCancellable?.cancel() &#125;) ) &#123; HStack &#123; Image(anyService.service.name) .resizable() .frame(width: 30, height: 30, alignment: .leading) Text(anyService.service.name) &#125; &#125;&#125; Adding NavigationLink to a View adds a round shadow cropping effect, which is usually not want we want. But we shouldn‚Äôt wrap Button as Button handles its own touch event, plus it has double shadow effect. 1234567NavigationLink(destination: QRCodeView(title: item.title, url: item.url)) &#123; Button(action: &#123;&#125;) &#123; Text(\"Open\") &#125;&#125; Just use Text and it‚Äôs good to go 12345NavigationLink(destination: QRCodeView(title: item.title, url: item.url)) &#123; Text(\"Open\")&#125;","categories":[],"tags":[{"name":"watchOS","slug":"watchOS","permalink":"https://onmyway133.github.io/tags/watchOS/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to use protocol in List in SwiftUI","slug":"How-to-use-protocol-in-List-in-SwiftUI","date":"2019-10-07T12:08:38.000Z","updated":"2019-10-07T12:12:51.000Z","comments":true,"path":"blog/How-to-use-protocol-in-List-in-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-protocol-in-List-in-SwiftUI/","excerpt":"","text":"Issue #446 Suppose we have Service protocol, and want to use in List 123protocol Service &#123; var name: String &#123; get &#125;&#125; 123456789101112131415struct MainView: View &#123; let services = [ Car() Plane() ] var body: some View &#123; List(services) &#123; service in HStack &#123; Image(service.name) Text(service.name) &#125; &#125; &#125;&#125; This is not possible because item in List needs to conform to Identifiable Protocol type ‚ÄòService‚Äô cannot conform to ‚ÄòIdentifiable‚Äô because only concrete types can conform to protocols Type eraserIn the same way that SwiftUI uses type eraser, for example AnyView, we can introduce AnyService to work around this 1234567var body: some View &#123; if useImage &#123; return AnyView(Image(\"my image\")) &#125; else &#123; return AnyView(Text(\"my text\")) &#125;&#125; Make AnyService conform to Identifiable 123456789struct AnyService: Identifiable &#123; let id: String let service: Service init(_ service: Service) &#123; self.service = service self.id = service.name &#125;&#125; Then in our View, we just need to declare services wrapped inside AnyService 123456789101112131415struct MainView: View &#123; let services = [ AnyService(Car()), AnyService(Plane()) ] var body: some View &#123; List(services) &#123; anyService in HStack &#123; Image(anyService.service.name) Text(anyService.service.name) &#125; &#125; &#125;&#125; A bit refactoring, we can just declare normal services and map them 123456789101112131415struct MainView: View &#123; let services: [Service] = [ Car(), Plane() ] var body: some View &#123; List(services.map(&#123; AnyService($0 &#125;)) &#123; anyService in HStack &#123; Image(anyService.service.name) Text(anyService.service.name) &#125; &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to support Swift Package Manager for existing projects","slug":"How-to-support-Swift-Package-Manager-for-existing-projects","date":"2019-10-07T09:01:37.000Z","updated":"2019-10-07T10:07:40.000Z","comments":true,"path":"blog/How-to-support-Swift-Package-Manager-for-existing-projects/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-support-Swift-Package-Manager-for-existing-projects/","excerpt":"","text":"Issue #445 How to add SPM Run swift package init Check enum for version for each platform https://developer.apple.com/documentation/swift_packages/supportedplatform/tvosversion Example https://github.com/onmyway133/Anchors/blob/master/Package.swift 12345678910111213141516171819202122232425262728// swift-tools-version:5.1import PackageDescriptionlet package = Package( name: \"Anchors\", platforms: [ .macOS(.v10_11), .iOS(.v9), .tvOS(.v9) ], products: [ .library( name: \"Anchors\", targets: [\"Anchors\"]), ], targets: [ .target( name: \"Anchors\", dependencies: [], path: \"Sources\" ), .testTarget( name: \"AnchorsTests\", dependencies: [\"Anchors\"]), ], swiftLanguageVersions: [.v5]) To test, swift test to test locally, this should validate Package.swift too Support multiple platformTo support multiple platform, use platform check 123#if canImport(UIKit)import UIKit#endif Use sources in Target https://developer.apple.com/documentation/swift_packages/target/2880339-sources https://github.com/onmyway133/EasyClosure/blob/master/Package.swift If this property is nil, all valid source files in the target‚Äôs path will be included and specified paths are relative to the target path. A path can be a path to a directory or an individual source file. In case of a directory, the Swift Package Manager searches for valid source files recursively inside it. 123456.target( name: \"EasyClosureiOS\", dependencies: [], path: \"Sources\", sources: [\"Shared\", \"iOS\"]) Error error: target ‚ÄòEasyClosuremacOS‚Äô has sources overlapping sources How to use SPM packages are at DerivedData/MyApp/SourcePackages/checkouts Delete DerivedData for Xcode to fetch new contents from GitHub Clean build folder as Xcode often caches changes from frameworks Read more https://dive.github.io/swift-package-manager/ios/2019/01/20/swift_package_manager_vs_ios.html","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to fix unreadable ASCII characters in Swift","slug":"How-to-fix-unreadable-ASCII-characters-in-Swift","date":"2019-10-07T05:43:56.000Z","updated":"2019-10-07T06:16:57.000Z","comments":true,"path":"blog/How-to-fix-unreadable-ASCII-characters-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-unreadable-ASCII-characters-in-Swift/","excerpt":"","text":"Issue #444 To avoid compiler error Unprintable ASCII character found in source file, from Swift 5, we can use isASCII. Run this from the generator app that generates Swift code. 1let normalized = weirdString.filter(&#123; $0.isASCII &#125;) For more check, see Character https://developer.apple.com/documentation/swift/character/3127011-isletter Watch out for Delete/House symbol ‚åÇ code 127 (0x7f) The above does not seem to work, use find to find  character (copy Sublime Text to see 0x7f character) 1find ./ -type f -exec sed -i &apos;&apos; -e &apos;s///&apos; &#123;&#125; \\;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to style NSTextView and NSTextField in macOS","slug":"How-to-style-NSTextView-and-NSTextField-in-macOS","date":"2019-10-05T18:28:16.000Z","updated":"2019-10-05T18:28:16.000Z","comments":true,"path":"blog/How-to-style-NSTextView-and-NSTextField-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-style-NSTextView-and-NSTextField-in-macOS/","excerpt":"","text":"Issue #443 12let textField = NSTextField()textField.focusRingType = .none 12345678let textView = NSTextView()textView.insertionPointColor = R.color.carettextView.isRichText = falsetextView.importsGraphics = falsetextView.isEditable = truetextView.isSelectable = truetextView.drawsBackground = falsetextView.allowsUndo = true","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to center NSWindow in screen","slug":"How-to-center-NSWindow-in-screen","date":"2019-10-04T08:37:42.000Z","updated":"2019-10-04T08:37:42.000Z","comments":true,"path":"blog/How-to-center-NSWindow-in-screen/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-center-NSWindow-in-screen/","excerpt":"","text":"Issue #442 On macOS, coordinate origin is bottom left 12345let window = NSWindow(contentRect: rect, styleMask: .borderless, backing: .buffered, defer: false)window.center()let frame = window.framewindow.setFrameOrigin(CGPoint(x: frame.origin.x, y: 100))","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to remove duplicates based on property in array in Swift","slug":"How-to-remove-duplicates-based-on-property-in-array-in-Swift","date":"2019-10-03T09:59:05.000Z","updated":"2019-10-03T10:18:18.000Z","comments":true,"path":"blog/How-to-remove-duplicates-based-on-property-in-array-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-remove-duplicates-based-on-property-in-array-in-Swift/","excerpt":"","text":"Issue #441 Make object conform to Equatable and Hashable and use Set to eliminate duplications. Set loses order so we need to sort after uniquing 12345678910111213struct App: Equatable, Hashable &#123; static func == (lhs: App, rhs: App) -&gt; Bool &#123; return lhs.name == rhs.name &amp;&amp; lhs.bundleId == rhs.bundleId &#125; func hash(into hasher: inout Hasher) &#123; hasher.combine(name) hasher.combine(bundleId) &#125;&#125;let uniqueApps = Array(Set(unsortedApps))let apps = uniqueApps.sorted(by: &#123; $0.name.lowercased() &lt; $1.name.lowercased() &#125;)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to get url of app on the iOS AppStore","slug":"How-to-get-url-of-app-on-the-iOS-AppStore","date":"2019-10-03T06:39:35.000Z","updated":"2019-10-03T06:39:40.000Z","comments":true,"path":"blog/How-to-get-url-of-app-on-the-iOS-AppStore/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-url-of-app-on-the-iOS-AppStore/","excerpt":"","text":"Issue #440 1http://itunes.apple.com/[country]/app/[App‚ÄìName]/id[App-ID]?mt=8 For example https://apps.apple.com/nl/app/cutters/id1466739130","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to log Error in Swift","slug":"How-to-log-Error-in-Swift","date":"2019-10-03T05:44:18.000Z","updated":"2019-10-03T05:44:39.000Z","comments":true,"path":"blog/How-to-log-Error-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-log-Error-in-Swift/","excerpt":"","text":"Issue #439 Use localizedDescriptionWe need to provide NSLocalizedDescriptionKey inside user info dictionary, otherwise the outputt string may not be what we want. NSErrorhttps://developer.apple.com/documentation/foundation/nserror/1414418-localizeddescription A string containing the localized description of the error.The object in the user info dictionary for the key NSLocalizedDescriptionKey. If the user info dictionary doesn‚Äôt contain a value for NSLocalizedDescriptionKey, a default string is constructed from the domain and code. 1234567let error = NSError(domain: \"com.onmyway133.MyApp\", code: 2, userInfo: [ \"status_code\": 2, \"status_message\": \"not enough power\"])error.localizedDescription// \"The operation couldn‚Äôt be completed. (com.onmyway133.MyApp error 2.)\" Errorhttps://developer.apple.com/documentation/swift/error/2292912-localizeddescription Retrieve the localized description for this error. 1234567enum AppError: Error &#123; case request case invalid&#125;AppError.request.localizedDescription// \"The operation couldn‚Äôt be completed. (MyApp.AppError error 0.)\" Use describing StringTo have better control, we can have toString which prints closly to what we expect 1234567891011extension Error &#123; func toString() -&gt; String &#123; return String(describing: self) &#125;&#125;AppError.request.toString()// requestnsError.toString()// Error Domain=com.onmyway133.MyApp Code=2 \"(null)\" UserInfo=&#123;status_message=not enough power, status_code=SwiftGRPC.StatusCode.powerRequired&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to handle NSTextField change in macOS","slug":"How-to-handle-NSTextField-change-in-macOS","date":"2019-10-02T10:47:06.000Z","updated":"2019-10-02T10:47:12.000Z","comments":true,"path":"blog/How-to-handle-NSTextField-change-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-NSTextField-change-in-macOS/","excerpt":"","text":"Issue #438 StoryboardIn Storyboard, NSTextField has an Action option that specify whether Send onSend on Enter only` should be the default behaviour. CodeIn code, NSTextFieldDelegate notifies whenever text field value changes, and target action notifies when Enter key is pressed 1234567891011121314151617import Cocoaclass ViewController: NSViewController, NSTextFieldDelegate &#123; @IBOutlet weak var textField: NSTextField! override func viewDidLoad() &#123; super.viewDidLoad() textField.delegate = self &#125; func controlTextDidChange(_ obj: Notification) &#123; let textField = obj.object as! NSTextField print(textField.stringValue) &#125;&#125; Use EasyClosureIf we use EasyClosure then this is easy 123456789let textField: NSTextField = textField.on.action &#123; string in print(\"User has pressed enter \\(string)\"&#125;textField.on.change &#123; string in print(\"Text field value has changed\")&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to add section header to NSCollectionView in macOS","slug":"How-to-add-section-header-to-NSCollectionView-in-macOS","date":"2019-10-02T10:04:41.000Z","updated":"2019-10-02T10:36:31.000Z","comments":true,"path":"blog/How-to-add-section-header-to-NSCollectionView-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-section-header-to-NSCollectionView-in-macOS/","excerpt":"","text":"Issue #437 NormalUse Omnia for itemId extension HeaderCell.swift 1234567891011121314151617181920212223final class HeaderCell: NSView, NSCollectionViewSectionHeaderView &#123; let label: NSTextField = withObject(NSTextField(labelWithString: \"\")) &#123; $0.textColor = R.color.header $0.font = R.font.header $0.alignment = .left $0.lineBreakMode = .byTruncatingTail &#125; override init(frame frameRect: NSRect) &#123; super.init(frame: frameRect) addSubviews([label]) activate( label.anchor.centerY, label.anchor.left.constant(8) ) &#125; required init?(coder: NSCoder) &#123; fatalError() &#125;&#125; ViewController.swift 1234567891011121314151617181920212223collectionView.register( HeaderCell.self, forSupplementaryViewOfKind: NSCollectionView.elementKindSectionHeader, withIdentifier: HeaderCell.itemId)func collectionView(_ collectionView: NSCollectionView, viewForSupplementaryElementOfKind kind: NSCollectionView.SupplementaryElementKind, at indexPath: IndexPath) -&gt; NSView &#123; if kind == NSCollectionView.elementKindSectionHeader &#123; let view = collectionView.makeSupplementaryView( ofKind: kind, withIdentifier: HeaderCell.itemId, for: indexPath ) as! HeaderCell let menu = app.menus[indexPath.section] view.label.stringValue = menu.name return view &#125; else &#123; return NSView() &#125;&#125; In generic subclassIf use CollectionViewHandler from Omnia, then need to add @objc due to a bug in Swift compiler for subclassing generic class 1@objc (collectionView:viewForSupplementaryElementOfKind:atIndexPath:) MyHandler.swift 1234567891011121314151617181920212223242526272829303132333435import AppKitimport Omniaclass MyHandler: CollectionViewHandler&lt;App.Key, KeyCell&gt; &#123; override init() &#123; super.init() layout.headerReferenceSize = NSSize(width: 300, height: 30) collectionView.register( HeaderCell.self, forSupplementaryViewOfKind: NSCollectionView.elementKindSectionHeader, withIdentifier: HeaderCell.itemId ) &#125; @objc (collectionView:viewForSupplementaryElementOfKind:atIndexPath:) func collectionView(_ collectionView: NSCollectionView, viewForSupplementaryElementOfKind kind: NSCollectionView.SupplementaryElementKind, at indexPath: IndexPath) -&gt; NSView &#123; if kind == NSCollectionView.elementKindSectionHeader &#123; let view = collectionView.makeSupplementaryView( ofKind: kind, withIdentifier: HeaderCell.itemId, for: indexPath ) as! HeaderCell let menu = app.menus[indexPath.section] view.label.stringValue = menu.name return view &#125; else &#123; return NSView() &#125; &#125;&#125; Use OmniaUse CollectionViewSectionHandler from Omnia 123456789101112131415161718192021222324class SectionHandler: CollectionViewSectionHandler&lt;App.Key, KeyCell, HeaderCell&gt; &#123;&#125;sectionHandler.configureHeader = &#123; section, view in view.label.stringValue = section.name&#125;sectionHandler.configure = &#123; item, cell in cell.shortcutLabel.stringValue = item.shortcut cell.nameLabel.stringValue = item.name&#125;sectionHandler.itemSize = &#123; [weak self] in guard let self = self else &#123; return .zero &#125; let width = self.sectionHandler.collectionView.frame.size.width - self.sectionHandler.layout.sectionInset.left - self.sectionHandler.layout.sectionInset.right return CGSize(width: width, height: 18)&#125; Read more https://www.raywenderlich.com/783-nscollectionview-tutorial#toc-anchor-020 https://www.raywenderlich.com/1047-advanced-collection-views-in-os-x-tutorial","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to show log in Apple Script","slug":"How-to-show-log-in-Apple-Script","date":"2019-10-01T10:03:09.000Z","updated":"2019-10-01T10:03:14.000Z","comments":true,"path":"blog/How-to-show-log-in-Apple-Script/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-log-in-Apple-Script/","excerpt":"","text":"Issue #436 Open Script Editor, use log command and look for 4 tabs in bottom panel Result, Messages, Events and Replies 1log &quot;hello world&quot;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"How to show context menu from NSButton in macOS","slug":"How-to-show-context-menu-from-NSButton-in-macOS","date":"2019-10-01T08:23:00.000Z","updated":"2019-10-01T08:23:00.000Z","comments":true,"path":"blog/How-to-show-context-menu-from-NSButton-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-context-menu-from-NSButton-in-macOS/","excerpt":"","text":"Issue #435 Use NSMenu and popUp 1234567891011121314151617181920212223242526func showQuitMenu() &#123; let menu = NSMenu() let aboutItem = NSMenuItem( title: \"About\", action: #selector(onAboutTouched(_:)), keyEquivalent: \"\" ) let quitItem = NSMenuItem( title: \"Quit Hacker Pad\", action: #selector(onQuitTouched(_:)), keyEquivalent: \"\" ) aboutItem.target = self quitItem.target = self menu.addItem(aboutItem) menu.addItem(quitItem) menu.popUp( positioning: aboutItem, at: bottomView.quitButton.frame.origin, in: bottomView )&#125; Use Omnia 12345678910let menuHandler = MenuHandler()menuHandler.add(title: \"About\", action: &#123; NSWorkspace.shared.open(URL(string: \"https://onmyway133.github.io/\")!)&#125;)menuHandler.add(title: \"Quit Hacker Pad\", action: &#123; NSApp.terminate(nil)&#125;)menuHandler.show(from: self.bottomView.gearButton, in: self.bottomView)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to handle UICollectionView reloadData with selected index path","slug":"How-to-handle-UICollectionView-reloadData-with-selected-index-path","date":"2019-09-30T18:15:00.000Z","updated":"2019-09-30T18:15:46.000Z","comments":true,"path":"blog/How-to-handle-UICollectionView-reloadData-with-selected-index-path/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-UICollectionView-reloadData-with-selected-index-path/","excerpt":"","text":"Issue #434 When calling collectionView.reloadData(), selected indexpath stays the same, but be aware that order of data may have changed 12345678let selectedData = ...let indexPathForSelectedData = ...collectionView.scrollToItem( at: indexPathForSelectedData, at: .centeredHorizontally, animated: false)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make checked NSButton in AppKit","slug":"How-to-make-checked-NSButton-in-AppKit","date":"2019-09-30T09:33:15.000Z","updated":"2019-09-30T09:33:21.000Z","comments":true,"path":"blog/How-to-make-checked-NSButton-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-checked-NSButton-in-AppKit/","excerpt":"","text":"Issue #433 Use Omnia for convenient style and isOn property 123let checkButton = NSButton(checkboxWithTitle: \"\", target: nil, action: nil)checkButton.stylePlain(title: \"Autosave\", color: R.color.text, font: R.font.text)checkButton.isOn = true","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to save files in sandboxed macOS app","slug":"How-to-save-files-in-sandboxed-macOS-app","date":"2019-09-28T19:09:26.000Z","updated":"2019-09-28T19:09:33.000Z","comments":true,"path":"blog/How-to-save-files-in-sandboxed-macOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-save-files-in-sandboxed-macOS-app/","excerpt":"","text":"Issue #432 Read Container Directories and File System Access When you adopt App Sandbox, your application has access to the following locations: The app container directory. Upon first launch, the operating system creates a special directory for use by your app‚Äîand only by your app‚Äîcalled a container. Each user on a system gets an individual container for your app, within their home directory; your app has unfettered read/write access to the container for the user who ran it. Use EasyStash 123var options = Options()options.searchPathDirectory = .documentDirectorystorage = try! Storage(options: options)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to add AdMob to Android app","slug":"How-to-add-AdMob-to-Android-app","date":"2019-09-27T07:33:49.000Z","updated":"2019-09-27T07:43:38.000Z","comments":true,"path":"blog/How-to-add-AdMob-to-Android-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-AdMob-to-Android-app/","excerpt":"","text":"Issue #431 Use AdMob with Firebase https://firebase.google.com/docs/admob/android/quick-start build.gradle 12345678910buildscript &#123; repositories &#123; google() jcenter() &#125; dependencies &#123; classpath 'com.google.gms:google-services:4.3.2' &#125;&#125; app/build.gradle 12345678910111213class Version &#123; class Firebase &#123; static def analytics = \"17.2.0\" static def ads = \"18.2.0\" &#125;&#125;dependencies &#123; implementation \"com.google.firebase:firebase-analytics:$Version.Firebase.analytics\" implementation \"com.google.firebase:firebase-ads:$Version.Firebase.ads\"&#125;apply plugin: 'com.google.gms.google-services' Manifest.xml 12345678&lt;manifest&gt; &lt;application&gt; &lt;!-- Sample AdMob App ID: ca-app-pub-3940256099942544~3347511713 --&gt; &lt;meta-data android:name=\"com.google.android.gms.ads.APPLICATION_ID\" android:value=\"[ADMOB_APP_ID]\"/&gt; &lt;/application&gt;&lt;/manifest&gt; MyApplication.kt 1234567class MyApplication: Application() &#123; override fun onCreate() &#123; super.onCreate() MobileAds.initialize(this) &#125;&#125; AdViewfragment.xml 12345678910&lt;com.google.android.gms.ads.AdView xmlns:ads=\"http://schemas.android.com/apk/res-auto\" android:id=\"@+id/adView\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" ads:adSize=\"BANNER\" ads:adUnitId=\"ca-app-pub-123456/123456\" ads:layout_constraintBottom_toBottomOf=\"parent\" ads:layout_constraintLeft_toLeftOf=\"parent\" ads:layout_constraintRight_toRightOf=\"parent\"/&gt; Fragment.kt 12345import com.google.android.gms.ads.AdRequestimport com.google.android.gms.ads.AdViewval request = AdRequest.Builder().build()adView.loadAd(request) TroubleshootingLink your app to Firebase option not showing https://support.google.com/admob/answer/6383165?authuser=0 Use standalone AdMob https://developers.google.com/admob/android/quick-start app/build.gradle 123dependencies &#123; implementation 'com.google.android.gms:play-services-ads:18.2.0'&#125; Cannot fit requested classes in a single dex file https://stackoverflow.com/questions/48249633/errorcannot-fit-requested-classes-in-a-single-dex-file-try-supplying-a-main-dex app/build.gradle 12345678910android &#123; defaultConfig &#123; multiDexEnabled true &#125;&#125;dependencies &#123; implementation 'com.android.support:multidex:1.0.3'&#125; Read more http://thetechnocafe.com/a-complete-guide-to-integrating-admob-in-your-android-app/","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to notarize electron app","slug":"How-to-notarize-electron-app","date":"2019-09-26T11:08:57.000Z","updated":"2019-10-23T09:41:33.000Z","comments":true,"path":"blog/How-to-notarize-electron-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-notarize-electron-app/","excerpt":"","text":"Issue #430 Use electron builder1npm install electron-builder@latest --save-dev Prefer electron-builder over electron-packager Configuration https://www.electron.build/configuration/configuration package.json 12345678910111213141516171819202122232425262728293031323334353637&#123; \"name\": \"icon_generator\", \"version\": \"1.3.0\", \"description\": \"A macOS app to generate app icons\", \"main\": \"babel/main.js\", \"repository\": \"https://github.com/onmyway133/IconGenerator\", \"author\": \"Khoa Pham\", \"license\": \"MIT\", \"scripts\": &#123; \"start\": \"npm run babel &amp;&amp; electron .\", \"babel\": \"babel ./src --out-dir ./babel --copy-files\", \"dist\": \"npm run babel &amp;&amp; electron-builder\" &#125;, \"build\": &#123; \"appId\": \"com.onmyway133.IconGenerator\", \"buildVersion\": \"20\", \"productName\": \"Icon Generator\", \"icon\": \"./Icon/Icon.icns\", \"mac\": &#123; \"category\": \"public.app-category.productivity\", \"hardenedRuntime\": true, \"gatekeeperAssess\": false, \"entitlements\": \"./entitlements.plist\", \"entitlementsInherit\": \"./entitlements.plist\" &#125;, \"win\": &#123; \"target\": \"msi\" &#125;, \"linux\": &#123; \"target\": [ \"AppImage\", \"deb\" ] &#125;, \"afterSign\": \"./afterSignHook.js\" &#125;&#125; Declare entitlementsentitlements.plist 123456789101112&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt; &lt;dict&gt; &lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.allow-dyld-environment-variables&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt;&lt;/plist&gt; Use electron-notarize https://github.com/electron/electron-notarize afterSignHook.js 12345678910111213141516171819202122232425262728293031323334const fs = require('fs');const path = require('path');var electron_notarize = require('electron-notarize');module.exports = async function (params) &#123; // Only notarize the app on Mac OS only. if (process.platform !== 'darwin') &#123; return; &#125; console.log('afterSign hook triggered', params); // Same appId in electron-builder. let appId = 'com.onmyway133.IconGenerator' let appPath = path.join(params.appOutDir, `$&#123;params.packager.appInfo.productFilename&#125;.app`); if (!fs.existsSync(appPath)) &#123; throw new Error(`Cannot find application at: $&#123;appPath&#125;`); &#125; console.log(`Notarizing $&#123;appId&#125; found at $&#123;appPath&#125;`); try &#123; await electron_notarize.notarize(&#123; appBundleId: appId, appPath: appPath, appleId: process.env.appleId, appleIdPassword: process.env.appleIdPassword, &#125;); &#125; catch (error) &#123; console.error(error); &#125; console.log(`Done notarizing $&#123;appId&#125;`);&#125;; RunGenerate password for Apple Id because of 2FA 123export appleId=onmyway133@gmail.comexport appleIdPassword=1234-abcd-efgh-7890npm run dist Check1spctl --assess --verbose Icon\\ Generator.app Troubleshootingbabel Since electron-builder create dist folder for distribution, for example dist/mac/Icon Generator, I‚Äôve renamed babel generated code to babel directory babel 6 regeneratorRuntime is not definedIt is because of afterSignHook. Ignore in .babelrc not work 123456789&#123; &quot;plugins&quot;: [ &quot;transform-react-jsx-source&quot; ], &quot;presets&quot;: [&quot;env&quot;, &quot;react&quot;], &quot;ignore&quot;: [ &quot;afterSignHook.js&quot; ]&#125; Should use babel 7 with babel.config.js https://babeljs.io/docs/en/config-files#project-wide-configuration 12npm install --save @babel/runtime npm install --save-dev @babel/plugin-transform-runtime Use electron-forgehttps://httptoolkit.tech/blog/notarizing-electron-apps-with-electron-forge/ Read more https://medium.com/@TwitterArchiveEraser/notarize-electron-apps-7a5f988406db https://kilianvalkhof.com/2019/electron/notarizing-your-electron-application/","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"},{"name":"electron","slug":"electron","permalink":"https://onmyway133.github.io/tags/electron/"}]},{"title":"How to use marked in WKWebView in AppKit","slug":"How-to-use-marked-in-WKWebView-in-AppKit","date":"2019-09-26T07:07:11.000Z","updated":"2019-09-26T11:35:26.000Z","comments":true,"path":"blog/How-to-use-marked-in-WKWebView-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-marked-in-WKWebView-in-AppKit/","excerpt":"","text":"Issue #429 Use https://github.com/markedjs/marked 123456789101112131415&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=\"utf-8\"/&gt; &lt;title&gt;Marked in the browser&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=\"content\"&gt;&lt;/div&gt; &lt;script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"&gt;&lt;/script&gt; &lt;script&gt; document.getElementById('content').innerHTML = marked(`# Marked in the browser\\n\\nRendered by **marked**.`); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; Should use back tick instead of &#39; to deal with multiline string, and escape back tick 1234let markdown = markdown.replacingOccurrences(of: \"`\", with: \"\\\\`\")marked(`\\(markdown)`);webView.loadHTMLString(string, baseURL: nil) For WKWebView to load even local content, need to enable Outgoing connections, and maybe Incoming connections in Sandbox","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to enable NSMenuItem in AppKit","slug":"How-to-enable-NSMenuItem-in-AppKit","date":"2019-09-25T08:26:20.000Z","updated":"2019-09-25T08:26:31.000Z","comments":true,"path":"blog/How-to-enable-NSMenuItem-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-enable-NSMenuItem-in-AppKit/","excerpt":"","text":"Issue #428 Need to set target 1234567let item = NSMenuItem( title: title, action: #selector(onMenuItemClicked(_:)), keyEquivalent: \"\")item.target = self Sometimes, need to check autoenablesItems Indicates whether the menu automatically enables and disables its menu items. This property contains a Boolean value, indicating whether the menu automatically enables and disables its menu items. If set to true, menu items of the menu are automatically enabled and disabled according to rules computed by the NSMenuValidation informal protocol. By default, NSMenu objects autoenable their menu items.","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use generic NSCollectionView in macOS","slug":"How-to-use-generic-NSCollectionView-in-macOS","date":"2019-09-24T11:49:34.000Z","updated":"2019-09-24T11:49:34.000Z","comments":true,"path":"blog/How-to-use-generic-NSCollectionView-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-generic-NSCollectionView-in-macOS/","excerpt":"","text":"Issue #427 See CollectionViewHandler Use ClickedCollectionView to detect clicked index for context menu.Embed NSCollectionView inside NSScrollView to enable scrolling 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778import AppKitpublic class CollectionViewHandler&lt;Item: Equatable, Cell: NSCollectionViewItem&gt;: NSObject, NSCollectionViewDataSource, NSCollectionViewDelegateFlowLayout &#123; public let layout = NSCollectionViewFlowLayout() public let scrollView = NSScrollView() public let collectionView = ClickedCollectionView() public var items = [Item]() public var itemSize: () -&gt; CGSize = &#123; .zero &#125; public var configure: (Item, Cell) -&gt; Void = &#123; _, _ in &#125; override init() &#123; super.init() layout.minimumLineSpacing = 4 layout.sectionInset = NSEdgeInsets(top: 4, left: 4, bottom: 4, right: 4) collectionView.dataSource = self collectionView.delegate = self collectionView.collectionViewLayout = layout collectionView.allowsMultipleSelection = false collectionView.backgroundColors = [.clear] collectionView.isSelectable = true collectionView.register(Cell.self, forItemWithIdentifier: Cell.itemId) scrollView.documentView = collectionView &#125; // MARK: - Items public func add(item: Item) &#123; items.insert(item, at: 0) let indexPath = IndexPath(item: 0, section: 0) collectionView.animator().insertItems(at: Set(arrayLiteral: indexPath)) &#125; public func remove(item: Item) &#123; guard let index = items.firstIndex(where: &#123; $0 == item &#125;) else &#123; return &#125; remove(index: index) &#125; public func remove(index: Int) &#123; items.remove(at: index) let indexPath = IndexPath(item: index, section: 0) collectionView.animator().deleteItems(at: Set(arrayLiteral: indexPath)) &#125; // MARK: - NSCollectionViewDataSource public func numberOfSections(in collectionView: NSCollectionView) -&gt; Int &#123; return 1 &#125; public func collectionView(_ collectionView: NSCollectionView, numberOfItemsInSection section: Int) -&gt; Int &#123; return items.count &#125; public func collectionView(_ collectionView: NSCollectionView, itemForRepresentedObjectAt indexPath: IndexPath) -&gt; NSCollectionViewItem &#123; let cell = collectionView.makeItem(withIdentifier: Cell.itemId, for: indexPath) as! Cell let item = items[indexPath.item] configure(item, cell) return cell &#125; // MARK: - NSCollectionViewDelegateFlowLayout public func collectionView(_ collectionView: NSCollectionView, layout collectionViewLayout: NSCollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; NSSize &#123; return itemSize() &#125;&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use throttle and debounce in RxSwift","slug":"How-to-use-throttle-and-debounce-in-RxSwift","date":"2019-09-19T06:13:56.000Z","updated":"2019-10-23T11:25:06.000Z","comments":true,"path":"blog/How-to-use-throttle-and-debounce-in-RxSwift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-throttle-and-debounce-in-RxSwift/","excerpt":"","text":"Issue #426 throttlehttps://rxmarbles.com/#throttle Returns an Observable that emits the first and the latest item emitted by the source Observable during sequential time windows of a specified duration.This operator makes sure that no two elements are emitted in less then dueTime. 1.throttle(.milliseconds(500), scheduler: MainScheduler.instance) In a time window, only the first item gets emitted. üí° In other words, in a time window, take first and discard following. For example, when failure, we show error message but don‚Äôt want to show error messages consecutively. We can use throttle to discard consecutive errors. 123viewModel.fetchBooksFail .observeOn(MainScheduler.instance) .throttle(.seconds(2), scheduler: MainScheduler.instance) debouncehttps://rxmarbles.com/#debounce Ignores elements from an observable sequence which are followed by another element within a specified relative time duration, using the specified scheduler to run throttling timers. 1.debounce(.milliseconds(500), scheduler: MainScheduler.instance) If an element is about to get emitted, wait for a time window to see if there are other elements emitted. If yes, start the waiting again. üí° In other words, in a time window, wait and take last For example, when receiving data, we may need to wait for the final data if there are many data events emitted consecutively 123viewModel.fetchBooks .filter(&#123; !$0.isEmpty &#125;) .debounce(.milliseconds(500), scheduler: MainScheduler.instance)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use flatMap and compactMap in Swift","slug":"How-to-use-flatMap-and-compactMap-in-Swift","date":"2019-09-19T05:41:24.000Z","updated":"2019-09-19T05:41:38.000Z","comments":true,"path":"blog/How-to-use-flatMap-and-compactMap-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-flatMap-and-compactMap-in-Swift/","excerpt":"","text":"Issue #425 flatMap: map and flatten array of arrayscompactMap: map and flatten array of optionals","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use Firebase ID token","slug":"How-to-use-Firebase-ID-token","date":"2019-09-17T11:05:11.000Z","updated":"2019-09-19T06:27:42.000Z","comments":true,"path":"blog/How-to-use-Firebase-ID-token/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Firebase-ID-token/","excerpt":"","text":"Issue #424 https://medium.com/@jwngr/demystifying-firebase-auth-tokens-e0c533ed330c One confusing point here that people often do not realize is that even though the custom token itself expires after one hour, a modern client SDK authenticated with that custom token will stay authenticated beyond that hour! What happens under the hood is that the custom token is sent to the Firebase Auth service in exchange for an ID token and refresh token pair which are used to keep the client SDK authenticated As with custom tokens, ID tokens are short-lived JWTs, lasting for just one hour. In order to allow end users to stay logged in for more than one hour, the modern SDKs transparently refresh a user‚Äôs ID token on your behalf using a refresh token If your app includes a custom backend server, ID tokens can and should be used to communicate securely with it. Instead of sending requests with a user‚Äôs raw uid which can be easily spoofed by a malicious client, send the user‚Äôs ID token which can be verified via a Firebase Admin SDK https://firebase.google.com/docs/auth/admin/verify-id-tokens#retrieve_id_tokens_on_clients When a user or device successfully signs in, Firebase creates a corresponding ID token that uniquely identifies them and grants them access to several resources, such as Firebase Realtime Database and Cloud Storage. You can re-use that ID token to identify the user or device on your custom backend server. To retrieve the ID token from the client, make sure the user is signed in and then get the ID token from the signed-in user:","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use custom domain for GitHub pages","slug":"How-to-use-custom-domain-for-GitHub-pages","date":"2019-09-17T09:40:48.000Z","updated":"2019-09-17T09:41:22.000Z","comments":true,"path":"blog/How-to-use-custom-domain-for-GitHub-pages/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-custom-domain-for-GitHub-pages/","excerpt":"","text":"Issue #423 In DNS settingsAdd 4 A records 1234A @ 185.199.110.153A @ 185.199.111.153A @ 185.199.108.153A @ 185.199.109.153 and 1 CNAME record 1CNAME www learntalks.github.io In GitHub Select custom domain and type learntalks.com In sourcepublic/CNAME 1learntalks.com","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"web","slug":"web","permalink":"https://onmyway133.github.io/tags/web/"}]},{"title":"How to constrain to views inside UICollectionViewCell in iOS","slug":"How-to-constrain-to-views-inside-UICollectionViewCell-in-iOS","date":"2019-09-17T07:44:33.000Z","updated":"2019-09-17T07:45:01.000Z","comments":true,"path":"blog/How-to-constrain-to-views-inside-UICollectionViewCell-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-constrain-to-views-inside-UICollectionViewCell-in-iOS/","excerpt":"","text":"Issue #422 To constrain views outside to elements inside UICollectionViewCell, we can use UILayoutGuide. Need to make layout guide the same constraints as the real elements 123456let imageViewGuide = UILayoutGuide()collectionView.addLayoutGuide(imageViewGuide)NSLayoutConstraint.on([ imageViewGuide.topAnchor.constraint(equalTo: collectionView.topAnchor, constant: 16), imageViewGuide.heightAnchor.constraint(equalTo: collectionView.heightAnchor, multiplier: 0.5)]) 1234NSLayoutConstraint.on([ loadingIndicator.centerXAnchor.constraint(equalTo: collectionView.centerXAnchor), loadingIndicator.centerYAnchor.constraint(equalTo: imageViewGuide.centerYAnchor)])","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to secure CVC in STPPaymentCardTextField in Stripe for iOS","slug":"How-to-secure-CVC-in-STPPaymentCardTextField-in-Stripe-for-iOS","date":"2019-09-16T09:14:07.000Z","updated":"2019-09-16T09:18:15.000Z","comments":true,"path":"blog/How-to-secure-CVC-in-STPPaymentCardTextField-in-Stripe-for-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-secure-CVC-in-STPPaymentCardTextField-in-Stripe-for-iOS/","excerpt":"","text":"Issue #421 123456789101112private func maskCvcIfAny() &#123; guard let view = paymentTextField.subviews.first(where: &#123; !($0 is UIImageView) &#125;), let cvcField = view.subviews .compactMap(&#123; $0 as? UITextField &#125;) .first(where: &#123; $0.tag == 2 &amp;&amp; ($0.accessibilityLabel ?? \"\").lowercased().contains(\"cvc\") &#125;) else &#123; return &#125; cvcField.isSecureTextEntry = true&#125; where tag is in STPPaymentCardTextFieldViewModel.h 123456typedef NS_ENUM(NSInteger, STPCardFieldType) &#123; STPCardFieldTypeNumber, STPCardFieldTypeExpiration, STPCardFieldTypeCVC, STPCardFieldTypePostalCode,&#125;; Also, need to check accessibilityLabel in STPPaymentCardTextField.m 1234567- (NSString *)defaultCVCPlaceholder &#123; if (self.viewModel.brand == STPCardBrandAmex) &#123; return STPLocalizedString(@\"CVV\", @\"Label for entering CVV in text field\"); &#125; else &#123; return STPLocalizedString(@\"CVC\", @\"Label for entering CVC in text field\"); &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to replace all occurrences of a string in Javascript","slug":"How-to-replace-all-occurrences-of-a-string-in-Javascript","date":"2019-09-16T08:31:23.000Z","updated":"2019-09-16T08:31:31.000Z","comments":true,"path":"blog/How-to-replace-all-occurrences-of-a-string-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-replace-all-occurrences-of-a-string-in-Javascript/","excerpt":"","text":"Issue #420 12345const normalized = string .replace(/\\//g, '') .replace(/\\\"/g, '') .replace(/\\(/g, '') .replace(/\\)/g, '')","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to read and write file using fs in node","slug":"How-to-read-and-write-file-using-fs-in-node","date":"2019-09-16T07:09:20.000Z","updated":"2019-09-16T08:52:30.000Z","comments":true,"path":"blog/How-to-read-and-write-file-using-fs-in-node/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-read-and-write-file-using-fs-in-node/","excerpt":"","text":"Issue #419 123456789101112function write(json) &#123; const data = JSON.stringify(json) const year = json.date.getFullYear() const directory = `collected/$&#123;slugify(className)&#125;/$&#123;year&#125;` fs.mkdirSync(directory, &#123; recursive: true &#125;) fs.writeFileSync( `$&#123;directory&#125;/$&#123;slugify(studentName)&#125;`, data, &#123; overwrite: true &#125; )&#125; 12345678910111213async function readAll() &#123; const classes = fs.readdirSync('classes') classes.forEach((class) =&gt; &#123; const years = fs.readdirSync(`classes/$&#123;class&#125;`) years.forEach((year) =&gt; &#123; const students = fs.readdirSync(`classes/$&#123;class&#125;/$&#123;year&#125;`) students.forEach((student) =&gt; &#123; const data = fs.readFileSync(`classes/$&#123;class&#125;/$&#123;year&#125;/$&#123;student&#125;) const json = JSON.parse(data) &#125;) &#125;) &#125;)&#125;","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"}]},{"title":"How to get videos from vimeo in node","slug":"How-to-get-videos-from-vimeo-in-node","date":"2019-09-16T06:36:02.000Z","updated":"2019-09-19T07:09:33.000Z","comments":true,"path":"blog/How-to-get-videos-from-vimeo-in-node/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-videos-from-vimeo-in-node/","excerpt":"","text":"Issue #418 CodePath for user users/nsspain/videosPath for showcase https://developer.vimeo.com/api/reference/albums#get_albumPath for Channels, Groups and Portfolios 12345678910111213141516171819202122232425262728const Vimeo = require('vimeo').Vimeoconst vimeoClient = new Vimeo(vimeoClientId, vimeoClientSecret, vimeoAccessToken)async getVideos(path) &#123; const options = &#123; path: `channels/staffpicks/videos`, query: &#123; page: 1, per_page: 100, fields: 'uri,name,description,created_time,pictures' &#125; &#125; return new Promise((resolve, reject) =&gt; &#123; try &#123; vimeoClient.request(options, (error, body, status_code, headers) =&gt; &#123; if (isValid(body)) &#123; resolve(body) &#125; else &#123; throw error &#125; &#125;) &#125; catch (e) &#123; reject(e) console.log(e) &#125; &#125;)&#125; Response look like 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293&#123; \"total\":13754, \"page\":1, \"per_page\":100, \"paging\":&#123; \"next\":\"/channels/staffpicks/videos?page=2&amp;per_page=100&amp;fields=uri%2Cname%2Cdescription%2Ccreated_time%2Cpictures\", \"previous\":null, \"first\":\"/channels/staffpicks/videos?page=1&amp;per_page=100&amp;fields=uri%2Cname%2Cdescription%2Ccreated_time%2Cpictures\", \"last\":\"/channels/staffpicks/videos?page=138&amp;per_page=100&amp;fields=uri%2Cname%2Cdescription%2Ccreated_time%2Cpictures\" &#125;, \"data\":[ &#123; \"uri\":\"/videos/359281775\", \"name\":\"Maestro\", \"description\":\"A Bloom Pictures short film directed by Illogic.\\n\\n\\\"Maestro\\\" is this week's Staff Pick Premiere. Read more about it on the Vimeo Blog: https://vimeo.com/blog/post/staff-pick-premiere-maestro-from-illogic\\n\\nMaking of :\\n https://vimeo.com/bloompictures/maestromakingof\\n\\nYou want to collaborate?\\nSend us a message at : hello@bloompictures.tv\\n\\nFor festivals and screenings, please contact : \\nfestival@miyu.fr\\n\\nPress/Media requests : \\nbenoit@animationshowcase.com\\n\\nhttps://www.bloompictures.tv\\n\\n¬©Bloom Pictures 2019\", \"created_time\":\"2019-09-11T12:31:33+00:00\", \"pictures\":&#123; \"uri\":\"/videos/359281775/pictures/813130850\", \"active\":true, \"type\":\"custom\", \"sizes\":[ &#123; \"width\":100, \"height\":75, \"link\":\"https://i.vimeocdn.com/video/813130850_100x75.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_100x75.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":200, \"height\":150, \"link\":\"https://i.vimeocdn.com/video/813130850_200x150.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_200x150.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":295, \"height\":166, \"link\":\"https://i.vimeocdn.com/video/813130850_295x166.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_295x166.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":640, \"height\":360, \"link\":\"https://i.vimeocdn.com/video/813130850_640x360.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_640x360.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":1280, \"height\":720, \"link\":\"https://i.vimeocdn.com/video/813130850_1280x720.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_1280x720.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":1920, \"height\":1080, \"link\":\"https://i.vimeocdn.com/video/813130850_1920x1080.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_1920x1080.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":640, \"height\":346, \"link\":\"https://i.vimeocdn.com/video/813130850_640x346.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_640x346.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":960, \"height\":519, \"link\":\"https://i.vimeocdn.com/video/813130850_960x519.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_960x519.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":1280, \"height\":692, \"link\":\"https://i.vimeocdn.com/video/813130850_1280x692.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_1280x692.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":1920, \"height\":1038, \"link\":\"https://i.vimeocdn.com/video/813130850_1920x1038.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_1920x1038.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125;, &#123; \"width\":1280, \"height\":692, \"link\":\"https://i.vimeocdn.com/video/813130850_1280x692.jpg?r=pad\", \"link_with_play_button\":\"https://i.vimeocdn.com/filter/overlay?src0=https%3A%2F%2Fi.vimeocdn.com%2Fvideo%2F813130850_1280x692.jpg&amp;src1=http%3A%2F%2Ff.vimeocdn.com%2Fp%2Fimages%2Fcrawler_play.png\" &#125; ], \"resource_key\":\"b42ac645a67b3277cb2fe66d3894016842ceef72\" &#125; &#125; ]&#125; Read more https://www.npmjs.com/package/vimeo#make-requests https://developer.vimeo.com/api/reference/users#get_picture","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"}]},{"title":"How to get videos from youtube in node","slug":"How-to-get-videos-from-youtube-in-node","date":"2019-09-13T12:06:43.000Z","updated":"2019-09-17T06:11:52.000Z","comments":true,"path":"blog/How-to-get-videos-from-youtube-in-node/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-videos-from-youtube-in-node/","excerpt":"","text":"Issue #417 12345678910111213141516171819202122232425class Youtube &#123; async getVideos(playlistId, pageToken) &#123; const options = &#123; key: clientKey, part: 'id,contentDetails,snippet', playlistId: playlistId, maxResult: 100, pageToken &#125; return new Promise((resolve, reject) =&gt; &#123; try &#123; youtube.playlistItems.list(options, (error, result) =&gt; &#123; if (isValid(result)) &#123; resolve(result) &#125; else &#123; throw error &#125; &#125;) &#125; catch (e) &#123; reject(e) &#125; &#125;) &#125;&#125; Response look like 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&#123; \"kind\": \"youtube#playlistItemListResponse\", \"etag\": \"\\\"p4VTdlkQv3HQeTEaXgvLePAydmU/ZNTrH71d3sV6gR6BWPeamXI1HhE\\\"\", \"nextPageToken\": \"CAUQAA\", \"pageInfo\": &#123; \"totalResults\": 32, \"resultsPerPage\": 5 &#125;, \"items\": [ &#123; \"kind\": \"youtube#playlistItem\", \"etag\": \"\\\"p4VTdlkQv3HQeTEaXgvLePAydmU/pt-bElhU3f7Q6c1Wc0URk9GJN-w\\\"\", \"id\": \"UExDbDVOTTRxRDN1X0w4ZEpyV1liTEI4RmNVYW9BSERGdC4yODlGNEE0NkRGMEEzMEQy\", \"snippet\": &#123; \"publishedAt\": \"2019-04-11T06:09:26.000Z\", \"channelId\": \"UCuPue-GLK4nVX8klxQITIOw\", \"title\": \"abc\", \"description\": \"abc\", \"thumbnails\": &#123; \"default\": &#123; \"url\": \"https://i.ytimg.com/vi/ZefmzgLabCA/default.jpg\", \"width\": 120, \"height\": 90 &#125;, \"medium\": &#123; \"url\": \"https://i.ytimg.com/vi/ZefmzgLabCA/mqdefault.jpg\", \"width\": 320, \"height\": 180 &#125;, \"high\": &#123; \"url\": \"https://i.ytimg.com/vi/ZefmzgLabCA/hqdefault.jpg\", \"width\": 480, \"height\": 360 &#125;, \"standard\": &#123; \"url\": \"https://i.ytimg.com/vi/ZefmzgLabCA/sddefault.jpg\", \"width\": 640, \"height\": 480 &#125;, \"maxres\": &#123; \"url\": \"https://i.ytimg.com/vi/ZefmzgLabCA/maxresdefault.jpg\", \"width\": 1280, \"height\": 720 &#125; &#125;, \"channelTitle\": \"try! Swift Conference\", \"playlistId\": \"PLCl5NM4qD3u_L8dJrWYbLB8FcUaoAHDFt\", \"position\": 0, \"resourceId\": &#123; \"kind\": \"youtube#video\", \"videoId\": \"ZefmzgLabCA\" &#125; &#125; &#125; ]&#125; To handle pagination 123456789async getVideosLoop(playlistId, nextPageToken, items, count) &#123; const response = await this.getVideos(playlistId, nextPageToken) const newItems = items.concat(response.data.items) if (isValid(response.data.nextPageToken) &amp;&amp; count &lt; 10) &#123; return this.getVideosLoop(playlistId, response.data.nextPageToken, newItems, count + 1) &#125; else &#123; return newItems &#125;&#125; To get playlist title, use playlists.list Read more https://developers.google.com/youtube/v3/docs/playlistItems/list https://developers.google.com/youtube/v3/quickstart/nodejs","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"}]},{"title":"How to convert callback to Promise in Javascript","slug":"How-to-convert-callback-to-Promise-in-Javascript","date":"2019-09-13T11:31:27.000Z","updated":"2019-09-13T11:52:29.000Z","comments":true,"path":"blog/How-to-convert-callback-to-Promise-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-convert-callback-to-Promise-in-Javascript/","excerpt":"","text":"Issue #416 12345678910111213// @flowconst toPromise = (f: (any) =&gt; void) =&gt; &#123; return new Promise&lt;any&gt;((resolve, reject) =&gt; &#123; try &#123; f((result) =&gt; &#123; resolve(result) &#125;) &#125; catch (e) &#123; reject(e) &#125; &#125;)&#125; 1const videos = await toPromise(callback) If a function accepts many parameters, we need to curry https://onmyway133.github.io/blog/Curry-in-Swift-and-Javascript/ 12345678910function curry2(f) &#123; return (p1) =&gt; &#123; return (p2) =&gt; &#123; return f(p1, p2) &#125; &#125;&#125;const callback = curry2(aFunctionThatAcceptsOptionsAndCallback)(options)const items = await toPromise(callback)","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to fix electron issues","slug":"How-to-fix-electron-issues","date":"2019-09-12T17:59:31.000Z","updated":"2019-09-13T05:23:28.000Z","comments":true,"path":"blog/How-to-fix-electron-issues/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-electron-issues/","excerpt":"","text":"Issue #415 Electron require() is not definedhttps://stackoverflow.com/questions/44391448/electron-require-is-not-defined 123456789101112function createWindow () &#123; win = new BrowserWindow(&#123; title: 'MyApp', width: 600, height: 500, resizable: false, icon: __dirname + '/Icon/Icon.icns', webPreferences: &#123; nodeIntegration: true &#125; &#125;)&#125; DevTools was disconnected from the page12npm install babel-cli@latest --save-devnpm install react@16.2.0 1win.openDevTools() This leads to Cannot find module &#39;react/lib/ReactComponentTreeHook&#39;If we‚Äôre using binary, then rebuild, it is the problem that cause devTools not work 1npx electron-builder This goes to Cannot read property injection of undefined at react-tap-event-plugin https://github.com/zilverline/react-tap-event-plugin/issues/121 1npm uninstall react-tap-event-plugin This goes to Unknown event handler property onTouchTap in EnhancedButton in material-ui Update material-uihttps://material-ui.com/https://material-ui.com/guides/migration-v0x/#raised-button 1npm install @material-ui/core From 1234import RadioButtonGroup from '@material-ui/core/RadioButton/RadioButtonGroup'import RadioButton from '@material-ui/core/RadioButton'import RaisedButton from '@material-ui/core/RaisedButton'import CardText from '@material-ui/core/Card/CardText' to 1234import RadioButtonGroup from '@material-ui/core/RadioGroup'import RadioButton from '@material-ui/core/Radio'import RaisedButton from '@material-ui/core/Button'import CardText from '@material-ui/core/DialogContentText' Use FormControlLabel https://material-ui.com/components/radio-buttons/ 1234567&lt;RadioGroup style=&#123;styles.group&#125; defaultselected=&#123;this.state.choice&#125; onChange=&#123;this.handleChoiceChange&#125; children=&#123;choiceElements&#125; /&gt; &#123;this.makeGenerateButton()&#125;/&gt;","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"electron","slug":"electron","permalink":"https://onmyway133.github.io/tags/electron/"}]},{"title":"How to easily parse deep json in Swift","slug":"How-to-easily-parse-deep-json-in-Swift","date":"2019-09-12T11:32:10.000Z","updated":"2019-09-13T07:31:27.000Z","comments":true,"path":"blog/How-to-easily-parse-deep-json-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-easily-parse-deep-json-in-Swift/","excerpt":"","text":"Issue #414 Codable is awesome, but sometimes we just need to quickly get value in a deepy nested JSON. In the same way I did for Dart How to resolve deep json object in Dart, let‚Äôs make that in Swift. See https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/JSON.swift 12345678910111213public func resolve&lt;T&gt;(_ jsonDictionary: [String: Any], keyPath: String) -&gt; T? &#123; var current: Any? = jsonDictionary keyPath.split(separator: \".\").forEach &#123; component in if let maybeInt = Int(component), let array = current as? Array&lt;Any&gt; &#123; current = array[maybeInt] &#125; else if let dictionary = current as? JSONDictionary &#123; current = dictionary[String(component)] &#125; &#125; return current as? T&#125; So we can just resolve via key path 1234567891011121314151617181920212223242526272829303132333435class JSONTests: XCTestCase &#123; func test() &#123; let json: [String: Any] = [ \"outside\": [ \"object\": [ \"number\": 1, \"text\": \"hello\" ], \"arrayOfObjects\": [ [ \"number\": 2, \"text\": \"two\" ], [ \"number\": 3, \"text\": \"three\" ] ], \"arrayOfArrays\": [ [ \"one\", \"two\", \"three\", \"four\" ], [ \"five\", \"six\", \"seven\" ] ] ] ] XCTAssertEqual(resolve(json, keyPath: \"outside.object.number\"), 1) XCTAssertEqual(resolve(json, keyPath: \"outside.object.text\"), \"hello\") XCTAssertEqual(resolve(json, keyPath: \"outside.arrayOfObjects.1.number\"), 3) XCTAssertEqual(resolve(json, keyPath: \"outside.arrayOfArrays.1.1\"), \"six\") &#125;&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to work with Hardened runtime and sandbox in macOS","slug":"How-to-work-with-Hardened-runtime-and-sandbox-in-macOS","date":"2019-09-11T07:16:52.000Z","updated":"2019-09-11T09:12:22.000Z","comments":true,"path":"blog/How-to-work-with-Hardened-runtime-and-sandbox-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-work-with-Hardened-runtime-and-sandbox-in-macOS/","excerpt":"","text":"Issue #413 Hardened Runtime and Sandboxing Resolving Common Notarization Issues macOS Code Signing In Depth","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"How to speed up GMSMarker in Google Maps for iOS","slug":"How-to-speed-up-GMSMarker-in-Google-Maps-for-iOS","date":"2019-09-10T09:23:47.000Z","updated":"2019-09-10T09:30:35.000Z","comments":true,"path":"blog/How-to-speed-up-GMSMarker-in-Google-Maps-for-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-speed-up-GMSMarker-in-Google-Maps-for-iOS/","excerpt":"","text":"Issue #412 Google Maps with a lot of pin, and no clustering can have bad performance if there are complex view in the marker. The workaround is to use manual layout and rasterization shouldRasterize When the value of this property is true, the layer is rendered as a bitmap in its local coordinate space and then composited to the destination with any other content. Shadow effects and any filters in the filters property are rasterized and included in the bitmap. However, the current opacity of the layer is not rasterized. If the rasterized bitmap requires scaling during compositing, the filters in the minificationFilter and magnificationFilter properties are applied as needed. In the class PinView: UIView 123456789101112131415isOpaque = truelayer.shouldRasterize = truelayer.rasterizationScale = UIScreen.main.scalefinal class StopMarker: GMSMarker &#123; let stop: Stop private let pinView = PinView() init(stop: Stop) &#123; self.stop = stop super.init() self.position = stop.toCoordinate() self.iconView = pinView &#125;&#125; Read more iOS Performance tips I: Drawing shadows When your app needs to draw something on the screen, the GPU takes your layer hierarchy (UIView is just a wrapper on top of CALayer, which in the end are OpenGL textures) and applies one by one on top of each other based on their x,y,z position. In regular rendering, the whole operation happens in special frame buffers that the display will directly read for rendering on the screen, repeating the process at a rate around 60 times per second. Of course the process have some drawbacks as well. The main one is that offscreen rendering requires a context switch (GPU has to change to a different memory area to perform the drawing) and then copying the resulting composited layer into the frame buffer. Every time any of the composited layers change, the cache needs to be redrawn again. This is why in many circumstances offscreen rendering is not a good idea, as it requires additional computation when need to be rerendered. Besides, the layer requires extra video memory which of course is limited, so use it with caution. Getting Pixels onto the Screen https://stackoverflow.com/questions/19405741/when-should-i-set-layer-shouldrasterize-to-yes","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to support drag and drop in UICollectionView iOS","slug":"How-to-support-drag-and-drop-in-UICollectionView-iOS","date":"2019-09-10T07:29:57.000Z","updated":"2019-09-10T07:30:49.000Z","comments":true,"path":"blog/How-to-support-drag-and-drop-in-UICollectionView-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-support-drag-and-drop-in-UICollectionView-iOS/","excerpt":"","text":"Issue #411 See DragAndDrop example 1234567891011121314151617181920212223242526272829303132333435363738394041class ViewController: UIViewController, UICollectionViewDropDelegate, UICollectionViewDragDelegate &#123; // MARK: - UICollectionViewDragDelegate func collectionView(_ collectionView: UICollectionView, itemsForBeginning session: UIDragSession, at indexPath: IndexPath) -&gt; [UIDragItem] &#123; let controller = leftController let provider = NSItemProvider( object: controller.imageForCell(indexPath: indexPath) ) let dragItem = UIDragItem(itemProvider: provider) dragItem.localObject = indexPath return [dragItem] &#125; // MARK: - UICollectionViewDropDelegate func collectionView(_ collectionView: UICollectionView, performDropWith coordinator: UICollectionViewDropCoordinator) &#123; let destinationIndexPath: IndexPath if let indexPath = coordinator.destinationIndexPath &#123; destinationIndexPath = indexPath &#125; else &#123; destinationIndexPath = IndexPath(row: 0, section: 0) &#125; let controller = rightController let dragItemIndexPath = coordinator.items.last?.dragItem.localObject as! IndexPath let draggedItem = leftController.items[dragItemIndexPath.item] // remove leftController.items.remove(at: dragItemIndexPath.item) leftController.collectionView.deleteItems(at: [dragItemIndexPath]) // insert controller.items.insert(draggedItem, at: destinationIndexPath.item) controller.collectionView.insertItems(at: [destinationIndexPath]) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to support drag and drop in NSView","slug":"How-to-support-drag-and-drop-in-NSView","date":"2019-09-10T07:25:02.000Z","updated":"2019-09-25T07:18:15.000Z","comments":true,"path":"blog/How-to-support-drag-and-drop-in-NSView/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-support-drag-and-drop-in-NSView/","excerpt":"","text":"Issue #410 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import AppKitimport Anchorsclass DraggingView: NSView &#123; var didDrag: ((FileInfo) -&gt; Void)? let highlightView = NSView() override init(frame frameRect: NSRect) &#123; super.init(frame: frameRect) registerForDraggedTypes([ .fileURL ]) highlightView.isHidden = true addSubview(highlightView) activate(highlightView.anchor.edges) highlightView.wantsLayer = true highlightView.layer?.borderColor = NSColor(hex: \"#FF6CA8\").cgColor highlightView.layer?.borderWidth = 6 &#125; required init?(coder decoder: NSCoder) &#123; fatalError() &#125; override func draggingEntered(_ sender: NSDraggingInfo) -&gt; NSDragOperation &#123; highlightView.isHidden = false return NSDragOperation() &#125; override func draggingEnded(_ sender: NSDraggingInfo) &#123; guard let pathAlias = sender.draggingPasteboard.propertyList(forType: .fileURL) as? String else &#123; return &#125; let url = URL(fileURLWithPath: pathAlias).standardized let fileInfo = FileInfo(url: url) didDrag?(fileInfo) &#125; override func draggingExited(_ sender: NSDraggingInfo?) &#123; highlightView.isHidden = true &#125; override func draggingUpdated(_ sender: NSDraggingInfo) -&gt; NSDragOperation &#123; return NSDragOperation() &#125;&#125; To get information about multiple files 12345678910111213141516override func draggingEnded(_ sender: NSDraggingInfo) &#123; guard let pasteBoardItems = sender.draggingPasteboard.pasteboardItems else &#123; return &#125; let fileInfos: [FileInfo] = pasteBoardItems .compactMap(&#123; return $0.propertyList(forType: .fileURL) as? String &#125;) .map(&#123; let url = URL(fileURLWithPath: $0).standardized return FileInfo(url: url) &#125;) didDrag(fileInfos)&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use NSStepper in Appkit","slug":"How-to-use-NSStepper-in-Appkit","date":"2019-09-08T19:48:50.000Z","updated":"2019-09-08T19:48:56.000Z","comments":true,"path":"blog/How-to-use-NSStepper-in-Appkit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-NSStepper-in-Appkit/","excerpt":"","text":"Issue #409 123456789101112131415let stepper = NSStepper()let textField = NSTextField(wrappingLabelWithString: \"\\(myLocalCount)\")stepper.integerValue = myLocalCountstepper.minValue = 5stepper.maxValue = 24stepper.valueWraps = falsestepper.target = selfstepper.action = #selector(onStepperChange(_:))@objc func onStepperChange(_ sender: NSStepper) &#123; myLocalCount = sender.integerValue textField.stringValue = \"\\(sender.integerValue)\"&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to handle shortcut in AppKit","slug":"How-to-handle-shortcut-in-AppKit","date":"2019-09-08T17:51:23.000Z","updated":"2019-09-08T17:51:29.000Z","comments":true,"path":"blog/How-to-handle-shortcut-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-shortcut-in-AppKit/","excerpt":"","text":"Issue #408 Podfile 1pod 'MASShortcut' 12345let shortcut = MASShortcut(keyCode: kVK_ANSI_K, modifierFlags: [.command, .shift])MASShortcutMonitor.shared()?.register(shortcut, withAction: &#123; self.showPopover(sender: self.statusItem.button)&#125;)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to select file in its directory in AppKit","slug":"How-to-select-file-in-its-directory-in-AppKit","date":"2019-09-07T19:14:41.000Z","updated":"2019-09-07T19:14:46.000Z","comments":true,"path":"blog/How-to-select-file-in-its-directory-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-select-file-in-its-directory-in-AppKit/","excerpt":"","text":"Issue #407 https://developer.apple.com/documentation/appkit/nsworkspace/1524399-selectfile In macOS 10.5 and later, this method does not follow symlinks when selecting the file. If the fullPath parameter contains any symlinks, this method selects the symlink instead of the file it targets. If you want to select the target file, use the resolvingSymlinksInPath method to resolve any symlinks before calling this method. It is safe to call this method from any thread of your app. 123NSWorkspace.shared.selectFile( url.path, inFileViewerRootedAtPath: url.deletingLastPathComponent().path)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use NSProgressIndicator in AppKit","slug":"How-to-use-NSProgressIndicator-in-AppKit","date":"2019-09-07T18:51:52.000Z","updated":"2019-09-07T18:51:59.000Z","comments":true,"path":"blog/How-to-use-NSProgressIndicator-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-NSProgressIndicator-in-AppKit/","excerpt":"","text":"Issue #406 1234let progressIndicator = NSProgressIndicator()progressIndicator.isIndeterminate = trueprogressIndicator.style = .spinningprogressIndicator.startAnimation(nil)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to show save panel in AppKit","slug":"How-to-show-save-panel-in-AppKit","date":"2019-09-07T17:36:00.000Z","updated":"2019-09-19T11:59:05.000Z","comments":true,"path":"blog/How-to-show-save-panel-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-save-panel-in-AppKit/","excerpt":"","text":"Issue #405 Enable Read/Write for User Selected File under Sandbox to avoid bridge absent error 12345678910111213141516171819202122232425262728func save() &#123; let panel = NSSavePanel() // 3 panel.directoryURL = FileManager.default.homeDirectoryForCurrentUser // 4 panel.nameFieldStringValue = \"abc.gif\" // 5 guard let window = view.window else &#123; return &#125; panel.beginSheetModal(for: window) &#123; (result) in guard result == .OK, let url = panel.url else &#123; self.showAlert() return &#125; &#125;&#125;func showAlert() &#123; let alert = NSAlert() alert.messageText = \"Hello world\" alert.informativeText = \"Information text\" alert.addButton(withTitle: \"OK\") alert.addButton(withTitle: \"Cancel\") alert.runModal()&#125; To save multiple files, use NSOpenPanel 12345let panel = NSOpenPanel()panel.canChooseFiles = falsepanel.allowsMultipleSelection = falsepanel.canChooseDirectories = truepanel.directoryURL = FileManager.default.homeDirectoryForCurrentUser Read more https://www.raywenderlich.com/666-filemanager-class-tutorial-for-macos-getting-started-with-the-file-system https://stackoverflow.com/questions/47954418/using-cocoa-nssavepanel-in-sandbox-causes-assertion-failure https://stackoverflow.com/questions/18417432/how-to-show-alert-pop-up-in-in-cocoa","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to animate NSView using keyframe","slug":"How-to-animate-NSView-using-keyframe","date":"2019-09-06T17:58:42.000Z","updated":"2019-09-06T17:58:47.000Z","comments":true,"path":"blog/How-to-animate-NSView-using-keyframe/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-animate-NSView-using-keyframe/","excerpt":"","text":"Issue #404 12345678let animation = CAKeyframeAnimation(keyPath: \"position.y\")animation.values = [50, 20, 50]animation.keyTimes = [0.0, 0.5, 1.0]animation.duration = 2animation.repeatCount = Float.greatestFiniteMagnitudeanimation.autoreverses = truemyView.wantsLayer = truemyView.layer?.add(animation, forKey: \"bounce\")","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to quit macOS on last window closed","slug":"How-to-quit-macOS-on-last-window-closed","date":"2019-09-06T09:13:14.000Z","updated":"2019-09-06T09:13:14.000Z","comments":true,"path":"blog/How-to-quit-macOS-on-last-window-closed/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-quit-macOS-on-last-window-closed/","excerpt":"","text":"Issue #403 https://developer.apple.com/documentation/appkit/nsapplicationdelegate/1428381-applicationshouldterminateafterl?language=objc The application sends this message to your delegate when the application‚Äôs last window is closed. It sends this message regardless of whether there are still panels open. (A panel in this case is defined as being an instance of NSPanel or one of its subclasses.) If your implementation returns NO, control returns to the main event loop and the application is not terminated. If you return YES, your delegate‚Äôs applicationShouldTerminate: method is subsequently invoked to confirm that the application should be terminated. 123func applicationShouldTerminateAfterLastWindowClosed(_ sender: NSApplication) -&gt; Bool &#123; return true&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to test Date with timezone aware in Swift","slug":"How-to-test-Date-with-timezone-aware-in-Swift","date":"2019-09-06T07:03:02.000Z","updated":"2019-09-12T07:11:22.000Z","comments":true,"path":"blog/How-to-test-Date-with-timezone-aware-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-test-Date-with-timezone-aware-in-Swift/","excerpt":"","text":"Issue #402 I want to test if a date has passed another date 12let base = Date(timeIntervalSince1970: 1567756697)XCTAssertEqual(validator.hasPassed(event: event, date: base), true) My hasPassed is using Calendar.current 12345func minuteSinceMidnight(date: Date) -&gt; MinuteSinceMidnight &#123; let calendar = Calendar.current let start = calendar.startOfDay(for: date) return Int(date.timeIntervalSince(start)) / 60&#125; But the minute is always having timezone applied. Even if I try with DateComponents 12345678func minuteSinceMidnight(date: Date) -&gt; MinuteSinceMidnight &#123; let components = calendar.dateComponents([.hour, .minute], from: date) guard let hour = components.hour, let minute = components.minute else &#123; return 0 &#125; return hour * 60 + minute&#125; As long as I use Calendar, it always has timezone applied. Checking this time interval 1567756697 on https://www.epochconverter.com/ Assuming that this timestamp is in seconds:GMT: Friday, September 6, 2019 7:58:17 PMYour time zone: Friday, September 6, 2019 9:58:17 PM GMT+02:00 DST Because I have GMT+2, there will always be 2 hours offset. This works in app, but not in test because of the way I construct Date with time interval. One way is to have test data using string construction, and provide timezone to DateFormatter 123let formatter = ISO8601DateFormatter()let date = formatter.date(from: \"2019-07-58T12:39:00Z\")let string = formatter.string(from: Date()) Another way is to have a fixed timezone for Calendar 12var calendar = Calendar.currentcalendar.timeZone = TimeZone(secondsFromGMT: 0)! Another way is to adjust existing date 1calendar.date(bySettingHour: 20, minute: 02, second: 00, of: Date()","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"testing","slug":"testing","permalink":"https://onmyway133.github.io/tags/testing/"}]},{"title":"How to sign executable for sandbox","slug":"How-to-sign-executable-for-sandbox","date":"2019-09-05T10:04:10.000Z","updated":"2019-09-06T03:34:56.000Z","comments":true,"path":"blog/How-to-sign-executable-for-sandbox/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-sign-executable-for-sandbox/","excerpt":"","text":"Issue #401 Find identity 1security find-identity Sign with entitlements and identity. For macOS, use 3rd Party Mac Developer Application 1codesign -f -s &quot;3rd Party Mac Developer Application: Khoa Pham (123DK123F2)&quot; --entitlements &quot;MyApp.entitlements&quot; &quot;tool/mytool&quot; To enable harden runtime 1codesign --verbose --force --deep -o runtime --sign","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"How to make simple traffic simulation in Javascript","slug":"How-to-make-simple-traffic-simulation-in-Javascript","date":"2019-09-05T07:14:24.000Z","updated":"2019-09-05T07:14:28.000Z","comments":true,"path":"blog/How-to-make-simple-traffic-simulation-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-simple-traffic-simulation-in-Javascript/","excerpt":"","text":"Issue #400 Use prototype.js for inheritance Use enchant.js for 2d game logic Code https://github.com/onmyway133/traffic_simulator","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to make collaborative drawing canvas with socketio and node","slug":"How-to-make-collaborative-drawing-canvas-with-socketio-and-node","date":"2019-09-05T07:10:35.000Z","updated":"2019-09-05T07:11:02.000Z","comments":true,"path":"blog/How-to-make-collaborative-drawing-canvas-with-socketio-and-node/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-collaborative-drawing-canvas-with-socketio-and-node/","excerpt":"","text":"Issue #399 Client Use https://github.com/facebook/create-react-app App.js 123456789101112import React, &#123; Component &#125; from 'react';import logo from './logo.svg';import './App.css';import Main from './Main'class App extends Component &#123; render() &#123; return &lt;Main /&gt; &#125;&#125;export default App; Main.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485// @flowimport React from 'react';import PropTypes from 'prop-types';import &#123; withStyles &#125; from '@material-ui/core/styles';import AppBar from '@material-ui/core/AppBar';import Toolbar from '@material-ui/core/Toolbar';import Typography from '@material-ui/core/Typography';import Button from '@material-ui/core/Button';import IconButton from '@material-ui/core/IconButton';import MenuIcon from '@material-ui/icons/Menu';import Manager from './Manager'const styles = &#123; root: &#123; flexGrow: 1, &#125;, grow: &#123; flexGrow: 1, &#125;, menuButton: &#123; marginLeft: -12, marginRight: 20, &#125;,&#125;;class Main extends React.Component &#123; static propTypes = &#123; classes: PropTypes.object.isRequired, &#125; render() &#123; const &#123; classes &#125; = this.props; return ( &lt;div className=&#123;classes.root&#125;&gt; &lt;AppBar position=\"static\"&gt; &lt;Toolbar&gt; &lt;IconButton className=&#123;classes.menuButton&#125; color=\"inherit\" aria-label=\"Menu\"&gt; &lt;MenuIcon /&gt; &lt;/IconButton&gt; &lt;Typography variant=\"h6\" color=\"inherit\" className=&#123;classes.grow&#125;&gt; Collaborate Canvas &lt;/Typography&gt; &lt;Button color=\"inherit\" onClick=&#123;this.onImagePress&#125; &gt;Image&lt;/Button&gt; &lt;Button color=\"inherit\" onClick=&#123;this.onClearPress&#125; &gt;Clear&lt;/Button&gt; &lt;input ref=\"fileInput\" type=\"file\" id=\"myFile\" multiple accept=\"image/*\" style=&#123;&#123;display: 'none'&#125;&#125; onChange=&#123;this.handleFiles&#125;&gt;&lt;/input&gt; &lt;/Toolbar&gt; &lt;/AppBar&gt; &lt;canvas ref=\"canvas\" with=\"1000\" height=\"1000\"&gt;&lt;/canvas&gt; &lt;/div&gt; ) &#125; componentDidMount() &#123; const canvas = this.refs.canvas this.manager = new Manager(canvas) this.manager.connect() &#125; onImagePress = () =&gt; &#123; const fileInput = this.refs.fileInput fileInput.click() &#125; onClearPress = () =&gt; &#123; this.manager.clear() &#125; handleFiles = (e) =&gt; &#123; e.persist() const canvas = this.refs.canvas const context = canvas.getContext('2d') const file = e.target.files[0] var image = new Image() image.onload = function() &#123; context.drawImage(image, 0, 0, window.innerWidth, window.innerHeight) &#125; image.src = URL.createObjectURL(file) &#125;&#125;export default withStyles(styles)(Main); ServerUse express and socket.io index.js 123456789101112131415161718192021222324252627282930313233343536// @flowconst express = require('express')const app = express()const http = require('http')const socketIO = require('socket.io')const server = http.createServer(app)const io = socketIO.listen(server)server.listen(3001)app.use(express.static(__dirname + '/public'))console.log(\"Server running on 127.0.0.1:8080\")let lines = []io.on('connection', (socket) =&gt; &#123; lines.forEach((line) =&gt; &#123; const data = &#123; line &#125; socket.emit('draw_line', data) &#125;) socket.on('draw_line', (data) =&gt; &#123; const &#123; line &#125; = data lines.push(line) io.emit('draw_line', data) &#125;) socket.on('clear', () =&gt; &#123; lines = [] io.emit('clear') &#125;) socket.on('draw_image', (data) =&gt; &#123; io.emit('draw_image', data) &#125;)&#125;)","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"}]},{"title":"How to generate changelog for GitHub releases with rxjs and node","slug":"How-to-generate-changelog-for-GitHub-releases-with-rxjs-and-node","date":"2019-09-05T07:03:12.000Z","updated":"2019-09-05T07:11:08.000Z","comments":true,"path":"blog/How-to-generate-changelog-for-GitHub-releases-with-rxjs-and-node/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-generate-changelog-for-GitHub-releases-with-rxjs-and-node/","excerpt":"","text":"Issue #398 How to Use https://github.com/onmyway133/github-changelogs-maker Generate personal access token https://github.com/settings/tokens TechnicalDependencies 1234const Rx = require('rxjs/Rx')const Fetch = require('node-fetch')const Minimist = require('minimist')const Fs = require('fs') Use GraphQL 123456789101112131415161718makeOptions(query, token) &#123; return &#123; method: 'POST', headers: &#123; 'Content-Type': 'application/json', 'Authorization': `bearer $&#123;token&#125;` &#125;, body: JSON.stringify(&#123; query: ` query &#123; repository(owner: \"$&#123;this.owner&#125;\", name: \"$&#123;this.repo&#125;\") &#123; $&#123;query&#125; &#125; &#125; ` &#125;) &#125;&#125; Use orderBy 12345678910111213141516171819202122232425262728fetchPRsAndIssues(dates) &#123; const query = ` pullRequests(last: 100, orderBy: &#123;field: UPDATED_AT, direction: ASC&#125;) &#123; edges &#123; node &#123; title merged mergedAt url author &#123; login url &#125; &#125; &#125; &#125; issues(last: 100, orderBy: &#123;field: UPDATED_AT, direction: ASC&#125;) &#123; edges &#123; node &#123; title closed updatedAt url &#125; &#125; &#125; &#125;&#125;","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"}]},{"title":"How to do launch screen in Android","slug":"How-to-do-launch-screen-in-Android","date":"2019-09-04T18:24:36.000Z","updated":"2019-09-04T18:24:41.000Z","comments":true,"path":"blog/How-to-do-launch-screen-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-launch-screen-in-Android/","excerpt":"","text":"Issue #397 We recommend that, rather than disabling the preview window, you follow the common Material Design patterns. You can use the activity‚Äôs windowBackground theme attribute to provide a simple custom drawable for the starting activity. styles.xml 123&lt;style name=\"LaunchTheme\" parent=\"Theme.AppCompat.NoActionBar\"&gt; &lt;item name=\"android:windowBackground\"&gt;@drawable/launch_background&lt;/item&gt;&lt;/style&gt; Set android:theme=&quot;@style/LaunchTheme&quot; to activity element AndroidManifest.xml 12345678910111213141516171819202122232425&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.onmyway133.whatsupintech\"&gt; &lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt; &lt;application android:name=\".MyApplication\" android:allowBackup=\"true\" android:icon=\"@mipmap/ic_launcher\" android:label=\"@string/app_name\" android:roundIcon=\"@mipmap/ic_launcher_round\" android:supportsRtl=\"true\" android:theme=\"@style/AppTheme\"&gt; &lt;activity android:name=\".features.main.MainActivity\" android:label=\"@string/app_name\" android:theme=\"@style/LaunchTheme\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\"/&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\"/&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/manifest&gt; MainActivity.kt 12345678class MainActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; setTheme(R.style.AppTheme_NoActionBar) super.onCreate(savedInstanceState) setContentView(R.layout.main_activity) &#125;&#125; Read more The Complete Android Splash Screen Guide Themed launch screens","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to add header to NavigationView in Android","slug":"How-to-add-header-to-NavigationView-in-Android","date":"2019-09-04T18:07:02.000Z","updated":"2019-09-04T18:07:10.000Z","comments":true,"path":"blog/How-to-add-header-to-NavigationView-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-header-to-NavigationView-in-Android/","excerpt":"","text":"Issue #396 Use app:headerLayout 12345678910&lt;com.google.android.material.navigation.NavigationView android:layout_width=\"wrap_content\" android:layout_height=\"match_parent\" android:id=\"@+id/navigationView\" android:fitsSystemWindows=\"true\" android:layout_gravity=\"start\" app:menu=\"@menu/drawer_menu\" app:itemIconTint=\"@color/title\" app:itemTextColor=\"@color/title\" app:headerLayout=\"@layout/navigation_header\" /&gt; navigation_header.xml 123456789101112131415&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt; &lt;androidx.appcompat.widget.AppCompatImageView android:layout_width=\"0dp\" android:layout_height=\"wrap_content\" android:src=\"@drawable/icon\" app:layout_constraintLeft_toLeftOf=\"parent\" app:layout_constraintRight_toRightOf=\"parent\" app:layout_constraintTop_toTopOf=\"parent\" app:layout_constraintBottom_toBottomOf=\"parent\"/&gt;&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to do simple analytics in iOS","slug":"How-to-do-simple-analytics-in-iOS","date":"2019-09-04T10:03:45.000Z","updated":"2019-09-04T10:07:10.000Z","comments":true,"path":"blog/How-to-do-simple-analytics-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-simple-analytics-in-iOS/","excerpt":"","text":"Issue #395 Prefer static enum to avoid repetition and error. The Log should have methods with all required fields so the call site is as simple as possible. How to format and assign parameters is encapsulated in this Analytics. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869import Foundationimport Firebaseimport FirebaseAnalyticsstruct Analytics &#123; enum Parameter: String &#123; case studentId = \"student_id\" case classId = \"class_id\" case url = \"url\" &#125; enum Property: String &#123; case grantLocation = \"grant_location\" &#125; enum Name: String &#123; case login case logOut = \"log_out\" case enroll &#125; struct Log &#123; private func log(_ name: Name, parameters: [Parameter: String] = [:]) &#123; let mapped: [String: String] = Dictionary(uniqueKeysWithValues: parameters.map(&#123; key, value in return (key.rawValue, value) &#125;)) FirebaseAnalytics.Analytics.logEvent(name.rawValue, parameters: mapped) &#125; private func set(userId: String?) &#123; FirebaseAnalytics.Analytics.setUserID(userId) &#125; private func setProperty(_ property: Property, value: String) &#123; FirebaseAnalytics.Analytics.setUserProperty(value, forName: property.rawValue) &#125; &#125; let log = Log()&#125;extension Analytics.Log &#123; func grantLocation(hasGranted: Bool) &#123; setProperty(.grantLocation, value: hasGranted.toString()) &#125; func login(userId: String) &#123; log(.login) set(userId: userId) &#125; func logOut() &#123; log(.logOut) set(userId: nil) &#125; func enroll(classId: String) &#123; log(.enroll, parameters: [ .classId: classId ]) &#125;&#125;private extension Bool &#123; func toString() -&gt; String &#123; return self ? \"yes\": \"no\" &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Back to static site","slug":"Back-to-static-site","date":"2019-09-03T18:11:53.000Z","updated":"2019-09-03T18:12:32.000Z","comments":true,"path":"blog/Back-to-static-site/","link":"","permalink":"https://onmyway133.github.io/blog/Back-to-static-site/","excerpt":"","text":"Issue #394 It‚Äôs been a while since I wrote Hello world, again, the ease of GitHub issue indeed motivates me to write more. In the mean time I also wrote on https://medium.com/@onmyway133 and https://dev.to/onmyway133 and got some traction. Then I started using GitHub pages again, with Jekyll and remote theme, it works great. But then I needed to manually link the GitHub issues to my page, that‚Äôs just labor work. The best combo is to have a GitHub page backed by GitHub issue. After a bit comparison between different static site generators, I actually tried them all, I chose Hexo because I simply like Javascript How to use Hexo to deploy static site How to get all GitHub issues using GraphQL I use the simple cactus theme for now with local searched power by https://www.npmjs.com/package/hexo-generator-search. Then I wrote a node.js script to mirror my GitHub issue to my page, with correct tags and updated date. If you by any chance visit my new page https://onmyway133.github.io/, ohayou from me üëã","categories":[],"tags":[]},{"title":"How to get all GitHub issues using GraphQL","slug":"How-to-get-all-GitHub-issues-using-GraphQL","date":"2019-09-03T12:02:25.000Z","updated":"2019-09-03T17:50:00.000Z","comments":true,"path":"blog/How-to-get-all-GitHub-issues-using-GraphQL/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-all-GitHub-issues-using-GraphQL/","excerpt":"","text":"Issue #393 https://developer.github.com/v4/explorer/ 123456789101112131415161718192021query &#123; repository(owner: &quot;onmyway133&quot;, name: &quot;blog&quot;) &#123; issues(orderBy: &#123;field: UPDATED_AT, direction: ASC&#125;, last: 100) &#123; edges &#123; cursor node &#123; title createdAt updatedAt labels(first: 10) &#123; edges &#123; node &#123; name &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; In node.js 1234567891011121314151617181920212223242526272829303132333435const GraphQL = require('graphql-request')const GraphQLClient = GraphQL.GraphQLClient const client = new GraphQLClient('https://api.github.com/graphql', &#123; headers: &#123; Authorization: 'Bearer 123456730712334152e6e1232c53987654312', &#125;,&#125;) const query = `&#123; repository(owner: \"onmyway133\", name: \"blog\") &#123; issues(first: 100) &#123; edges &#123; node &#123; title createdAt updatedAt labels(first: 10) &#123; edges &#123; node &#123; name &#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125;` client.request(query).then(data =&gt; &#123; const issues = data.repository.issues.edges.map((edge) =&gt; &#123; return edge.node &#125;) console.log(issues)&#125;)","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to use Hexo to deploy static site","slug":"How-to-use-Hexo-to-deploy-static-site","date":"2019-09-03T11:02:18.000Z","updated":"2019-09-13T08:38:41.000Z","comments":true,"path":"blog/How-to-use-Hexo-to-deploy-static-site/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Hexo-to-deploy-static-site/","excerpt":"","text":"Issue #392 It‚Äôs been a long journey since https://github.com/onmyway133/blog/issues/1, next step is to keep GitHub issues as source, and mirror those to a static site. Use 2 repos https://github.com/onmyway133/web for source https://github.com/onmyway133/onmyway133.github.io for generated content 1234npm install -g hexo-cliecho $PATH=$PATH:/Users/khoa/.nodenv/versions/10.15.2/bin/hexohexo init blognpm install hexo-deployer-git --save Update _config.yml 1234deploy: type: git repo: https://github.com/onmyway133/onmyway133.github.io.git branch: master 12hexo cleanhexo deploy Read more https://hexo.io/docs/deployment.html https://gist.github.com/btfak/18938572f5df000ebe06fbd1872e4e39","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to use type coersion in Javascript","slug":"How-to-use-type-coersion-in-Javascript","date":"2019-09-03T09:59:28.000Z","updated":"2019-09-03T10:00:21.000Z","comments":true,"path":"blog/How-to-use-type-coersion-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-type-coersion-in-Javascript/","excerpt":"","text":"Issue #391 People who make fun of Javascript probably don‚Äôt understand implicit type coersion and when to use triple equal. Javascript is very unexpected, but when we work with this language, we need to be aware. Coercion‚ÄìAutomatically changing a value from one type to another. If x is Number and y is String, return x == ToNumber(y) If x is String or Number and y is Object, return x == ToPrimitive(y) Empty array becomes empty string Read more https://codeburst.io/javascript-double-equals-vs-triple-equals-61d4ce5a121a https://www.freecodecamp.org/news/js-type-coercion-explained-27ba3d9a2839/ https://www.freecodecamp.org/news/explaining-the-best-javascript-meme-i-have-ever-seen/","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to safely access deeply nested object in Javascript","slug":"How-to-safely-access-deeply-nested-object-in-Javascript","date":"2019-09-03T09:53:16.000Z","updated":"2019-09-03T09:53:25.000Z","comments":true,"path":"blog/How-to-safely-access-deeply-nested-object-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-safely-access-deeply-nested-object-in-Javascript/","excerpt":"","text":"Issue #390 An object ‚Äòs property can be null or undefined. Accessing step by step is tedious 1234props.user &amp;&amp;props.user.posts &amp;&amp;props.user.posts[0] &amp;&amp;props.user.posts[0].comments Dynamic parsing path is too clever and involves string in the end, which is a no no 1234const get = (p, o) =&gt; p.reduce((xs, x) =&gt; (xs &amp;&amp; xs[x]) ? xs[x] : null, o)const getUserComments = get(['user', 'posts', 0, 'comments']) Instead let‚Äôs use function and catch errors explicitly, and defaults with a fallback 1234567891011121314const get: (f, defaultValue) =&gt; &#123; try &#123; const value = f() if (isNotNullOrUndefined(value)) &#123; return value &#125; else &#123; return defaultValue &#125; &#125; catch &#123; return defaultValue &#125;&#125;const comments = get(() =&gt; &#123; .user.posts[0].comments &#125;, []) Read more https://medium.com/javascript-inside/safely-accessing-deeply-nested-values-in-javascript-99bf72a0855a","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to use flow type in Javascript","slug":"How-to-use-flow-type-in-Javascript","date":"2019-09-03T09:46:41.000Z","updated":"2019-09-03T09:47:19.000Z","comments":true,"path":"blog/How-to-use-flow-type-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-flow-type-in-Javascript/","excerpt":"","text":"Issue #389 Prefer flow over TypeScript for simplicity Javascript primitive types number and string are too general and do not express the domain objects. Because lack of type alias in Javascript, we can use flow 123456789101112131415161718192021222324export type Centimeter = numberexport type Color = stringexport type ImageSource = numberexport type Kilogram = numberexport type Kilocalorie = number // 1 cal = 4.1840 Jexport type Second = numberexport type SecondsSince1970 = numberexport type Minute = numberexport type DateString = string // 2018-11-20export type DateTimeString = string // 2018-11-20T00:00:00export type YearWeekString = string // 201838export type FunctionWithVoid = () =&gt; voidexport type FunctionWithString = (string) =&gt; voidexport type FunctionWithBoolean = (boolean) =&gt; voidexport type FunctionWithNumber = (number) =&gt; voidexport type JSONObject = anyexport type JSONString = stringexport type StringToString = anyexport type Degree = numberexport type Radian = numberexport type Animal = 'cat' | 'dog' | 'cow'","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to use flow in Kotlin","slug":"How-to-use-flow-in-Kotlin","date":"2019-09-03T08:57:06.000Z","updated":"2019-09-03T09:06:53.000Z","comments":true,"path":"blog/How-to-use-flow-in-Kotlin/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-flow-in-Kotlin/","excerpt":"","text":"Issue #388 Asynchronous Flowhttps://kotlinlang.org/docs/reference/coroutines/flow.html Using List result type we can only return all the values at once. To represent the stream of values that are being asynchronously computed we can use Flow type similarly to the Sequence type for synchronously computed values:","categories":[],"tags":[{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to choose Firebase vs Google Analytics","slug":"How-to-choose-Firebase-vs-Google-Analytics","date":"2019-09-03T08:32:17.000Z","updated":"2019-09-03T08:34:12.000Z","comments":true,"path":"blog/How-to-choose-Firebase-vs-Google-Analytics/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-choose-Firebase-vs-Google-Analytics/","excerpt":"","text":"Issue #387 Google Analytics is shutting down. From Firebase Analytics console, we can choose to upgrade to Google Analytics, no code change is needed. https://support.google.com/firebase/answer/9167112?hl=en In October 2019, we will start to sunset Google Analytics mobile-apps reporting based on the Google Analytics Services SDKs for Android and iOS. https://firebase.googleblog.com/2019/07/firebase-google-analytics-upgrade.html Thanks to our continued partnership with Google Analytics, you can now upgrade your Firebase projects to the next generation of app analytics! https://www.e-nor.com/blog/google-analytics/google-analytics-unifies-app-and-website-measurement Google Analytics team has officially launched a new type of GA properties called ‚ÄúApp + Web‚Äù to open public beta It is a new GA property type that allows you to combine app and web data for unified reporting and analysis Over the coming weeks, those who have existing Firebase projects will be able to upgrade your projects to the next generation Google Analytics experience as follows:","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use lessThan and greaterThan in Auto Layout in iOS","slug":"How-to-use-lessThan-and-greaterThan-in-Auto-Layout-in-iOS","date":"2019-09-03T05:36:58.000Z","updated":"2019-09-03T05:37:03.000Z","comments":true,"path":"blog/How-to-use-lessThan-and-greaterThan-in-Auto-Layout-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-lessThan-and-greaterThan-in-Auto-Layout-in-iOS/","excerpt":"","text":"Issue #386 When it comes to right and bottom side, we should use negative values, and use lessThan, as it means less than a negative value","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to check app running on jailbreak iOS device","slug":"How-to-check-app-running-on-jailbreak-iOS-device","date":"2019-09-02T10:53:07.000Z","updated":"2019-09-02T10:53:13.000Z","comments":true,"path":"blog/How-to-check-app-running-on-jailbreak-iOS-device/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-check-app-running-on-jailbreak-iOS-device/","excerpt":"","text":"Issue #385 From https://github.com/OneSignal/OneSignal-iOS-SDK/blob/master/iOS_SDK/OneSignalSDK/Source/OneSignalJailbreakDetection.m 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172+ (BOOL)isJailbroken &#123; #if !(TARGET_IPHONE_SIMULATOR) FILE *file = fopen(\"/Applications/Cydia.app\", \"r\"); if (file) &#123; fclose(file); return YES; &#125; file = fopen(\"/Library/MobileSubstrate/MobileSubstrate.dylib\", \"r\"); if (file) &#123; fclose(file); return YES; &#125; file = fopen(\"/bin/bash\", \"r\"); if (file) &#123; fclose(file); return YES; &#125; file = fopen(\"/usr/sbin/sshd\", \"r\"); if (file) &#123; fclose(file); return YES; &#125; file = fopen(\"/etc/apt\", \"r\"); if (file) &#123; fclose(file); return YES; &#125; file = fopen(\"/usr/bin/ssh\", \"r\"); if (file) &#123; fclose(file); return YES; &#125; NSFileManager *fileManager = [NSFileManager defaultManager]; if ([fileManager fileExistsAtPath:@\"/Applications/Cydia.app\"]) return YES; else if ([fileManager fileExistsAtPath:@\"/Library/MobileSubstrate/MobileSubstrate.dylib\"]) return YES; else if ([fileManager fileExistsAtPath:@\"/bin/bash\"]) return YES; else if ([fileManager fileExistsAtPath:@\"/usr/sbin/sshd\"]) return YES; else if ([fileManager fileExistsAtPath:@\"/etc/apt\"]) return YES; else if ([fileManager fileExistsAtPath:@\"/usr/bin/ssh\"]) return YES; // Omit logic below since they show warnings in the device log on iOS 9 devices. if (NSFoundationVersionNumber &gt; 1144.17) // NSFoundationVersionNumber_iOS_8_4 return NO; // Check if the app can access outside of its sandbox NSError *error = nil; NSString *string = @\".\"; [string writeToFile:@\"/private/jailbreak.txt\" atomically:YES encoding:NSUTF8StringEncoding error:&amp;error]; if (!error) return YES; else [fileManager removeItemAtPath:@\"/private/jailbreak.txt\" error:nil]; // Check if the app can open a Cydia's URL scheme if ([[UIApplication sharedApplication] canOpenURL:[NSURL URLWithString:@\"cydia://package/com.example.package\"]]) return YES; #endif return NO;&#125;","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Links for iOS","slug":"Links-for-iOS","date":"2019-08-29T04:47:11.000Z","updated":"2019-10-29T09:09:30.000Z","comments":true,"path":"blog/Links-for-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/Links-for-iOS/","excerpt":"","text":"Issue #384 General iOS Device Display Summary Information Property List Screenshot specifications iOS Adoption https://mixpanel.com/trends/ https://developer.apple.com/support/app-store/ Tools https://app.quicktype.io/ https://www.wtfautolayout.com/","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to create bounce animation programmatically in Android","slug":"How-to-create-bounce-animation-programmatically-in-Android","date":"2019-08-28T19:03:35.000Z","updated":"2019-08-28T19:04:15.000Z","comments":true,"path":"blog/How-to-create-bounce-animation-programmatically-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-create-bounce-animation-programmatically-in-Android/","excerpt":"","text":"Issue #383 Right click res -&gt; New -&gt; Android Resource Directory, select anim and name it animRight click res/anim -&gt; New -&gt; Android Resource file, name it bounce 1234567891011121314151617&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;set xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt; &lt;translate android:fromYDelta=\"0\" android:toYDelta=\"-100\" android:repeatCount=\"infinite\" /&gt;&lt;/set&gt;``` We have to set `repeatCount` in xml, setting in code does not work !!```ktval bounce = AnimationUtils.loadAnimation(context, R.anim.bounce)bounce.repeatMode = Animation.REVERSEbounce.duration = (1000..2000).random().toLong()imageView.startAnimation(bounce)","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to use point in dp programmatically in Android","slug":"How-to-use-point-in-dp-programmatically-in-Android","date":"2019-08-28T18:43:54.000Z","updated":"2019-08-28T18:44:00.000Z","comments":true,"path":"blog/How-to-use-point-in-dp-programmatically-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-point-in-dp-programmatically-in-Android/","excerpt":"","text":"Issue #382 12345678910import android.content.Contextfun Int.toDp(context: Context?): Int &#123; if (context != null) &#123; val scale = context.resources.displayMetrics.density return (this.toFloat() * scale + 0.5f).toInt() &#125; else &#123; return 0 &#125;&#125; 12val set = ConstraintSet()set.setMargin(imageView.id, ConstraintSet.RIGHT, rightMargin.toDp(150)) Read more https://stackoverflow.com/questions/5255184/android-and-setting-width-and-height-programmatically-in-dp-units","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to create constraints programmatically with ConstraintLayout in Android","slug":"How-to-create-constraints-programmatically-with-ConstraintLayout-in-Android","date":"2019-08-28T18:11:14.000Z","updated":"2019-08-28T18:11:22.000Z","comments":true,"path":"blog/How-to-create-constraints-programmatically-with-ConstraintLayout-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-create-constraints-programmatically-with-ConstraintLayout-in-Android/","excerpt":"","text":"Issue #381 From API &lt; 17, there is ViewCompat.generateViewId()For API 17, there is View.generateViewId() Note that to use ConstraintSet, all views under ConstraintLayout inside xml must have unique id 123456789val imageView = ImageView(context)imageView.id = View.generateViewId()imageView.setImageResource(resId)constraintLayout.addView(imageView)val set = ConstraintSet()set.clone(constraintLayout)set.connect(imageView.id, ConstraintSet.RIGHT, ConstraintSet.PARENT_ID, ConstraintSet.RIGHT)set.applyTo(constraintLayout)","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to use custom font as resource in Android","slug":"How-to-use-custom-font-as-resource-in-Android","date":"2019-08-28T17:22:23.000Z","updated":"2019-08-28T17:25:37.000Z","comments":true,"path":"blog/How-to-use-custom-font-as-resource-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-custom-font-as-resource-in-Android/","excerpt":"","text":"Issue #380 Downloadable fontshttps://developer.android.com/guide/topics/ui/look-and-feel/downloadable-fonts Android 8.0 (API level 26) and Android Support Library 26 introduce support for APIs to request fonts from a provider application instead of bundling files into the APK or letting the APK download fonts. The feature is available on devices running Android API versions 14 and higher through the Support Library 26 Before Select File -&gt; New -&gt; Folder -&gt; Assets Folder to create src/main/assets/fonts 12al myTypeface = Typeface.createFromAsset(assets, \"fonts/myFont.ttf\")myTextView.typeface = myTypeface In resCreate font directory Right click res -&gt; New -&gt; Android Resource Directory, select font and name the folder font Add custom fonts to res/font folder. Note that name must be lower case and underscore, like opensans_extrabolditalic.ttf Right click res/font -&gt; New -&gt; Font resource file to create font family opensans.xml 1234567891011121314151617181920212223242526272829303132333435&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;font-family xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" &gt; &lt;font android:font=\"@font/opensans_regular\" android:fontStyle=\"normal\" android:fontWeight=\"400\" app:fontFamily=\"@font/opensans_regular\" app:fontStyle=\"normal\" app:fontWeight=\"400\" /&gt; &lt;font android:font=\"@font/opensans_semibold\" android:fontStyle=\"normal\" android:fontWeight=\"400\" app:fontFamily=\"@font/opensans_semibold\" app:fontStyle=\"normal\" app:fontWeight=\"400\" /&gt; &lt;font android:font=\"@font/opensans_bold\" android:fontStyle=\"normal\" android:fontWeight=\"400\" app:fontFamily=\"@font/opensans_bold\" app:fontStyle=\"normal\" app:fontWeight=\"400\" /&gt;&lt;/font-family&gt;``` Then use```xml&lt;TextView android:fontFamily=\"@font/opensans_bold\" android:textSize=\"26dp\"/&gt; Read more https://stackoverflow.com/questions/5583608/difference-between-res-and-assets-directories https://www.raywenderlich.com/213-custom-and-downloadable-fonts-on-android https://stackoverflow.com/questions/27588965/how-to-use-custom-font-in-a-project-written-in-android-studio","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to get Hacker News top stories using parallel coroutine and Retrofit","slug":"How-to-get-Hacker-News-top-stories-using-parallel-coroutine-and-Retrofit","date":"2019-08-28T09:46:17.000Z","updated":"2019-09-02T06:06:18.000Z","comments":true,"path":"blog/How-to-get-Hacker-News-top-stories-using-parallel-coroutine-and-Retrofit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-Hacker-News-top-stories-using-parallel-coroutine-and-Retrofit/","excerpt":"","text":"Issue #379 1234567interface Api &#123; @GET(\"topstories.json?print=pretty\") suspend fun getTopStories(): List&lt;Int&gt; @GET(\"item/&#123;id&#125;.json?print=pretty\") suspend fun getStory(@Path(\"id\") id: Int): Item&#125; 123456789class Repo &#123; fun api(): Api &#123; return Retrofit.Builder() .baseUrl(\"https://hacker-news.firebaseio.com/v0/\") .addConverterFactory(MoshiConverterFactory.create()) .build() .create(Api::class.java) &#125;&#125; 123456789101112131415161718class ViewModel(val repo: Repo): ViewModel() &#123; val items = MutableLiveData&lt;ArrayList&lt;Item&gt;&gt;() suspend fun load() &#123; try &#123; val ids = repo.api() .getTopStories() .take(20) val items = ids.map &#123; repo.api().getStory(it) &#125; this.items.value = items.toCollection(ArrayList()) &#125; catch (e: Exception) &#123; this.items.value = arrayListOf() &#125; &#125;&#125; Running parallelThe above run in serial. To run in parallel, we can use async 12345678910111213141516171819202122232425import kotlinx.coroutines.asyncimport kotlinx.coroutines.coroutineScopeclass ViewModel(val repo: Repo): ViewModel() &#123; val items = MutableLiveData&lt;ArrayList&lt;Item&gt;&gt;() suspend fun load() &#123; try &#123; val ids = repo.api() .getTopStories() .take(20) coroutineScope &#123; val items = ids .map &#123; async &#123; repo.api().getStory(it) &#125; &#125; .awaitAll() this@ViewModel.items.value = items.toCollection(ArrayList()) &#125; &#125; catch (e: Exception) &#123; this.items.value = arrayListOf() &#125; &#125;&#125; Parallel decompositionhttps://medium.com/@elizarov/structured-concurrency-722d765aa952 With structured concurrency async coroutine builder became an extension on CoroutineScope just like launch did. You cannot simply write async { ‚Ä¶ } anymore, you have to provide a scope. A proper example of parallel decomposition becomes: coroutineScopehttps://proandroiddev.com/part-2-coroutine-cancellation-and-structured-concurrency-2dbc6583c07d coroutineScope function can be used to create a custom scope that suspends and only completes when all coroutines launched within that scope complete. If any of the children coroutines within the coroutineScope throws an exception, all other running sibling coroutines gets cancelled and this exception is propagated up the hierarchy. If the parent coroutine at the top of the hierarchy does not handle this error, it will also be cancelled. awaitAllhttps://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/await-all.html Awaits for completion of given deferred values without blocking a thread and resumes normally with the list of values when all deferred computations are complete or resumes with the first thrown exception if any of computations complete exceptionally including cancellation. This function is not equivalent to deferreds.map { it.await() } which fails only when it sequentially gets to wait for the failing deferred, while this awaitAll fails immediately as soon as any of the deferreds fail. This suspending function is cancellable. If the Job of the current coroutine is cancelled or completed while this suspending function is waiting, this function immediately resumes with CancellationException. Read more https://jivimberg.io/blog/2018/05/04/parallel-map-in-kotlin/ https://stackoverflow.com/questions/53535977/coroutines-runblocking-vs-coroutinescope awaitAll https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/await-all.html","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to show generic list in Fragment in Android","slug":"How-to-show-generic-list-in-Fragment-in-Android","date":"2019-08-28T06:57:10.000Z","updated":"2019-08-28T09:30:51.000Z","comments":true,"path":"blog/How-to-show-generic-list-in-Fragment-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-generic-list-in-Fragment-in-Android/","excerpt":"","text":"Issue #378 After having a generic RecyclerView, if we want to show multiple kinds of data in Fragment, we can use generic. We may be tempted to use interface or protocol, but should prefer generic. 12345678910111213141516171819class FeedFragment() : Fragment() &#123; override fun onActivityCreated(savedInstanceState: Bundle?) &#123; super.onActivityCreated(savedInstanceState) val mainViewModel: MainViewModel = ViewModelProviders.of(activity!!).get(MainViewModel::class.java) mainViewModel.resId.observe(viewLifecycleOwner, Observer &#123; when (it) &#123; R.id.gitHub -&gt; &#123; handleGitHub() &#125; R.id.hackerNews -&gt; &#123; handleHackerNews() &#125; R.id.reddit -&gt; &#123; handleReddit() &#125; R.id.dev -&gt; &#123; handleDev() &#125; R.id.productHunt -&gt; &#123; handleProductHunt() &#125; else -&gt; &#123;&#125; &#125; &#125;) recyclerView.layoutManager = LinearLayoutManager(context) &#125;&#125; The difference between each kind are The type of model The type of Adapter How to observe from viewModel How to load from viewModel Here we also use lifecycleScope from lifecycle runtime ktx 1implementation \"androidx.lifecycle:lifecycle-runtime-ktx:2.2.0-alpha01\" 12345678910111213141516171819202122232425private fun &lt;T&gt; handle( makeResId: () -&gt; Int, makeAdapter: () -&gt; com.myapp.Adapter&lt;T&gt;, observe: ((ArrayList&lt;T&gt;) -&gt; Unit) -&gt; Unit, load: suspend () -&gt; Unit) &#123; (activity as AppCompatActivity).toolbar.title = getString(makeResId()) val adapter = makeAdapter() recyclerView.adapter = adapter observe &#123; adapter.update(it) &#125; fun doLoad() &#123; viewLifecycleOwner.lifecycleScope.launch &#123; progressBar.visibility = View.VISIBLE load() progressBar.visibility = View.GONE swipeRefreshLayout.isRefreshing = false &#125; &#125; doLoad() swipeRefreshLayout.setOnRefreshListener &#123; doLoad() &#125;&#125; Then we just need to provide the required data 123456789101112131415private fun handleDev() &#123; val viewModel: com.myapp.ViewModel by viewModel() handle( &#123; R.string.menu_dev &#125;, &#123; com.myapp.Adapter(items = arrayListOf()) &#125;, &#123; completion -&gt; viewModel.items.observe(viewLifecycleOwner, Observer &#123; completion(it) &#125;) &#125;, &#123; viewModel.load() &#125; )&#125; Read more Use Kotlin coroutines with Architecture components","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to manage OneSignal push notification in iOS","slug":"How-to-manage-OneSignal-push-notification-in-iOS","date":"2019-08-27T11:29:44.000Z","updated":"2019-08-27T11:31:33.000Z","comments":true,"path":"blog/How-to-manage-OneSignal-push-notification-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-manage-OneSignal-push-notification-in-iOS/","excerpt":"","text":"Issue #377 OneSignal is an alternative for Parse for push notifications but the sdk has many extra stuff and assumptions and lots of swizzling. We can just use Rest to make API calls. From https://github.com/onmyway133/Dust Every official push notification SDK can do many things Register device token. This is crucial for the notification to get from your backend -&gt; APNS -&gt; device Manage player id, user id, arn, ‚Ä¶This is used to associate with device token Manager tag, topic, subscription, segments, ‚Ä¶This is used to group a set of device tokens Do swizzling, update your application badge number, change your user notification settings, ‚Ä¶ without your knowing about that Some other fancy stuffs Dust does only one thing, which is push notification handling. The rest is under your control OneSignal 1234567func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject : AnyObject]?) -&gt; Bool &#123; OneSignal.appID = \"\"&#125;func application(application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: NSData) &#123; OneSignal.handleDeviceToken(deviceToken)&#125; Here is the implementation 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768import UIKitstruct Utils &#123; static func parse(deviceToken data: NSData) -&gt; String &#123; let buffer = UnsafePointer&lt;CChar&gt;(data.bytes) var string = \"\" for i in 0..&lt;data.length &#123; string += String(format: \"%02.2hhx\", arguments: [buffer[i]]) &#125; return string &#125; static func deviceModel() -&gt; String &#123; var systemInfo = utsname() uname(&amp;systemInfo) var v = systemInfo.machine var deviceModel = \"\" let _ = withUnsafePointer(&amp;v) &#123; deviceModel = String(UTF8String: UnsafePointer($0)) ?? \"\" &#125; return deviceModel &#125; static func systemVersion() -&gt; String &#123; let version = NSProcessInfo.processInfo().operatingSystemVersion return \"\\(version.majorVersion).\\(version.minorVersion).\\(version.patchVersion)\" &#125; static func language() -&gt; String &#123; return NSLocale.preferredLanguages().first! &#125; static func timezone() -&gt; Int &#123; return NSTimeZone.localTimeZone().secondsFromGMT &#125; static func soundFiles() -&gt; [String] &#123; guard let resourcePath = NSBundle.mainBundle().resourcePath else &#123; return [] &#125; let files = try? NSFileManager.defaultManager() .contentsOfDirectoryAtPath(resourcePath) .filter &#123; return $0.hasSuffix(\".wav\") || $0.hasSuffix(\".mp3\") &#125; return files ?? [] &#125; static func versionNumber() -&gt; String? &#123; return NSBundle.mainBundle().infoDictionary?[\"CFBundleShortVersionString\"] as? String &#125; static func buildNumber() -&gt; String? &#123; return NSBundle.mainBundle().infoDictionary?[\"CFBundleVersionString\"] as? String &#125; static func netType() -&gt; Int &#123; // Reachability return 0 &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243import Foundationpublic struct UserDefaults &#123; struct Key &#123; static let playerID: String = \"Dust-OneSignal-Player-ID-Key\" static let deviceToken: String = \"Dust-OneSignal-Device-Token-Key\" static let subscribed: String = \"Dust-OneSignal-Disable-Subscribed-Key\" &#125; public static var playerID: String? &#123; get &#123; return NSUserDefaults.standardUserDefaults().stringForKey(Key.playerID) &#125; set &#123; NSUserDefaults.standardUserDefaults().setObject(newValue, forKey: Key.playerID) NSUserDefaults.standardUserDefaults().synchronize() &#125; &#125; public static var deviceToken: String? &#123; get &#123; return NSUserDefaults.standardUserDefaults().stringForKey(Key.deviceToken) &#125; set &#123; NSUserDefaults.standardUserDefaults().setObject(newValue, forKey: Key.deviceToken) NSUserDefaults.standardUserDefaults().synchronize() &#125; &#125; public static var subscribed: Bool &#123; get &#123; return NSUserDefaults.standardUserDefaults().boolForKey(Key.subscribed) &#125; set &#123; NSUserDefaults.standardUserDefaults().setBool(newValue, forKey: Key.subscribed) NSUserDefaults.standardUserDefaults().synchronize() &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141import Foundationimport Alamofirepublic struct OneSignal &#123; static var appID: String = \"\" static let version = \"020115\" static let baseURL = NSURL(string: \"https://onesignal.com/api/v1\")! enum NotificationType: Int &#123; case subscribed = 7 case unsubscribed = -2 static func value() -&gt; Int &#123; return UserDefaults.subscribed ? NotificationType.subscribed.rawValue : NotificationType.unsubscribed.rawValue &#125; &#125; enum Provisioning: Int &#123; case development = 1 &#125; public static func setup(appID appID: String) &#123; NSUserDefaults.standardUserDefaults().registerDefaults([ UserDefaults.Key.subscribed: true ]) OneSignal.appID = appID &#125; public static func registerOrUpdateSession(completion: ((String?) -&gt; Void)? = nil) &#123; guard let bundleID = NSBundle.mainBundle().bundleIdentifier, let deviceToken = UserDefaults.deviceToken else &#123; return &#125; var params: [String: AnyObject] = [ \"app_id\" : appID, \"device_model\" : Utils.deviceModel(), \"device_os\" : Utils.systemVersion(), \"language\" : Utils.language(), \"timezone\" : NSNumber(integer: Utils.timezone()), \"device_type\" : NSNumber(integer : 0), \"sounds\" : Utils.soundFiles(), \"sdk\" : version, \"identifier\" : deviceToken, \"net_type\" : NSNumber(integer: Utils.netType()), \"rooted\": NSNumber(bool: false), \"as_id\": \"OptedOut\", \"sdk_type\": \"native\", \"ios_bundle\": bundleID, \"game_version\": Utils.versionNumber() ?? \"\", \"notification_types\": NotificationType.value(), ] #if DEBUG params[\"test_type\"] = Provisioning.development.rawValue #endif let url: NSURL if let playerID = UserDefaults.playerID &#123; url = baseURL.URLByAppendingPathComponent(\"players/\\(playerID)/on_session\") &#125; else &#123; url = baseURL.URLByAppendingPathComponent(\"players\") &#125; Alamofire .request(.POST, url, parameters: params) .responseJSON &#123; response in guard let json = response.result.value as? [String: AnyObject] else &#123; completion?(nil) return &#125; if let id = json[\"id\"] as? String &#123; UserDefaults.playerID = id completion?(id) &#125; else if let value = json[\"success\"] as? Int, playerID = UserDefaults.playerID where value == 1 &#123; completion?(playerID) &#125; else &#123; completion?(nil) &#125; &#125; &#125; public static func handle(deviceToken data: NSData) &#123; UserDefaults.deviceToken = Utils.parse(deviceToken: data) registerOrUpdateSession() &#125; public static func update(subscription subscribed: Bool) &#123; guard let playerID = UserDefaults.playerID else &#123; return &#125; UserDefaults.subscribed = subscribed let url = baseURL.URLByAppendingPathComponent(\"players/\\(playerID)\") let params: [String: AnyObject] = [ \"app_id\": appID, \"notification_types\": NotificationType.value() ] Alamofire .request(.PUT, url, parameters: params) .responseJSON &#123; response in print(response) &#125; &#125; public static func update(badge count: Int) &#123; guard let playerID = UserDefaults.playerID else &#123; return &#125; let url = baseURL.URLByAppendingPathComponent(\"players/\\(playerID)\") let params: [String: AnyObject] = [ \"app_id\": appID, \"badge_count\": count ] Alamofire .request(.PUT, url, parameters: params) .responseJSON &#123; response in &#125; &#125; public static func getPlayerID(completion: String -&gt; Void) &#123; if let playerID = UserDefaults.playerID &#123; completion(playerID) return &#125; registerOrUpdateSession &#123; playerID in if let playerID = playerID &#123; completion(playerID) &#125; &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to do throttle and debounce using DispatchWorkItem in Swift","slug":"How-to-do-throttle-and-debounce-using-DispatchWorkItem-in-Swift","date":"2019-08-27T11:26:45.000Z","updated":"2019-08-27T11:26:57.000Z","comments":true,"path":"blog/How-to-do-throttle-and-debounce-using-DispatchWorkItem-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-throttle-and-debounce-using-DispatchWorkItem-in-Swift/","excerpt":"","text":"Issue #376 https://github.com/onmyway133/Omnia/blob/master/Sources/Shared/Debouncer.swift 1234567891011121314151617import Foundationpublic class Debouncer &#123; private let delay: TimeInterval private var workItem: DispatchWorkItem? public init(delay: TimeInterval) &#123; self.delay = delay &#125; /// Trigger the action after some delay public func run(action: @escaping () -&gt; Void) &#123; workItem?.cancel() workItem = DispatchWorkItem(block: action) DispatchQueue.main.asyncAfter(deadline: .now() + delay, execute: workItem!) &#125;&#125; 12345678910111213141516171819202122232425262728293031import XCTestclass DebouncerTests: XCTestCase &#123; func testDebounce() &#123; let expectation = self.expectation(description: #function) let debouncer = Debouncer(delay: 0.5) var value = 0 debouncer.run(action: &#123; value = 1 &#125;) debouncer.run(action: &#123; value = 2 &#125;) DispatchQueue.main.asyncAfter(deadline: DispatchTime.now() + 0.2, execute: &#123; debouncer.run(action: &#123; value = 3 &#125;) &#125;) DispatchQueue.main.asyncAfter(deadline: DispatchTime.now() + 0.71, execute: &#123; XCTAssertEqual(value, 3) expectation.fulfill() &#125;) wait(for: [expectation], timeout: 1.2) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to simplify UIApplication life cycle observation in iOS","slug":"How-to-simplify-UIApplication-life-cycle-observation-in-iOS","date":"2019-08-27T11:24:45.000Z","updated":"2019-08-27T11:25:04.000Z","comments":true,"path":"blog/How-to-simplify-UIApplication-life-cycle-observation-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-simplify-UIApplication-life-cycle-observation-in-iOS/","excerpt":"","text":"Issue #375 1234567891011121314151617final class LifecyclerHandler &#123; private var observer: AnyObject! var action: (() -&gt; Void)? private let debouncer = Debouncer(delay: 1.0) func setup() &#123; observer = NotificationCenter.default.addObserver( forName: UIApplication.didBecomeActiveNotification, object: nil, queue: .main, using: &#123; [weak self] _ in self?.debouncer.run &#123; self?.action?() &#125; &#125;) &#125;&#125; 123456789101112private let lifecycleHandler = LifecyclerHandler()override func viewDidLoad() &#123; super.viewDidLoad() lifecycleHandler.action = &#123; Deps.userHandler.refreshToken() &#125; lifecycleHandler.setup()&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to do UITests with Google Maps on iOS","slug":"How-to-do-UITests-with-Google-Maps-on-iOS","date":"2019-08-27T10:52:17.000Z","updated":"2019-08-27T10:52:23.000Z","comments":true,"path":"blog/How-to-do-UITests-with-Google-Maps-on-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-UITests-with-Google-Maps-on-iOS/","excerpt":"","text":"Issue #374 Interact with GMSMapViewAdd accessibilityIdentifier to the parent view of GMSMapView. Setting directly onto GMSMapView has no effect 1accessibilityIdentifier = \"MapView\" 1234567let map = app.otherElements.matching(identifier: \"MapView\").element(boundBy: 0)map.pinch(withScale: 2, velocity: 1)map.rotate(CGFloat.pi/3, withVelocity: 1.0)map.swipeLeft()map.swipeRight()map.swipeDown()map.swipeDown() Interact with GMSMarker (1st try)Need to enable accessibility 1mapView.accessibilityElementsHidden = false Can‚Äôt use pinch to zoom out with UITests, so need to mock location !!! 1map().pinch(withScale: 0.05, velocity: -1) Need to use gpx to mock to preferred location 1234let map = app.otherElements[Constant.AccessibilityId.mapView.rawValue]let pin = app.otherElements .matching(identifier: Constant.AccessibilityId.pin.rawValue) .element(boundBy: 0) Try isAccessibilityElement = true for PinView, can‚Äôt touch!!Use coordinate, can‚Äôt touch !! 12let coordinate = pin.coordinate(withNormalizedOffset: CGVector(dx: 0.5, dy: 0.5))coordinate.tap() Try traversing all the pins, can‚Äôt touch 123456Array(0..&lt;pins.count).forEach &#123; let pin = pins.element(boundBy: $0) if pin.isHittable &#123; pin.tap() &#125;&#125; When po app.otherElements, coordinates are outside screen 1Other, &#123;&#123;1624.0, 1624.0&#125;, &#123;30.0, 30.0&#125;&#125;, identifier: &apos;pin&apos;, label: &apos;Hello world&apos; Interact with GMSMarker (works)My PinView has isHittable being false, no matter how I use coordinate or enable it. It can‚Äôt be touched. Go to Xcode -&gt; Open Developer Tool -&gt; Accessibility Inspector to inspect our app in iOS simulator It turns out that if I do 1po app.buttons It shows all the GMSMarker, but with identifier having class name MyApp.MyStopMarker, so just need to use buttons 1234567891011extension NSPredicate &#123; static func contains(identifier: String) -&gt; NSPredicate &#123; return NSPredicate(format: \"identifier CONTAINS[c] '\\(text)'\") &#125;&#125;let pin = map() .buttons.matching(NSPredicate.contains(\"MyStopMarker\")) .element(boundBy: 0)pin.tap()","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Make to make rounded background UIButton in iOS","slug":"Make-to-make-rounded-background-UIButton-in-iOS","date":"2019-08-27T05:02:46.000Z","updated":"2019-08-27T05:02:52.000Z","comments":true,"path":"blog/Make-to-make-rounded-background-UIButton-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/Make-to-make-rounded-background-UIButton-in-iOS/","excerpt":"","text":"Issue #373 UIButton.contentEdgeInsets does not play well with Auto Layout, we need to use intrinsicContentSize 12345678910111213141516171819202122final class InsetButton: UIButton &#123; required init(text: String) &#123; super.init(frame: .zero) titleLabel?.textColor = .white setTitle(text, for: .normal) layer.cornerRadius = 15 layer.masksToBounds = true backgroundColor = .black isUserInteractionEnabled = false &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; override var intrinsicContentSize: CGSize &#123; let size = super.intrinsicContentSize return CGSize(width: size.width + 24, height: size.height) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Links for Javascript","slug":"Links-for-Javascript","date":"2019-08-26T10:16:32.000Z","updated":"2019-08-28T09:34:52.000Z","comments":true,"path":"blog/Links-for-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/Links-for-Javascript/","excerpt":"","text":"Issue #372 https://www.freecodecamp.org/news/explaining-the-best-javascript-meme-i-have-ever-seen/ https://www.freecodecamp.org/news/requiring-modules-in-node-js-everything-you-need-to-know-e7fbd119be8/ https://www.freecodecamp.org/news/when-and-why-you-should-use-es6-arrow-functions-and-when-you-shouldnt-3d851d7f0b26/","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to make scrolling UIScrollView with Auto Layout in iOS","slug":"How-to-make-scrolling-UIScrollView-with-Auto-Layout-in-iOS","date":"2019-08-26T06:43:30.000Z","updated":"2019-08-29T05:31:20.000Z","comments":true,"path":"blog/How-to-make-scrolling-UIScrollView-with-Auto-Layout-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-scrolling-UIScrollView-with-Auto-Layout-in-iOS/","excerpt":"","text":"Issue #371 Scrolling UIScrollView is used in common scenarios like steps, onboarding.From iOS 11, UIScrollView has contentLayoutGuide and frameLayoutGuide Docshttps://developer.apple.com/documentation/uikit/uiscrollview/2865870-contentlayoutguide Use this layout guide when you want to create Auto Layout constraints related to the content area of a scroll view. https://developer.apple.com/documentation/uikit/uiscrollview/2865772-framelayoutguide Use this layout guide when you want to create Auto Layout constraints that explicitly involve the frame rectangle of the scroll view itself, as opposed to its content rectangle. CodeI found out that using contentLayoutGuide and frameLayoutGuide does not work in iOS 11, when swiping to the next page, it breaks the constraints. iOS 12 works well, so we have to check iOS version Let the contentView drives the contentSize of scrollView 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495import UIKitfinal class PagerView: UIView &#123; let scrollView = UIScrollView() private(set) var pages: [UIView] = [] private let contentView = UIView() override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; scrollView.isPagingEnabled = true scrollView.showsHorizontalScrollIndicator = false addSubview(scrollView) scrollView.addSubview(contentView) if #available(iOS 12.0, *) &#123; scrollView.translatesAutoresizingMaskIntoConstraints = false contentView.translatesAutoresizingMaskIntoConstraints = false NSLayoutConstraint.on([ scrollView.frameLayoutGuide.pinEdges(view: self) ]) NSLayoutConstraint.on([ scrollView.contentLayoutGuide.pinEdges(view: contentView), [scrollView.contentLayoutGuide.heightAnchor.constraint( equalTo: scrollView.frameLayoutGuide.heightAnchor )] ]) &#125; else &#123; NSLayoutConstraint.on([ scrollView.pinEdges(view: self), scrollView.pinEdges(view: contentView) ]) NSLayoutConstraint.on([ contentView.heightAnchor.constraint(equalTo: heightAnchor) ]) &#125; &#125; func update(pages: [UIView]) &#123; clearExistingViews() self.pages = pages setupConstraints() &#125; private func setupConstraints() &#123; pages.enumerated().forEach &#123; tuple in let index = tuple.offset let page = tuple.element contentView.addSubview(page) NSLayoutConstraint.on([ page.topAnchor.constraint(equalTo: scrollView.topAnchor), page.bottomAnchor.constraint(equalTo: scrollView.bottomAnchor), page.widthAnchor.constraint(equalTo: scrollView.widthAnchor) ]) if index == 0 &#123; NSLayoutConstraint.on([ page.leftAnchor.constraint(equalTo: contentView.leftAnchor) ]) &#125; else &#123; NSLayoutConstraint.on([ page.leftAnchor.constraint(equalTo: pages[index - 1].rightAnchor) ]) &#125; if index == pages.count - 1 &#123; NSLayoutConstraint.on([ page.rightAnchor.constraint(equalTo: contentView.rightAnchor) ]) &#125; &#125; &#125; private func clearExistingViews() &#123; pages.forEach &#123; $0.removeFromSuperview() &#125; &#125;&#125; 12345678910extension UILayoutGuide &#123; func pinEdges(view: UIView, inset: UIEdgeInsets = UIEdgeInsets.zero) -&gt; [NSLayoutConstraint] &#123; return [ leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: inset.left), trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: inset.right), topAnchor.constraint(equalTo: view.topAnchor, constant: inset.top), bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: inset.bottom) ] &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use Product Hunt GraphQL API with Retrofit","slug":"How-to-use-Product-Hunt-GraphQL-API-with-Retrofit","date":"2019-08-26T03:29:15.000Z","updated":"2019-08-28T08:55:55.000Z","comments":true,"path":"blog/How-to-use-Product-Hunt-GraphQL-API-with-Retrofit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Product-Hunt-GraphQL-API-with-Retrofit/","excerpt":"","text":"Issue #370 Define response model 1234567891011121314151617181920212223242526272829303132import com.squareup.moshi.Jsondata class Response( @field:Json(name=\"data\") val data: ResponseData)data class ResponseData( @field:Json(name=\"posts\") val posts: Posts)data class Posts( @field:Json(name=\"edges\") val edges: List&lt;Edge&gt;)data class Edge( @field:Json(name=\"node\") val node: Item)data class Item( @field:Json(name=\"id\") val id: String, @field:Json(name=\"name\") val name: String, @field:Json(name=\"url\") val url: String, @field:Json(name=\"tagline\") val tagline: String, @field:Json(name=\"featuredAt\") val featuredAt: String, @field:Json(name=\"votesCount\") val votesCount: Int, @field:Json(name=\"commentsCount\") val commentsCount: Int, @field:Json(name=\"thumbnail\") val thumbnail: Thumbnail)data class Thumbnail( @field:Json(name=\"url\") val ur: String) Here is the query 123456789101112131415161718&#123; posts &#123; edges &#123; node &#123; id name url tagline featuredAt votesCount commentsCount thumbnail &#123; url &#125; &#125; &#125; &#125;&#125; Here‚Äôs how request looks in Insomnia 12345678910&gt; POST /v2/api/graphql HTTP/1.1&gt; Host: api.producthunt.com&gt; User-Agent: insomnia/6.6.2&gt; Cookie: __cfduid=d9a588136cbb286b156d8e4a873d52a301566795296&gt; Accept: application/json&gt; Content-Type: application/json&gt; Authorization: Bearer 068665d215cccad9123449841463b1248da07123418915a192a1233dedfd23b2&gt; Content-Length: 241| &#123;&quot;query&quot;:&quot;&#123;\\n posts &#123;\\n edges &#123;\\n node &#123;\\n id\\n name\\n url\\n tagline\\n featuredAt\\n votesCount\\n commentsCount\\n thumbnail &#123;\\n url\\n &#125;\\n &#125;\\n &#125;\\n &#125;\\n&#125;&quot;&#125; To post as json, need to use object for Moshi to convert 123456789101112131415161718data class GetTopBody( @field:Json(name=\"query\") val queryString: String)interface Api &#123; @Headers( \"Content-Type: application/json\", \"Accept: application/json\", \"Authorization: Bearer 068665d215cccad9123449841463b1248da07123418915a192a1233dedfd23b2\", \"Host: api.producthunt.com\", \"User-Agent: insomnia/6.6.2\" ) @POST(\"./\") suspend fun getTop( @Body body: GetTopBody ): Response&#125; And consume it in ViewModel. Use multiline string interpolation. No need to set contentLength 1234567891011121314151617181920212223242526272829303132333435class ViewModel(val repo: Repo): ViewModel() &#123; val items = liveData &#123; val queryString = \"\"\"&#123; posts &#123; edges &#123; node &#123; id name url tagline featuredAt votesCount commentsCount thumbnail &#123; url &#125; &#125; &#125; &#125;&#125; \"\"\".trimIndent() val body = GetTopBody(queryString) try &#123; val response = repo.api().getTop(body) val items = response.data.posts.edges.map &#123; it.node &#125; emit(items.toCollection(ArrayList())) &#125; catch (e: Exception) &#123; emit(arrayListOf&lt;Item&gt;()) &#125; &#125;&#125; The response looks like 123456789101112131415161718192021222324252627282930313233343536&#123; \"data\": &#123; \"posts\": &#123; \"edges\": [ &#123; \"node\": &#123; \"id\": \"158359\", \"name\": \"Toast\", \"url\": \"https://www.producthunt.com/posts/toast-2?utm_campaign=producthunt-api&amp;utm_medium=api-v2&amp;utm_source=Application%3A+PH+API+Explorer+%28ID%3A+9162%29\", \"tagline\": \"Organise tabs into organised sessions\", \"featuredAt\": \"2019-08-25T07:00:00Z\", \"votesCount\": 318, \"commentsCount\": 16, \"thumbnail\": &#123; \"url\": \"https://ph-files.imgix.net/a169654a-850d-4b1c-80ba-be289f973fb7?auto=format&amp;fit=crop\" &#125; &#125; &#125;, &#123; \"node\": &#123; \"id\": \"165621\", \"name\": \"Tree\", \"url\": \"https://www.producthunt.com/posts/tree-2?utm_campaign=producthunt-api&amp;utm_medium=api-v2&amp;utm_source=Application%3A+PH+API+Explorer+%28ID%3A+9162%29\", \"tagline\": \"Write documents in tree-like organisation with Markdown\", \"featuredAt\": \"2019-08-25T09:10:53Z\", \"votesCount\": 227, \"commentsCount\": 11, \"thumbnail\": &#123; \"url\": \"https://ph-files.imgix.net/68b1f007-e630-4c79-8a27-756ec364343f?auto=format&amp;fit=crop\" &#125; &#125; &#125; ] &#125; &#125;&#125; MapInstead of using an object, we can use Map. If using HashMap, I get Unable to create @Body converter for java.util.HashMap&lt;java.lang.String, java.lang.String&gt; 123456@POST(\"./\")suspend fun getTop( @Body body: Map&lt;String, String&gt;): Responseval body = mapOf(\"query\" to queryString) TroubleshootingUse Network Profiler to inspect failure View &gt; Tool Windows &gt; Profiler Read more Product Hunt API Docs https://api.producthunt.com/v2/docs API Explorer https://ph-graph-api-explorer.herokuapp.com/ Posts http://api-v2-docs.producthunt.com.s3-website-us-east-1.amazonaws.com/object/post/ https://stackoverflow.com/questions/21398598/how-to-post-raw-whole-json-in-the-body-of-a-retrofit-request","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to fix Auto Layout issues in iOS","slug":"How-to-fix-Auto-Layout-issues-in-iOS","date":"2019-08-23T08:35:12.000Z","updated":"2019-08-26T09:12:59.000Z","comments":true,"path":"blog/How-to-fix-Auto-Layout-issues-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-Auto-Layout-issues-in-iOS/","excerpt":"","text":"Issue #369 UITemporaryLayoutHeight and UITemporaryLayoutWidth Demystify warnings with https://www.wtfautolayout.com/ Reduce priority Use Auto Layout directly instead of using manual frame layout, specially for scrolling pager NSAutoresizingMaskLayoutConstraint Check that a view ACTUALLY has translatesAutoresizingMaskIntoConstraints set to false UISV-spacing, UISV-distributing Check UIStackView Set stackview.alignment = .center if you see UIStackView trying to set same trailing or leading edges for its subviews Reduce priority if there‚Äôs edge constraints break from subviews to UIStackView Intrinsic size between UIImageView and UILabel When constraint to each other, can cause UILabel to disappear Reduce compression resistance 1imageView.setContentCompressionResistancePriority(UILayoutPriority.defaultLow, for: .vertical) Read more https://useyourloaf.com/blog/stack-view-constraint-conflicts-when-hiding-views/","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to simplify anchor with NSLayoutConstraint in iOS","slug":"How-to-simplify-anchor-with-NSLayoutConstraint-in-iOS","date":"2019-08-23T08:34:20.000Z","updated":"2019-08-26T06:51:45.000Z","comments":true,"path":"blog/How-to-simplify-anchor-with-NSLayoutConstraint-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-simplify-anchor-with-NSLayoutConstraint-in-iOS/","excerpt":"","text":"Issue #368 See https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/NSLayoutConstraint.swift 1234567891011121314151617181920212223242526272829303132extension NSLayoutConstraint &#123; /// Disable auto resizing mask and activate constraints /// /// - Parameter constraints: constraints to activate static func on(_ constraints: [NSLayoutConstraint]) &#123; constraints.forEach &#123; ($0.firstItem as? UIView)?.translatesAutoresizingMaskIntoConstraints = false $0.isActive = true &#125; &#125; static func on(_ constraintsArray: [[NSLayoutConstraint]]) &#123; let constraints = constraintsArray.flatMap(&#123; $0 &#125;) NSLayoutConstraint.on(constraints) &#125; func priority(_ value: Float) -&gt; NSLayoutConstraint &#123; priority = UILayoutPriority(value) return self &#125;&#125;extension Array where Element == NSLayoutConstraint &#123; func priority(_ value: Float) -&gt; [NSLayoutConstraint] &#123; forEach &#123; $0.priority = UILayoutPriority(value) &#125; return self &#125;&#125; 12345678910extension UILayoutGuide &#123; func pinEdges(view: UIView, inset: UIEdgeInsets = UIEdgeInsets.zero) -&gt; [NSLayoutConstraint] &#123; return [ leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: inset.left), trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: inset.right), topAnchor.constraint(equalTo: view.topAnchor, constant: inset.top), bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: inset.bottom) ] &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344extension UIView &#123; func pinEdges(view: UIView, inset: UIEdgeInsets = UIEdgeInsets.zero) -&gt; [NSLayoutConstraint] &#123; return [ leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: inset.left), trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: inset.right), topAnchor.constraint(equalTo: view.topAnchor, constant: inset.top), bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: inset.bottom) ] &#125; func pinCenter(view: UIView, offset: CGPoint = .zero) -&gt; [NSLayoutConstraint] &#123; return [ centerXAnchor.constraint(equalTo: view.centerXAnchor, constant: offset.x), centerYAnchor.constraint(equalTo: view.centerYAnchor, constant: offset.y) ] &#125; func padding(view: UIView, _ constant: CGFloat = 0) -&gt; [NSLayoutConstraint] &#123; return [ leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: constant), trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -constant) ] &#125; func size(_ constant: CGFloat) -&gt; [NSLayoutConstraint] &#123; return [ widthAnchor.constraint(equalToConstant: constant), heightAnchor.constraint(equalToConstant: constant) ] &#125; func size(_ width: CGFloat, _ height: CGFloat) -&gt; [NSLayoutConstraint] &#123; return [ widthAnchor.constraint(equalToConstant: width), heightAnchor.constraint(equalToConstant: height) ] &#125; func addSubviews(_ views: [UIView]) &#123; views.forEach &#123; addSubview($0) &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to get trending repos on GitHub using Retrofit","slug":"How-to-get-trending-repos-on-GitHub-using-Retrofit","date":"2019-08-22T17:22:35.000Z","updated":"2019-08-28T09:45:18.000Z","comments":true,"path":"blog/How-to-get-trending-repos-on-GitHub-using-Retrofit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-trending-repos-on-GitHub-using-Retrofit/","excerpt":"","text":"Issue #367 1https://api.github.com/search/repositories?sort=stars&amp;order=desc&amp;q=language:javascript,java,swift,kotlin&amp;q=created:&gt;2019-08-21 12345678interface Api &#123; @GET(\"https://api.github.com/search/repositories\") suspend fun getTrendingRepos( @Query(\"sort\") sort: String, @Query(\"order\") order: String, @Query(\"q\") qs: List&lt;String&gt; ): Response&#125; 12345678910class Repo &#123; fun api(): Api &#123; return Retrofit.Builder() .baseUrl(\"https://api.github.com/\") .addConverterFactory(MoshiConverterFactory.create()) .build() .create(Api::class.java) &#125;&#125; 123456789101112131415161718192021class ViewModel(val repo: Repo, val dateProvider: DateProvider): ViewModel() &#123; val items = MutableLiveData&lt;ArrayList&lt;Item&gt;&gt;() suspend fun load() &#123; try &#123; val order = \"desc\" val sort = \"star\" val formatter = SimpleDateFormat(\"YYYY-MM-dd\") val qs = listOf( \"language:javascript,java,swift,kotlin\", \"q=created:&gt;$&#123;formatter.format(dateProvider.yesterday)&#125;\" ) val response = repo.api().getTrendingRepos(sort=sort, order=order, qs=qs) this.items.value = response.items.toCollection(ArrayList()) &#125; catch (e: Exception) &#123; this.items.value = arrayListOf() &#125; &#125;&#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to use Retrofit in Android","slug":"How-to-use-Retrofit-in-Android","date":"2019-08-22T05:59:14.000Z","updated":"2019-08-26T06:47:03.000Z","comments":true,"path":"blog/How-to-use-Retrofit-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Retrofit-in-Android/","excerpt":"","text":"Issue #366 Code uses Retrofit 2.6.0 which has Coroutine support app/build.gradle 123456implementation \"androidx.lifecycle:lifecycle-livedata-ktx:2.2.0-alpha01\"implementation \"com.squareup.moshi:moshi:$Version.moshi\"implementation \"com.squareup.retrofit2:retrofit:$Version.retrofit\"implementation \"com.squareup.retrofit2:converter-moshi:$Version.retrofit\" Api.kt 123456import retrofit2.http.GETinterface Api &#123; @GET(\"api/articles\") suspend fun getArticles(): List&lt;Article&gt;&#125; Repo.kt 123456789101112import retrofit2.Retrofitimport retrofit2.converter.moshi.MoshiConverterFactoryclass Repo &#123; fun get(): Api &#123; return Retrofit.Builder() .baseUrl(\"https://dev.to\") .addConverterFactory(MoshiConverterFactory.create()) .build() .create(Api::class.java) &#125;&#125; ViewModel.kt 123456789import androidx.lifecycle.ViewModelimport androidx.lifecycle.liveDataimport kotlinx.coroutines.Dispatchersclass ViewModel(val repo: Repo): ViewModel() &#123; val articles = liveData(Dispatchers.Main) &#123; emit(repo.get().getArticles().toCollection(ArrayList())) &#125;&#125; Article.kt 123456import com.squareup.moshi.Jsondata class Article( @field:Json(name=\"type_of\") val typeOf: String, @field:Json(name=\"title\") val title: String)","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to handle link clicked in WKWebView in iOS","slug":"How-to-handle-link-clicked-in-WKWebView-in-iOS","date":"2019-08-21T06:46:31.000Z","updated":"2019-08-21T06:46:36.000Z","comments":true,"path":"blog/How-to-handle-link-clicked-in-WKWebView-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-link-clicked-in-WKWebView-in-iOS/","excerpt":"","text":"Issue #365 12345678910111213141516171819202122232425import WebKitimport SafariServicesfinal class WebViewHandler: NSObject, WKNavigationDelegate &#123; var show: ((UIViewController) -&gt; Void)? let supportedSchemes = [\"http\", \"https\"] func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -&gt; Void) &#123; defer &#123; decisionHandler(.allow) &#125; guard navigationAction.navigationType == .linkActivated, let url = navigationAction.request.url, let scheme = url.scheme, supportedSchemes.contains(scheme) else &#123; return &#125; let controller = SFSafariViewController(url: url) show?(controller) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use AppFlowController in iOS","slug":"How-to-use-AppFlowController-in-iOS","date":"2019-08-20T10:39:35.000Z","updated":"2019-08-20T10:44:26.000Z","comments":true,"path":"blog/How-to-use-AppFlowController-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-AppFlowController-in-iOS/","excerpt":"","text":"Issue #364 AppFlowController.swift 1234567891011121314151617181920212223242526272829303132333435363738394041import UIKitimport GoogleMapsimport Stripefinal class AppFlowController: UIViewController &#123; private lazy var window = UIWindow(frame: UIScreen.main.bounds) func configure() &#123; GMSServices.provideAPIKey(Constant.googleMapsApiKey) STPPaymentConfiguration.shared().publishableKey = Constant.stripeKey &#125; func start() &#123; if Deps.onboardingHandler.hasOnboarded &#123; startMain() &#125; else &#123; startOnboarding() &#125; window.makeKeyAndVisible() &#125; func startOnboarding() &#123; let controller = OnboardingController() controller.delegate = self window.rootViewController = controller &#125; func startMain() &#123; let controller = MainFlowController() window.rootViewController = controller controller.start() &#125;&#125;extension AppFlowController: OnboardingControllerDelegate &#123; func onboardingControllerDidFinish(_ controller: OnboardingController) &#123; Deps.onboardingHandler.hasOnboarded = true startMain() &#125;&#125; AppDelegate.swift 123456789101112131415@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123; private let appFlowController = AppFlowController() func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123; appFlowController.configure() appFlowController.start() UIApplication.shared.registerForRemoteNotifications() FirebaseApp.configure() return true &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use ViewModel and ViewModelsProviders in Android","slug":"How-to-use-ViewModel-and-ViewModelsProviders-in-Android","date":"2019-08-20T02:56:29.000Z","updated":"2019-08-20T03:39:32.000Z","comments":true,"path":"blog/How-to-use-ViewModel-and-ViewModelsProviders-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-ViewModel-and-ViewModelsProviders-in-Android/","excerpt":"","text":"Issue #363 ViewModels a simple examplehttps://medium.com/androiddevelopers/viewmodels-a-simple-example-ed5ac416317e Rotating a device is one of a few configuration changes that an app can go through during its lifetime, including keyboard availability and changing the device‚Äôs language. All of these configuration changes cause the Activity to be torn down and recreated The ViewModel class is designed to hold and manage UI-related data in a life-cycle conscious way. This allows data to survive configuration changes such as screen rotations. The ViewModel exists from when the you first request a ViewModel (usually in the onCreate the Activity) until the Activity is finished and destroyed. onCreate may be called several times during the life of an Activity, such as when the app is rotated, but the ViewModel survives throughout. Storing an Application context in a ViewModel is okay because an Application context is tied to the Application lifecycle. This is different from an Activity context, which is tied to the Activity lifecycle. In fact, if you need an Application context, you should extend AndroidViewModel which is simply a ViewModel that includes an Application reference. The first time the ViewModelProviders.of method is called by MainActivity, it creates a new ViewModel instance. When this method is called again, which happens whenever onCreate is called, it will return the pre-existing ViewModel associated with the specific Court-Counter MainActivity 1ViewModelProviders.of(&lt;THIS ARGUMENT&gt;).get(ScoreViewModel.class); This allows you to have an app that opens a lot of different instances of the same Activity or Fragment, but with different ViewModel information Dive deep into Android‚Äôs ViewModel ‚Äî Android Architecture Componentshttps://android.jlelse.eu/dive-deep-into-androids-viewmodel-android-architecture-components-e0a7ded26f70 1234567891011121314151617181920212223/** * Utilities methods for &#123;@link ViewModelStore&#125; class. */public class ViewModelProviders &#123;/** * Creates a &#123;@link ViewModelProvider&#125;, which retains ViewModels while a scope of given Activity * is alive. More detailed explanation is in &#123;@link ViewModel&#125;. * &lt;p&gt; * It uses &#123;@link ViewModelProvider.AndroidViewModelFactory&#125; to instantiate new ViewModels. * * @param activity an activity, in whose scope ViewModels should be retained * @return a ViewModelProvider instance */ @NonNull @MainThread public static ViewModelProvider of(@NonNull FragmentActivity activity) &#123; ViewModelProvider.AndroidViewModelFactory factory = ViewModelProvider.AndroidViewModelFactory.getInstance( checkApplication(activity)); return new ViewModelProvider(ViewModelStores.of(activity), factory); &#125; &#125; It seems like ViewModelProviders.of is just a factory of ViewModelProvider, which depends upon ViewModelFactory and a ViewModelStore. 12MyViewModelFactory factory = new MyViewModelFactory(data1, data2);ViewModelProviders.of(this, factory).get(MyViewModel.class); 123public class ViewModelStore &#123; private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;();&#125; HolderFragment HolderFragment is a regular Android Headless Fragment. It is the scope where all ViewModels inside the ViewModelStore will live. 12345public class HolderFragment extends Fragment implements ViewModelStoreOwner &#123; private static final HolderFragmentManager sHolderFragmentManager = new HolderFragmentManager(); private ViewModelStore mViewModelStore = new ViewModelStore();&#125; 1234static class HolderFragmentManager &#123; private Map&lt;Activity, HolderFragment&gt; mNotCommittedActivityHolders = new HashMap&lt;&gt;(); private Map&lt;Fragment, HolderFragment&gt; mNotCommittedFragmentHolders = new HashMap&lt;&gt;();&#125; Who owns the HolderFragment? The HolderFragment has an inner static class named HolderFragmentManager. The HolderFragmentManager creates and manages HolderFragment instances.After creating the instances it associates them with an Activity or Fragment. The whole process is done using the methods holderFragmentFor(Activity) and holderFragmentFor(Fragment). How does HolderFragment retains the state ? By setting retain instance to true and not providing a view, the HolderFragment becomes essentially a headless Fragment that is retained for as long as the Activity is not destroyed. 123public HolderFragment() &#123; setRetainInstance(true);&#125; void setRetainInstance (boolean retain) Control whether a fragment instance is retained across Activity re-creation (such as from a configuration change). This can only be used with fragments not in the back stack. If set, the fragment lifecycle will be slightly different when an activity is recreated: Retrieving ViewModel instance1get(MyViewModel.class) It tries to retrieve a MyViewModel instance from the store. If none is there, it uses the factory to create it and then stores it into HashMap&lt;String, ViewModel&gt;. In order to retrieve the already created ViewModel, it generates a key from the class qualified name.","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to declare UIGestureRecognizer in iOS","slug":"How-to-declare-UIGestureRecognizer-in-iOS","date":"2019-08-19T07:16:20.000Z","updated":"2019-08-19T07:16:26.000Z","comments":true,"path":"blog/How-to-declare-UIGestureRecognizer-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-declare-UIGestureRecognizer-in-iOS/","excerpt":"","text":"Issue #362 12345let tapGR = UITapGestureRecognizer(target: self, action: #selector(handleTap(_:)))@objc private func handleTap(_ gr: UITapGestureRecognizer) &#123; didTouch?()&#125; We need to use lazy instead of let for gesture to work 1lazy var tapGR = UITapGestureRecognizer(target: self, action: #selector(handleTap(_:)))","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use function builder in Swift 5.1","slug":"How-to-use-function-builder-in-Swift-5.1","date":"2019-08-18T19:10:17.000Z","updated":"2019-08-18T19:10:17.000Z","comments":true,"path":"blog/How-to-use-function-builder-in-Swift-5.1/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-function-builder-in-Swift-5.1/","excerpt":"","text":"Issue #361 12345678910111213141516171819protocol Task &#123;&#125;struct Build: Task &#123;&#125;struct Test: Task &#123;&#125;@_functionBuilderpublic struct TaskBuilder &#123; public static func buildBlock(_ tasks: Task...) -&gt; [Task] &#123; tasks &#125;&#125;public func run(@TaskBuilder builder: () -&gt; [Task]) &#123; MyManager.run(tasks: builder())&#125;public func run(@TaskBuilder builder: () -&gt; Task) &#123; MyManager.run(tasks: [builder()])&#125; 1234run &#123; Build() Test()&#125; Read more The Swift 5.1 features that power SwiftUI‚Äôs API","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to simplify get GRPC streaming in Swift","slug":"How-to-simplify-get-GRPC-streaming-in-Swift","date":"2019-08-16T08:49:06.000Z","updated":"2019-10-22T07:49:41.000Z","comments":true,"path":"blog/How-to-simplify-get-GRPC-streaming-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-simplify-get-GRPC-streaming-in-Swift/","excerpt":"","text":"Issue #360 Given a streaming service 123service Server &#123; rpc GetUsers(GetUsersRequest) returns (stream GetUsersResponse);&#125; To get a response list in Swift, we need to do observe stream, which is a subclass of ClientCallServerStreaming 123456789101112131415161718192021222324252627282930func getUsers(roomId: String, completion: @escaping (Result&lt;[User], Error&gt;) -&gt; Void) &#123; let request = withValue(Server_GetUsersRequest()) &#123; $0.roomId = roomId &#125; DispatchQueue.global().async &#123; var users = [User]() do &#123; var streaming = true let stream = try self.client.getUsers(request, completion: &#123; _ in streaming = false &#125;) while streaming &#123; if let response = try stream.receive() &#123; users.append(response.user) &#125; &#125; DispatchQueue.main.async &#123; completion(.success(users)) &#125; &#125; catch &#123; DispatchQueue.main.async &#123; completion(.failure(error)) &#125; &#125; &#125;&#125; This can get repetitive very fast. To avoid the duplication, we can make a generic function 123456789101112131415161718192021222324252627282930313233import SwiftGRPCfunc getStream&lt;Streaming, Response&gt;( makeStream: @escaping (@escaping () -&gt; Void) throws -&gt; Streaming, receive: @escaping (Streaming) throws -&gt; Response?, completion: @escaping (Result&lt;[Response], Error&gt;) -&gt; Void) &#123; DispatchQueue.global().async &#123; var responses = [Response]() do &#123; var streaming = true let stream = try makeStream(&#123; streaming = false &#125;) while streaming &#123; if let response = try receive(stream) &#123; responses.append(response) &#125; &#125; DispatchQueue.main.async &#123; completion(.success(responses)) &#125; &#125; catch &#123; DispatchQueue.main.async &#123; completion(.failure(error)) &#125; &#125; &#125;&#125; Since swift-grpc generates very concrete structs, we need to use generic. The difference is the Streaming class and Response struct 12345678910111213141516func getUsers(roomId: String, completion: @escaping (Result&lt;[User], Error&gt;) -&gt; Void) &#123; let request = withValue(Server_GetUsersRequest()) &#123; $0.roomId = roomId &#125; getStream( makeStream: &#123; completion in return try self.client.getUsers(request, completion: &#123; _ in completion() &#125;) &#125;, receive: &#123; stream in return try stream.receive() &#125;, completion: &#123; result in completion(result.map &#123; $0.map &#123; $0.user &#125;&#125;) &#125;)&#125; Handle CallResult1234567891011import SwiftGRPCimport SwiftProtobufextension CallResult &#123; func toError() -&gt; NSError &#123; return NSError(domain: \"com.myApp\", code: statusCode.rawValue, userInfo: [ \"status_code\": statusCode, \"status_message\": statusMessage ?? \"\" ]) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to inject view model with Koin in Android","slug":"How-to-inject-view-model-with-Koin-in-Android","date":"2019-08-15T18:52:00.000Z","updated":"2019-08-15T18:52:00.000Z","comments":true,"path":"blog/How-to-inject-view-model-with-Koin-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-inject-view-model-with-Koin-in-Android/","excerpt":"","text":"Issue #359 app/build.gradle 123implementation \"org.koin:koin-core:$Version.koin\"implementation \"org.koin:koin-androidx-scope:$Version.koin\"implementation \"org.koin:koin-androidx-viewmodel:$Version.koin\" MyApplication.kt 1234567891011121314151617181920212223import android.app.Applicationimport org.koin.android.ext.koin.androidContextimport org.koin.android.ext.koin.androidLoggerimport org.koin.androidx.viewmodel.dsl.viewModelimport org.koin.core.context.startKoinimport org.koin.dsl.moduleclass MyApplication: Application() &#123; var appModule = module &#123; single &#123; MyRepo() &#125; viewModel &#123; MyViewModel(get()) &#125; &#125; override fun onCreate() &#123; super.onCreate() startKoin &#123; androidLogger() androidContext(this@MyApplication) modules(appModule) &#125; &#125;&#125; MyFragment.kt 123import org.koin.androidx.viewmodel.ext.android.viewModelval viewModel: MyViewModel by viewModel()","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to use coroutine LiveData in Android","slug":"How-to-use-coroutine-LiveData-in-Android","date":"2019-08-15T18:48:58.000Z","updated":"2019-09-09T06:17:25.000Z","comments":true,"path":"blog/How-to-use-coroutine-LiveData-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-coroutine-LiveData-in-Android/","excerpt":"","text":"Issue #358 app/build.gradle 1implementation \"androidx.lifecycle:lifecycle-livedata-ktx:2.2.0-alpha01\" 12345678910111213import androidx.lifecycle.ViewModelimport androidx.lifecycle.liveDataimport kotlinx.coroutines.Dispatchersclass MainViewModel : ViewModel() &#123; val repository: TodoRepository = TodoRepository() val firstTodo = liveData(Dispatchers.IO) &#123; val retrivedTodo = repository.getTodo(1) emit(retrivedTodo) &#125;&#125; Use coroutines with LiveDatahttps://developer.android.com/topic/libraries/architecture/coroutines The liveData building block serves as a structured concurrency primitive between coroutines and LiveData. The code block starts executing when LiveData becomes active and is automatically canceled after a configurable timeout when the LiveData becomes inactive. Source codehttps://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/lifecycle/lifecycle-livedata-ktx/src/main/java/androidx/lifecycle/CoroutineLiveData.kthttps://android.googlesource.com/platform/frameworks/support/+/androidx-master-dev/lifecycle/lifecycle-livedata-ktx/src/main/java/androidx/lifecycle/FlowLiveData.kt CoroutineLiveData.kt 123456@UseExperimental(ExperimentalTypeInference::class)fun &lt;T&gt; liveData( context: CoroutineContext = EmptyCoroutineContext, timeoutInMs: Long = DEFAULT_TIMEOUT, @BuilderInference block: suspend LiveDataScope&lt;T&gt;.() -&gt; Unit): LiveData&lt;T&gt; = CoroutineLiveData(context, timeoutInMs, block) a LiveData that tries to load the User from local cache first and then tries from the server and also yields the updated value 12345678910111213141516val user = liveData &#123; // dispatch loading first emit(LOADING(id)) // check local storage val cached = cache.loadUser(id) if (cached != null) &#123; emit(cached) &#125; if (cached == null || cached.isStale()) &#123; val fresh = api.fetch(id) // errors are ignored for brevity cache.save(fresh) emit(fresh) &#125;&#125; Read more Suspend what you‚Äôre doing: Retrofit has now Coroutines support! Exploring new Coroutines and Lifecycle Architectural Components integration on Android Coroutine in Android: Working with Lifecycle","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to declare generic RecyclerView adapter in Android","slug":"How-to-declare-generic-RecyclerView-adapter-in-Android","date":"2019-08-14T18:53:28.000Z","updated":"2019-08-15T19:07:30.000Z","comments":true,"path":"blog/How-to-declare-generic-RecyclerView-adapter-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-declare-generic-RecyclerView-adapter-in-Android/","excerpt":"","text":"Issue #357 generic/Adapter.kt 12345678910111213141516171819202122232425262728293031package com.onmyway133.genericimport android.view.LayoutInflaterimport android.view.Viewimport android.view.ViewGroupimport androidx.recyclerview.widget.RecyclerViewabstract class Adapter&lt;T&gt;(var items: ArrayList&lt;T&gt;): RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() &#123; abstract fun configure(item: T, holder: ViewHolder) fun update(items: ArrayList&lt;T&gt;) &#123; this.items = items notifyDataSetChanged() &#125; override fun getItemCount(): Int = items.count() override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder &#123; val view = LayoutInflater .from(parent.context) .inflate(viewType, parent, false) return ViewHolder(view) &#125; override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) &#123; configure(items[position], holder as ViewHolder) &#125;&#125;class ViewHolder(view: View): RecyclerView.ViewHolder(view) &#123;&#125; hero/HeroAdapter.kt 12345678910111213package com.onmyway133.heroimport kotlinx.android.synthetic.main.hero_item_view.view.*class Adapter(items: ArrayList&lt;Hero&gt;): com.onmyway133.generic.Adapter&lt;Hero&gt;(items) &#123; override fun configure(item: Hero, holder: ViewHolder) &#123; holder.itemView.titleLabel.text = item.name holder.itemView.descriptionLabel.text = item.description &#125; override fun getItemViewType(position: Int): Int &#123; return R.layout.hero_item_view &#125;&#125; May run into https://stackoverflow.com/questions/49512629/default-interface-methods-are-only-supported-starting-with-android-n app/build.gradle 123456android &#123; compileOptions &#123; sourceCompatibility JavaVersion.VERSION_1_8 targetCompatibility JavaVersion.VERSION_1_8 &#125;&#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to use Payment Intent and Setup Intents with Stripe in iOS","slug":"How-to-use-Payment-Intent-and-Setup-Intents-with-Stripe-in-iOS","date":"2019-08-14T09:05:23.000Z","updated":"2019-08-27T10:13:54.000Z","comments":true,"path":"blog/How-to-use-Payment-Intent-and-Setup-Intents-with-Stripe-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Payment-Intent-and-Setup-Intents-with-Stripe-in-iOS/","excerpt":"","text":"Issue #356 StripeHandler.swift From Stripe 16.0.0 https://github.com/stripe/stripe-ios/blob/master/CHANGELOG.md#1600-2019-07-18 Migrates STPPaymentCardTextField.cardParams property type from STPCardParams to STPPaymentMethodCardParams 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104final class StripeHandler &#123; func createPaymentMethod( textField: STPPaymentCardTextField, completion: @escaping (Result&lt;STPPaymentMethod, Error&gt;) -&gt; Void) &#123; let paymentMethodParams = STPPaymentMethodParams( card: textField.cardParams, billingDetails: nil, metadata: nil ) STPAPIClient.shared().createPaymentMethod( with: paymentMethodParams, completion: &#123; paymentMethod, error in DispatchQueue.main.async &#123; if let paymentMethod = paymentMethod &#123; completion(.success(paymentMethod)) &#125; else &#123; completion(.failure(error ?? AppError.request)) &#125; &#125; &#125;) STPAPIClient.shared().createPaymentMethod( with: paymentMethodParams, completion: &#123; paymentMethod, error in DispatchQueue.main.async &#123; if let paymentMethod = paymentMethod &#123; completion(.success(paymentMethod)) &#125; else &#123; completion(.failure(error ?? AppError.request)) &#125; &#125; &#125;) &#125; func confirmSetupIntents( clientSecret: String, paymentMethodId: String, context: STPAuthenticationContext?, completion: @escaping (Result&lt;STPSetupIntent, Error&gt;) -&gt; Void) &#123; guard let context = context else &#123; completion(.failure(AppError.invalid)) return &#125; let setupIntentParams = STPSetupIntentConfirmParams(clientSecret: clientSecret) setupIntentParams.paymentMethodID = paymentMethodId let paymentHandler = STPPaymentHandler.shared() paymentHandler.confirmSetupIntent( setupIntentParams, with: context, completion: &#123; status, intent, error in DispatchQueue.main.async &#123; if case .succeeded = status, let intent = intent &#123; completion(.success(intent)) &#125; else &#123; completion(.failure(error ?? AppError.invalid)) &#125; &#125; &#125;) &#125; func confirmPaymentIntents( clientSecret: String, context: STPAuthenticationContext?, completion: @escaping (Result&lt;STPPaymentIntent, Error&gt;) -&gt; Void) &#123; guard let context = context else &#123; completion(.failure(AppError.invalid)) return &#125; STPPaymentHandler.shared().handleNextAction( forPayment: clientSecret, with: context, returnURL: nil, completion: &#123; status, paymentIntent, error in if case .succeeded = status, let paymentIntent = paymentIntent &#123; completion(.success(paymentIntent)) &#125; else &#123; completion(.failure(error ?? AppError.invalid)) &#125; &#125;) &#125; func toCard(paymentMethod: STPPaymentMethod) -&gt; MyCard? &#123; guard let card = paymentMethod.card, let last4 = card.last4 else &#123; return nil &#125; return withValue(MyCard()) &#123; $0.expiryYear = UInt32(card.expYear) $0.expiryMonth = UInt32(card.expMonth) $0.lastFourDigits = last4 $0.brand = STPCard.string(from: card.brand) &#125; &#125;&#125; Payment intentshttps://stripe.com/docs/payments/payment-intents/creating-payment-intents When using automatic confirmation, create the PaymentIntent at the beginning of the checkout process. When using manual confirmation, create the PaymentIntent after collecting payment information from the customer using Elements or our iOS and Android SDKs. For a detailed comparison on the automatic and manual confirmation flows, see accepting one-time payments. Step 3: Authenticate the payment if necessary Pass the confirmed Payment Intent client secret from the previous step to STPPaymentHandler handleNextActionForPayment. If the customer must perform 3D Secure authentication to complete the payment, STPPaymentHandler presents view controllers using the STPAuthenticationContext passed in and walks them through that process. See Supporting 3D Secure Authentication on iOS to learn more. 12345678910111213141516MyAPIClient.createAndConfirmPaymentIntent(paymentMethodId: paymentMethodId) &#123; result in guard case .success(let paymentIntentClientSecret) = result else &#123; // Handle error return &#125; STPPaymentHandler.shared().handleNextAction(forPayment: paymentIntentClientSecret, with: self, returnURL: nil) &#123; (status, paymentIntent, error) in switch (status) &#123; case .succeeded: // ...Continued in Step 4 case .canceled: // Handle cancel case .failed: // Handle error &#125; &#125;&#125; Setup intentsThere is Setup intents https://stripe.com/docs/payments/cards/reusing-cards#saving-cards-without-payment for saving cards Use the Setup Intents API to authenticate a customer‚Äôs card without making an initial payment. This flow works best for businesses that want to onboard customers without charging them right away: Step 4: Submit the card details to Stripe from the client Pass the STPSetupIntentParams object to the confirmSetupIntent method on a STPPaymentHandler sharedManager. If the customer must perform additional steps to complete the payment, such as authentication, STPPaymentHandler presents view controllers using the STPAuthenticationContext passed in and walks them through that process. See Supporting 3D Secure Authentication on iOS to learn more. 12345678910111213let setupIntentParams = STPSetupIntentParams(clientSecret: clientSecret)setupIntentParams.paymentMethodId = paymentMethodIdlet paymentManager = STPPaymentHandler.shared()paymentManager.confirmSetupIntent(setupIntentParams, authenticationContext: self, completion &#123; (status, setupIntent, error) in switch (status) &#123; case .succeeded: // Setup succeeded case .canceled: // Handle cancel case .failed: // Handle error &#125;&#125;) Authentication contextIn STPPaymentHandler.m 123456789101112131415161718192021- (BOOL)_canPresentWithAuthenticationContext:(id&lt;STPAuthenticationContext&gt;)authenticationContext &#123; UIViewController *presentingViewController = authenticationContext.authenticationPresentingViewController; // Is presentingViewController non-nil and in the window? if (presentingViewController == nil || presentingViewController.view.window == nil) &#123; return NO; &#125; // Is it the Apple Pay VC? if ([presentingViewController isKindOfClass:[PKPaymentAuthorizationViewController class]]) &#123; // We can't present over Apple Pay, user must implement prepareAuthenticationContextForPresentation: to dismiss it. return [authenticationContext respondsToSelector:@selector(prepareAuthenticationContextForPresentation:)]; &#125; // Is it already presenting something? if (presentingViewController.presentedViewController == nil) &#123; return YES; &#125; else &#123; // Hopefully the user implemented prepareAuthenticationContextForPresentation: to dismiss it. return [authenticationContext respondsToSelector:@selector(prepareAuthenticationContextForPresentation:)]; &#125;&#125; Use stripe SDKSTPSetupIntentConfirmParams.useStripeSDK A boolean number to indicate whether you intend to use the Stripe SDK‚Äôs functionality to handle any SetupIntent next actions.If set to false, STPSetupIntent.nextAction will only ever contain a redirect url that can be opened in a webview or mobile browser.When set to true, the nextAction may contain information that the Stripe SDK can use to perform native authentication within your app. 12let setupIntentParams = STPSetupIntentConfirmParams(clientSecret: clientSecret)setupIntentParams.useStripeSDK = NSNumber(booleanLiteral: true) Read more Using Payment Intents on iOS One-time Payments with the Payment Intents API Supporting 3D Secure Authentication on iOS STPSetupIntentConfirmParams Testing","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to format currency in Swift","slug":"How-to-format-currency-in-Swift","date":"2019-08-13T11:09:29.000Z","updated":"2019-08-13T11:18:28.000Z","comments":true,"path":"blog/How-to-format-currency-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-format-currency-in-Swift/","excerpt":"","text":"Issue #355 123456789101112final class CurrencyFormatter &#123; func format(amount: UInt64, decimalCount: Int) -&gt; String &#123; let formatter = NumberFormatter() formatter.minimumFractionDigits = 0 formatter.maximumFractionDigits = decimalCount formatter.numberStyle = .decimal let value = Double(amount) / pow(Double(10), Double(decimalCount)) let fallback = String(format: \"%.0f\", value) return formatter.string(from: NSNumber(value: value)) ?? fallback &#125;&#125; 12345678910111213class CurrencyFormatterTests: XCTestCase &#123; func testFormat() &#123; let formatter = CurrencyFormatter() // 120 USD XCTAssertEqual(formatter.format(amount: 120, decimalCount: 0), \"120\") // 12000 cents XCTAssertEqual(formatter.format(amount: 12000, decimalCount: 2), \"120\") // 12520 cents XCTAssertEqual(formatter.format(amount: 12520, decimalCount: 2), \"125.2\") &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to simplify struct mutating in Swift","slug":"How-to-simplify-struct-mutating-in-Swift","date":"2019-08-13T09:55:52.000Z","updated":"2019-08-13T09:55:57.000Z","comments":true,"path":"blog/How-to-simplify-struct-mutating-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-simplify-struct-mutating-in-Swift/","excerpt":"","text":"Issue #354 In Construction, we have a build method to apply closure to inout struct. We can explicitly define that with withValue 12345func withValue&lt;T&gt;(_ value: T, closure: (inout T) -&gt; Void) -&gt; T &#123; var mutableValue = value closure(&amp;mutableValue) return mutableValue&#125; So we can modify Protobuf structs easily 123456user.book = withValue(Book()) &#123; $0.price = 300 $0.author = withValue(Author()) &#123; $0.name = \"Thor\" &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to not resign first responder for UITextField in iOS","slug":"How-to-not-resign-first-responder-for-UITextField-in-iOS","date":"2019-08-13T06:37:55.000Z","updated":"2019-08-15T11:34:22.000Z","comments":true,"path":"blog/How-to-not-resign-first-responder-for-UITextField-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-not-resign-first-responder-for-UITextField-in-iOS/","excerpt":"","text":"Issue #353 When using STPPaymentCardTextField from stripe-ios, the default behavior is when we touch outside to dismiss keyboard, it checks and focus on number text field is it is invalid STPPaymentCardTextField.m 12345678910111213141516171819202122- (STPFormTextField *)currentFirstResponderField &#123; for (STPFormTextField *textField in [self allFields]) &#123; if ([textField isFirstResponder]) &#123; return textField; &#125; &#125; return nil;&#125;- (BOOL)canResignFirstResponder &#123; return [self.currentFirstResponderField canResignFirstResponder];&#125;- (BOOL)resignFirstResponder &#123; [super resignFirstResponder]; BOOL success = [self.currentFirstResponderField resignFirstResponder]; [self layoutViewsToFocusField:nil animated:YES completion:nil]; [self updateImageForFieldType:STPCardFieldTypeNumber]; return success;&#125; Then it calls [self.numberField becomeFirstResponder]; is validation on number fails 1234567891011121314typedef void (^STPLayoutAnimationCompletionBlock)(BOOL completed);- (void)layoutViewsToFocusField:(NSNumber *)focusedField animated:(BOOL)animated completion:(STPLayoutAnimationCompletionBlock)completion &#123; NSNumber *fieldtoFocus = focusedField; if (fieldtoFocus == nil &amp;&amp; ![self.focusedTextFieldForLayout isEqualToNumber:@(STPCardFieldTypeNumber)] &amp;&amp; ([self.viewModel validationStateForField:STPCardFieldTypeNumber] != STPCardValidationStateValid)) &#123; fieldtoFocus = @(STPCardFieldTypeNumber); [self.numberField becomeFirstResponder]; &#125;&#125; isUserInteractionEnabledBe aware to use isUserInteractionEnabled on STPPaymentCardTextField as that can resign first responder when set to true and become first responder when set to false","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use React JSX with Babel in Electron","slug":"How-to-use-React-JSX-with-Babel-in-Electron","date":"2019-08-12T04:44:36.000Z","updated":"2019-09-12T17:38:27.000Z","comments":true,"path":"blog/How-to-use-React-JSX-with-Babel-in-Electron/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-React-JSX-with-Babel-in-Electron/","excerpt":"","text":"Issue #352 For a normal electron app created with npm init, we can use all features of ES6, but not the JSX syntax for React. We can use just Babel to transpile JSX, as used in IconGenerator .babelrc 123456&#123; \"plugins\": [ \"transform-react-jsx-source\" ], \"presets\": [\"env\", \"react\"]&#125; And in package.json, call babel to transpile src to dist 12345\"main\": \"dist/main.js\",\"scripts\": &#123; \"start\": \"npm run babel &amp;&amp; electron .\", \"babel\": \"babel ./src --out-dir ./dist --copy-files\"&#125;, Remember to use dist/main.js as our starting point, and in index.html, specify ./dist/renderer.js 123456&lt;body&gt; &lt;div id=\"root\" /&gt; &lt;script type=\"text/javascript\"&gt; require('./dist/renderer.js') &lt;/script&gt;&lt;/body&gt;","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"electron","slug":"electron","permalink":"https://onmyway133.github.io/tags/electron/"},{"name":"react","slug":"react","permalink":"https://onmyway133.github.io/tags/react/"}]},{"title":"How to define version property in gradle","slug":"How-to-define-version-property-in-gradle","date":"2019-08-10T18:49:00.000Z","updated":"2019-08-13T03:23:55.000Z","comments":true,"path":"blog/How-to-define-version-property-in-gradle/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-define-version-property-in-gradle/","excerpt":"","text":"Issue #351 From Gradle tips and recipes, Configure project-wide properties For projects that include multiple modules, it might be useful to define properties at the project level and share them across all modules. You can do this by adding extra properties to the ext block in the top-level build.gradle file. 12345ext &#123; navigationVersion = \"2.0.0\"&#125;rootProject.ext.navigationVersion Versions are used mostly in dependencies block so having them defined in global ext is not quite right. We can use def to define variables 1234dependencies &#123; def navigationVersion = \"2.0.0\" implementation \"androidx.navigation:navigation-fragment-ktx:$navigationVersion\"&#125; For better namespacing, we can use a class 12345678910class Version &#123; static def navigation = \"2.0.0\" static def drawerLayout = \"1.0.0\" static def koin = \"2.0.1\" static def moshi = \"1.8.0\"&#125;dependencies &#123; implementation \"androidx.navigation:navigation-fragment-ktx:$Version.navigation\"&#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to use Firebase PhoneAuth in iOS","slug":"How-to-use-Firebase-PhoneAuth-in-iOS","date":"2019-08-07T11:57:14.000Z","updated":"2019-10-11T07:14:53.000Z","comments":true,"path":"blog/How-to-use-Firebase-PhoneAuth-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Firebase-PhoneAuth-in-iOS/","excerpt":"","text":"Issue #350 Read Authenticate with Firebase on iOS using a Phone Number Disable swizzlingInfo.plist 12&lt;key&gt;FirebaseAppDelegateProxyEnabled&lt;/key&gt;&lt;string&gt;NO&lt;/string&gt; Enable remote notificationEnable Capability -&gt; Background mode -&gt; Remote notification AppDelegate.swift 1234567891011121314151617181920212223242526272829303132333435363738394041import Firebaseimport UIKitimport FirebaseAuth@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123; private let appFlowController = AppFlowController() func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123; UIApplication.shared.registerForRemoteNotifications() FirebaseApp.configure() return true &#125; // MARK: - Remote Notification func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) &#123; Auth.auth().setAPNSToken(deviceToken, type: .unknown) &#125; func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) &#123; print(error) &#125; func application( _ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -&gt; Void) &#123; completionHandler(.noData) &#125; func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -&gt; Bool &#123; if Auth.auth().canHandle(url) &#123; return true &#125; else &#123; return false &#125; &#125;&#125; Firebase push message looks like 12345678‚ñø 1 element ‚ñø 0 : 2 elements ‚ñø key : AnyHashable(&quot;com.google.firebase.auth&quot;) - value : &quot;com.google.firebase.auth&quot; ‚ñø value : 1 element ‚ñø 0 : 2 elements - key : warning - value : This fake notification should be forwarded to Firebase Auth. CaptchaTo disable captcha during testing 1Auth.auth().settings?.isAppVerificationDisabledForTesting = true","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use Navigation component with DrawerLayout in Android","slug":"How-to-use-Navigation-component-with-DrawerLayout-in-Android","date":"2019-08-07T07:36:15.000Z","updated":"2019-09-23T05:59:56.000Z","comments":true,"path":"blog/How-to-use-Navigation-component-with-DrawerLayout-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Navigation-component-with-DrawerLayout-in-Android/","excerpt":"","text":"Issue #349 build.gradle 123dependencies &#123; classpath 'android.arch.navigation:navigation-safe-args-gradle-plugin:1.0.0-alpha05'&#125; app/build.gradle 12345678910apply plugin: 'androidx.navigation.safeargs'dependencies &#123; def navigationVersion = \"2.0.0\" def drawerLayoutVersion = \"1.0.0\" implementation \"androidx.drawerlayout:drawerlayout:$drawerLayoutVersion\" implementation \"androidx.navigation:navigation-fragment-ktx:$navigationVersion\" implementation \"androidx.navigation:navigation-ui-ktx:$navigationVersion\"&#125; main_activity.xml Use CoordinatorLayout and ToolBar Define layout_gravity for NavigationView 12345678910111213141516171819202122232425262728293031323334353637&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;androidx.drawerlayout.widget.DrawerLayout android:layout_height=\"match_parent\" android:layout_width=\"match_parent\" xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" xmlns:tools=\"http://schemas.android.com/tools\" android:id=\"@+id/drawerLayout\" tools:context=\".MainActivity\"&gt; &lt;androidx.coordinatorlayout.widget.CoordinatorLayout android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;com.google.android.material.appbar.AppBarLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;androidx.appcompat.widget.Toolbar android:layout_width=\"match_parent\" android:layout_height=\"?attr/actionBarSize\" android:id=\"@+id/toolbar\"/&gt; &lt;/com.google.android.material.appbar.AppBarLayout&gt; &lt;fragment android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:id=\"@+id/hostFragment\" android:name=\"androidx.navigation.fragment.NavHostFragment\" app:defaultNavHost=\"true\" app:navGraph=\"@navigation/navigation_graph\"/&gt; &lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt; &lt;com.google.android.material.navigation.NavigationView android:layout_width=\"wrap_content\" android:layout_height=\"match_parent\" android:id=\"@+id/navigationView\" android:fitsSystemWindows=\"true\" android:layout_gravity=\"start\" app:menu=\"@menu/drawer_menu\"/&gt;&lt;/androidx.drawerlayout.widget.DrawerLayout&gt; navigation/navigation_graph.xml 123456789101112131415161718192021&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;navigation xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" android:id=\"@+id/navigationGraph\" xmlns:tools=\"http://schemas.android.com/tools\" app:startDestination=\"@id/aboutFragment\"&gt; &lt;fragment android:id=\"@+id/aboutFragment\" android:name=\"com.onmyway133.whatsupintech.AboutFragment\" android:label=\"@string/menu_about\" tools:layout=\"@layout/about_fragment\" /&gt; &lt;fragment android:id=\"@+id/feedFragment\" android:name=\"com.onmyway133.whatsupintech.FeedFragment\" android:label=\"@string/menu_git_hub\" tools:layout=\"@layout/feed_fragment\" /&gt; &lt;fragment android:id=\"@+id/webFragment\" android:name=\"com.onmyway133.whatsupintech.WebFragment\" tools:layout=\"@layout/web_fragment\"/&gt;&lt;/navigation&gt; menu/drawer_menu.xml 12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;group android:checkableBehavior=\"single\"&gt; &lt;item android:id=\"@+id/about\" android:title=\"@string/menu_about\" /&gt; &lt;item android:id=\"@+id/hackerNews\" android:title=\"@string/menu_hacker_news\" /&gt; &lt;item android:id=\"@+id/reddit\" android:title=\"@string/menu_reddit\" /&gt; &lt;item android:id=\"@+id/dev\" android:title=\"@string/menu_dev\" /&gt; &lt;item android:id=\"@+id/gitHub\" android:title=\"@string/menu_git_hub\" /&gt; &lt;/group&gt;&lt;/menu&gt; MainActivity.kotlin Use AppBarConfiguration to define multiple top level destinations Convert Toolbar to ActionBar 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package com.onmyway133.whatsupintechimport android.os.Bundleimport androidx.appcompat.app.AppCompatActivity;import androidx.core.view.GravityCompatimport androidx.navigation.findNavControllerimport androidx.navigation.ui.AppBarConfigurationimport androidx.navigation.ui.navigateUpimport androidx.navigation.ui.setupActionBarWithNavControllerimport androidx.navigation.ui.setupWithNavControllerimport kotlinx.android.synthetic.main.main_activity.*class MainActivity : AppCompatActivity() &#123; lateinit var appBarConfig: AppBarConfiguration override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) setContentView(R.layout.main_activity) setupNavigationController() &#125; fun setupNavigationController() &#123; val navigationController = findNavController(R.id.hostFragment) setSupportActionBar(toolbar) appBarConfig = AppBarConfiguration(setOf(R.id.aboutFragment, R.id.feedFragment), drawerLayout) setupActionBarWithNavController(navigationController, appBarConfig) navigationView.setupWithNavController(navigationController) navigationView.setNavigationItemSelectedListener &#123; menuItem -&gt; drawerLayout.closeDrawers() menuItem.isChecked = true when (menuItem.itemId) &#123; R.id.about -&gt; navigationController.navigate(R.id.aboutFragment) R.id.gitHub, R.id.reddit, R.id.hackerNews, R.id.dev -&gt; navigationController.navigate(R.id.feedFragment) &#125; true &#125; &#125; override fun onSupportNavigateUp(): Boolean &#123; val navigationController = findNavController(R.id.hostFragment) return navigationController.navigateUp(appBarConfig) || super.onSupportNavigateUp() &#125; override fun onBackPressed() &#123; if (drawerLayout.isDrawerOpen(GravityCompat.START)) &#123; drawerLayout.closeDrawer(GravityCompat.START) &#125; else &#123; return super.onBackPressed() &#125; &#125;&#125; Update UI components with NavigationUITie destinations to menu items NavigationUI also provides helpers for tying destinations to menu-driven UI components. NavigationUI contains a helper method, onNavDestinationSelected(), which takes a MenuItem along with the NavController that hosts the associated destination. If the id of the MenuItem matches the id of the destination, the NavController can then navigate to that destination. Add a navigation drawer The drawer icon is displayed on all top-level destinations that use a DrawerLayout. Top-level destinations are the root-level destinations of your app. They do not display an Up button in the app bar. Read more Android Navigation TypeSafe Arguments Gradle Plugin Get started with the Navigation component Conditional navigation Navigation Drawer with New JetPacks Navigation Component","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"Links for Android","slug":"Links-for-Android","date":"2019-08-06T18:24:43.000Z","updated":"2019-09-03T09:13:08.000Z","comments":true,"path":"blog/Links-for-Android/","link":"","permalink":"https://onmyway133.github.io/blog/Links-for-Android/","excerpt":"","text":"Issue #348 Google Maven Repository https://dl.google.com/dl/android/maven2/index.html Posts https://medium.com/androiddevelopers/viewmodels-a-simple-example-ed5ac416317e https://proandroiddev.com/5-common-mistakes-when-using-architecture-components-403e9899f4cb https://tech.instacart.com/introducing-coil-kotlin-first-image-loading-on-android-f0fdc7a2a99e Coroutine Index https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/index.html https://proandroiddev.com/suspend-what-youre-doing-retrofit-has-now-coroutines-support-c65bd09ba067 https://blog.mindorks.com/mastering-kotlin-coroutines-in-android-step-by-step-guide https://jivimberg.io/blog/2018/05/04/parallel-map-in-kotlin/ Use Kotlin coroutines with Architecture components https://proandroiddev.com/async-operations-with-kotlin-coroutines-part-1-c51cc581ad33 https://medium.com/@elizarov/coroutine-context-and-scope-c8b255d59055 https://medium.com/@elizarov/structured-concurrency-722d765aa952","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to make digit passcode input in Swift","slug":"How-to-make-digit-passcode-input-in-Swift","date":"2019-08-06T11:14:49.000Z","updated":"2019-08-06T11:18:54.000Z","comments":true,"path":"blog/How-to-make-digit-passcode-input-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-digit-passcode-input-in-Swift/","excerpt":"","text":"Issue #347 Add a hidden UITextField to view hierarchy, and add UITapGestureRecognizer to activate that textField. Use padding string with limit to the number of labels, and prefix to get exactly n characters. DigitView.swift 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283import UIKitfinal class DigitView: UIView &#123; lazy var stackView: UIStackView = &#123; let view = UIStackView() view.axis = .horizontal view.distribution = .equalSpacing return view &#125;() private(set) var boxes: [UIView] = [] private(set) var labels: [UILabel] = [] lazy var hiddenTextField: UITextField = &#123; let textField = UITextField() textField.alpha = 0 textField.keyboardType = .numbersAndPunctuation return textField &#125;() lazy var tapGR = UITapGestureRecognizer(target: self, action: #selector(handle(_:))) override init(frame: CGRect) &#123; super.init(frame: frame) setup() addGestureRecognizer(tapGR) &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; override func layoutSubviews() &#123; super.layoutSubviews() boxes.forEach &#123; $0.layer.borderWidth = 1 $0.layer.borderColor = R.color.primary.cgColor $0.layoutIfNeeded() $0.layer.cornerRadius = $0.bounds.height / 2 &#125; &#125; @objc private func handle(_ tapGR: UITapGestureRecognizer) &#123; hiddenTextField.becomeFirstResponder() &#125; private func setup() &#123; addSubviews([hiddenTextField, stackView]) boxes = Array(0..&lt;6).map &#123; _ in return UIView() &#125; labels = boxes.map &#123; box in let label = UILabel() label.font = R.customFont.semibold(16) label.textAlignment = .center label.textColor = R.color.primary box.addSubview(label) NSLayoutConstraint.on([ label.centerXAnchor.constraint(equalTo: box.centerXAnchor), label.centerYAnchor.constraint(equalTo: box.centerYAnchor) ]) return label &#125; boxes.forEach &#123; stackView.addArrangedSubview($0) NSLayoutConstraint.on([ $0.heightAnchor.constraint(equalTo: stackView.heightAnchor, multiplier: 0.9), $0.widthAnchor.constraint(equalTo: $0.heightAnchor, multiplier: 1.0) ]) &#125; NSLayoutConstraint.on([ stackView.pinEdges(view: self, inset: UIEdgeInsets(top: 0, left: 16, bottom: 0, right: -16)) ]) &#125;&#125; DigitHandler.swift 1234567891011121314151617181920212223242526272829303132333435final class DigitHandler: NSObject &#123; let digitView: DigitView init(digitView: DigitView) &#123; self.digitView = digitView super.init() digitView.hiddenTextField.delegate = self digitView.hiddenTextField.addTarget(self, action: #selector(handle(_:)), for: .editingChanged) &#125; @objc private func handle(_ textField: UITextField) &#123; guard let text = textField.text else &#123; return &#125; let count = digitView.labels.count let paddedText = String(text.padding(toLength: count, withPad: \"-\", startingAt: 0).prefix(count)) zip(digitView.labels, paddedText).forEach &#123; tuple in tuple.0.text = String(tuple.1) &#125; &#125;&#125;extension DigitHandler: UITextFieldDelegate &#123; func textFieldShouldReturn(_ textField: UITextField) -&gt; Bool &#123; textField.resignFirstResponder() return true &#125; func textField(_ textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -&gt; Bool &#123; let text = textField.text ?? \"\" return text.count &lt; digitView.labels.count &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make credit card input UI in Swift","slug":"How-to-make-credit-card-input-UI-in-Swift","date":"2019-08-05T12:16:48.000Z","updated":"2019-08-05T12:20:49.000Z","comments":true,"path":"blog/How-to-make-credit-card-input-UI-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-credit-card-input-UI-in-Swift/","excerpt":"","text":"Issue #346 We have FrontCard that contains number and expiration date, BackCard that contains CVC. CardView is used to contain front and back sides for flipping transition. We leverage STPPaymentCardTextField from Stripe for working input fields, then CardHandler is used to parse STPPaymentCardTextField content and update our UI. For masked credit card numbers, we pad string to fit 16 characters with ‚óè symbol, then chunk into 4 parts and zip with labels to update. For flipping animation, we use UIView.transition with showHideTransitionViews BackCard.swift 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import UIKitfinal class BackCard: UIView &#123; lazy var rectangle: UIView = &#123; let view = UIView() view.backgroundColor = R.color.darkText return view &#125;() lazy var cvcLabel: UILabel = &#123; let label = UILabel() label.font = R.customFont.medium(14) label.textColor = R.color.darkText label.textAlignment = .center return label &#125;() lazy var cvcBox: UIView = &#123; let view = UIView() view.backgroundColor = R.color.lightText return view &#125;() override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; addSubviews([rectangle, cvcBox, cvcLabel]) NSLayoutConstraint.on([ rectangle.leftAnchor.constraint(equalTo: leftAnchor), rectangle.rightAnchor.constraint(equalTo: rightAnchor), rectangle.heightAnchor.constraint(equalToConstant: 52), rectangle.topAnchor.constraint(equalTo: topAnchor, constant: 30), cvcBox.rightAnchor.constraint(equalTo: rightAnchor, constant: -16), cvcBox.topAnchor.constraint(equalTo: rectangle.bottomAnchor, constant: 16), cvcBox.widthAnchor.constraint(equalToConstant: 66), cvcBox.heightAnchor.constraint(equalToConstant: 30), cvcLabel.centerXAnchor.constraint(equalTo: cvcBox.centerXAnchor), cvcLabel.centerYAnchor.constraint(equalTo: cvcBox.centerYAnchor) ]) &#125;&#125; FrontCard.swift 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import UIKitfinal class FrontCard: UIView &#123; lazy var stackView: UIStackView = &#123; let stackView = UIStackView() stackView.axis = .horizontal stackView.distribution = .equalSpacing return stackView &#125;() lazy var numberLabels: [UILabel] = Array(0..&lt;4).map(&#123; _ in return UILabel() &#125;) lazy var expirationStaticLabel: UILabel = &#123; let label = UILabel() label.font = R.customFont.regular(10) label.textColor = R.color.darkText return label &#125;() lazy var expirationLabel: UILabel = &#123; let label = UILabel() label.font = R.customFont.medium(14) label.textColor = R.color.darkText return label &#125;() override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; addSubview(stackView) numberLabels.forEach &#123; stackView.addArrangedSubview($0) &#125; addSubviews([expirationStaticLabel, expirationLabel]) numberLabels.forEach &#123; $0.font = R.customFont.medium(16) $0.textColor = R.color.darkText $0.textAlignment = .center &#125; NSLayoutConstraint.on([ stackView.heightAnchor.constraint(equalToConstant: 50), stackView.leftAnchor.constraint(equalTo: leftAnchor, constant: 24), stackView.rightAnchor.constraint(equalTo: rightAnchor, constant: -24), stackView.topAnchor.constraint(equalTo: centerYAnchor), expirationStaticLabel.topAnchor.constraint(equalTo: stackView.bottomAnchor), expirationStaticLabel.leftAnchor.constraint(equalTo: rightAnchor, constant: -70), expirationLabel.leftAnchor.constraint(equalTo: expirationStaticLabel.leftAnchor), expirationLabel.topAnchor.constraint(equalTo: expirationStaticLabel.bottomAnchor) ]) &#125;&#125; CardView.swift 123456789101112131415161718192021222324252627282930import UIKitfinal class CardView: UIView &#123; let backCard = BackCard() let frontCard = FrontCard() override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; addSubview(backCard) addSubview(frontCard) [backCard, frontCard].forEach &#123; NSLayoutConstraint.on([ $0.pinEdges(view: self) ]) $0.clipsToBounds = true $0.layer.cornerRadius = 10 $0.backgroundColor = R.color.card.background &#125; &#125;&#125; CardHandler.swift 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182import Foundationimport Stripefinal class CardHandler &#123; let cardView: CardView init(cardView: CardView) &#123; self.cardView = cardView &#125; func reset() &#123; cardView.frontCard.expirationStaticLabel.text = R.string.localizable.cardExpiration() cardView.frontCard.expirationLabel.text = R.string.localizable.cardExpirationPlaceholder() cardView.backCard.cvcLabel.text = R.string.localizable.cardCvcPlaceholder() &#125; func showFront() &#123; flip( from: cardView.backCard, to: cardView.frontCard, options: .transitionFlipFromLeft ) &#125; func showBack() &#123; flip( from: cardView.frontCard, to: cardView.backCard, options: .transitionFlipFromRight ) &#125; func handle(_ textField: STPPaymentCardTextField) &#123; handle(number: textField.cardNumber ?? \"\") handle(month: textField.formattedExpirationMonth, year: textField.formattedExpirationYear) handle(cvc: textField.cvc) &#125; private func handle(number: String) &#123; let paddedNumber = number.padding( toLength: 16, withPad: R.string.localizable.cardNumberPlaceholder(), startingAt: 0 ) let chunkedNumbers = paddedNumber.chunk(by: 4) zip(cardView.frontCard.numberLabels, chunkedNumbers).forEach &#123; tuple in tuple.0.text = tuple.1 &#125; &#125; private func handle(cvc: String?) &#123; if let cvc = cvc, !cvc.isEmpty &#123; cardView.backCard.cvcLabel.text = cvc &#125; else &#123; cardView.backCard.cvcLabel.text = R.string.localizable.cardCvcPlaceholder() &#125; &#125; private func handle(month: String?, year: String?) &#123; guard let month = month, let year = year, !month.isEmpty else &#123; cardView.frontCard.expirationLabel.text = R.string.localizable.cardExpirationPlaceholder() return &#125; let formattedYear = year.ifEmpty(replaceWith: \"00\") cardView.frontCard.expirationLabel.text = \"\\(month)/\\(formattedYear)\" &#125; private func flip(from: UIView, to: UIView, options: UIView.AnimationOptions) &#123; UIView.transition( from: from, to: to, duration: 0.25, options: [options, .showHideTransitionViews], completion: nil ) &#125;&#125; String+Extension.swift 12345678910111213extension String &#123; func ifEmpty(replaceWith: String) -&gt; String &#123; return isEmpty ? replaceWith : self &#125; func chunk(by length: Int) -&gt; [String] &#123; return stride(from: 0, to: count, by: length).map &#123; let start = index(startIndex, offsetBy: $0) let end = index(start, offsetBy: length, limitedBy: endIndex) ?? endIndex return String(self[start..&lt;end]) &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to stop implicit animation when title change on UIButton","slug":"How-to-stop-implicit-animation-when-title-change-on-UIButton","date":"2019-08-02T05:21:47.000Z","updated":"2019-08-02T06:45:36.000Z","comments":true,"path":"blog/How-to-stop-implicit-animation-when-title-change-on-UIButton/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-stop-implicit-animation-when-title-change-on-UIButton/","excerpt":"","text":"Issue #345 UIButton with system type has implicit animation for setTitle(_:for:) Use this method to set the title for the button. The title you specify derives its formatting from the button‚Äôs associated label object. If you set both a title and an attributed title for the button, the button prefers the use of the attributed title over this one. At a minimum, you should set the value for the normal state. If a title is not specified for a state, the default behavior is to use the title associated with the normal state. If the value for normal is not set, then the property defaults to a system value. 1234UIView.performWithoutAnimation &#123; button.setTitle(title, for: .normal) button.layoutIfNeeded()&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use addSubview in iOS","slug":"How-to-use-addSubview-in-iOS","date":"2019-08-01T12:06:27.000Z","updated":"2019-08-01T12:06:32.000Z","comments":true,"path":"blog/How-to-use-addSubview-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-addSubview-in-iOS/","excerpt":"","text":"Issue #344 addSubview can trigger viewDidLayoutSubviews, so be careful to just do layout stuff in viewDidLayoutSubviews This method establishes a strong reference to view and sets its next responder to the receiver, which is its new superview. Views can have only one superview. If view already has a superview and that view is not the receiver, this method removes the previous superview before making the receiver its new superview. When the bounds change for a view controller‚Äô¬Ä¬ôs view, the view adjusts the positions of its subviews and then the system calls this method. However, this method being called does not indicate that the individual layouts of the view‚Äô¬Ä¬ôs subviews have been adjusted. Each subview is responsible for adjusting its own layout. Your view controller can override this method to make changes after the view lays out its subviews. The default implementation of this method does nothing.","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to run app on beta iOS devices","slug":"How-to-run-app-on-beta-iOS-devices","date":"2019-08-01T04:59:03.000Z","updated":"2019-11-05T10:32:42.000Z","comments":true,"path":"blog/How-to-run-app-on-beta-iOS-devices/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-app-on-beta-iOS-devices/","excerpt":"","text":"Issue #343 Xcode 10.3 with iOS 13 1sudo ln -s /Applications/Xcode-beta.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport/13.0 /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport Xcode 10.3 with iOS 13.1 beta 2 1sudo ln -s /Applications/Xcode-beta.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport/13.0/ /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport/13.1 Use DeviceSupport Download and unzip Device support https://github.com/iGhibli/iOS-DeviceSupport 1/Applications/Xcode/Contents/Developer/Platforms/iPhoneOS.platform/DeviceSupport","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"xcode","slug":"xcode","permalink":"https://onmyway133.github.io/tags/xcode/"}]},{"title":"How to submit electron app to AppStore","slug":"How-to-submit-electron-app-to-AppStore","date":"2019-07-31T18:19:25.000Z","updated":"2019-10-11T06:18:37.000Z","comments":true,"path":"blog/How-to-submit-electron-app-to-AppStore/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-submit-electron-app-to-AppStore/","excerpt":"","text":"Issue #342 BeforeInstall electron as dev npm install electron --save-devUpdate electron-packager npm install electron-packager@latest --save-devUse no space in app name Package with electron-packagerFollow https://github.com/electron/electron-osx-sign/wiki/Packaging-and-Submitting-an-Electron-App-to-the-Mac-App-Store 123npx electron-packager . \"MyApp\" --app-bundle-id=com.onmyway133.MyApp --helper-bundle-id=com.onmyway133.MyApp.helper --app-version=1.4.0 --build-version=1.0.100 --platform=mas --arch=x64 --icon=Icon/Icon.icns --overwritenpx electron-osx-sign \"MyApp-mas-x64/MyApp.app\" --verbosenpx electron-osx-flat \"MyApp-mas-x64/MyApp.app\" --verbose If you have multiple developer identities in your keychain: electron-osx-sign searches your keychain for the first signing certificates that it can locate. If you have multiple certificates then it may not know which cert you want to use for signing and you need to explicitly provide the name: 1electron-osx-sign &quot;My App-mas-x64/My App.app&quot; --identity=&quot;3rd Party Mac Developer Application: My Company, Inc (ABCDEFG1234)&quot; --verbose Read moreSign with electron-osx-signRead README https://github.com/electron/electron-osx-sign For distribution in the Mac App Store: Have the provisioning profile for distribution placed in the current working directory and the signing identity installed in the default keychain. CertificateOn developer.apple.com, create Mac App Distribution certificate. Make sure when we download in Keychain Access, it has associated private key Manually upload1/Applications/Xcode.app/Contents/Applications/Application\\ Loader.app/Contents/itms/bin/iTMSTransporter -m upload -assetFile MyApp/MyApp.pkg -u onmyway133@gmail.com -p mypassword Use Application LoaderUse Using app-specific passwords Troubleshootingelectron Bad CFBundleExecutable. Cannot find executable file ERROR ITMS-90261: ‚ÄúBad CFBundleExecutable. Cannot find executable file that matches the value of CFBundleExecutable in the nested bundle MyApp [com.onmyway133.MyApp.pkg/Payload/MyApp.app/Contents/Frameworks/MyApp (GPU).app] property list file.‚Äù https://github.com/electron/electron-packager/issues?utf8=%E2%9C%93&amp;q=helper Try electron 5.0.0 npm install electron@5.0.0 --save-dev Specifically, we found that when the user closes the main application window there is no menu item to re-open it.https://stackoverflow.com/questions/35008347/electron-close-w-x-vs-right-click-dock-and-quit 12345678910111213141516function createMenu() &#123; const application = &#123; label: \"MyApp\", submenu: [ &#123; label: \"New\", accelerator: \"Command+N\", click: () =&gt; &#123; if (win === null) &#123; createWindow() &#125; &#125; &#125; ] &#125;&#125; ‚Äòelectron-osx-flat@latest‚Äô is not in the npm registry1npm install -g electron-osx-sign@latest App sandbox not enabledelectron-osx-sign Command failed: codesign1ran xattr -cr * Command failed: codesign bundle format is ambiguous Perhaps you accidentally packaged the previous generated app bundle into your newly packaged app? Remove dist folder generated by electron-builder","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"electron","slug":"electron","permalink":"https://onmyway133.github.io/tags/electron/"}]},{"title":"How to format hour minute from time interval in Swift","slug":"How-to-format-hour-minute-from-time-interval-in-Swift","date":"2019-07-31T07:35:44.000Z","updated":"2019-07-31T07:36:21.000Z","comments":true,"path":"blog/How-to-format-hour-minute-from-time-interval-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-format-hour-minute-from-time-interval-in-Swift/","excerpt":"","text":"Issue #340 Use DateComponentsFormatterhttps://nshipster.com/formatter/#datecomponentsformatter Results in no padding 0 1234567891011func format(second: TimeInterval) -&gt; String? &#123; let formatter = DateComponentsFormatter() formatter.unitsStyle = .positional formatter.allowedUnits = [.hour, .minute] formatter.zeroFormattingBehavior = .pad return formatter.string(from: second)&#125;XCTAssertEqual(format(second: 5400 ), \"1:30\")XCTAssertEqual(format(second: 7200), \"2:00\")XCTAssertEqual(format(second: 39600 ), \"11:00\") Use mod123456789101112131415func format(minute: Int) -&gt; String &#123; let h = minute / 60 let m = minute % 60 return \"\\(h.padZero()):\\(m.padZero())\"&#125;private extension Int &#123; func padZero() -&gt; String &#123; return String(format: \"%02d\", self) &#125;&#125;XCTAssertEqual(format(minute: 90 ), \"01:30\")XCTAssertEqual(format(minute: 120), \"02:00\")XCTAssertEqual(format(minute: 660 ), \"11:00\")","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to cache URLSession response","slug":"How-to-cache-URLSession-response","date":"2019-07-03T11:49:07.000Z","updated":"2019-07-03T11:49:15.000Z","comments":true,"path":"blog/How-to-cache-URLSession-response/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-cache-URLSession-response/","excerpt":"","text":"Issue #339 For simple cases, we don‚Äôt need to. Let‚Äôs use urlCache The URL cache for providing cached responses to requests within the session. Accessing Cached Data The URL Loading System caches responses both in memory and on disk, improving performance and reducing network traffic. The URLCache class is used for caching responses from network resources. Your app can directly access the shared cache instance by using the shared property of URLCache. Or, you can create your own caches for different purposes, setting distinct caches on your URLSessionConfiguration objects. Read more URLCache","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use ext in gradle in Android","slug":"How-to-use-ext-in-gradle-in-Android","date":"2019-07-02T12:15:02.000Z","updated":"2019-07-02T12:15:26.000Z","comments":true,"path":"blog/How-to-use-ext-in-gradle-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-ext-in-gradle-in-Android/","excerpt":"","text":"Issue #338 Gradle uses Groovy and it has ext, also known as ExtraPropertiesExtension Additional, ad-hoc, properties for Gradle domain objects. Extra properties extensions allow new properties to be added to existing domain objects. They act like maps, allowing the storage of arbitrary key/value pairs. All ExtensionAware Gradle domain objects intrinsically have an extension named ‚Äúext‚Äù of this type. 123456789project.ext &#123; myprop = \"a\"&#125;assert project.myprop == \"a\"assert project.ext.myprop == \"a\"project.myprop = \"b\"assert project.myprop == \"b\"assert project.ext.myprop == \"b\" In root build.gradle, ext adds extra property to rootProject object. There we can access rootProject.ext or just ext 123ext &#123; myLibraryVersion = '1.0.0'&#125; In module app/build.gradle, ext adds extra property to project object. There we can access project.ext or just ext 123ext &#123; myLibraryVersion = '1.0.0'&#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to do custom presentation with UIViewPropertyAnimator in iOS","slug":"How-to-do-custom-presentation-with-UIViewPropertyAnimator-in-iOS","date":"2019-07-02T08:14:34.000Z","updated":"2019-07-02T08:14:40.000Z","comments":true,"path":"blog/How-to-do-custom-presentation-with-UIViewPropertyAnimator-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-custom-presentation-with-UIViewPropertyAnimator-in-iOS/","excerpt":"","text":"Issue #337 Normally we just present from any UIViewController in any UINavigationController in UITabBarController and it will present over tabbar 1present(detailViewController, animated: true, completion: nil) If we have animation with UIViewPropertyAnimator, then we can implement UIViewControllerAnimatedTransitioning and interruptibleAnimator(using:) The methods in this protocol let you define an animator object, which creates the animations for transitioning a view controller on or off screen in a fixed amount of time. The animations you create using this protocol must not be interactive. To create interactive transitions, you must combine your animator object with another object that controls the timing of your animations. Implement this method when you want to perform your transitions using an interruptible animator object, such as a UIViewPropertyAnimator object. You must return the same animator object for the duration of the transition. For more fine-grained control, we can have UIPresentationController From the time a view controller is presented until the time it is dismissed, UIKit uses a presentation controller to manage various aspects of the presentation process for that view controller. The presentation controller can add its own animations on top of those provided by animator objects, it can respond to size changes, and it can manage other aspects of how the view controller is presented onscreen. A lazy approach is to present without animation and do animation after 1234present(detailViewController, animated: false, completion: &#123; let animator = UIViewPropertyAnimator() animator.startAnimation()&#125;) If we don‚Äôt want to involve UIViewController then we can work on UIView level. This way we can animate hiding tab bar. Any UIViewController within UITabBarController has tabBarController 12345let animator = UIViewPropertyAnimator()animator.addAnimations &#123; self.tabBarController?.tabBar.transform = CGAffineTransform(translationX: 0, y: tabbar.frame.height)&#125;animator.startAnimation()","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to show dropdown in AppKit","slug":"How-to-show-dropdown-in-AppKit","date":"2019-06-29T17:37:25.000Z","updated":"2019-09-06T17:37:23.000Z","comments":true,"path":"blog/How-to-show-dropdown-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-dropdown-in-AppKit/","excerpt":"","text":"Issue #336 Use NSPopUpButton var pullsDown: Bool A Boolean value indicating whether the button displays a pull-down or pop-up menu. func addItem(withTitle: String)Adds an item with the specified title to the end of the menu. Should disable pullsDown if we want to set title automatically and not scale button for title Read more Managing Pop-Up Buttons and Pull-Down Lists","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to scan up to character in Swift","slug":"How-to-scan-up-to-character-in-Swift","date":"2019-06-29T17:29:25.000Z","updated":"2019-06-29T17:29:30.000Z","comments":true,"path":"blog/How-to-scan-up-to-character-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-scan-up-to-character-in-Swift/","excerpt":"","text":"Issue #335 This is useful when we want to get the first meaningful line in a big paragraph 1234let scanner = Scanner(string: text)var result: NSString? = \"\"scanner.scanUpTo(\"\\n\", into: &amp;result)return result as String?","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use NSSecureCoding in Swift","slug":"How-to-use-NSSecureCoding-in-Swift","date":"2019-06-29T17:19:34.000Z","updated":"2019-06-29T17:19:43.000Z","comments":true,"path":"blog/How-to-use-NSSecureCoding-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-NSSecureCoding-in-Swift/","excerpt":"","text":"Issue #334 NSSecureCoding has been around since iOS 6 and has had some API changes in iOS 12 A protocol that enables encoding and decoding in a manner that is robust against object substitution attacks. The class must subclass from NSObject and conform to NSSecureCoding 1234567891011121314151617181920212223242526272829303132class Note: NSObject, NSSecureCoding &#123; static var supportsSecureCoding: Bool = true func encode(with aCoder: NSCoder) &#123; aCoder.encode(id, forKey: \"id\") aCoder.encode(text, forKey: \"text\") aCoder.encode(date, forKey: \"date\") &#125; required init?(coder aDecoder: NSCoder) &#123; guard let id = aDecoder.decodeObject(forKey: \"id\") as? String, let text = aDecoder.decodeObject(forKey: \"text\") as? String, let date = aDecoder.decodeObject(forKey: \"date\") as? Date else &#123; return nil &#125; self.id = id self.text = text self.date = date &#125; let id: String var text = \"untitled\" var date: Date = Date() override init() &#123; id = UUID().uuidString super.init() &#125;&#125; First, we need to serialize to Data, then use EasyStash for easy persistency 123456789do &#123; let data = try NSKeyedArchiver.archivedData( withRootObject: self.notes, requiringSecureCoding: true ) try self.storage.save(object: data, forKey: self.key)&#125; catch &#123; print(error)&#125; Then we can use unarchiveTopLevelObjectWithData to unarchive array 1234567do &#123; let data: Data = try self.storage.load(forKey: self.key) let notes = try NSKeyedUnarchiver.unarchiveTopLevelObjectWithData(data) as? [Note] // notes is of type [Note]?&#125; catch &#123; print(error)&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to simplify pager interaction with Rx","slug":"How-to-simplify-pager-interaction-with-Rx","date":"2019-06-27T11:30:34.000Z","updated":"2019-06-27T11:31:59.000Z","comments":true,"path":"blog/How-to-simplify-pager-interaction-with-Rx/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-simplify-pager-interaction-with-Rx/","excerpt":"","text":"Issue #333 In a traditional pager with many pages of content, and a bottom navigation with previous and next button. Each page may have different content, and depending on each state, may block the next button. The state of next button should state in real time depending on state in each page content, and when user moves back and forth between pages, the state of next button should be reflected as well. We might have 12345678910111213141516extension ViewController: BottomNavigationDelegate &#123; func bottomNavigationCanGoNext(currentIndex: Int) -&gt; Bool &#123;&#125; func bottomNavigationDidMoveTo(index: Int) &#123;&#125;&#125;extension ViewController: PreferencePageDelegate &#123; func preferencePageDidSelect(itemCount: Int) &#123;&#125;&#125;extension ViewController: FormPageDelegate &#123; func formPageDidCheck(valid: Bool) &#123;&#125;&#125;extension ViewController: ConsentPageDelegate &#123; func consentPageDidAccept(agree: Bool) &#123;&#125;&#125; The indirect communications between each page, bottom navigation and ViewController get complicated and out of hands very quickly. This is a perfect problem for Rx to solve. If we look closely, the state of next button is a derivative of current index, how many items selected in preferences, valid form and agreement status. 12345678910111213141516171819202122232425262728class BottomNavigation &#123; let index = PublishSubject&lt;Int&gt;()&#125;class PreferencePage &#123; let itemCount = PublishSubject&lt;Int&gt;()&#125;class FormPage &#123; let valid = PublishSubject&lt;Bool&gt;()&#125;class ConsentPage &#123; let agree = PublishSubject&lt;Bool&gt;()&#125;let canNext = Observable .combineLatest(bottomNavigation.index, preferencePage.itemCount, formPage.valid, consentPage.agree) .map(&#123; (index, itemCount, valid, agree) -&gt; Bool in // Logic goes here to reduce, for example switch index &#123; case 0: return true case 1: return itemCount &gt; 2 case 2: return valid case 3: Return agree default: return false &#125; &#125;)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use moveItem in NSCollectionView in AppKit","slug":"How-to-use-moveItem-in-NSCollectionView-in-AppKit","date":"2019-06-27T07:15:08.000Z","updated":"2019-06-27T08:08:03.000Z","comments":true,"path":"blog/How-to-use-moveItem-in-NSCollectionView-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-moveItem-in-NSCollectionView-in-AppKit/","excerpt":"","text":"Issue #332 From moveItem(at:to:) Moves an item from one location to another in the collection view. After rearranging items in your data source object, use this method to synchronize those changes with the collection view. Calling this method lets the collection view know that it must update its internal data structures and possibly update its visual appearance. You can move the item to a different section or to a new location in the same section. The collection view updates the layout as needed to account for the move, animating cells into position in response. When inserting or deleting multiple sections and items, you can animate all of your changes at once using the performBatchUpdates(_:completionHandler:) method. 123456notes.swapAt(index, 0)collectionView.animator().moveItem( at: index.toIndexPath(), to: 0.toIndexPath()) There may be unknown reasons or bug that make other cells stay in incorrect state. The fix is to reload the rest cells 12let set = Set((1..&lt;notes.count).map(&#123; $0.toIndexPath() &#125;))collectionView.reloadItems(at: set)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to show dropdown from NSSegmentedControl in AppKit","slug":"How-to-show-dropdown-from-NSSegmentedControl-in-AppKit","date":"2019-06-27T07:04:13.000Z","updated":"2019-06-27T07:04:19.000Z","comments":true,"path":"blog/How-to-show-dropdown-from-NSSegmentedControl-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-dropdown-from-NSSegmentedControl-in-AppKit/","excerpt":"","text":"Issue #331 From NSSegmentedControl The features of a segmented control include the following:A segment can have an image, text (label), menu, tooltip, and tag.A segmented control can contain images or text, but not both. 1234567891011121314151617181920212223242526272829let languageMenu = NSMenu(title: \"\")let languages = [\"Swift\", \"Javascript\"]languages.forEach &#123; let item = NSMenuItem(title: $0, action: #selector(handleSelectLanguage(_:)), keyEquivalent: \"\") item.target = self item.isEnabled = true languageMenu.addItem(item)&#125;let themeMenu = NSMenu(title: \"\")let themes = [\"one dark\", \"one light\"]themes.forEach &#123; let item = NSMenuItem(title: $0, action: #selector(handleSelectLanguage(_:)), keyEquivalent: \"\") item.target = self item.isEnabled = true themeMenu.addItem(item)&#125;segment.segmentCount = 2segment.selectedSegmentBezelColor = NSColor.redsegment.setLabel(\"Language\", forSegment: 0)segment.setLabel(\"Theme\", forSegment: 1segment.setMenu(languageMenu, forSegment: 0)segment.setMenu(themeMenu, forSegment: 1segment.showsMenuIndicator(forSegment: 0)segment.showsMenuIndicator(forSegment: 1)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to make scrollable NSTextView in AppKit","slug":"How-to-make-scrollable-NSTextView-in-AppKit","date":"2019-06-26T18:07:38.000Z","updated":"2019-06-26T18:47:32.000Z","comments":true,"path":"blog/How-to-make-scrollable-NSTextView-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-scrollable-NSTextView-in-AppKit/","excerpt":"","text":"Issue #330 When adding NSTextView in xib, we see it is embedded under NSClipView. But if we try to use NSClipView to replicate what‚Äôs in the xib, it does not scroll. To make it work, we can follow Putting an NSTextView Object in an NSScrollView and How to make scrollable vertical NSStackView to make our ScrollableInput For easy Auto Layout, we use Anchors for UIScrollView. Things worth mentioned for vertical scrolling 123textContainer.heightTracksTextView = falsetextView.autoresizingMask = [.width]textView.isVerticallyResizable = true 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849class ScrollableInput: NSView &#123; let scrollView = NSScrollView() let textView = NSTextView() override init(frame frameRect: NSRect) &#123; super.init(frame: frameRect) let rect = CGRect( x: 0, y: 0, width: 0, height: CGFloat.greatestFiniteMagnitude ) let layoutManager = NSLayoutManager() let textContainer = NSTextContainer(size: rect.size) layoutManager.addTextContainer(textContainer) textView = NSTextView(frame: rect, textContainer: textContainer) textView.maxSize = NSSize(width: 0, height: CGFloat.greatestFiniteMagnitude) textContainer.heightTracksTextView = false textContainer.widthTracksTextView = true textView.isRichText = false textView.importsGraphics = false textView.isEditable = true textView.isSelectable = true textView.font = R.font.text textView.textColor = R.color.text textView.isVerticallyResizable = true textView.isHorizontallyResizable = false addSubview(scrollView) scrollView.hasVerticalScroller = true scrollView.drawsBackground = false scrollView.drawsBackground = false textView.drawsBackground = false activate( scrollView.anchor.edges ) scrollView.documentView = textView textView.autoresizingMask = [.width] &#125; required init?(coder decoder: NSCoder) &#123; fatalError() &#125;&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to handle keyboard for UITextField in scrolling UIStackView in iOS","slug":"How-to-handle-keyboard-for-UITextField-in-scrolling-UIStackView-in-iOS","date":"2019-06-26T08:36:04.000Z","updated":"2019-08-19T05:58:49.000Z","comments":true,"path":"blog/How-to-handle-keyboard-for-UITextField-in-scrolling-UIStackView-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-keyboard-for-UITextField-in-scrolling-UIStackView-in-iOS/","excerpt":"","text":"Issue #329 Firstly, to make UIStackView scrollable, embed it inside UIScrollView. Read How to embed UIStackView inside UIScrollView in iOS It‚Äôs best to listen to keyboardWillChangeFrameNotification as it contains frame changes for Keyboard in different situation like custom keyboard, languages. Posted immediately prior to a change in the keyboard‚Äôs frame. 1234567891011121314151617class KeyboardHandler &#123; let scrollView: UIScrollView let stackView: UIStackView var observer: AnyObject? var keyboardHeightConstraint: NSLayoutConstraint! struct Info &#123; let frame: CGRect let duration: Double let animationOptions: UIView.AnimationOptions &#125; init(scrollView: UIScrollView, stackView: UIStackView) &#123; self.scrollView = scrollView self.stackView = stackView &#125;&#125; To make scrollView scroll beyond its contentSize, we can change its contentInset.bottom. Another way is to add a dummy view with certain height to UIStackView and alter its NSLayoutConstraint constant We can‚Äôt access self inside init, so it‚Äôs best to have setup function 1234567891011121314func setup() &#123; let space = UIView() keyboardHeightConstraint = space.heightAnchor.constraint(equalToConstant: 0) NSLayoutConstraint.on([keyboardHeightConstraint]) stackView.addArrangedSubview(spa observer = NotificationCenter.default.addObserver( forName: UIResponder.keyboardWillChangeFrameNotification, object: nil, queue: .main, using: &#123; [weak self] notification in self?.handle(notification) &#125; )&#125; Convert Notification to a convenient Info struct 1234567891011121314func convert(notification: Notification) -&gt; Info? &#123; guard let frameValue = notification.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] NSValue, let durationotification.userInfo?[UIResponder.keyboardAnimationDurationUserInfoKey] as? NSNumber, let raw = notification.userInfo?[UIResponder.keyboardAnimationCurveUserInfoKey] NSNumber else &#123; return nil return Info( frame: frameValue.cgRectValue, duration: duration.doubleValue, animationOptions: UIView.AnimationOptions(rawValue: raw.uintValue) )&#125; Then we can compare with UIScreen to check if Keyboard is showing or hiding 123456789101112131415func handle(_ notification: Notification) &#123; guard let info = convert(notification: notification) else &#123; return let isHiding = info.frame.origin.y == UIScreen.main.bounds.height keyboardHeightConstraint.constant = isHiding ? 0 : info.frame.hei UIView.animate( withDuration: info.duration, delay: 0, options: info.animationOptions, animations: &#123; self.scrollView.layoutIfNeeded() self.moveTextFieldIfNeeded(info: info) &#125;, completion: nil)&#125; To move UITextField we can use scrollRectToVisible(_:animated:) but we have little control over how much we want to scroll This method scrolls the content view so that the area defined by rect is just visible inside the scroll view. If the area is already visible, the method does nothing. Another way is to check if keyboard overlaps UITextField. To do that we use convertRect:toView: with nil target so it uses window coordinates. Since keyboard frame is always relative to window, we have frames in same coordinate space. Converts a rectangle from the receiver‚Äôs coordinate system to that of another view. rect: A rectangle specified in the local coordinate system (bounds) of the receiver.view: The view that is the target of the conversion operation. If view is nil, this method instead converts to window base coordinates. Otherwise, both view and the receiver must belong to the same UIWindow object. 1234567891011121314func moveTextFieldIfNeeded(info: Info) &#123; guard let input = stackView.arrangedSubviews .compactMap(&#123; $0 as? UITextField &#125;) .first(where: &#123; $0.isFirstResponder &#125;) else &#123; return let inputFrame = input.convert(input.bounds, to: nil) if inputFrame.intersects(info.frame) &#123; scrollView.setContentOffset(CGPoint(x: 0, y: inputFrame.height), animated: true) &#125; else &#123; scrollView.setContentOffset(.zero, animated: true) &#125;&#125; Move up the entire viewFor simplicity, we can move up the entire view 12345678910111213func move(info: Info) &#123; let isHiding = info.frame.origin.y == UIScreen.main.bounds.height let moveUp = CGAffineTransform(translationX: 0, y: -info.frame.height) switch (view.transform, isHiding) &#123; case (.identity, false): view.transform = moveUp case (moveUp, true): view.transform = .identity default: break &#125;&#125; Prefer willShow and willHideThere ‚Äòs an edge case with the above switch on view.transform and isHiding with one time verification sms code, which make it into the correct case handling. It‚Äôs safe to just set view.transform depending on show with willHide and willShow 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677import UIKitclass KeyboardHandler &#123; let view: UIView var observerForWillShow: AnyObject? var observerForWillHide: AnyObject? var keyboardHeightConstraint: NSLayoutConstraint! struct Info &#123; let frame: CGRect let duration: Double let animationOptions: UIView.AnimationOptions &#125; init(view: UIView) &#123; self.view = view &#125; func setup() &#123; observerForWillShow = NotificationCenter.default.addObserver( forName: UIResponder.keyboardWillShowNotification, object: nil, queue: .main, using: &#123; [weak self] notification in self?.handle(notification, show: true) &#125; ) observerForWillHide = NotificationCenter.default.addObserver( forName: UIResponder.keyboardWillHideNotification, object: nil, queue: .main, using: &#123; [weak self] notification in self?.handle(notification, show: false) &#125; ) &#125; func handle(_ notification: Notification, show: Bool) &#123; guard let info = convert(notification: notification) else &#123; return &#125; UIView.animate( withDuration: info.duration, delay: 0, options: info.animationOptions, animations: &#123; self.move(info: info, show: show) &#125;, completion: nil) &#125; func move(info: Info, show: Bool) &#123; let moveUp = CGAffineTransform(translationX: 0, y: -info.frame.height) if show &#123; view.transform = moveUp &#125; else &#123; view.transform = .identity &#125; &#125; func convert(notification: Notification) -&gt; Info? &#123; guard let frameValue = notification.userInfo?[UIResponder.keyboardFrameEndUserInfoKey] as? NSValue, let duration = notification.userInfo?[UIResponder.keyboardAnimationDurationUserInfoKey] as? NSNumber, let raw = notification.userInfo?[UIResponder.keyboardAnimationCurveUserInfoKey] as? NSNumber else &#123; return nil &#125; return Info( frame: frameValue.cgRectValue, duration: duration.doubleValue, animationOptions: UIView.AnimationOptions(rawValue: raw.uintValue) ) &#125;&#125; Read more Managing the Keyboard","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make simple form validator in Swift","slug":"How-to-make-simple-form-validator-in-Swift","date":"2019-06-25T12:05:08.000Z","updated":"2019-10-18T09:03:53.000Z","comments":true,"path":"blog/How-to-make-simple-form-validator-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-simple-form-validator-in-Swift/","excerpt":"","text":"Issue #328 Sometimes we want to validate forms with many fields, for example name, phone, email, and with different rules. If validation fails, we show error message. We can make simple Validator and Rule 1234567891011121314151617181920212223242526272829303132333435363738class Validator &#123; func validate(text: String, with rules: [Rule]) -&gt; String? &#123; return rules.compactMap(&#123; $0.check(text) &#125;).first &#125; func validate(input: InputView, with rules: [Rule]) &#123; guard let message = validate(text: input.textField.text ?? \"\", with: rules) else &#123; input.messageLabel.isHidden = true return &#125; input.messageLabel.isHidden = false input.messageLabel.text = message &#125;&#125;struct Rule &#123; // Return nil if matches, error message otherwise let check: (String) -&gt; String? static let notEmpty = Rule(check: &#123; return $0.isEmpty ? \"Must not be empty\" : nil &#125;) static let validEmail = Rule(check: &#123; let regex = #\"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]&#123;2,64&#125;\"# let predicate = NSPredicate(format: \"SELF MATCHES %@\", regex) return predicate.evaluate(with: $0) ? nil : \"Must have valid email\" &#125;) static let countryCode = Rule(check: &#123; let regex = #\"^\\+\\d+.*\"# let predicate = NSPredicate(format: \"SELF MATCHES %@\", regex) return predicate.evaluate(with: $0) ? nil : \"Must have prefix country code\" &#125;)&#125; Then we can use very expressively 12let validator = Validator()validator.validate(input: inputView, with: [.notEmpty, .validEmail]) Then a few tests to make sure it works 1234567891011121314151617181920class ValidatorTests: XCTestCase &#123; let validator = Validator() func testEmpty() &#123; XCTAssertNil(validator.validate(text: \"a\", with: [.notEmpty])) XCTAssertNotNil(validator.validate(text: \"\", with: [.notEmpty])) &#125; func testEmail() &#123; XCTAssertNil(validator.validate(text: \"onmyway133@gmail.com\", with: [.validEmail])) XCTAssertNotNil(validator.validate(text: \"onmyway133\", with: [.validEmail])) XCTAssertNotNil(validator.validate(text: \"onmyway133.com\", with: [.validEmail])) &#125; func testCountryCode() &#123; XCTAssertNil(validator.validate(text: \"+47 11 222 333\", with: [.countryCode])) XCTAssertNotNil(validator.validate(text: \"11 222 333\", with: [.countryCode])) XCTAssertNotNil(validator.validate(text: \"47 11 222 333\", with: [.countryCode])) &#125;&#125; allSatisfyTo check if all rules are ok, we can use reduce 123func check(text: String, with rules: [Rule]) -&gt; Bool &#123; return rules.allSatisfy(&#123; $0.check(text).isOk &#125;)&#125; Or more concisely, use allSatisfy 1234func check(text: String, with rules: [Rule]) -&gt; Bool &#123; return rules.allSatisfy(&#123; $0.check(text).isOk &#125;)&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to organise test files","slug":"How-to-organise-test-files","date":"2019-06-25T09:01:49.000Z","updated":"2019-09-12T07:11:27.000Z","comments":true,"path":"blog/How-to-organise-test-files/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-organise-test-files/","excerpt":"","text":"Issue #327 In terms of tests, we usually have files for unit test, UI test, integeration test and mock. Out of sight, out of mind. Unit tests are for checking specific functions and classes, it‚Äôs more convenient to browse them side by side with source file. For example in Javascript, Kotlin and Swift 123index.jsindex.test.jsindex.mock.js 123LocationManager.ktLocationManager.mock.ktLocationManager.test.kt 123BasketHandler.swiftBasketHandler.mock.swiftBasketHandler.test.swift Integration tests check features or sub features, and may cover many source files, it‚Äôs better to place them in feature folders 1234567891011- Features - Cart - Sources - Tests - Cart.test.swift - Validator.test.swift - Profile - Sources - Tests - Updater.test.swift - AvatarUploader.test.swift","categories":[],"tags":[{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"testing","slug":"testing","permalink":"https://onmyway133.github.io/tags/testing/"},{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to deal with weak in closure in Swift","slug":"How-to-deal-with-weak-in-closure-in-Swift","date":"2019-06-25T08:18:40.000Z","updated":"2019-06-25T11:18:56.000Z","comments":true,"path":"blog/How-to-deal-with-weak-in-closure-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-weak-in-closure-in-Swift/","excerpt":"","text":"Issue #326 Traditionally, from Swift 4.2 we need guard let self 123456789addButton.didTouch = &#123; [weak self] in guard let self = self, let product = self.purchasedProduct() else &#123; return self.delegate?.productViewController(self, didAdd: product)&#125; This is cumbersome, we can invent a higher order function to zip and unwrap the optionals 1234567891011func with&lt;A, B&gt;(_ op1: A?, _ op2: B?, _ closure: (A, B) -&gt; Void) &#123; if let value1 = op1, let value2 = op2 &#123; closure(value1, value2) &#125;&#125;addButton.didTouch = &#123; [weak self] in with(self, self?.purchasedProduct()) &#123; $0.delegate?.productViewController($0, didAdd: $1) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make material UITextField with floating label in iOS","slug":"How-to-make-material-UITextField-with-floating-label-in-iOS","date":"2019-06-24T06:34:53.000Z","updated":"2019-06-24T06:34:58.000Z","comments":true,"path":"blog/How-to-make-material-UITextField-with-floating-label-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-material-UITextField-with-floating-label-in-iOS/","excerpt":"","text":"Issue #325 Use UILabel as placeholder and move it When label is moved up, scale it down 80%. It means it has 10% padding on the left and right when shrinked, so offsetX for translation is 10% Translation transform should happen before scale Ideally we can animate font and color change using CATextLayer, but with UILabel we can use UIView.transition 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117final class MaterialInputView: UIView &#123; lazy var label: UILabel = &#123; return UILabel() &#125;() lazy var textField: UITextField = &#123; let textField = UITextField() textField.tintColor = R.color.primary textField.textColor = R.color.lightText textField.font = R.customFont.medium(16) textField.autocapitalizationType = .none textField.autocorrectionType = .no return textField &#125;() lazy var line: UIView = &#123; let line = UIView() line.backgroundColor = R.color.primary return line &#125;() // Whether label should be moved to top private var isUp: Bool = false &#123; didSet &#123; styleLabel(isUp: isUp) moveLabel(isUp: isUp) &#125; &#125; override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; addSubviews([textField, label, line]) textField.delegate = self NSLayoutConstraint.on([ textField.leftAnchor.constraint(equalTo: leftAnchor, constant: 16), textField.rightAnchor.constraint(equalTo: rightAnchor, constant: -16), textField.topAnchor.constraint(equalTo: topAnchor, constant: 16), label.leftAnchor.constraint(equalTo: textField.leftAnchor), label.centerYAnchor.constraint(equalTo: textField.centerYAnchor), line.leftAnchor.constraint(equalTo: textField.leftAnchor), line.rightAnchor.constraint(equalTo: textField.rightAnchor), line.topAnchor.constraint(equalTo: textField.bottomAnchor, constant: 8), line.heightAnchor.constraint(equalToConstant: 2) ]) styleLabel(isUp: false) &#125; private func styleLabel(isUp: Bool) &#123; UIView.transition( with: label, duration: 0.15, options: .curveEaseInOut, animations: &#123; if isUp &#123; self.label.font = R.customFont.regular(12) self.label.textColor = R.color.primary &#125; else &#123; self.label.font = R.customFont.medium(16) self.label.textColor = R.color.grayText &#125; &#125;, completion: nil ) &#125; private func moveLabel(isUp: Bool) &#123; UIView.animate( withDuration: 0.15, delay: 0, options: .curveEaseInOut, animations: &#123; if isUp &#123; let offsetX = self.label.frame.width * 0.1 let translation = CGAffineTransform(translationX: -offsetX, y: -24) let scale = CGAffineTransform(scaleX: 0.8, y: 0.8) self.label.transform = translation.concatenating(scale) &#125; else &#123; self.label.transform = .identity &#125; &#125;, completion: nil ) &#125;&#125;extension MaterialInputView: UITextFieldDelegate &#123; func textFieldDidBeginEditing(_ textField: UITextField) &#123; if !isUp &#123; isUp = true &#125; &#125; func textFieldShouldEndEditing(_ textField: UITextField) -&gt; Bool &#123; guard let text = textField.text else &#123; return false &#125; if isUp &amp;&amp; text.isEmpty &#123; isUp = false &#125; return true &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to embed UIStackView inside UIScrollView in iOS","slug":"How-to-embed-UIStackView-inside-UIScrollView-in-iOS","date":"2019-06-24T05:56:22.000Z","updated":"2019-06-24T05:56:28.000Z","comments":true,"path":"blog/How-to-embed-UIStackView-inside-UIScrollView-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-embed-UIStackView-inside-UIScrollView-in-iOS/","excerpt":"","text":"Issue #324 1234567891011view.addSubview(scrollView)scrollView.addSubview(stackView)NSLayoutConstraint.on([ scrollView.pinEdges(view: view), stackView.pinEdges(view: scrollView)])NSLayoutConstraint.on([ stackView.widthAnchor.constraint(equalTo: scrollView.widthAnchor, multiplier: 1.0)])","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to animate NSCollectionView changes","slug":"How-to-animate-NSCollectionView-changes","date":"2019-06-23T20:05:33.000Z","updated":"2019-06-23T20:05:39.000Z","comments":true,"path":"blog/How-to-animate-NSCollectionView-changes/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-animate-NSCollectionView-changes/","excerpt":"","text":"Issue #323 Use proxy animator() 12345let indexPath = IndexPath(item: index, section: 0)collectionView.animator().deleteItems(at: Set(arrayLiteral: indexPath))let indexPath = IndexPath(item: 0, section: 0)collectionView.animator().insertItems(at: Set(arrayLiteral: indexPath))","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to handle right click in AppKit","slug":"How-to-handle-right-click-in-AppKit","date":"2019-06-23T20:00:06.000Z","updated":"2019-06-23T20:00:13.000Z","comments":true,"path":"blog/How-to-handle-right-click-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-right-click-in-AppKit/","excerpt":"","text":"Issue #322 12345lazy var gr = NSClickGestureRecognizer(target: self, action: #selector(onPress(_:)))gr.buttonMask = 0x2gr.numberOfClicksRequired = 1view.addGestureRecognizer(gr)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to show context menu in NSCollectionView","slug":"How-to-show-context-menu-in-NSCollectionView","date":"2019-06-23T19:31:37.000Z","updated":"2019-10-03T07:01:26.000Z","comments":true,"path":"blog/How-to-show-context-menu-in-NSCollectionView/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-context-menu-in-NSCollectionView/","excerpt":"","text":"Issue #321 Detect locationInWindow in NSEvent1234567891011121314151617181920212223242526272829303132333435class ClickedCollectionView: NSCollectionView &#123; var clickedIndex: Int? override func menu(for event: NSEvent) -&gt; NSMenu? &#123; clickedIndex = nil let point = convert(event.locationInWindow, from: nil) for index in 0..&lt;numberOfItems(inSection: 0) &#123; let frame = frameForItem(at: index) if NSMouseInRect(point, frame, isFlipped) &#123; clickedIndex = index break &#125; &#125; return super.menu(for: event) &#125;&#125;let menu = NSMenu()menu.addItem(NSMenuItem(title: \"Delete\", action: #selector(didSelectDelete(_:)), keyEquivalent: \"\"))collectionView.menu = menu@objc func didSelectDelete(_ item: NSMenuItem) &#123; guard let index = collectionView.clickedIndex, index &lt; notes.count else &#123; return &#125; let indexPath = IndexPath(item: index, section: 0) notes.remove(at: index) collectionView.deleteItems(at: Set(arrayLiteral: indexPath))&#125; For NSCollectionView with more than 1 sections 1let frame = layoutAttributesForItem(at: IndexPath(item: index, section: 0))?.frame ?? .zero Use OmniaOmnia supports clicked indexPath for multi section NSCollectionView 123collectionViewHandler.addMenuItem(title: \"Add to Favorite\", action: &#123; item in print(item) &#125;)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to customize NSTextView in AppKit","slug":"How-to-customize-NSTextView-in-AppKit","date":"2019-06-22T20:08:50.000Z","updated":"2019-06-22T20:14:01.000Z","comments":true,"path":"blog/How-to-customize-NSTextView-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-customize-NSTextView-in-AppKit/","excerpt":"","text":"Issue #320 Scrollable Putting an NSTextView Object in an NSScrollView Use xib then load Embed image or NSTextAttachmentCellProtocol Select TextView Select Rich Text and Graphics Select Size Inspector -&gt; Resizable and tick both Horizontally and Vertically Customize1234567891011121314scrollView.drawsBackground = falsetextView.drawsBackground = falsetextView.string = &quot;What&apos;s on your mind?&quot;textView.delegate = selftextView.selectedTextAttributes = [ NSAttributedString.Key.backgroundColor: NSColor(hex: &quot;414858&quot;), NSAttributedString.Key.foregroundColor: NSColor(hex: &quot;ACB2BE&quot;)]extension MainView: NSTextViewDelegate &#123; func textViewDidChangeSelection(_ notification: Notification) &#123; // Change text color again after image dragging &#125;&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use custom font in AppKit","slug":"How-to-use-custom-font-in-AppKit","date":"2019-06-22T18:55:56.000Z","updated":"2019-06-22T18:58:26.000Z","comments":true,"path":"blog/How-to-use-custom-font-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-custom-font-in-AppKit/","excerpt":"","text":"Issue #319 Add fonts to targets Declare in Info.plist https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/GeneralPurposeKeys.html#//apple_ref/doc/uid/TP40009253-SW8 ATSApplicationFontsPath (String - macOS) identifies the location of a font file or directory of fonts in the bundle‚Äôs Resources directory. If present, macOS activates the fonts at the specified path for use by the bundled app. The fonts are activated only for the bundled app and not for the system as a whole. The path itself should be specified as a relative directory of the bundle‚Äôs Resources directory. For example, if a directory of fonts was at the path /Applications/MyApp.app/Contents/Resources/Stuff/MyFonts/, you should specify the string Stuff/MyFonts/ for the value of this key. 12&lt;key&gt;ATSApplicationFontsPath&lt;/key&gt;&lt;string&gt;.&lt;/string&gt; Reference by name 1NSFont(name: \"FiraCode-Bold\", size: 14)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to make custom controller for View in iOS","slug":"How-to-make-custom-controller-for-View-in-iOS","date":"2019-06-19T08:11:34.000Z","updated":"2019-08-08T10:29:41.000Z","comments":true,"path":"blog/How-to-make-custom-controller-for-View-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-custom-controller-for-View-in-iOS/","excerpt":"","text":"Issue #318 I do UI in code, and usually separate between View and ViewController. 1234567class ProfileView: UIView &#123;&#125;class ProfileViewController: UIViewController &#123; override func loadView() &#123; self.view = ProfileView() &#125;&#125; But in places where using UIViewController and manage their view controller containment hierarchy is not desired, then we can roll out a normal object to act as the controller. 1234567891011class ProfileController &#123; let profileView: ProfileView init(profileView: ProfileView) &#123; self.profileView = profileView &#125; func update(profile: Profile) &#123; profileView.nameLabel.text = profile.name &#125;&#125; If the name Controller sounds confusing with UIViewController, I usually use Handler, which contains other Handler to handle logic for view","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"A bit about Design","slug":"A-bit-about-Design","date":"2019-06-18T09:20:19.000Z","updated":"2019-11-05T08:37:51.000Z","comments":true,"path":"blog/A-bit-about-Design/","link":"","permalink":"https://onmyway133.github.io/blog/A-bit-about-Design/","excerpt":"","text":"Issue #317 UI Why Your App Looks Better in Sketch 8 Tips for Dark Theme Design UX Duolingo User Retention Design Details 30 Things We Often Forget When Designing Mobile Apps Case study club Showcase https://saaspages.xyz/ Resources https://shape.so/ https://icons8.com/ https://icons8.com/animated-icons https://icons8.com/vector-creator https://feathericons.com/ https://iconstore.co/ https://streamlineicons.com/","categories":[],"tags":[{"name":"design","slug":"design","permalink":"https://onmyway133.github.io/tags/design/"}]},{"title":"Understanding device and OS share for iOS and Android","slug":"Understanding-device-and-OS-share-for-iOS-and-Android","date":"2019-06-18T07:32:14.000Z","updated":"2019-06-18T07:32:24.000Z","comments":true,"path":"blog/Understanding-device-and-OS-share-for-iOS-and-Android/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-device-and-OS-share-for-iOS-and-Android/","excerpt":"","text":"Issue #316 Browsers and devices used in 2018 AppStore measurement","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make UIPanGestureRecognizer work with horizontal swipe in UICollectionView","slug":"How-to-make-UIPanGestureRecognizer-work-with-horizontal-swipe-in-UICollectionView","date":"2019-06-18T07:12:52.000Z","updated":"2019-06-18T07:13:13.000Z","comments":true,"path":"blog/How-to-make-UIPanGestureRecognizer-work-with-horizontal-swipe-in-UICollectionView/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-UIPanGestureRecognizer-work-with-horizontal-swipe-in-UICollectionView/","excerpt":"","text":"Issue #315 123456extension PanCollectionViewController: UIGestureRecognizerDelegate &#123; func gestureRecognizerShouldBegin(_ gestureRecognizer: UIGestureRecognizer) -&gt; Bool &#123; let velocity = panGR.velocity(in: panGR.view) return abs(velocity.y) &gt; abs(velocity.x) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use media query in CSS","slug":"How-to-use-media-query-in-CSS","date":"2019-06-17T18:14:32.000Z","updated":"2019-06-17T18:23:16.000Z","comments":true,"path":"blog/How-to-use-media-query-in-CSS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-media-query-in-CSS/","excerpt":"","text":"Issue #314 12345678910111213141516&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;@media only screen and (max-width: 600px) &#123; div.container &#123; margin: 0 auto; width: 70%; margin-top: 60%; &#125; &#125;body &#123; background-image: url(\"../images/wallpaper.png\"); background-position: top right; background-attachment: fixed; background-size: cover;&#125;","categories":[],"tags":[]},{"title":"What's new in iOS","slug":"What's-new-in-iOS","date":"2019-06-17T10:53:31.000Z","updated":"2019-10-29T07:24:17.000Z","comments":true,"path":"blog/What's-new-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/What's-new-in-iOS/","excerpt":"","text":"Issue #313 iOS 10‚ûïUserNotifications Push user-facing notifications to the user‚Äôs device from a server, or generate them locally from your app. ‚ûïUIViewPropertyAnimator A class that animates changes to views and allows the dynamic modification of those animations. ‚ûïNSPersistentContainer A container that encapsulates the Core Data stack in your app. ‚ûïUIFeedbackGenerator The abstract superclass for all feedback generators. iOS 10.3‚ûïSKStoreReviewController An object that controls the process of requesting App Store ratings and reviews from users. iOS 11‚ûïsafeAreaLayoutGuide The layout guide representing the portion of your view that is unobscured by bars and other content. ‚ûïCoreML Integrate machine learning models into your app. ‚ûïVision Apply computer vision algorithms to perform a variety of tasks on input images and video. ‚ûïARKit Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game. ‚ûïDeviceCheck Access per-device, per-developer data that your associated server can use in its business logic. ‚ûïDrag and Drop Bring drag and drop to your app by using interaction APIs with your views. ‚ûïCoreNFC Detect NFC tags and read messages that contain NDEF data. ‚ûïmaskedCorners Animatable corner radius iOS 12‚ûïAuthenticationServices Make it easy for users to log into apps and services. iOS 13‚ûïSwiftUI Declare the user interface and behavior for your app on every platform. ‚ûïCombine Customize handling of asynchronous events by combining event-processing operators. ‚ûïCryptoKit Perform cryptographic operations securely and efficiently. ‚ûïUISearchTextField Expose UISearchTextField on UISearchBar ‚ûïMetricKit","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"What is new in iOS","slug":"What-is-new-in-iOS","date":"2019-06-17T10:53:31.000Z","updated":"2019-11-01T07:38:42.000Z","comments":true,"path":"blog/What-is-new-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/What-is-new-in-iOS/","excerpt":"","text":"Issue #313 iOS 10‚ûïUserNotifications Push user-facing notifications to the user‚Äôs device from a server, or generate them locally from your app. ‚ûïUIViewPropertyAnimator A class that animates changes to views and allows the dynamic modification of those animations. ‚ûïNSPersistentContainer A container that encapsulates the Core Data stack in your app. ‚ûïUIFeedbackGenerator The abstract superclass for all feedback generators. iOS 10.3‚ûïSKStoreReviewController An object that controls the process of requesting App Store ratings and reviews from users. iOS 11‚ûïsafeAreaLayoutGuide The layout guide representing the portion of your view that is unobscured by bars and other content. ‚ûïCoreML Integrate machine learning models into your app. ‚ûïVision Apply computer vision algorithms to perform a variety of tasks on input images and video. ‚ûïARKit Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game. ‚ûïDeviceCheck Access per-device, per-developer data that your associated server can use in its business logic. ‚ûïDrag and Drop Bring drag and drop to your app by using interaction APIs with your views. ‚ûïCoreNFC Detect NFC tags and read messages that contain NDEF data. ‚ûïmaskedCorners Animatable corner radius iOS 12‚ûïAuthenticationServices Make it easy for users to log into apps and services. iOS 13 https://www.hackingwithswift.com/articles/193/whats-new-in-ios-13 https://onesignal.com/blog/ios-13-introduces-4-breaking-changes-to-notifications/ ‚ûïSwiftUI Declare the user interface and behavior for your app on every platform. ‚ûïCombine Customize handling of asynchronous events by combining event-processing operators. ‚ûïCryptoKit Perform cryptographic operations securely and efficiently. ‚ûïUISearchTextField Expose UISearchTextField on UISearchBar ‚ûïMetricKit","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to avoid crash when closing NSWindow for agent macOS app","slug":"How-to-avoid-crash-when-closing-NSWindow-for-agent-macOS-app","date":"2019-06-16T16:21:48.000Z","updated":"2019-06-16T16:22:01.000Z","comments":true,"path":"blog/How-to-avoid-crash-when-closing-NSWindow-for-agent-macOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-avoid-crash-when-closing-NSWindow-for-agent-macOS-app/","excerpt":"","text":"Issue #312 1234567891011121314class ClosableWindow: NSWindow &#123; override func close() &#123; self.orderOut(NSApp) &#125;&#125;let window = ClosableWindow( contentRect: rect, styleMask: [.titled, .closable], backing: .buffered, defer: false&#125;window.makeKeyAndOrderFront(NSApp)","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to get cell at center during scroll in UICollectionView","slug":"How-to-get-cell-at-center-during-scroll-in-UICollectionView","date":"2019-06-14T09:28:25.000Z","updated":"2019-09-30T18:56:07.000Z","comments":true,"path":"blog/How-to-get-cell-at-center-during-scroll-in-UICollectionView/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-cell-at-center-during-scroll-in-UICollectionView/","excerpt":"","text":"Issue #311 See Omnia https://github.com/onmyway133/Omnia/blob/master/Sources/iOS/UICollectionView.swift#L30 123456789101112131415extension HorizontalUsersViewController: UIScrollViewDelegate &#123; func scrollViewDidEndDecelerating(_ scrollView: UIScrollView) &#123; let point = view.convert(collectionView.center, to: collectionView) guard let indexPath = collectionView.indexPathForItem(at: point), indexPath.item &lt; users.count else &#123; return &#125; let user = users[indexPath.item] delegate?.didScrollTo(user) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to downsample image in iOS","slug":"How-to-downsample-image-in-iOS","date":"2019-06-14T09:27:14.000Z","updated":"2019-06-14T09:28:43.000Z","comments":true,"path":"blog/How-to-downsample-image-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-downsample-image-in-iOS/","excerpt":"","text":"Issue #310 https://www.swiftjectivec.com/optimizing-images/ https://nshipster.com/image-resizing/","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to show location in Apple Maps and Google Maps app in iOS","slug":"How-to-show-location-in-Apple-Maps-and-Google-Maps-app-in-iOS","date":"2019-06-13T12:02:15.000Z","updated":"2019-06-13T12:05:19.000Z","comments":true,"path":"blog/How-to-show-location-in-Apple-Maps-and-Google-Maps-app-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-show-location-in-Apple-Maps-and-Google-Maps-app-in-iOS/","excerpt":"","text":"Issue #309 Apple Maps1234let placemark = MKPlacemark(coordinate: coordinate, addressDictionary: nil)let mapItem = MKMapItem(placemark: placemark)mapItem.name = shop.namemapItem.openInMaps(launchOptions: [:]) Google Maps https://developers.google.com/maps/documentation/urls/ios-urlscheme Use q to show pin Since iOS 9, we need to declare LSApplicationQueriesSchemes 1234&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;&lt;array&gt; &lt;string&gt;comgooglemaps&lt;/string&gt;&lt;/array&gt; 12345678910var string = \"comgooglemaps://\"string += \"?q=Food\"string += \"&amp;center=\\(coordinate.latitude),\\(coordinate.longitude)\"string += \"&amp;zoom=15\"let googleUrl = URL(string: string)!if UIApplication.shared.canOpenURL(URL(string: \"comgooglemaps://\")!) &#123; UIApplication.shared.open(googleUrl)&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make convenient touch handler for UIButton in iOS","slug":"How-to-make-convenient-touch-handler-for-UIButton-in-iOS","date":"2019-06-13T11:29:10.000Z","updated":"2019-09-24T06:50:14.000Z","comments":true,"path":"blog/How-to-make-convenient-touch-handler-for-UIButton-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-convenient-touch-handler-for-UIButton-in-iOS/","excerpt":"","text":"Issue #308 If you don‚Äôt want to use https://github.com/onmyway133/EasyClosure yet, it‚Äôs easy to roll out a closure based UIButton. The cool thing about closure is it captures variables 1234567891011121314151617final class ClosureButton: UIButton &#123; var didTouch: (() -&gt; Void)? override init(frame: CGRect) &#123; super.init(frame: frame) addTarget(self, action: #selector(buttonTouched(_:)), for: .touchUpInside) &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; @objc private func buttonTouched(_: UIButton) &#123; didTouch?() &#125;&#125; Then in cellForItem 12345678func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell &#123; let cell: UserCell = collectionView.dequeue(for: indexPath)! let user = users[indexPath.item] cell.powerButton.didTouch = &#123; [weak self] in self?.openPowerView(user) &#125; return cell&#125; With this we can even forward touch event to another button 12345func forwardTouchEvent(button: ClosureButton) &#123; didTouch = &#123; [weak button] in button?.didTouch?() &#125;&#125; Another benefit is that we can apply debouncing to avoid successive tap on button 123456let debouncer = Debouncer(timeInterval: 0.2)@objc private func buttonTouched(_: UIButton) &#123; debouncer.run &#123; [weak self] in self?.didTouch?() &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to format distance in iOS","slug":"How-to-format-distance-in-iOS","date":"2019-06-13T09:49:44.000Z","updated":"2019-06-13T09:49:51.000Z","comments":true,"path":"blog/How-to-format-distance-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-format-distance-in-iOS/","excerpt":"","text":"Issue #307 123456import MapKitlet formatter = MKDistanceFormatter()formatter.unitStyle = .abbreviatedformatter.units = .metricdistanceLabel.text = formatter.string(fromDistance: distance) // 700m, 1.7km","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to mock grpc model in Swift","slug":"How-to-mock-grpc-model-in-Swift","date":"2019-06-13T06:03:11.000Z","updated":"2019-08-14T11:06:13.000Z","comments":true,"path":"blog/How-to-mock-grpc-model-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-mock-grpc-model-in-Swift/","excerpt":"","text":"Issue #306 123456789let json: [String: Any] = [ \"id\": \"123\", \"name\": \"Thor\", \"isInMarvel\": true]let data = try JSONSerialization.data(withJSONObject: json, options: [])let string = String(data: data, encoding: .utf8)!return try Hero(jsonString: string) If we use withValue from How to simplify struct mutating in Swift then we can mock easily 123456789extension Hero &#123; static func mock() -&gt; Hero &#123; return withValue(Hero()) &#123; $0.id = \"123\" $0.name = \"Thor\" $0.isInMarvel = true &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Favorite WWDC 2019 sessions","slug":"Favorite-WWDC-2019-sessions","date":"2019-06-12T20:12:46.000Z","updated":"2019-06-13T06:07:53.000Z","comments":true,"path":"blog/Favorite-WWDC-2019-sessions/","link":"","permalink":"https://onmyway133.github.io/blog/Favorite-WWDC-2019-sessions/","excerpt":"","text":"Issue #305 This year I‚Äôm lucky enough to get the ticket to WWDC and I couldn‚Äôt be more satisfied. 5 conference days full of awesomeness, talks, labs and networking, all make WWDC special and memorial conference for every attendee. As predicted by many, Marzipan (now officially called Project Catalyst) a technology that could allow iOS apps to be ported to macOS, would be the main topic for this year. But WWDC went more spectacular than that, with dark mode on iOS, independent watchOS apps, and SwiftUI being the star of the show. With over 150 sessions and extra videos, it can be a bit overwhelming to catch up, so I sum up 10 essential sessions to get started. It‚Äôs good to catch up with the latest technology, but be aware that frameworks and APIs come and get deprecated very often. It‚Äôs better to understand why they are introduced, how to learn the skills and mindset so we can apply them in our apps to delight user experience. Firstly, a little tip to get the most of WWDC videos. Although you can watch on Apple developer website, there‚Äôs WWDC for macOS app that allows much more comfortable watching experience. There we can tweak playing speed, picture in picture view mode, favorite and download videos for offline watching. Secondly, for those of you who want to search some texts in the talks, there is ASCIIwwdc that provides full transcripts of all the talks. 1. Platform State of the UnionIf you only have time for 1 video, this is it. Right after the Keynote, Platform State of the Union is like keynote for developers as it highlights important development changes. macOS 10.15, iOS 13, watchOS 6 and tvOS 13: As usual we get version bumps on all major platforms, which brings lots of new features and enhancement. macOS 10.15 is caleld Catalina and there‚Äôs a whole new platform for iPad called iPadOS. Security and Privacy: Adding to security enhancement from last year, this year shows how Apple really commits into this. There are one-time location permission, signing with Apple, security protocol for HomeKit, new crypto framework which marks MD5 as insecure. Also, apps that target kids can‚Äôt display ad or include analytics. tvOS 13 gets multiple user support watchOS 6 makes way for independent watch apps, which does not require accompanying iOS apps. There‚Äôs also dedicated watch appstore. iOS 13 now can live in the dark, but dropping support for iPhone 5S, 6 and below. Also, there is ability to toggle language setting per app only. iPadOS is a spinoff version of iOS for now, they look the same but they are expected to take different paths. It includes mouse support and requires iPad Air 2 and newer devices. macOS 10.15 introduces a replacement of bash with zsh. It also supports SideCar which allows iPad as an external display. Last but not least, there is Project Catalyst that enables iPad apps to run on the mac. Xcode 11 includes Swift 5.1 that can target latest SDKs. It brings a new look and feel with tons of features like minimap, Xcode preview, official support for Swift Package Manager, source control enhancement and test plan. 2. What‚Äôs New in SwiftAlthough Swift is developed in the open, it‚Äôs easy to lose track of in tons of proposals and changes. Swift 5.1 brings lots of cool features that power SwiftUI and Combine, so it‚Äôs a prerequisite. Module stability: This looks unimportant but this may be the most key feature of Swift 5.1. Unlike ABI stability we get in Swift 5, module stability helps resolves differences at compile time. In other words, this ensures a Swift 5 library will work with the future Swift compilers. A single expression can be declared without return keyword Function builder, with marker @_functionBuilder which works pretty much like function with receiver in Kotlin, allows for some very neat DSL syntax. Property wrapper, a counterpart of Kotlin delegated property, allows property accessors to be used in a convenient way. Shipped with Swift 5.1, we can use that with @propertyWrapper annotation. Opaque return type with some keyword remedies limitation of Swift protocol with Self or associcated types requirements. Among other things, there are other cool features like universal Self, static subscripts, collection diffing and matching against optional. 3. Introducing SwiftUI: Building Your First AppWelcome to the spotlight of WWDC 2019, SwiftUI. It may be the most exciting announcement since Swift was introduced in 2014. SwiftUI is not just a new framework, it‚Äôs a complete paradigm shift from imperative programming with UIKit/AppKit to a declarative world. I was amazed by how quickly React and Flutter allows fast prototyping and developing, so I‚Äôm very happy Apple finally makes this available natively on all platforms. The cool thing about SwiftUI is that it is expressive and has consistent syntax across platforms. So it is a learn once, write anywhere concept. Together with hot reloading of Xcode Preview, this ends the long debate among iOS community about whether to write UI in code or Storyboard, as the source of truth is now the concise code, but users are free to change any UI details via interactive Preview. Not only SwiftUI handles consistent UI according to Apple design guideline, it also provides many features for free like accessibility, dark mode and other bookkeeping. SwiftUI supports latest platform versions and no backward compatibility, so some of us have to wait 1 or 2 more years until iOS 13 is widely adopted. To learn more about SwiftUI, there are other advanced sesions like SwiftUI Essentials Building Custom Views with SwiftUI Data Flow Through SwiftUI SwiftUI On All Devices Integrating SwiftUI 4. Implementing Dark Mode on iOSAs much as I was excited about Dark theme in Android Q, Dark Mode in iOS is something that eases my eyes. Some apps also support Dark theme by their owns, but with iOS 13, supporting Dark mode to our apps is not a daunting task. There are more vibrancy materials, system colors that adapts automatically to dark and light modes. We can also select images for each mode in Asset Catalog easily. 5. Introducing Combine and Advances in FoundationCombine is a unified declarative framework for processing values over time. As a huge fan of Rx, Combine looks like home. It was thrilled to see this finnaly get supported official by Apple. This simplifying asyncrhonous programming a lot, also streamline other communication patterns like KVO and notification center. Combine is the force the powers reactive nature in SwiftUI with Binding and BindableObject. There‚Äôs also lots of improvements to Foundation like collection diffing, new list and relative formatters, and notably Combine syntax for URLSession, which makes networking a breeze. To learn more about Combine, there‚Äôs Combine in Practice where we can learn more about error handling, schedule work and many operators on streams. 6. Modernizing Your UI for iOS 13Take a look at this talk to learn about new features in iOS 13 that we should be aware in our apps. Newly in iOS 13, we can take advantage of card style modal presentation that is very cumbersome to replicate ourselves. There‚Äôs also new UISearchBarTextField with advanced customizations for token and inputs. Lastly, the new UIMenu makes showing context menu trivial and make way for iPad apps to behave like native on the mac. 7. Modern Swift API DesignIf you‚Äôre developing iOS apps, chances are that you have already stumbled upon API Design Guidelines which contains valuable guides to structuring our Swift code. This highlights my most favorite programming advice ‚ÄúClarity at the point of use‚Äù, because things we declare are written only once, but read many many times, so we should make those concise and clear. There‚Äôs also mention of preferring generic over protocol which reminds me of protocol witness technique. This talk details how Apple engineers themselves design Swift code in their RealityKit and SwiftUI frameworks. 8. Optimizing App LaunchThe launch time of your app can be decisive in user experience, it needs to be fast and do just the necessary things. With enhancements via shared and cached frameworks, apps now load faster on iOS 13. But there‚Äôs more thing we can do to improve this, thanks to the new App Launch profiler in Xcode 11, together with app launch time measurement in XCTests. The 3 words we can take away from this talk is minimize, prioritize, and optimize work at this critical launch time. 9. Introducing iPad Apps for MacStarting with iOS 13 with Project Catalyst, there‚Äôs a new target environment check called UIKitForMac, which allows iPad apps to target the mac while using the same code base. Most of the UI after porting have the correct look and feel like a native macOS app with many features provided for free like window management. There are, kind of obviously, some frameworks that are designed specifically for phone and tablet experience, can‚Äôt be supported in macOS. There are other sesions like Taking iPad Apps for Mac to the Next Level where we can learn more about this. 10. Creating Independent Watch Apps watchOS finally gets its own Appstore and the ability to run independent watchOS apps without a companying iOS app. With the introduction of URLSession and streaming APIs for the watch, together with enhancements in push notifications, Apple sign in, debugging, this can‚Äôt be a better time to start developing for the watch. It is stunning to see how Apple comes up with so many cool announcements this year while keeping innovation and quality high. There are more sessions to explore, head over to WWDC 2019 developer website to learn more.","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Support IP handover in rtpproxy for VoIP applications","slug":"Support-IP-handover-in-rtpproxy-for-VoIP-applications","date":"2019-06-12T19:33:28.000Z","updated":"2019-06-12T19:34:26.000Z","comments":true,"path":"blog/Support-IP-handover-in-rtpproxy-for-VoIP-applications/","link":"","permalink":"https://onmyway133.github.io/blog/Support-IP-handover-in-rtpproxy-for-VoIP-applications/","excerpt":"","text":"Issue #304 If you do VoIP applications, especially with open sources like pjsip, you may encounter kamalio and rtpproxy to serve SIP requests. Due to limitation of NAT traversals, rtpproxy is needed to work around NAT. All SIP handshake requests go through a proxy server, but rtpproxy can also relay voice, video or any RTP stream of data. When I played with rtpproxy, it was before version 2.0 and I need to handle IP handover. This refers to the scenario when user switches between different network, for example from Wifi to 4G and they get new IP. Normally this means ending in the SIP call, but the expectation is that we can retry and continue the call if possible for users. That‚Äôs why I forked rtpproxy and add IP handover support. You can check the GitHub repo at rtpproxy. Use src_cnt to track the number of consecutive packets from different address. When this number exceeds THRESHOLD (10 for RTP and 2 for RTCP), I switch to this new address This way Client can ALWAYS change IP when he switches from 3G to Wifi, or from this Wifi hotspot to another There‚Äôs no chance for attack, unless attacker sends &gt; 10 (RTP THRESHOLD) packets in 20ms (supposed my client sends packets every 20ms) This idea is borrowed from http://www.pjsip.org/pjmedia/docs/html/group__PJMEDIA__CONFIG.htm There is a macro PJMEDIA_RTP_NAT_PROBATION_CNT. Basically, it is ‚ÄúSee if source address of RTP packet is different than the configured address, and switch RTP remote address to source packet address after several consecutive packets have been received.‚Äù Mobile clients now change IP frequently, from these hotspots to those. So if rtpproxy can support this feature, it would be nicer. Take a look at https://github.com/onmyway133/rtpproxy/blob/master/rtpp_session.h // IP Handover Count how many consecutive different packets are received, 0 is for callee, 1 is for caller unsigned int src_count[2];And how it actions in https://github.com/onmyway133/rtpproxy/blob/master/main.c static void rxmit_packets(struct cfg *cf, struct rtpp_session *sp, int ridx, double dtime) { int ndrain, i, port; struct rtp_packet *packet = NULL; /* Repeat since we may have several packets queued on the same socket */ for (ndrain = 0; ndrain &lt; 5; ndrain++) { if (packet != NULL) rtp_packet_free(packet); packet = rtp_recv(sp-&gt;fds[ridx]); if (packet == NULL) break; packet-&gt;laddr = sp-&gt;laddr[ridx]; packet-&gt;rport = sp-&gt;ports[ridx]; packet-&gt;rtime = dtime; i = 0; // IP Handover do not need canupdate // Use src_count if (sp-&gt;addr[ridx] != NULL) { /* Check that the packet is authentic, drop if it isn&apos;t */ if (sp-&gt;asymmetric[ridx] == 0) { /* if (memcmp(sp-&gt;addr[ridx], &amp;packet-&gt;raddr, packet-&gt;rlen) != 0) { if (sp-&gt;canupdate[ridx] == 0) { // // Continue, since there could be good packets in // queue. // continue; } // Signal that an address has to be updated rtpp_log_write(RTPP_LOG_ERR, cf-&gt;glog, &quot;IP Handover Set i 1st ridx %d&quot;,ridx); i = 1; } else if (sp-&gt;canupdate[ridx] != 0 &amp;&amp; sp-&gt;last_update[ridx] != 0 &amp;&amp; dtime - sp-&gt;last_update[ridx] &gt; UPDATE_WINDOW) { sp-&gt;canupdate[ridx] = 0; rtpp_log_write(RTPP_LOG_ERR, cf-&gt;glog, &quot;IP Handover Set canupdate to 0 1st ridx %d&quot;,ridx); } */ if (memcmp(sp-&gt;addr[ridx], &amp;packet-&gt;raddr, packet-&gt;rlen) == 0) { sp-&gt;src_count[ridx] = 0; } else { sp-&gt;src_count[ridx]++; // IP Handover RTCP packet sends at larger interval, so must use smaller THRESHOLD // Check to see if port is odd or even if(sp-&gt;ports[ridx] % 2 == 0) { if(sp-&gt;src_count[ridx] &gt;= 10) { i = 1; } } else { if(sp-&gt;src_count[ridx] &gt;= 2) { i = 1; } } } } else { /* * For asymmetric clients don&apos;t check * source port since it may be different. */ rtpp_log_write(RTPP_LOG_ERR, cf-&gt;glog, &quot;IP Handover We are in asymmetric ridx %d&quot;,ridx); if (!ishostseq(sp-&gt;addr[ridx], sstosa(&amp;packet-&gt;raddr))) /* * Continue, since there could be good packets in * queue. */ continue; } sp-&gt;pcount[ridx]++; } else { sp-&gt;pcount[ridx]++; sp-&gt;addr[ridx] = malloc(packet-&gt;rlen); if (sp-&gt;addr[ridx] == NULL) { sp-&gt;pcount[3]++; rtpp_log_write(RTPP_LOG_ERR, sp-&gt;log, &quot;can&apos;t allocate memory for remote address - &quot; &quot;removing session&quot;); remove_session(cf, GET_RTP(sp)); /* Break, sp is invalid now */ break; } /* Signal that an address have to be updated. */ rtpp_log_write(RTPP_LOG_ERR, cf-&gt;glog, &quot;IP Handover Set i 2nd ridx %d&quot;,ridx); i = 1; } /* * Update recorded address if it&apos;s necessary. Set &quot;untrusted address&quot; * flag in the session state, so that possible future address updates * from that client won&apos;t get address changed immediately to some * bogus one. */ if (i != 0) { sp-&gt;untrusted_addr[ridx] = 1; memcpy(sp-&gt;addr[ridx], &amp;packet-&gt;raddr, packet-&gt;rlen); // IP Handover Do not use canupdate // After update, reset src_count /* if (sp-&gt;prev_addr[ridx] == NULL || memcmp(sp-&gt;prev_addr[ridx], &amp;packet-&gt;raddr, packet-&gt;rlen) != 0) { sp-&gt;canupdate[ridx] = 0; if(sp-&gt;prev_addr[ridx] == NULL) { rtpp_log_write(RTPP_LOG_ERR, cf-&gt;glog, &quot;IP Handover prev_addr NULL ridx %d&quot;,ridx); } rtpp_log_write(RTPP_LOG_ERR, cf-&gt;glog, &quot;IP Handover Set canupdate to 0 2nd ridx %d&quot;,ridx); } */ sp-&gt;src_count[ridx] = 0; port = ntohs(satosin(&amp;packet-&gt;raddr)-&gt;sin_port); rtpp_log_write(RTPP_LOG_INFO, sp-&gt;log, &quot;%s&apos;s address filled in: %s:%d (%s)&quot;, (ridx == 0) ? &quot;callee&quot; : &quot;caller&quot;, addr2char(sstosa(&amp;packet-&gt;raddr)), port, (sp-&gt;rtp == NULL) ? &quot;RTP&quot; : &quot;RTCP&quot;); /* * Check if we have updated RTP while RTCP is still * empty or contains address that differs from one we * used when updating RTP. Try to guess RTCP if so, * should be handy for non-NAT&apos;ed clients, and some * NATed as well. */ if (sp-&gt;rtcp != NULL &amp;&amp; (sp-&gt;rtcp-&gt;addr[ridx] == NULL || !ishostseq(sp-&gt;rtcp-&gt;addr[ridx], sstosa(&amp;packet-&gt;raddr)))) { if (sp-&gt;rtcp-&gt;addr[ridx] == NULL) { sp-&gt;rtcp-&gt;addr[ridx] = malloc(packet-&gt;rlen); if (sp-&gt;rtcp-&gt;addr[ridx] == NULL) { sp-&gt;pcount[3]++; rtpp_log_write(RTPP_LOG_ERR, sp-&gt;log, &quot;can&apos;t allocate memory for remote address - &quot; &quot;removing session&quot;); remove_session(cf, sp); /* Break, sp is invalid now */ break; } } memcpy(sp-&gt;rtcp-&gt;addr[ridx], &amp;packet-&gt;raddr, packet-&gt;rlen); satosin(sp-&gt;rtcp-&gt;addr[ridx])-&gt;sin_port = htons(port + 1); /* Use guessed value as the only true one for asymmetric clients */ sp-&gt;rtcp-&gt;canupdate[ridx] = NOT(sp-&gt;rtcp-&gt;asymmetric[ridx]); rtpp_log_write(RTPP_LOG_INFO, sp-&gt;log, &quot;guessing RTCP port &quot; &quot;for %s to be %d&quot;, (ridx == 0) ? &quot;callee&quot; : &quot;caller&quot;, port + 1); } } if (sp-&gt;resizers[ridx].output_nsamples &gt; 0) rtp_resizer_enqueue(&amp;sp-&gt;resizers[ridx], &amp;packet); if (packet != NULL) send_packet(cf, sp, ridx, packet); } if (packet != NULL) rtp_packet_free(packet); }Here are some useful resources that I read http://stackoverflow.com/questions/18200089/how-does-rtpproxy-handle-handover http://lists.sip-router.org/pipermail/sr-users/2008-March/062795.html http://sourceforge.net/p/sippy/rtpproxy/ci/c71201d897ee7c5620d88bb7d56412cd9dc3362a/tree//main.c?diff=5d030295ce90f2f6ff292b0d65bae1d4318db02a","categories":[],"tags":[]},{"title":"How to test drive view in iOS","slug":"How-to-test-drive-view-in-iOS","date":"2019-06-12T09:11:26.000Z","updated":"2019-06-12T09:12:40.000Z","comments":true,"path":"blog/How-to-test-drive-view-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-test-drive-view-in-iOS/","excerpt":"","text":"Issue #303 Instead of setting up custom framework and Playground, we can just display that specific view as root view controller 1234567891011121314151617181920window.rootViewController = makeTestPlayground()func makeTestPlayground() -&gt; UIViewController &#123; let content = UserCell() content.nameLabel.text = \"Thor\" content.streetLabel.text = \"Asgard\" content.weaponLabel.text = \"Hammer\" let viewController = UIViewController() viewController.view.backgroundColor = .white viewController.view.addSubview(content) NSLayoutConstraint.on([ content.centerXAnchor.constraint(equalTo: viewController.view.centerXAnchor), content.centerYAnchor.constraint(equalTo: viewController.view.centerYAnchor), content.widthAnchor.constraint(equalTo: viewController.view.widthAnchor, multiplier0.9), content.heightAnchor.constraint(equalToConstant: 200) ] return viewController&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make carousel layout for UICollectionView in iOS","slug":"How-to-make-carousel-layout-for-UICollectionView-in-iOS","date":"2019-06-12T08:35:42.000Z","updated":"2019-06-17T08:29:28.000Z","comments":true,"path":"blog/How-to-make-carousel-layout-for-UICollectionView-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-carousel-layout-for-UICollectionView-in-iOS/","excerpt":"","text":"Issue #302 Based on AnimatedCollectionViewLayout1234567891011121314151617181920212223242526272829303132333435363738394041final class CarouselLayout: UICollectionViewFlowLayout &#123; override func layoutAttributesForElements(in rect: CGRect) -&gt; [UICollectionViewLayoutAttributes]? &#123; guard let attributes = super.layoutAttributesForElements(in: rect) else &#123; return nil &#125; guard let collectionView = collectionView else &#123; return nil &#125; return attributes.map(&#123; transform(collectionView: collectionView, attribute: $0) &#125;) &#125; override func shouldInvalidateLayout(forBoundsChange newBounds: CGRect) -&gt; Bool &#123; return true &#125; private func transform(collectionView: UICollectionView, attribute: UICollectionViewLayoutAttributes) -&gt; UICollectionViewLayoutAttributes &#123; let a = attribute let width = collectionView.frame.size.width let itemOffset = a.center.x - collectionView.contentOffset.x let middleOffset = (itemOffset / width) - 0.5 change( width: collectionView.frame.size.width, attribute: attribute, middleOffset: middleOffset ) return attribute &#125; private func change(width: CGFloat, attribute: UICollectionViewLayoutAttributes, middleOffset: CGFloat) &#123; let alpha: CGFloat = 0.8 let itemSpacing: CGFloat = 0.21 let scale: CGFloat = 1.0 let scaleFactor = scale - 0.1 * abs(middleOffset) let scaleTransform = CGAffineTransform(scaleX: scaleFactor, y: scaleFactor) let translationX = -(width * itemSpacing * middleOffset) let translationTransform = CGAffineTransform(translationX: translationX, y: 0) attribute.alpha = 1.0 - abs(middleOffset) + alpha attribute.transform = translationTransform.concatenating(scaleTransform) &#125;&#125; How to use 123456let layout = CarouselLayout()layout.scrollDirection = .horizontallayout.sectionInset = .zerolayout.minimumInteritemSpacing = 0layout.minimumLineSpacing = 0 We can inset cell content and use let scale: CGFloat = 1.0 to avoid scaling down center cell Based on CityCollectionViewFlowLayout123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131import UIKitclass CityCollectionViewFlowLayout: UICollectionViewFlowLayout &#123; fileprivate var lastCollectionViewSize: CGSize = CGSize.zero var scaleOffset: CGFloat = 200 var scaleFactor: CGFloat = 0.9 var alphaFactor: CGFloat = 0.3 var lineSpacing: CGFloat = 25.0 required init?(coder _: NSCoder) &#123; fatalError() &#125; init(itemSize: CGSize) &#123; super.init() self.itemSize = itemSize minimumLineSpacing = lineSpacing scrollDirection = .horizontal &#125; func setItemSize(itemSize: CGSize) &#123; self.itemSize = itemSize &#125; override func invalidateLayout(with context: UICollectionViewLayoutInvalidationContext) &#123; super.invalidateLayout(with: context) guard let collectionView = self.collectionView else &#123; return &#125; if collectionView.bounds.size != lastCollectionViewSize &#123; configureContentInset() lastCollectionViewSize = collectionView.bounds.size &#125; &#125; override func targetContentOffset(forProposedContentOffset proposedContentOffset: CGPoint, withScrollingVelocity velocity: CGPoint) -&gt; CGPoint &#123; guard let collectionView = self.collectionView else &#123; return proposedContentOffset &#125; let proposedRect = CGRect(x: proposedContentOffset.x, y: 0, width: collectionView.bounds.width, height: collectionView.bounds.height) guard let layoutAttributes = self.layoutAttributesForElements(in: proposedRect) else &#123; return proposedContentOffset &#125; var candidateAttributes: UICollectionViewLayoutAttributes? let proposedContentOffsetCenterX = proposedContentOffset.x + collectionView.bounds.width / 2 for attributes in layoutAttributes &#123; if attributes.representedElementCategory != .cell &#123; continue &#125; if candidateAttributes == nil &#123; candidateAttributes = attributes continue &#125; if abs(attributes.center.x - proposedContentOffsetCenterX) &lt; abs(candidateAttributes!.center.x - proposedContentOffsetCenterX) &#123; candidateAttributes = attributes &#125; &#125; guard let aCandidateAttributes = candidateAttributes else &#123; return proposedContentOffset &#125; var newOffsetX = aCandidateAttributes.center.x - collectionView.bounds.size.width / 2 let offset = newOffsetX - collectionView.contentOffset.x if (velocity.x &lt; 0 &amp;&amp; offset &gt; 0) || (velocity.x &gt; 0 &amp;&amp; offset &lt; 0) &#123; let pageWidth = itemSize.width + minimumLineSpacing newOffsetX += velocity.x &gt; 0 ? pageWidth : -pageWidth &#125; return CGPoint(x: newOffsetX, y: proposedContentOffset.y) &#125; override func shouldInvalidateLayout(forBoundsChange _: CGRect) -&gt; Bool &#123; return true &#125; override func layoutAttributesForElements(in rect: CGRect) -&gt; [UICollectionViewLayoutAttributes]? &#123; guard let collectionView = self.collectionView, let superAttributes = super.layoutAttributesForElements(in: rect) else &#123; return super.layoutAttributesForElements(in: rect) &#125; let contentOffset = collectionView.contentOffset let size = collectionView.bounds.size let visibleRect = CGRect(x: contentOffset.x, y: contentOffset.y, width: size.width, height: size.height) let visibleCenterX = visibleRect.midX guard case let newAttributesArray as [UICollectionViewLayoutAttributes] = NSArray(array: superAttributes, copyItems: true) else &#123; return nil &#125; newAttributesArray.forEach &#123; let distanceFromCenter = visibleCenterX - $0.center.x let absDistanceFromCenter = min(abs(distanceFromCenter), self.scaleOffset) let scale = absDistanceFromCenter * (self.scaleFactor - 1) / self.scaleOffset + 1 $0.transform3D = CATransform3DScale(CATransform3DIdentity, scale, scale, 1) let alpha = absDistanceFromCenter * (self.alphaFactor - 1) / self.scaleOffset + 1 $0.alpha = alpha &#125; return newAttributesArray &#125; func configureContentInset() &#123; guard let collectionView = self.collectionView else &#123; return &#125; let inset = collectionView.bounds.size.width / 2 - itemSize.width / 2 collectionView.contentInset = UIEdgeInsets.init(top: 0, left: inset, bottom: 0, right: inset) collectionView.contentOffset = CGPoint(x: -inset, y: 0) &#125; func resetContentInset() &#123; guard let collectionView = self.collectionView else &#123; return &#125; collectionView.contentInset = UIEdgeInsets.init(top: 0, left: 0, bottom: 0, right: 0) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to make simple pan to dismiss view in iOS","slug":"How-to-make-simple-pan-to-dismiss-view-in-iOS","date":"2019-06-12T06:30:14.000Z","updated":"2019-06-12T07:40:49.000Z","comments":true,"path":"blog/How-to-make-simple-pan-to-dismiss-view-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-simple-pan-to-dismiss-view-in-iOS/","excerpt":"","text":"Issue #301 Make it more composable using UIViewController subclass and ThroughView to pass hit events to underlying views. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134class PanViewController: UIViewController &#123; var animator = UIViewPropertyAnimator(duration: 0, curve: .easeOut) lazy var panGR = UIPanGestureRecognizer(target: self, action: #selector(handlePan(_: ))) let slideView = UIView() let gripView = UIView() var options: Options = Options() var didHide: (() -&gt; Void)? let pullDownVelocity: CGFloat = 70 class Options &#123; var contentView: UIView = UIView() var percentHeight: CGFloat = 0.24 &#125; override func loadView() &#123; view = ThroughView() view.translatesAutoresizingMaskIntoConstraints = false &#125; override func viewDidLoad() &#123; super.viewDidLoad() setup() &#125; func setup() &#123; slideView.layer.cornerRadius = 10 slideView.clipsToBounds = true gripView.backgroundColor = UIColor.yellow gripView.layer.cornerRadius = 1 view.addSubview(slideView) slideView.addSubview(gripView) slideView.addGestureRecognizer(panGR) NSLayoutConstraint.on([ slideView.leftAnchor.constraint(equalTo: view.leftAnchor), slideView.rightAnchor.constraint(equalTo: view.rightAnchor), slideView.heightAnchor.constraint(equalTo: view.heightAnchor), slideView.topAnchor.constraint(equalTo: view.bottomAnchor) ]) NSLayoutConstraint.on([ gripView.centerXAnchor.constraint(equalTo: slideView.centerXAnchor), gripView.topAnchor.constraint(equalTo: slideView.topAnchor, constant: 16), gripView.widthAnchor.constraint(equalToConstant: 30), gripView.heightAnchor.constraint(equalToConstant: 2) ]) &#125; func apply(options: Options) &#123; self.options.contentView.removeFromSuperview() slideView.insertSubview(options.contentView, at: 0) NSLayoutConstraint.on([ options.contentView.leftAnchor.constraint(equalTo: slideView.leftAnchor), options.contentView.rightAnchor.constraint(equalTo: slideView.rightAnchor), options.contentView.topAnchor.constraint(equalTo: slideView.topAnchor), options.contentView.heightAnchor.constraint(equalTo: slideView.heightAnchor, multiplier: options.percentHeight) ]) self.options = options &#125; @objc func handlePan(_ gr: UIPanGestureRecognizer) &#123; switch gr.state &#123; case .began: break case .changed: break case .ended: let velocity = gr.velocity(in: slideView) if velocity.y &gt; pullDownVelocity &#123; hide() &#125; default: break &#125; &#125; func show() &#123; guard let parentView = view.superview else &#123; return &#125; animator = self.makeAnimator() animator.addAnimations &#123; self.slideView.transform = CGAffineTransform( translationX: 0, y: -parentView.bounds.height * self.options.percentHeight - parentView.safeAreaInsets.bottom ) &#125; animator.startAnimation() &#125; func hide() &#123; animator = self.makeAnimator() animator.addAnimations &#123; self.slideView.transform = CGAffineTransform.identity &#125; animator.addCompletion(&#123; _ in self.didHide?() &#125;) animator.startAnimation() &#125; func makeAnimator() -&gt; UIViewPropertyAnimator &#123; return UIViewPropertyAnimator(duration: 0.25, dampingRatio: 1.0) &#125;&#125;class ThroughView: UIView &#123; override func didMoveToSuperview() &#123; super.didMoveToSuperview() guard let superview = superview else &#123; return &#125; NSLayoutConstraint.on([pinEdges(view: superview)]) &#125; override func point(inside point: CGPoint, with event: UIEvent?) -&gt; Bool &#123; guard let slideView = subviews.first else &#123; return false &#125; return slideView.hitTest(convert(point, to: slideView), with: event) != nil &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Getting started with WWDC 2019","slug":"Getting-started-with-WWDC-2019","date":"2019-06-11T07:34:21.000Z","updated":"2019-11-01T07:30:17.000Z","comments":true,"path":"blog/Getting-started-with-WWDC-2019/","link":"","permalink":"https://onmyway133.github.io/blog/Getting-started-with-WWDC-2019/","excerpt":"","text":"Issue #300 WWDC WWDC special WWDC by Sundell NSHipster WWDC 2019 WWDC 2019 - The Things You May Have Missed 7 essential WWDC session videos for iOS developers The 15 Best WWDC Videos of All Time WWDC Extracted gists Favorite WWDC 2019 sessions Swift 5.1 Property wrappers to remove boilerplate code in Swift Understanding Opaque Return Types in Swift The Swift 5.1 features that power SwiftUI‚Äôs API What‚Äôs new in Swift 5.1 Swift Opaque Result Types Burritos A collection of Swift Property Wrappers How can Property Wrappers and Function Builders be leveraged? SwiftUI SwiftUI About-SwiftUI Swift UI by example Inside SwiftUI‚Äôs Declarative Syntax‚Äôs Compiler Magic Answers to the most common questions about SwiftUI SwiftUI: Getting Started SwiftUI-Cheat-Sheet Understanding Property Wrappers in SwiftUI SwiftUI Framework Learning and Usage Guide SwiftUI-2048 Fucking SwiftUI SwiftUI-Processing SwiftWebUI Building forms with SwiftUI Animations in SwiftUI SwiftUI DesignCode Good to know SwiftUI: Setting Environment Values SwiftUI Layout System Code https://github.com/xtabbas/calculator-checklist https://github.com/alfianlosari/SwiftUI-MovieDB https://github.com/unixzii/SwiftUI-2048 Combine RxSwift to Apple‚Äôs Combine Cheat Sheet Will Combine kill RxSwift? OpenCombine Open-source implementation of Apple‚Äôs Combine framework for processing values over time. CombineSwiftPlayground Combine framework in action ‚Äî Part 2 Using Combine üöÄ Dark Mode How To Adopt Dark Mode In Your iOS App","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Links for SwiftUI","slug":"Links-for-SwiftUI","date":"2019-06-11T07:34:21.000Z","updated":"2019-11-01T09:09:54.000Z","comments":true,"path":"blog/Links-for-SwiftUI/","link":"","permalink":"https://onmyway133.github.io/blog/Links-for-SwiftUI/","excerpt":"","text":"Issue #300 SwiftUI Redux-like state container in SwiftUI SwiftUI: Setting Environment Values SwiftUI Layout System SwiftUI tips and tricks Code https://github.com/xtabbas/calculator-checklist https://github.com/alfianlosari/SwiftUI-MovieDB https://github.com/unixzii/SwiftUI-2048 Combine https://github.com/learncombine/Combine101 Property wrapper Swift Dependency Injection via Property Wrapper","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"swiftUI","slug":"swiftUI","permalink":"https://onmyway133.github.io/tags/swiftUI/"}]},{"title":"How to style NSButton in AppKit","slug":"How-to-style-NSButton-in-AppKit","date":"2019-05-31T05:29:23.000Z","updated":"2019-10-29T07:55:03.000Z","comments":true,"path":"blog/How-to-style-NSButton-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-style-NSButton-in-AppKit/","excerpt":"","text":"Issue #297 1234567891011121314151617let button = NSButton()button.wantsLayer = truebutton.isBordered = falsebutton.setButtonType(.momentaryChange)button.attributedTitle = NSAttributedString( string: \"Click me\", attributes: [ NSAttributedString.Key.foregroundColor: NSColor.white, NSAttributedString.Key.font: NSFont.labelFont(ofSize: 13) ]button.layer?.backgroundColor = NSColor.orange.cgColorbutton.layer?.cornerRadius = 12activate( button.anchor.height.equal.to(32), button.anchor.width.equal.to(100)) To make it have native rounded rect 1234button.imageScaling = .scaleProportionallyDownbutton.setButtonType(.momentaryPushIn)button.bezelStyle = .roundedbutton.isBordered = true 1234567891011121314151617181920import AppKitimport Omniaextension NSButton &#123; func style(imageName: String) &#123; image = NSImage(named: NSImage.Name(imageName)) isBordered = false imageScaling = .scaleProportionallyDown &#125; func styleAction(title: String) &#123; attributedTitle = NSAttributedString(string: title, attributes: [ NSAttributedString.Key.foregroundColor: NSColor(hex: \"008B80\"), NSAttributedString.Key.font: NSFont.boldSystemFont(ofSize: 13) ]) isBordered = false setButtonType(.momentaryChange) &#125;&#125; Read more https://mackuba.eu/2014/10/06/a-guide-to-nsbutton-styles","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to debounce action in Flutter","slug":"How-to-debounce-action-in-Flutter","date":"2019-05-30T15:26:24.000Z","updated":"2019-06-29T16:50:32.000Z","comments":true,"path":"blog/How-to-debounce-action-in-Flutter/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-debounce-action-in-Flutter/","excerpt":"","text":"Issue #293 Answer https://stackoverflow.com/a/55119208/1418457 This is useful to throttle TextField change event. You can make Debouncer class using Timer 123456789101112131415161718import 'package:flutter/foundation.dart';import 'dart:async';class Debouncer &#123; final int milliseconds; VoidCallback action; Timer _timer; Debouncer(&#123; this.milliseconds &#125;); run(VoidCallback action) &#123; if (_timer != null) &#123; _timer.cancel(); &#125; _timer = Timer(Duration(milliseconds: milliseconds), action); &#125;&#125; Declare and trigger 12345final _debouncer = Debouncer(milliseconds: 500);onTextChange(String text) &#123; _debouncer.run(() =&gt; print(text));&#125;","categories":[],"tags":[{"name":"dart","slug":"dart","permalink":"https://onmyway133.github.io/tags/dart/"},{"name":"flutter","slug":"flutter","permalink":"https://onmyway133.github.io/tags/flutter/"}]},{"title":"How to add indicator under tab bar buttons in iOS","slug":"How-to-add-indicator-under-tab-bar-buttons-in-iOS","date":"2019-05-27T06:44:05.000Z","updated":"2019-10-14T07:24:07.000Z","comments":true,"path":"blog/How-to-add-indicator-under-tab-bar-buttons-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-indicator-under-tab-bar-buttons-in-iOS/","excerpt":"","text":"Issue #288 selectionIndicatorImage https://developer.apple.com/documentation/uikit/uitabbar/1623456-selectionindicatorimage Should design image with enough height, transparent background and indicator at the bottom Use this property to specify a custom selection image. Your image is rendered on top of the tab bar but behind the contents of the tab bar item itself. The default value of this property is nil, which causes the tab bar to apply a default highlight to the selected item Custom UITabBar or UITabBarController Hide existing tabBar tabBar.isHidden = true Position custom buttons 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import UIKitclass CustomTabBarController: UITabBarController &#123; private let bar = UIView() private var buttons = [UIButton]() override var viewControllers: [UIViewController]? &#123; didSet &#123; populate(viewControllers: viewControllers) &#125; &#125; override func viewDidLoad() &#123; super.viewDidLoad() setup() &#125; private func setup() &#123; tabBar.isHidden = true bar.backgroundColor = R.color.background view.addSubview(bar) NSLayoutConstraint.on([ bar.leftAnchor.constraint(equalTo: view.leftAnchor), bar.rightAnchor.constraint(equalTo: view.rightAnchor), bar.bottomAnchor.constraint(equalTo: view.bottomAnchor), bar.topAnchor.constraint(equalTo: tabBar.topAnchor) ]) &#125; private func populate(viewControllers: [UIViewController]) &#123; buttons.forEach &#123; $0.removeFromSuperview() &#125; buttons = viewControllers.map(&#123; let button = UIButton() button.setImage($0.tabBarItem.image, for: .normal) bar.addSubview(button) return button &#125;) view.setNeedsLayout() &#125; override func viewDidLayoutSubviews() &#123; super.viewDidLayoutSubviews() let padding: CGFloat = 20 let buttonSize = CGSize(width: 30, height: 44) let width = view.bounds.width - padding * 20 for (index, button) in buttons.enumerated() &#123; button.center = CGPoint(x: bar.center.x, y: bar.frame.height/2) &#125; &#125;&#125; Handle UITabBarControllerDelegate Override func tabBar(_ tabBar: UITabBar, didSelect item: UITabBarItem) tabBar.subviews contains 1 private UITabBarBackground and many private UITabBarButton 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import UIKitclass CustomTabBarController: UITabBarController &#123; let indicator: UIView = &#123; let view = UIView() view.backgroundColor = R.color.primary view.frame.size = CGSize(width: 32, height: 2) view.layer.cornerRadius = 1 return view &#125;() override func viewDidLoad() &#123; super.viewDidLoad() tabBar.addSubview(indicator) self.delegate = self &#125; private func animate(index: Int) &#123; let buttons = tabBar.subviews .filter(&#123; String(describing: $0).contains(\"Button\") &#125;) guard index &lt; buttons.count else &#123; return &#125; let selectedButton = buttons[index] UIView.animate( withDuration: 0.25, delay: 0, options: .curveEaseInOut, animations: &#123; let point = CGPoint( x: selectedButton.center.x, y: selectedButton.frame.maxY - 1 ) self.indicator.center = point &#125;, completion: nil ) &#125; override func viewDidLayoutSubviews() &#123; super.viewDidLayoutSubviews() animate(index: selectedIndex) &#125;&#125;extension CustomTabBarController: UITabBarControllerDelegate &#123; override func tabBar(_ tabBar: UITabBar, didSelect item: UITabBarItem) &#123; guard let items = tabBar.items, let index = items.firstIndex(of: item) else &#123; return &#125; animate(index: index) &#125;&#125; In iOS 13, we need to use viewDidAppear 12345override func viewDidAppear(_ animated: Bool) &#123; super.viewDidAppear(animated) moveIndicator(index: selectedIndex, animated: false)&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Understanding socket and port in TCP","slug":"Understanding-socket-and-port-in-TCP","date":"2019-05-25T14:12:06.000Z","updated":"2019-09-12T07:09:56.000Z","comments":true,"path":"blog/Understanding-socket-and-port-in-TCP/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-socket-and-port-in-TCP/","excerpt":"","text":"Issue #287 When digging into the world of TCP, I get many terminologies I don‚Äôt know any misconceptions. But with the help of those geeks on SO, the problems were demystified. Now it‚Äôs time to sum up and share with others :D What defines a unique connection ?There are 5 elements that identify a connection. They call them 5-tuple Protocol. This is often omitted as it is understood that we are talking about TCP, which leaves 4. Source IP address. Source port. Target P address. Target port. Does TCP listen on one port and talk on another port ?No. This is a common misconception. TCP listens on 1 port and talk on that same port. If clients make multiple TCP connection to server. It‚Äôs the client OS that must generate different random source ports, so that server can see them as unique connections What is the maximum number of concurrent TCP connections that a server can handle, in theory ?A single listening port can accept more than one connection simultaneously.There is a ‚Äò64K‚Äô limit that is often cited, but that is per client per server port, and needs clarifying. If a client has many connections to the same port on the same destination, then three of those fields will be the same ‚Äî only source_port varies to differentiate the different connections. Ports are 16-bit numbers, therefore the maximum number of connections any given client can have to any given host port is 64K. However, multiple clients can each have up to 64K connections to some server‚Äôs port, and if the server has multiple ports or either is multi-homed then you can multiply that further So the real limit is file descriptors. Each individual socket connection is given a file descriptor, so the limit is really the number of file descriptors that the system has been configured to allow and resources to handle. The maximum limit is typically up over 300K, but is configurable e.g. with sysctl Concurrent connection request vs Concurrent open connectionWhen clients want to make TCP connection with server, this request will be queued in server ‚Äòs backlog queue. This backlog queue size is small (about 5‚Äì10), and this size limits the number of concurrent connection requests. However, server quickly pick connection request from that queue and accept it. Connection request which is accepted are called open connection. The number of concurrent open connections is limited by server ‚Äòs resources allocated for file descriptor. Why connection is rejected after successful TCP handshake ?It‚Äôs normal. When server receive connection request from client (by receiving SYN), it will then response with SYN, ACK, hence cause successful TCP handshake. But this request are stills in backlog queue. But, if the application process exceeds the limit of max file descriptors it can use, then when server calls accept, then it realizes that there are no file descriptors available to be the allocated for the socket and fails the accept call and the TCP connection sending a FIN to other side What are active and passive socket ?Sockets come in two primary flavors. An active socket is con¬≠nect¬≠ed to a remote active socket via an open data con¬≠nec¬≠tion‚Ä¶ A passive socket is not con¬≠nect¬≠ed, but rather awaits an in¬≠com¬≠ing con¬≠nec¬≠tion, which will spawn a new active socket once a con¬≠nec¬≠tion is es¬≠tab¬≠lished Each port can have a single passive socket binded to it, await¬≠ing in¬≠com¬≠ing con¬≠nec¬≠tions, and mul¬≠ti¬≠ple active sockets, each cor¬≠re¬≠spond¬≠ing to an open con¬≠nec¬≠tion on the port. It‚Äôs as if the factory worker is waiting for new mes¬≠sages to arrive (he rep¬≠re¬≠sents the passive socket), and when one message arrives from a new sender, he ini¬≠ti¬≠ates a cor¬≠re¬≠spon¬≠dence (a con¬≠nec¬≠tion) with them by del¬≠e¬≠gat¬≠ing someone else (an active socket) to ac¬≠tu¬≠al¬≠ly read the packet and respond back to the sender if nec¬≠es¬≠sary. This permits the factory worker to be free to receive new packets Where to go from hereHere are some more links to help you explore further What is the difference between a port and a socket? Passive and active sockets Why will a TCP Server send a FIN immediately after accepting a connection? What is the theoretical maximum number of open TCP connections that a modern Linux box can have socket listen backlog parameter, how to determine this value? Question about listening and backlog for sockets Rejecting a TCP connection before it‚Äôs being accepted? Best way to generate million tcp connection Max parallel http connections in a browser? How to retain one million simultaneous TCP connections? TCP RST packet details How many tuples are there in a connection? Does TCP use another port for sending data?","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"How to use Gradle Kotlin DSL in Android","slug":"How-to-use-Gradle-Kotlin-DSL-in-Android","date":"2019-05-24T09:38:15.000Z","updated":"2019-10-24T04:00:59.000Z","comments":true,"path":"blog/How-to-use-Gradle-Kotlin-DSL-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Gradle-Kotlin-DSL-in-Android/","excerpt":"","text":"Issue #285 ktssettings.gradle.kts 1include(\":app\") build.gradle.kts 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788import org.gradle.kotlin.dsl.applyimport org.gradle.kotlin.dsl.dependenciesimport org.gradle.kotlin.dsl.kotlinimport org.gradle.kotlin.dsl.*import org.jetbrains.kotlin.config.KotlinCompilerVersionplugins &#123; id(\"com.android.application\") kotlin(\"android\") kotlin(\"android.extensions\")&#125;//apply &#123;// from(\"$rootDir/tools/grgit.gradle\")// from(\"$rootDir/buildSrc/quality.gradle.kts\")// from(\"$rootDir/tools/ktlint.gradle\")// from(\"$rootDir/tools/detekt.gradle\")//&#125;android &#123; compileSdkVersion(28) flavorDimensions(\"default\") defaultConfig &#123; applicationId = \"com.onmyway133.myapp\" minSdkVersion(26) targetSdkVersion(28)// versionCode = ext.get(\"gitCommitCount\") as? Int versionCode = 1 versionName = \"1.0\" testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\" &#125; signingConfigs &#123; create(\"release\") &#123; keyAlias = \"keyalias\" keyPassword = \"keypassword\" storePassword = \"storepassword\" storeFile = file(\"/Users/khoa/Android/Key/keystore\") &#125; &#125; buildTypes &#123; getByName(\"debug\") &#123; signingConfig = signingConfigs.getByName(\"debug\") isMinifyEnabled = true proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"$project.rootDir/tools/proguard-rules-debug.pro\") &#125; getByName(\"release\") &#123; signingConfig = signingConfigs.getByName(\"release\") isMinifyEnabled = true isShrinkResources = true proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"$project.rootDir/tools/proguard-rules.pro\") &#125; &#125; productFlavors &#123; create(\"staging\") &#123; &#125; create(\"production\") &#123; &#125; &#125; lintOptions &#123; lintConfig = file(\"$project.rootDir/tools/lint-rules.xml\") htmlOutput = file(\"$project.buildDir/outputs/lint/lint.html\") xmlReport = false htmlReport = true &#125;&#125;dependencies &#123; implementation(fileTree(mapOf(\"dir\" to \"libs\", \"include\" to listOf(\"*.jar\")))) implementation(kotlin(\"stdlib-jdk7\", KotlinCompilerVersion.VERSION)) implementation(\"androidx.appcompat:appcompat:1.0.2\") implementation(\"androidx.core:core-ktx:1.0.2\") implementation(\"androidx.constraintlayout:constraintlayout:1.1.3\") implementation(\"com.google.android.material:material:1.0.0\") testImplementation(\"junit:junit:4.12\") androidTestImplementation(\"androidx.test:runner:1.1.1\") androidTestImplementation(\"androidx.test.espresso:espresso-core:3.1.1\")&#125;tasks.getByName(\"check\").dependsOn(\"lint\") tools/quality.gradle.kts 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455plugins &#123; id(\"findbugs\") id(\"pmd\") id(\"checkstyle\")&#125;tasks &#123; val findbugs by registering(FindBugs::class) &#123; ignoreFailures = false effort = \"max\" reportLevel = \"low\" classes = files(\"$project.buildDir/intermediates/javac\") setExcludeFilter(file(\"$rootProject.rootDir/tools/findbugs-exclude.xml\")) source = fileTree(\"src/main/java/\") classpath = files() reports &#123; xml.isEnabled = false html.isEnabled = true html.destination = file(\"$project.buildDir/outputs/findbugs/findbugs-output.html\") &#125; &#125; val pmd by registering(Pmd::class) &#123; ruleSetFiles = files(\"$&#123;project.rootDir&#125;/tools/pmd-rules.xml\") ignoreFailures = false ruleSets = listOf&lt;String&gt;() fileTree() source(fileTree(baseDir = \"src/main/java\")) include(\"**/*.kt\") exclude(\"**/gen/**\") reports &#123; xml.isEnabled = false html.isEnabled = true html.destination = file(\"$project.buildDir/outputs/pmd/pmd.html\") &#125; &#125; val checkstyle by registering(Checkstyle::class) &#123; description = \"Check code standard\" group = \"verification\" configFile = file(\"$project.rootDir/tools/checkstyle.xml\") source(fileTree(baseDir = \"src\")) include(\"**/*.kt\") exclude(\"**/gen/**\") classpath = files() ignoreFailures = false &#125;&#125; Reference https://guides.gradle.org/migrating-build-logic-from-groovy-to-kotlin https://github.com/gradle/kotlin-dsl/blob/master/samples/hello-android/app/build.gradle.kts About Gradle Understanding Android Gradle build files Configure your build","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to deal with CSS responsiveness in Wordpress","slug":"How-to-deal-with-CSS-responsiveness-in-Wordpress","date":"2019-05-23T16:28:14.000Z","updated":"2019-09-12T07:11:30.000Z","comments":true,"path":"blog/How-to-deal-with-CSS-responsiveness-in-Wordpress/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-CSS-responsiveness-in-Wordpress/","excerpt":"","text":"Issue #283 Original post https://medium.com/fantageek/dealing-with-css-responsiveness-in-wordpress-5ad24b088b8b During the alpha test of LearnTalks, some of my friends reported that the screen is completely blank in search page, and this happened in mobile only. This article is how I identify the problem and found a workaround for the issue, it may not be the solution, but at least the screen does not appear blank anymore. As someone who likes to keep up with tech via watching conference videos, I thought it might be a good idea to collect all of these to better search and explore later. So I built a web app with React and Firebase, it is a work in progress for now. Due to time constraints, I decided to go first with Wordpress to quickly play with the idea. So there is LearnTalks. The theme Marinate that I used didn‚Äôt want to render the search page correctly. So I head over to Chrome Dev Tool for Responsive Viewport Mode and Safari for Web Inspector The tests showed that the problem only happened on certain screen resolutions. This must be due to CSS @media query which display different layouts for different screen sizes. And somehow it didn‚Äôt work for some sizes. [@media](http://twitter.com/media) screen and (max-width: 800px) { #site-header { display: none; } }A bit about the rulesThe @media rule is used in media queries to apply different styles for different media types/devices. Media queries can be used to check many things, such as: width and height of the viewport width and height of the device orientation (is the tablet/phone in landscape or portrait mode?) resolution Using media queries are a popular technique for delivering a tailored style sheet (responsive web design) to desktops, laptops, tablets, and mobile phones. So I go to Wordpress Dashboard -&gt; Appearance -&gt; Editor to examine CSS files. Unsurprisingly, there are a bunch of media queries [@media](http://twitter.com/media) (min-width: 600px) and (max-width: 767px) { .main-navigation { padding: 0; } .site-header .pushmenu { margin-top:0px; } .social-networks li a { line-height:2.1em !Important; } .search { display: none !important; } .customer blockquote { padding: 10px; text-align: justify; } }The .search selector is suspicious display: none !important; The important directive is, well, quite important It means, essentially, what it says; that ‚Äòthis is important, ignore subsequent rules, and any usual specificity issues, apply this rule!‚ÄôIn normal use a rule defined in an external stylesheet is overruled by a style defined in the head of the document, which, in turn, is overruled by an in-line style within the element itself (assuming equal specificity of the selectors). Defining a rule with the !important ‚Äòattribute‚Äô (?) discards the normal concerns as regards the ‚Äòlater‚Äô rule overriding the ‚Äòearlier‚Äô ones. Luckily, this theme allows the ability to Edit CSS , so I can override that to a block attribute to always show search page","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"Best places to learn iOS development","slug":"Best-places-to-learn-iOS-development","date":"2019-05-23T16:25:01.000Z","updated":"2019-09-12T07:11:34.000Z","comments":true,"path":"blog/Best-places-to-learn-iOS-development/","link":"","permalink":"https://onmyway133.github.io/blog/Best-places-to-learn-iOS-development/","excerpt":"","text":"Issue #278 Original post https://medium.com/fantageek/best-places-to-learn-ios-development-85ebebe890cf It‚Äôs good to be software engineers, when you get paid to do what you like best. The good thing about software development is it ‚Äòs changing fast, and challenging. This is also the not good thing, when you need to continuously learn and adapt to keep up with the trends. This is for those who have been iOS developers for some time. If you have a lot of free time to spend, then congratulations. If you do not, you know the luxury of free time, then it‚Äôs time to learn wisely, by selecting only the good resources. But where should I learn from? Welcome to the technology age, where there are tons to things to keep track of, iOS releases, SDK, 3rd frameworks, build tools, patterns, ‚Ä¶ Here are my list that I tend to open very often. It is opinionated and date aware. If it was several years ago, then http://nshipster.com/, https://www.objc.io/ should be in the top of the list. I like to keep track of stuff, via my lists https://github.com/onmyway133/fantastic-ios, https://github.com/onmyway133/fantastic-ios-architecture, https://github.com/onmyway133/fantastic-ios-animation. Also you should use services like https://feedly.com/ to organise your subscription feed. The point of this is for continuous learning, so it should be succinct. There is no particular order. 1. RaywenderlichRay Wenderlich | High quality programming tutorials: iOS, Android, Swift, Kotlin, Unity, and morePassword Autofill allows our apps to automatically populate the username and password and believe it or not, it only‚Ä¶www.raywenderlich.com This is probably one of the most visited site for learning iOS development. All the tutorials are well designed and easy to follow. If you can, you can subscribe to videos https://videos.raywenderlich.com/courses. I myself find watching video much more relaxing. And the team is reviving its Podcast https://www.raywenderlich.com/rwpodcast which I really recommend 2. Swift TalkSwift Talk ¬∑ objc.ioWe use the child view controller we created last time to factor out more code from the large view controller.talk.objc.io The people behind objc.io started their swift talks last year. I‚Äôm a fan of clean code, so these talks are really helpful when they show how to organise and write code. Also, they have awesome guests from some companies too. 3. NSScreencastIf you have less time, then this is great option. These covers many aspects of the iOS SDKs, and the videos are weekly.NSScreencast: Bite-sized Screencasts for iOS DevelopmentQuality videos on iOS development, released each week.nsscreencast.com 4. Swift By SundellI actually learn a lot from reading John ‚Äòs blog. He shows various tips on iOS programming and the Swift language. Also his podcast is a must subscribe https://www.swiftbysundell.com/podcast/. I‚Äôve listened to many podcasts, but I like this best.All postsLike many abstractions and patterns in programming, the goal of the builder pattern is to reduce the need to keep‚Ä¶www.swiftbysundell.com 5. AppCodaI like this because the content is short, and focused. I can easily follow and grasp the gist immediately. And it has large collection of various contents.AppCoda - Learn Swift &amp; iOS Programming by DoingAppCoda is an educational startup that focuses on teaching people how to learn Swift &amp; iOS programming blog. Our‚Ä¶www.appcoda.com 6. Use Your LoafThis has updated posts for every new SDK features. Also, the content is short and to the points. It‚Äôs like wikipedia for iOS development.Use Your LoafIf you are upgrading to Xcode 10 and migrating to Swift 4.2 you are likely to see a number of errors because Swift 4.2‚Ä¶useyourloaf.com 7. iOS GoodiesThe number of newsletters now is like stars on the sky. Among them I like iOS Goodies the best. It is driven by community https://github.com/iOS-Goodies/iOS-Goodies and contains lots of new awesome stuff each week.iOS Goodiesweekly iOS newsletter curated by Marius Constantinescu logo by Jos√© Torre founded by Rui Peres and Tiago Almeidaios-goodies.com 8. Erica SadunThis is a bit advanced where it discusses Swift languages. But it‚Äôs good to read if you want to get yourself to know more about hidden language features.Erica SadunRecently, some of my simulators launched and loaded just fine. Others simply went black. It didn‚Äôt seem to matter which‚Ä¶ericasadun.com 9. SwiftingI just discovered this recently, but I kinda like the blog. The number of posts are growing, and those are good reads about iOS SDKs.swifting.ioOur dear friend and a founder of swifting.io - Micha≈Ç, had an accident two months ago. He had a bad luck and got hit by‚Ä¶swifting.io 10. KhanlouI learn many good patterns and clean code from reading this blog. He suggests many ideas on refactoring code. Really recommend.KhanlouTo convert this into an infinite collection, we need to think about a few things. First, how will we represent an index‚Ä¶khanlou.com 11. Ole BegemannThis has been in my favorite list for a long time. Although this is a bit advanced, it is good to dive deep into Swift.Articles - Ole BegemannEdit descriptionoleb.net 12. Krzysztof Zab≈ÇockiThis is my favorite, too. This shows many practical advices for iOS development. He also talks about build tool that I really like.PostsHave you ever written tests? Usually, they use equality asserts, e.g. XCTAssertEqual, what happens if the object isn‚Äôt‚Ä¶merowing.info 13. Realm NewsRealm collects a huge collection of iOS videos from conferences and meet ups, and it has transcripts too. It‚Äôs more than enough to fill your free time.Realm Academy - Expert content from the mobile expertsDeveloper videos, articles and tutorials from top conferences, top authors, and community leaders.academy.realm.io 14. Big Nerd RanchThis has posts in both iOS and Android. But I really like the contents, very good.App Development and Design Blog | Big Nerd RanchOur blog offers app development and design tutorials, tips and tricks for software engineering and insights for team‚Ä¶www.bignerdranch.com 15. Cocoa with LoveThis is very advanced, and suitable for hardcore fans. I feel small when reading the posts.Cocoa with LoveThe upcoming CwlViews library offers a syntax for constructing views that has a profound effect on the Cocoa‚Ä¶www.cocoawithlove.com 16. Atomic SpinI really enjoy reading blog posts from Atomic Object. There are posts for many platforms, and about life, so you need to filter for iOS development.Atomic SpinMore and more studies have shown that the most effective teams are the ones whose members trust each other and feel‚Ä¶spin.atomicobject.com 17. RaizlabsThis has very good articles about iOS. Highly recommend.React Native Animations: Part 2 - RaizException - Raizlabs Developer BlogWhen we build apps for our clients, beautiful designs and interactions are important. But equally important is‚Ä¶www.raizlabs.com 18. Invasive CodeThis has topics for many iOS features. All the contents are good and succinct.iOS Development - Computer Vision iOS AppsComputer Vision iOS Appswww.invasivecode.com 19. Think and BuildI like posts about animation and replicating app features. This has all of them. http://www.thinkandbuild.it/ 20. Little Bites of CocoaThis has a series of small tips, on how to use iOS SDKs and other 3rd frameworks. Good to know.Little Bites of Cocoa - Tips and techniques for iOS and Mac development - Weekday mornings at 9:42‚Ä¶Tips and techniques for iOS and Mac development - Weekday mornings at 9:42 AM. The goal of each of these ‚Äòbites‚Äô is to‚Ä¶littlebitesofcocoa.com 21. Samwize ()All the posts are good, short and to the points. Really like this.@samwize¬Ø_(„ÉÑ)_/¬Øsamwize.com I think that‚Äôs enough. Feel free to share and suggest other awesome blogs that I might miss. Also, it‚Äôs good to contribute back to community by writing your blog posts. You will learn a lot by sharing.","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"20 recommended utility apps for macOS","slug":"20-recommended-utility-apps-for-macOS","date":"2019-05-23T16:21:05.000Z","updated":"2019-09-12T07:11:42.000Z","comments":true,"path":"blog/20-recommended-utility-apps-for-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/20-recommended-utility-apps-for-macOS/","excerpt":"","text":"Issue #274 Original post https://hackernoon.com/20-recommended-utility-apps-for-macos-in-2018-ea494b4db72b Depending on the need, we have different apps on the mac. As someone who worked mostly with development, below are my indispensable apps. They are like suits to Tony Stark. Since I love open source apps, they have higher priority in the list. Open source appsiTerm 2 https://www.iterm2.com/ iTerm2 is a replacement for Terminal and the successor to iTerm. It works on Macs with macOS 10.10 or newer. iTerm2 brings the terminal into the modern age with features you never knew you always wanted. iTerm2 has good integration with tmux and supports Split Panes Term2 allows you to divide a tab into many rectangular ‚Äúpanes‚Äù, each of which is a different terminal session. The shortcuts cmd-d and cmd-shift-d divide an existing session vertically or horizontally, respectively. You can navigate among split panes with cmd-opt-arrow or cmd-[ and cmd-]. You can ‚Äúmaximize‚Äù the current pane ‚Äî hiding all others in that tab ‚Äî with cmd-shift-enter. Pressing the shortcut again restores the hidden panes. There‚Äôs the_silver_searcher with ag command to quickly search for files oh-my-zsh https://github.com/robbyrussell/oh-my-zsh A delightful community-driven (with 1,200+ contributors) framework for managing your zsh configuration. Includes 200+ optional plugins (rails, git, OSX, hub, capistrano, brew, ant, php, python, etc), over 140 themes to spice up your morning, and an auto-update tool so that makes it easy to keep up with the latest updates from the community. I use z shell with oh-my-zsh plugins. I also use zsh-autocompletions to have autocompletion like fish shell and z to track and quickly navigate to the most used directories. spectacle https://github.com/eczarny/spectacle Spectacle allows you to organize your windows without using a mouse. With spectable, I can organise windows easily with just Cmd+Option+F or Cmd+Option+Left insomnia https://github.com/getinsomnia/insomnia Insomnia is a cross-platform REST client, built on top of Electron. Regardless if you like electron.js apps or not. This is a great tool for testing REST requets Visual Studio Code https://github.com/Microsoft/vscode VS Code is a new type of tool that combines the simplicity of a code editor with what developers need for their core edit-build-debug cycle. Code provides comprehensive editing and debugging support, an extensibility model, and lightweight integration with existing tools. This seems to be the most popular for front end development, and many other things. There‚Äôs bunch of extensions that make the experience to a new level. IconGenerator https://github.com/onmyway133/IconGeneratorBuilt by me. When developing iOS, Android and macOS applications, I need a quick way to generate icons in different sizes. You can simply drag the generated asset into Xcode and that‚Äôs it. vmd https://github.com/yoshuawuyts/vmd Preview markdown files in a separate window. Markdown is formatted exactly the same as on GitHub. colorpicker https://github.com/Toinane/colorpicker A mininal but complete colorpicker desktop app I used to use Sip but I often get the problem of losing focus. GifCapture https://github.com/onmyway133/GifCaptureI built this as a native macOS app to capture screen and save to gif file. It works like Licecap but open source. There‚Äôs also an open source tool called kap that is slick. Itsycal https://github.com/sfsam/Itsycal Itsycal is a tiny calendar for your Mac‚Äôs menu bar. The app is minimal and works very well. It can shows calendar for integrated accounts in the mac. PushNotifications https://github.com/onmyway133/PushNotificationsI often need to test push notification to iOS and Android apps. And I want to support both certificate and key p8 authentication for Apple Push Notification service, so I built this tool. Lyrics https://github.com/onmyway133/Lyrics A menu bar app to show the lyric of the playing Spotify song When I listen to some songs in Spotify, I want to see the lyrics too. The lyrics is fetched from https://genius.com/ and displayed in a wonderful UI. gitify https://github.com/manosim/gitify GitHub Notifications on your desktop. I use this to get real time notification for issues and pull requests for projects on GitHub. I hope there is support for Bitbucket soon. FinderGo https://github.com/onmyway133/FinderGoFinderGo is both a native macOS app and a Finder extension. It has toolbar button that opens terminal right within Finder in the current directory. You can configure it to open either Terminal, iTerm2 or Hyper Atom one dark themeThis is about theme. There is the very popular dracular themes, but I find it too strong for the eyes. I don‚Äôt use Atom, but I love its one dark UI. I used to maintain my own theme for Xcode called DarkSide but now I use xcode-one-dark for Xcode and Atom One Dark Theme for Visual Studio Code. I also use Fira Code font in Xcode, Visual Studio Code and Android Studio, which has beautiful ligatures. Chrome extensionsI use Chrome for its speed and wonderful support for extensions. The extensions I made are github-chat to enable chat within GitHub and github-extended to see more pinned repositories. There are also refined github, github-repo-size and octotree that are indispensable for me. caprine https://github.com/sindresorhus/caprine Caprine is an unofficial and privacy focused Facebook Messenger app with many useful features. Close source and commercial appsSublime Text https://www.sublimetext.com/ Sublime Text is a sophisticated text editor for code, markup and prose. You‚Äôll love the slick user interface, extraordinary features and amazing performance. Sublime Text is simply fast and the editing experience is very good. I‚Äôve used Atom but it is too slow. Sublime Merge https://www.sublimemerge.com/ Meet a new Git client, from the makers of Sublime Text Sublime Merge never lets me down. The source control app is simply very quick. I used SourceTree in the past, but it is very slow and had problem with authentication to Bitbucket and GitHub, and it halts very often for React Native apps, which has lots of node modules committed. 1 Password https://1password.com/ 1Password remembers them all for you. Save your passwords and log in to sites with a single click. It‚Äôs that simple. Everyone need strong and unique passwords these day. This tool is indispensable Monosnap https://monosnap.com/welcome Make screenshots. Draw on it. Shoot video and share your files. It‚Äôs fast, easy and free. I haven‚Äôt found a good open source alternative, this is good in capturing screen or portion of the screen. VLC https://www.videolan.org/index.nb.htmliTunes or Quick Time has problem with some video codecs. This app VLC can play all kinds of video types. Xcode https://developer.apple.com/xcode/Xcode is the go to editor for iOS developer. The current version is Xcode 10. From Xcode 8, plugins are not supported. The way to go is Xcode extensions. I have developed XcodeColorSense2 to easily recognise hex colors, and XcodeWay to easily navigate to many places right from Xcode Sketch https://www.sketchapp.com/ Sketch is a design toolkit built to help you create your best work ‚Äî from your earliest ideas, through to final artwork. Sketch is the most favorite design tool these days. There are many cool plugins for it. I use Sketch-Action and User Flows Where to go from hereI hope you find some new tools to try. If you know other awesome tools, feel free to make a comment. Here are some more links to discover further Electron apps The best Mac apps of 2018 Best Open Source Tools For Developers open-source-mac-os-apps","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"},{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"How to run Android apps in Bitrise","slug":"How-to-run-Android-apps-in-Bitrise","date":"2019-05-23T16:18:19.000Z","updated":"2019-09-12T07:11:49.000Z","comments":true,"path":"blog/How-to-run-Android-apps-in-Bitrise/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-Android-apps-in-Bitrise/","excerpt":"","text":"Issue #273 Original post https://hackernoon.com/using-bitrise-ci-for-android-apps-fa9c48e301d8 CI, short for Continuous Integration, is a good practice to move fast and confidently where code is integrated into shared repository many times a day. The ability to have pull requests get built, tested and release builds get distributed to testers allows team to verify automated build and identify problems quickly. I ‚Äòve been using BuddyBuild for both iOS and Android apps and were very happy with it. The experience from creating new apps and deploying build is awesome. It works so well that Apple acquired it, which then lead to the fact that Android apps are no longer supported and new customers can‚Äôt register. We are one of those who are looking for new alternatives. We‚Äôve been using TravisCI, CircleCI and Jenkins to deploy to Fabric. There is also TeamCity that is promising. But after a quick survey with friends and people, Bitrise is the most recommended. So maybe I should try that. The thing I like about Bitrise is its wide range support of workflow. They are just scripts that execute certain actions, and most of them are open source. There‚Äôs also yml config file, but all things can be done using web interface, so I don‚Äôt need to look into pages of documentation just to get the configuration right. This post is not a promote for Bitrise, it is just about trying and adapting to new things. There is no eternal thing in tech, things come ad go fast. Below are some of the lessons I learn after using Bitrise, hope you find them useful. Variant to buildThere is no Android Build step in the default ‚Äòprimary‚Äô workflow, as primary is generally used for testing the code for every push. There is an Android Build step in the deploy workflow and the app gets built by running this workflow. However, I like to have the Android Build step in my primary workflow, so I added it there. Usually I want app module and stagingRelease build variant as we need to deploy staging builds to internal testers. If you go to Bitrise.yml tab you can see that the configuration file has been updated. This is very handy. I‚Äôve used some other CI services and I needed to lookup their documentation on how to make this yml work. Bump version code automaticallyI‚Äôve used some other CI services before and the app version code surely does not start from 0. So it makes sense that Bitrise can auto bump version code from the current number. There are some predefined steps in Workflow but they don‚Äôt serve my need For the Set Android Manifest Version code and name step, the source code is here so I understand what it does. It works by modify AndroidManifest.xml file using sed . This article Adjust your build number is not clear enough. sed -i.bak ‚Äús/android:versionCode=‚Äù\\‚Äù${VERSIONCODE}\\‚Äù‚Äù/android:versionCode=‚Äù\\‚Äù${CONFIG_new_version_code}\\‚Äù‚Äù/‚Äù ${manifest_file}In our projects, the versionCode is from an environment variable BUILD_NUMBER in Jenkins, so we need look up the same thing in Available Environment Variables, and it is BITRISE_BUILD_NUMBER , which is a build number of the build on bitrise.io. This is how versionCode looks like in build.gradle versionCode (System.*getenv*(&quot;BITRISE_BUILD_NUMBER&quot;) as Integer ?: System.*getenv*(&quot;BUILD_NUMBER&quot;) as Integer ?: 243)243 is the current version code of this project, so let‚Äôs go to app‚Äôs Settings and change Your next build number will be Deploy to FabricI hope Bitrise has its own Crash reporting tool. For now I use Crashlytics in Fabric. And despite that Bitrise can distribute builds to testers, I still need to cross deploy to Fabric for historial reasons. There is only script steps-fabric-crashlytics-beta-deploy to deploy IPA file for iOS apps, so we need something for Android. Fortunately I can use the Fabric plugin for gradle. Add Fabric pluginFollow Install Crashlytics via Gradle to add Fabric plugin. Basically you need to add these dependencies to your app ‚Äòs build.gradle buildscript { repositories { google() maven { url &apos;https://maven.fabric.io/public&apos; } } dependencies { classpath &apos;io.fabric.tools:gradle:1.+&apos; } } apply plugin: &apos;io.fabric&apos; dependencies { compile(&apos;com.crashlytics.sdk.android:crashlytics:2.9.4@aar&apos;) { transitive = true; } }and API credentials in Manifest file &lt;meta-data android:name=‚Äùio.fabric.ApiKey‚Äù android:value=‚Äù67ffdb78ce9cd50af8404c244fa25df01ea2b5bc‚Äù /&gt;Deploy commandModern Android Studio usually includes a gradlew execution file in the root of your project. Run ./gradlew tasks for the list of tasks that you app can perform, look for Build tasks that start with assemble . Read more Build your app from the command line You can execute all the build tasks available to your Android project using the Gradle wrapper command line tool. It‚Äôs available as a batch file for Windows (gradlew.bat) and a shell script for Linux and Mac (gradlew.sh), and it‚Äôs accessible from the root of each project you create with Android Studio. For me, I want to deploy staging release build variant, so I run. Check that the build is on Fabric. ./gradlew assembleStagingRelease crashlyticsUploadDistributionStagingReleaseManage tester groupGo to your app on Fabric.io and create group of testers. Note that alias that is generated for the group Go to your app‚Äôs build.gradle and add ext.betaDistributionGroupAliases=‚Äômy-internal-testers‚Äô to your desired productFlavors or buildTypes . For me I add to staging under productFlavors productFlavors { staging { // ‚Ä¶ ext.betaDistributionGroupAliases=‚Äôhyper-internal-testers-1&apos; } production { // ‚Ä¶ } }Now that the command is run correctly, let‚Äôs add that to Bitrise Gradle Run stepGo to Workflow tab and add a Gradle Run step and place it below Deploy to Bitrise.io step. Expand Config, and add assembleStagingRelease crashlyticsUploadDistributionStagingRelease to Gradle task to run . Now start a new build in Bitrise manually or trigger new build by making pull request, you can see that the version code is increased for every build, crossed build gets deployed to Fabric to your defined tester groups. As an alternative, you can also use Fabric/Crashlytics deployer, just update config with your apps key and secret found in settings. Where to go from hereI hope those tips are useful to you. Here are some more links to help you explore further Convert old Android workflows and configure new steps based on the old Gradle tasks on Bitrise Replace whole line containing a string using Sed Alternatives to Buddybuild? Simplifying Android app distribution with Beta by Crashlytics Fabric app for Android Studio Crashlytics distribution for app with multiple flavors Gradle plugins Setting up a new app in Crashlytics without the IDE plugin","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"How to make tag selection view in React Native","slug":"How-to-make-tag-selection-view-in-React-Native","date":"2019-05-23T16:16:04.000Z","updated":"2019-07-02T18:13:42.000Z","comments":true,"path":"blog/How-to-make-tag-selection-view-in-React-Native/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-tag-selection-view-in-React-Native/","excerpt":"","text":"Issue #271 Original post https://hackernoon.com/how-to-make-tag-selection-view-in-react-native-b6f8b0adc891 Besides React style programming, Yoga is another cool feature of React Native. It is a cross-platform layout engine which implements Flexbox so we use the same layout code for both platforms. As someone who uses Auto Layout in iOS and Constraint Layout in Android, I find Flexbox bit hard to use at first, but there are many tasks that Flexbox does very well, they are distribute elements in space and flow layout. In this post we will use Flexbox to build a tag selection view using just Javascript code. This is very easy to do so we don‚Äôt need to install extra dependencies. Our tag view will support both multiple selection and exclusive selection. First, we need a custom Button . Button with BackgroundButton is of the basic elements in React Native, but it is somewhat limited if we want to have custom content inside the button, for example texts, images and background import { Button } from &apos;react-native&apos; ... &lt;Button onPress={onPressLearnMore} title=&quot;Learn More&quot; color=&quot;#841584&quot; accessibilityLabel=&quot;Learn more about this purple button&quot; /&gt;TouchableOpacityLuckily we have TouchableOpacity, which is a wrapper for making views respond properly to touches. On press down, the opacity of the wrapped view is decreased, dimming it. To implement button in our tag view, we need to a button with background a check image. Create a file called BackgroundButton.js import React from &apos;react&apos; import { TouchableOpacity, View, Text, StyleSheet, Image } from &apos;react-native&apos; import R from &apos;res/R&apos; export default class BackgroundButton extends React.Component { render() { const styles = this.makeStyles() return ( &lt;TouchableOpacity style={styles.touchable} onPress={this.props.onPress}&gt; &lt;View style={styles.view}&gt; {this.makeImageIfAny(styles)} &lt;Text style={styles.text}&gt;{this.props.title}&lt;/Text&gt; &lt;/View&gt; &lt;/TouchableOpacity&gt; ) } makeImageIfAny(styles) { if (this.props.showImage) { return &lt;Image style={styles.image} source={R.images.check} /&gt; } } makeStyles() { return StyleSheet.create({ view: { flexDirection: &apos;row&apos;, borderRadius: 23, borderColor: this.props.borderColor, borderWidth: 2, backgroundColor: this.props.backgroundColor, height: 46, alignItems: &apos;center&apos;, justifyContent: &apos;center&apos;, paddingLeft: 16, paddingRight: 16 }, touchable: { marginLeft: 4, marginRight: 4, marginBottom: 8 }, image: { marginRight: 8 }, text: { fontSize: 18, textAlign: &apos;center&apos;, color: this.props.textColor, fontSize: 16 } }) } }Dynamic stylesNormally we use const styles = StyleSheet.create({}) but since we want our button to be configurable, we make styles into a function, so on every render we get a new styles with proper configurations. The properties we support are borderColor, textColor, backgroundColor and showImage In the makeImageIfAny we only need to return Image if the view is selected. We don‚Äôt have the else case, so in if showImage is false, this returns undefined and React won‚Äôt render any element makeImageIfAny(styles) { if (this.props.showImage) { return &lt;Image style={styles.image} source={R.images.check} /&gt; } }padding and marginTo understand padding and margin, visit CSS Box Model. Basically padding means clearing an area around the content and padding is transparent, while margin means clearing an area outside the border and the margin also is transparent. Pay attention to styles . We have margin for touchable so that each tag button have a little margin outside each other. touchable: { marginLeft: 4, marginRight: 4, marginBottom: 8 }In the view we need flexDirection as row because React Native has flexDirection as column by default. And a row means we have Image and Text side by side horizontally inside the button. We also use alignItems and justifyContent to align elements centeredly on both main and cross axises. The padding is used to have some spaces between the inner text and the view. view: { flexDirection: &apos;row&apos;, height: 46, alignItems: &apos;center&apos;, justifyContent: &apos;center&apos;, paddingLeft: 16, paddingRight: 16 }Tag ViewCreate a file called TagsView.js This is where we parse tags and show a bunch of BackgroundButton import React from &apos;react&apos; import { View, StyleSheet, Button } from &apos;react-native&apos; import R from &apos;res/R&apos; import BackgroundButton from &apos;library/components/BackgroundButton&apos; import addOrRemove from &apos;library/utils/addOrRemove&apos; export default class TagsView extends React.Component { constructor(props) { super(props) this.state = { selected: props.selected } } render() { return ( &lt;View style={styles.container}&gt; {this.makeButtons()} &lt;/View&gt; ) } onPress = (tag) =&gt; { let selected if (this.props.isExclusive) { selected = [tag] } else { selected = addOrRemove(this.state.selected, tag) } this.setState({ selected }) } makeButtons() { return this.props.all.map((tag, i) =&gt; { const on = this.state.selected.includes(tag) const backgroundColor = on ? R.colors.on.backgroundColor : R.colors.off.backgroundColor const textColor = on ? R.colors.on.text : R.colors.off.text const borderColor = on ? R.colors.on.border : R.colors.off.border return ( &lt;BackgroundButton backgroundColor={backgroundColor} textColor={textColor} borderColor={borderColor} onPress={() =&gt; { this.onPress(tag) }} key={i} showImage={on} title={tag} /&gt; ) }) } } const styles = StyleSheet.create({ container: { flex: 1, flexDirection: &apos;row&apos;, flexWrap: &apos;wrap&apos;, padding: 20 } })We parse an array of tags to build BackgroundButton . We keep the selected array in state because this is mutated inside the TagsView component. If it is isExclusive then the new selected contains just the new selected tag. If it is multiple selection, then we add the new selected tag into the selected array. The addOrRemove is a our homegrown utility function to add an item into an array if it does not exists, or remove if it exists, using the high orderfilter function. const addOrRemove = (array, item) =&gt; { const exists = array.includes(item) if (exists) { return array.filter((c) =&gt; { return c !== item }) } else { const result = array result.push(item) return result } }Flex wrapPay attention to styles const styles = StyleSheet.create({ container: { flex: 1, flexDirection: &apos;row&apos;, flexWrap: &apos;wrap&apos;, padding: 20 } })The hero here is flexWrap which specifies whether the flexible items should wrap or not. Take a look at CSS flex-wrap property for other options. Since we have main axis as row , element will be wrapped to the next row if there are not enough space. That‚Äôs how we can achieve a beautiful tag view. Using TagsViewThen consuming TagsView is as easy as declare it inside render const selected = [&apos;Swift&apos;, Kotlin] const tags = [&apos;Swift&apos;, &apos;Kotlin&apos;, &apos;C#&apos;, &apos;Haskell&apos;, &apos;Java&apos;] return ( &lt;TagsView all={tags} selected={selected} isExclusive={false} /&gt; )Learning FlexboxLearning Flebox is crucial in using React and React Native effectively. The best places to learn it are w3school CSS Flexbox and Basic concepts of flexbox by Mozzila.Basic concepts of flexboxThe Flexible Box Module, usually referred to as flexbox, was designed as a one-dimensional layout model, and as a‚Ä¶developer.mozilla.org There is a showcase of all possible Flexbox propertiesThe Full React Native Layout Cheat SheetA simple visual guide with live examples for all major React Native layout propertiesmedium.com Yoga has its own YogaKit published on CocoaPods, you can learn it with native code in iOSYoga Tutorial: Using a Cross-Platform Layout EngineLearn about Yoga, Facebook‚Äôs cross-platform layout engine that helps developers write more layout code in style akin to‚Ä¶www.raywenderlich.com And when we use flexbox, we should compose element instead of hardcoding values, for example we can use another View with justifyContent: flex-end to move a button down the screen. This follows flexbox style and prevent rigid code.Position element at the bottom of the screen using Flexbox in React NativeReact Native uses Yoga to achieve Flexbox style layout, which helps us set up layout in a declarative and easy way.medium.com Where to go from hereI hope you learn something useful in this post. For more information please consult the official guide Layout with Flexbox and layout-props for all the possible Flexbox properties.","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"}]},{"title":"Introducing Learn Talks‚Ää‚Äî‚ÄäAwesome conference and meetup talks","slug":"Introducing-Learn-Talks-Awesome-conference-and-meetup-talks","date":"2019-05-23T16:14:41.000Z","updated":"2019-09-12T07:11:55.000Z","comments":true,"path":"blog/Introducing-Learn-Talks-Awesome-conference-and-meetup-talks/","link":"","permalink":"https://onmyway133.github.io/blog/Introducing-Learn-Talks-Awesome-conference-and-meetup-talks/","excerpt":"","text":"Issue #269 Original post https://medium.com/swlh/introducing-learn-talks-awesome-conference-and-meetup-talks-e97c8cf7e0f Product Hunt https://www.producthunt.com/posts/learn-talks Hi, it‚Äôs Khoa here. I‚Äôm so glad to finally launch LearnTalks, in order to help others and myself to catch up with new conference and meetup talks. Being one who is extremely passionate about making things and writing , I also love to learn about every new thing in tech. Tech moves so fast, what we learn today may be deprecated very soon, and only continuous learning can keep us move forward. Tech conference and meetup are best places to learn about new things and tips, although there are some rises and falls ‚Ä¶, they are still growing and provides valuable resources for lots of people. There are lots of conferences and meetups that one can‚Äôt go to all, this can give fear of missing out feeling. Fortunately people are kind enough to always publish videos publicly so others can learn from. I have been for a long time curating a list‚Ä¶ to keep track of all cool videos, but it get out of hand very quickly. That‚Äôs why I make LearnTalks.com as a convenient place to search and explore new tech talks. The features include Easy search for talk, author and event See upcoming events Explore tags of topics and technologies Mobile friendly Firstly, thanks to all the people who helped me alpha test the website and provided valuable feedback. I addressed and fixed many issues.And thanks a lot to many conference organisers who gave me a yes, support and encouragement promptly after I sent emails. Thanks a lot for spending your free time organising cool events and sharing the videos to the community. I really appreciate. This website is just a curation to videos, it does not repost or claim copyright of any of the videos. And there are links back to conference and meetup pages. It is free to use and has no commercial purpose. Hope you find the website useful as I do. There are of course many things needed to improve, I‚Äôm looking forward to receiving feedbacks and support from you ‚ù§Ô∏è If there are any issues or copyright violations, please feel free to drop me a message.","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"How to add app icons and splash screens to a React Native app in staging and production","slug":"How-to-add-app-icons-and-splash-screens-to-a-React-Native-app-in-staging-and-production","date":"2019-05-23T16:09:18.000Z","updated":"2019-08-29T09:35:24.000Z","comments":true,"path":"blog/How-to-add-app-icons-and-splash-screens-to-a-React-Native-app-in-staging-and-production/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-add-app-icons-and-splash-screens-to-a-React-Native-app-in-staging-and-production/","excerpt":"","text":"Issue #268 Original post https://medium.freecodecamp.org/how-to-add-app-icons-and-splash-screens-to-a-react-native-app-in-staging-and-production-d1dab615e7c6 React Native was designed to be ‚Äúlearn once, write anywhere,‚Äù and it is usually used to build cross platform apps for iOS and Android. And for each app that we build, there are times we need to reuse the same code, build and tweak it a bit to make it work for different environments. For example, we might need multiple skins, themes, a free and paid version, or more often different staging and production environments. And the task that we can‚Äôt avoid is adding app icons and splash screens to our apps. In fact, to add a staging and production environment, and to add app icons, requires us to use Xcode and Android Studio, and we do it the same way we do with native iOS or Android projects. Let‚Äôs call our app MyApp and bootstrap it with react-native init MyApp . There will of course, be tons of libraries to help us with managing different environments. In this post, we will do just like we did with native apps, so that we know the basic steps. Build configuration, target, build types, production flavor, and build variantThere are some terminologies we needed to remember. In iOS, debug and releases are called build configurations, and staging and production are called targets. A build configuration specifies a set of build settings used to build a target‚Äôs product in a particular way. For example, it is common to have separate build configurations for debug and release builds of a product.A target specifies a product to build and contains the instructions for building the product from a set of files in a project or work-space. A target defines a single product; it organizes the inputs into the build system ‚Äî the source files and instructions for processing those source files ‚Äî required to build that product. Projects can contain one or more targets, each of which produces one product In Android, debug and releases are called build types, and staging and production are called product flavors. Together they form build variants. For example, a ‚Äúdemo‚Äù product flavor can specify different features and device requirements, such as custom source code, resources, and minimum API levels, while the ‚Äúdebug‚Äù build type applies different build and packaging settings, such as debug options and signing keys. The resulting build variant is the ‚ÄúdemoDebug‚Äù version of your app, and it includes a combination of the configurations and resources included in the ‚Äúdemo‚Äù product flavor, ‚Äúdebug‚Äù build type, and main/ source set. Staging and production targets in iOSOpen MyApp.xcodeproj inside ios using Xcode. Here is what we get after bootstrapping: React Native creates iOS and tvOS apps, and two test targets. In Xcode, a project can contain many targets, and each target means a unique product with its own build settings ‚Äî Info.plist and app icons. Duplicate targetIf we don‚Äôt need the tvOS app, we can delete the MyApp-tvOS and MyApp-tvOSTests . Let‚Äôs use MyApp target as our production environment, and right click -&gt; Duplicate to make another target. Let‚Äôs call it MyApp Staging. Each target must have unique bundle id. Change the bundle id of MyApp to com.onmyway133.MyApp and MyApp Staging to com.onmyway133.MyApp.Staging. Info.plistWhen we duplicate MyApp target , Xcode also duplicates Info.plist into MyApp copy-Info.plist for the staging target. Change it to a more meaningful name Info-Staging.plist and drag it to the MyApp group in Xcode to stay organised. After dragging, MyApp Staging target can‚Äôt find the plist, so click Choose Info.plist File and point to the Info-Staging.plist. SchemeXcode also duplicates the scheme when we duplicate the target, so we get MyApp copy: Click Manage Schemes in the scheme drop-down to open Scheme manager: I usually delete the generated MyApp copy scheme, then I create a new scheme again for the MyApp Staging target. You need to make sure that the scheme is marked as Shared so that it is tracked into git. For some reason, the staging scheme does not have all the things set up like the production scheme. You can run into issues like ‚ÄòReact/RCTBundleURLProvider.h‚Äô file not found or RN: ‚ÄòReact/RCTBridgeModule.h‚Äô file not found . It is because React target is not linked yet. To solve it, we must disable Parallelise Build and add React target and move it above MyApp Staging. Staging and production product flavors in AndroidOpen the android folder in Android Studio. By default there are only debug and release build types: They are configured in the app module build.gradle: buildTypes { release { minifyEnabled enableProguardInReleaseBuilds proguardFiles getDefaultProguardFile(&quot;proguard-android.txt&quot;), &quot;proguard-rules.pro&quot; } }First, let‚Äôs change application id to com.onmyway133.MyApp to match iOS. It is not required but I think it‚Äôs good to stay organised. Then create two product flavors for staging and production. For staging, let‚Äôs add .Staging to the application id. From Android Studio 3, ‚Äúall flavors must now belong to a named flavor dimension‚Äù ‚Äî normally we just need default dimensions. Here is how it looks in build.gradle for our app module: android { compileSdkVersion rootProject.ext.compileSdkVersion buildToolsVersion rootProject.ext.buildToolsVersion flavorDimensions &quot;default&quot; defaultConfig { applicationId &quot;com.onmyway133.MyApp&quot; minSdkVersion rootProject.ext.minSdkVersion targetSdkVersion rootProject.ext.targetSdkVersion versionCode 1 versionName &quot;1.0&quot; ndk { abiFilters &quot;armeabi-v7a&quot;, &quot;x86&quot; } } splits { abi { reset() enable enableSeparateBuildPerCPUArchitecture universalApk false // If true, also generate a universal APK include &quot;armeabi-v7a&quot;, &quot;x86&quot; } } buildTypes { release { minifyEnabled enableProguardInReleaseBuilds proguardFiles getDefaultProguardFile(&quot;proguard-android.txt&quot;), &quot;proguard-rules.pro&quot; } } productFlavors { staging { applicationIdSuffix &quot;.Staging&quot; } production { } } }Click Sync Now to let gradle do the syncing job. After that, we can see that we have four build variants: How to run staging and productionTo run the Android app, we can specify a variant like react-native run-android ‚Äî variant=productionDebug, but I prefer to go to Android Studio, select the variant, and run. To run iOS app, we can specify the scheme like react-native run-ios ‚Äî simulator=‚ÄôiPhone X‚Äô ‚Äî scheme=‚ÄùMyApp Staging‚Äù . As of react-native 0.57.0 this does not work. But it does not matter as I usually go to Xcode, select the scheme, and run. Add app icon for iOSAccording to the Human Interface Guideline, we need app icons of different sizes for different iOS versions, device resolutions, and situations (notification, settings, Spring Board). I‚Äôve crafted a tool called IconGenerator, which was previously mentioned in Best Open Source Tools For Developers. Drag the icon that you want ‚Äî I prefer those with 1024x1024 pixels for high resolution app icons ‚Äî to the Icon Generator MacOS app. Click Generate and we get AppIcon.appiconset . This contains app icons of the required sizes that are ready to be used in Asset Catalog. Drag this to Asset Catalog in Xcode. That is for production. For staging, it‚Äôs good practice to add a ‚ÄúStaging‚Äù banner so that testers know which is staging, and which is production. We can easily do this in Sketch. Remember to set a background, so we don‚Äôt get a transparent background. For an app icon with transparent background, iOS shows the background as black which looks horrible. After exporting the image, drag the staging icon to the IconGenerator the same way we did earlier. But this time, rename the generated appiconset to AppIcon-Staging.appiconset. Then drag this to Asset Catalog in Xcode. For the staging target to use staging app icons, open MyApp Staging target and choose AppIcon-Staging as App Icon Source. Add app icon for Android I like to switch to Project view, as it is easier to change app icons. Click res -&gt; New -&gt; Image Asset to open Asset Studio. We can use the same app icons that we used in iOS: Android 8.0 (API level 26) introduced Adaptive Icons so we need to tweak the Resize slider to make sure our app icons look as nice as possible. Android 8.0 (API level 26) introduces adaptive launcher icons, which can display a variety of shapes across different device models. For example, an adaptive launcher icon can display a circular shape on one OEM device, and display a squircle on another device. Each device OEM provides a mask, which the system then uses to render all adaptive icons with the same shape. Adaptive launcher icons are also used in shortcuts, the Settings app, sharing dialogs, and the overview screen. ‚Äî Android developers We are doing for production first, which means the main Res Directory. This step will replace the existing placeholder app icons generated by Android Studio when we bootstrapped React Native projects. Now that we have production app icons, let‚Äôs make staging app icons. Android manages code and assets via convention. Click on src -&gt; New -&gt; Directory and create a staging folder. Inside staging, create a folder called res . Anything we place in staging will replace the ones in main ‚Äî this is called source sets. You can read more here: Build with source sets. You can use source set directories to contain the code and resources you want packaged only with certain configurations. For example, if you are building the ‚ÄúdemoDebug‚Äù build variant, which is the crossproduct of a ‚Äúdemo‚Äù product flavor and ‚Äúdebug‚Äù build type, Gradle looks at these directories, and gives them the following priority:src/demoDebug/ (build variant source set)src/debug/ (build type source set)src/demo/ (product flavor source set)src/main/ (main source set) Right click on staging/res -&gt; New -&gt; Image Asset to make app icons for staging. We also use the same staging app icons like in iOS, but this time we choose staging as Res Directory. This way Android Studio knows how to generate different ic_launcher and put them into staging. Add launch screen for iOSThe splash screen is called a [Launch Screen](http://Launch Screen) in iOS, and it is important. A launch screen appears instantly when your app starts up. The launch screen is quickly replaced with the first screen of your app, giving the impression that your app is fast and responsive In the old days, we needed to use static launch images with different sizes for each device and orientation. Launch Screen storyboardFor now the recommended way is to use Launch Screen storyboard . The iOS project from React Native comes with LaunchScreen.xib but xib is a thing of the past. Let‚Äôs delete it and create a file called Launch Screen.storyboard . Right click on MyApp folder -&gt; New and chose Launch Screen, add it to both targets as usually we show the same splash screen for both staging and production. Image SetOpen asset catalog, right click and select New Image Set . We can name it anything. This will be used in the Launch Screen.storyboard. Open Launch Screen.storyboard and add an UIImageView . If you are using Xcode 10, click the Library button in the upper right corner and choose Show Objects Library. Set image for Image View, and make sure Content Mode is set to Aspect Filled, as this ensures that the image always covers the full screen (although it may be cropped). Then connect ImageView using constraints to the View, not the Safe Area. You do this by Control+drag from the Image View (splash) to the View. Constrains without marginClick into each constraint and uncheck Relative to Margin. This makes our ImageView pin to the very edges of the view and with no margin at all. Now go to both targets and select Launch Screen.storyboard as Launch Screen File: On iOS, the launch screen is often cached, so you probably won‚Äôt see the changes. One way to avoid that is to delete the app and run it again. Add a launcher theme for AndroidThere are several ways to add splash screen for Android, from using launcher themes, Splash Activity, and a timer. For me, a reasonable splash screen for Android should be a very minimal image. As there are many Android devices with different ratios and resolutions, if you want to show a full screen splash image, it will probably not scale correctly for each device. This is just about UX. For the splash screen, let‚Äôs use the launcher theme with splash_background.xml . Learn about Device MetricThere is no single splash image that suits all Android devices. A more logical approach is to create multiple splash images for all common resolutions in portrait and landscape. Or we can design a minimal splash image that works. You can find more info here: Device Metric. Here is how to add splash screen in 4 easy steps: Add splash imageWe usually need a common splash screen for both staging and production. Drag an image into main/res/drawble . Android Studio seems to have a problem with recognising some jpg images for the splash screen, so it‚Äôs best to choose png images. Add splash_background.xmlRight click on drawable -&gt; New -&gt; Drawable resource file . Name it whatever you want ‚Äî I choose splash_background.xml . Choose the root element as layer-list: A [Layer List](http://Layer List) means ‚Äúa Drawable that manages an array of other Drawables. These are drawn in array order, so the element with the largest index is drawn on top‚Äù. Here is how splash_background.xml looks like: &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!-- The android:opacity=‚Äùopaque‚Äù line ‚Äî this is critical in preventing a flash of black as your theme transitions. --&gt; &lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:opacity=&quot;opaque&quot;&gt; &lt;!-- The background color, preferably the same as your normal theme --&gt; &lt;item android:drawable=&quot;@android:color/white&quot;/&gt; &lt;!-- Your splash image --&gt; &lt;item&gt; &lt;bitmap android:src=&quot;@drawable/iron_man&quot; android:gravity=&quot;center&quot;/&gt; &lt;/item&gt; &lt;/layer-list&gt;Note that we point to our splash image we added earlier with android:src=‚Äù@drawable/iron_man‚Äù. Declare styleOpen styles.xml and add SplashTheme: &lt;style name=&quot;SplashTheme&quot; parent=&quot;Theme.AppCompat.NoActionBar&quot;&gt; &lt;item name=&quot;android:windowBackground&quot;&gt;@drawable/splash_background&lt;/item&gt; &lt;/style&gt;Use SplashThemeGo to Manifest.xml and change the theme of the the launcher activity, which has category android:name=‚Äùandroid.intent.category.LAUNCHER‚Äù . Change it to android:theme=‚Äù@style/SplashTheme‚Äù . For React Native, the launcher activity is usually MainActivity . Here is how Manifest.xml looks: &lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; package=&quot;com.myapp&quot;&gt; &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt; &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt; &lt;application android:name=&quot;.MainApplication&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@mipmap/ic_launcher&quot; android:allowBackup=&quot;false&quot; android:theme=&quot;@style/AppTheme&quot;&gt; &lt;activity android:name=&quot;.MainActivity&quot; android:label=&quot;@string/app_name&quot; android:configChanges=&quot;keyboard|keyboardHidden|orientation|screenSize&quot; android:theme=&quot;@style/SplashTheme&quot; android:windowSoftInputMode=&quot;adjustResize&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt; &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;activity android:name=&quot;com.facebook.react.devsupport.DevSettingsActivity&quot; /&gt; &lt;/application&gt; &lt;/manifest&gt;Run the app now and you should see the splash screen showing when the app starts. Managing environment configurationsThe differences between staging and production are just about app names, application ids, and app icons. We probably use different API keys, and backend URL for staging and production. Right now the most popular library to handle these scenarios is react-native-config, which is said to ‚Äúbring some 12 factor love to your mobile apps‚Äù. It requires lots of steps to get started, and I hope there is a less verbose solution. Where to go from hereIn this post, we touched Xcode and Android Studio more than Visual Studio Code, but this was inevitable. I hope this post was useful to you. Here are some more links to read more about this topic: Add App Icons and Launch Screens to React Native Apps (iOS &amp; Android) How to Add a Splash Screen to a React Native App (iOS and Android) Managing Configuration in React Native Adding multiple target pipelines for React Native Apps (and Fastlane CircleCI deployment) pt. 1 The (Complete) Android Splash Screen Guide","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"}]},{"title":"How to Make Linear Gradient View with Bridging in React Native","slug":"How-to-Make-Linear-Gradient-View-with-Bridging-in-React-Native","date":"2019-05-23T15:57:46.000Z","updated":"2019-07-02T18:14:00.000Z","comments":true,"path":"blog/How-to-Make-Linear-Gradient-View-with-Bridging-in-React-Native/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-Make-Linear-Gradient-View-with-Bridging-in-React-Native/","excerpt":"","text":"Issue #264 Original post https://medium.com/react-native-training/react-native-bridging-how-to-make-linear-gradient-view-83c3805373b7 React Native lets us build mobile apps using only Javascript. It works by providing a common interface that talks to native iOS and Android components. There are enough essentials components to get started, but the cooler thing is that it is easy to build our own, hence we are not limited by React Native. In this post we will implement a linear gradient view, which is not supported by default in React Native, using native UI component, particularly CAGradientLayer in iOS and GradientDrawable in Android. In Javascript there are hundreds of libraries for a single problem and you should check if you really need it or not. A search on Google for linear gradient shows a bunch of libraries, like react-native-linear-gradient. The less dependencies the better. Linear gradient is in fact very easy to build and we probably don‚Äôt need to add extra dependencies. Also integrating and following updates with 3rd libraries are painful, I would avoid that as much as possible. Native UI component vs Native moduleIn React Native, there are native UI component and native module. React Native moves pretty fast so most of the articles will be outdated, it‚Äôs best to consult official documentation for the latest React Native version. This post will try to give you overview of the whole picture because for now the official guide seems not completed. Native Modules in iOS Native Modules in Android Native UI Components in iOS Native UI Components in Android In simple explanation, native UI component is about making UIView in iOS or View in Android available as React.Component and used in render function in Javascript. There are tons of native UI widgets out there ready to be used in the latest apps ‚Äî some of them are part of the platform, others are available as third-party libraries, and still more might be in use in your very own portfolio. React Native has several of the most critical platform components already wrapped, like ScrollView and TextInput, but not all of them, and certainly not ones you might have written yourself for a previous app. Native module is more general in that we make any native class available in Javascript. Sometimes an app needs access to platform API, and React Native doesn‚Äôt have a corresponding module yet. Maybe you want to reuse some existing Objective-C, Swift or C++ code without having to reimplement it in JavaScript, or write some high performance, multi-threaded code such as for image processing, a database, or any number of advanced extensions. View ManagerTo expose native UI views, we use the ViewManager as the bridge, it is RCTViewManager in iOS and SimpleViewManager in Android. Then inside this ViewManager we can just return our custom view. I see it‚Äôs good to use Objective C/Java for the ViewManager to match React Native classes, and the custom view we can use either Swift/Objective C in iOS and Kotlin/Java in Android. I prefer to use Swift, but in this post to remove the overhead of introducing bridging header from Swift to Objective C, we use Objective C for simplicity. We also add the native source code directly into iOS and Android project, but in the future we can extract them easily to a React Native library. For now let ‚Äòs use the name RNGradientViewManager and RNGradientView to stay consistent between iOS and Android. The RN prefix is arbitrary, you can use any prefix you want, but here I use it to indicate that these classes are meant to be used in Javascript side in React Native. Implement in iOSProject structureAdd these Objective-C classes to the projects, I usually place them inside NativeComponents folder Native views are created and manipulated by subclasses of RCTViewManager. These subclasses are similar in function to view controllers, but are essentially singletons - only one instance of each is created by the bridge. They expose native views to the RCTUIManager, which delegates back to them to set and update the properties of the views as necessary. The RCTViewManagers are also typically the delegates for the views, sending events back to JavaScript via the bridge. RNGradientViewManagerCreate a RNGradientViewManager that inherits from RCTViewManager RNGradientViewManager.h #import &lt;React/RCTViewManager.h&gt; @interface RNGradientViewManager : RCTViewManager @endRNGradientViewManager.m #import &quot;RNGradientViewManager.h&quot; #import &quot;RNGradientView.h&quot; [@implementation](http://twitter.com/implementation) RNGradientViewManager RCT_EXPORT_MODULE() - (UIView *)view { return [[RNGradientView alloc] init]; } RCT_EXPORT_VIEW_PROPERTY(progress, NSNumber); RCT_EXPORT_VIEW_PROPERTY(cornerRadius, NSNumber); RCT_EXPORT_VIEW_PROPERTY(fromColor, UIColor); RCT_EXPORT_VIEW_PROPERTY(toColor, UIColor); [@end](http://twitter.com/end)In iOS we use macro RCT_EXPORT_MODULE() to automatically register the module with the bridge when it loads. The optional js_name argument will be used as the JS module name. If omitted, the JS module name will match the Objective-C class name. #define RCT_EXPORT_MODULE(js_name)The ViewManager, not the View, is the facade to the Javascript side, so we expose properties using RCT_EXPORT_VIEW_PROPERTY . Note that we do that inside @implementation RNGradientViewManager Here we specify the types as NSNumber and UIColor , and later in Javascript we can just pass number and color hex string, and React Native can do the conversions for us. In older versions of React Native, we need processColor in Javascript or RCTConvert color in iOS side, but we don‚Äôt need to perform manual conversion now. RNGradientViewIn the Native UI component example for iOS, they use WKWebView but here we make a RNGradientView which subclasses from RCTView to take advantage of many features of React Native views, and to avoid some problems we can get if using a normal UIView RNGradientView.h #import &lt;UIKit/UIKit.h&gt; #import &lt;React/RCTView.h&gt; [@interface](http://twitter.com/interface) RNGradientView : RCTView [@end](http://twitter.com/end)RNGradientView.m #import &quot;RNGradientView.h&quot; #import &lt;UIKit/UIKit.h&gt; [@interface](http://twitter.com/interface) RNGradientView() [@property](http://twitter.com/property) CAGradientLayer *gradientLayer; [@property](http://twitter.com/property) UIColor *_fromColor; [@property](http://twitter.com/property) UIColor *_toColor; [@property](http://twitter.com/property) NSNumber *_progress; [@property](http://twitter.com/property) NSNumber *_cornerRadius; [@end](http://twitter.com/end) [@implementation](http://twitter.com/implementation) RNGradientView // MARK: - Init - (instancetype)initWithFrame:(CGRect)frame { self = [super initWithFrame:frame]; if (self) { self.gradientLayer = [self makeGradientLayer]; [self.layer addSublayer:self.gradientLayer]; self._fromColor = [UIColor blackColor]; self._toColor = [UIColor whiteColor]; self._progress = [@0](http://twitter.com/0).5; [self update]; } return self; } // MARK: - Life cycle - (void)layoutSubviews { [super layoutSubviews]; self.gradientLayer.frame = CGRectMake( 0, 0, self.bounds.size.width*self._progress.floatValue, self.bounds.size.height ); } // MARK: - Properties - (void)setFromColor:(UIColor *)color { self._fromColor = color; [self update]; } - (void)setToColor:(UIColor *)color { self._toColor = color; [self update]; } - (void)setProgress:(NSNumber *)progress { self._progress = progress; [self update]; } - (void)setCornerRadius:(NSNumber *)cornerRadius { self._cornerRadius = cornerRadius; [self update]; } // MARK: - Helper - (void)update { self.gradientLayer.colors = @[ (id)self._fromColor.CGColor, (id)self._toColor.CGColor ]; self.gradientLayer.cornerRadius = self._cornerRadius.floatValue; [self setNeedsLayout]; } - (CAGradientLayer *)makeGradientLayer { CAGradientLayer *gradientLayer = [CAGradientLayer layer]; gradientLayer.masksToBounds = true; gradientLayer.startPoint = CGPointMake(0.0, 0.5); gradientLayer.endPoint = CGPointMake(1.0, 0.5); gradientLayer.anchorPoint = CGPointZero; return gradientLayer; } [@end](http://twitter.com/end)We can implement anything we want in this native view, in this case we use CAGradientLayer to get nicely displayed linear gradient. Since RNGradientViewManager exposes some properties like progress, cornerRadius, fromColor, toColor we need to implement some setters as they will be called by React Native when we update values in Javascript side. In the setter we call setNeedsLayout to tell the view to invalidate the layout, hence layoutSubviews will be called again. requireNativeComponentOpen project in Visual Studio Code, add GradientView.js to src/nativeComponents . The folder name is arbitrary, but it‚Äôs good to stay organised. import { requireNativeComponent } from &apos;react-native&apos; module.exports = requireNativeComponent(&apos;RNGradientView&apos;, null)Here we use requireNativeComponent to load our RNGradientView . We only need this one Javascript file for interacting with both iOS and Android. You can name the module as RNGradientView but I think the practice in Javascript is that we don‚Äôt use prefix, so we name just GradientView . const requireNativeComponent = (uiViewClassName: string): string =&gt; createReactNativeComponentClass(uiViewClassName, () =&gt; getNativeComponentAttributes(uiViewClassName), ); module.exports = requireNativeComponent;Before I tried to use export default for the native component, but this way the view is not rendered at all, even if I wrap it inside React.Component . It seems we must use module.exports for the native component to be properly loaded. Now using it is as easy as declare the GradientView with JSX syntax import GradientView from &apos;nativeComponents/GradientView&apos; export default class Profile extends React.Component { render() { return ( &lt;SafeAreaView style={styles.container}&gt; &lt;GradientView style={styles.progress} fromColor={R.colors.progress.from} toColor={R.colors.progress.to} cornerRadius={5.0} progress={0.8} /&gt; ) } }Implement in AndroidProject structureAdd these Java classes to the projects, I usually place them inside nativeComponents folder RNGradientManagerCreate a RNGradientManager that extends SimpleViewManagerRNGradientManager.java package com.onmyway133.myApp.nativeComponents; import android.support.annotation.Nullable; import com.facebook.react.uimanager.SimpleViewManager; import com.facebook.react.uimanager.ThemedReactContext; import com.facebook.react.uimanager.annotations.ReactProp; public class RNGradientViewManager extends SimpleViewManager&lt;RNGradientView&gt; { [@Override](http://twitter.com/Override) public String getName() { return &quot;RNGradientView&quot;; } [@Override](http://twitter.com/Override) protected RNGradientView createViewInstance(ThemedReactContext reactContext) { return new RNGradientView(reactContext); } // Properties [@ReactProp](http://twitter.com/ReactProp)(name = &quot;progress&quot;) public void setProgress(RNGradientView view, [@Nullable](http://twitter.com/Nullable) float progress) { view.setProgress(progress); } [@ReactProp](http://twitter.com/ReactProp)(name = &quot;cornerRadius&quot;) public void setCornerRadius(RNGradientView view, [@Nullable](http://twitter.com/Nullable) float cornerRadius) { view.setCornerRadius(cornerRadius); } [@ReactProp](http://twitter.com/ReactProp)(name = &quot;fromColor&quot;, customType = &quot;Color&quot;) public void setFromColor(RNGradientView view, [@Nullable](http://twitter.com/Nullable) int color) { view.setFromColor(color); } [@ReactProp](http://twitter.com/ReactProp)(name = &quot;toColor&quot;, customType = &quot;Color&quot;) public void setToColor(RNGradientView view, [@Nullable](http://twitter.com/Nullable) int color) { view.setToColor(color); } }We usually use Color as android.graphics.Color , but for the GradientDrawable that we are going to use, it use color as ARGB integer. So it‚Äôs nifty that React Native deals with Color as int type. We also need to specify customType = ‚ÄúColor‚Äù as Color is something kinda custom. RNGradientViewThis is where we implement our view, we can do that in Kotlin if we like. RNGradientView.java package com.onmyway133.myApp.nativeComponents; import android.content.Context; import android.graphics.drawable.GradientDrawable; import android.graphics.drawable.ScaleDrawable; import android.support.annotation.Nullable; import android.util.AttributeSet; import android.view.Gravity; import android.view.View; public class RNGradientView extends View { float progress; float cornerRadius; int fromColor; int toColor; public RNGradientView(Context context) { super(context); } public RNGradientView(Context context, @Nullable AttributeSet attrs) { super(context, attrs); } public RNGradientView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); } public RNGradientView(Context context, @Nullable AttributeSet attrs, int defStyleAttr, int defStyleRes) { super(context, attrs, defStyleAttr, defStyleRes); } // update void update() { GradientDrawable gradient = new GradientDrawable(); gradient.setColors(new int[] { this.fromColor, this.toColor }); gradient.setOrientation(GradientDrawable.Orientation.*LEFT_RIGHT*); gradient.setGradientType(GradientDrawable.*LINEAR_GRADIENT*); gradient.setShape(GradientDrawable.*RECTANGLE*); gradient.setCornerRadius(this.cornerRadius * 4); ScaleDrawable scale = new ScaleDrawable(gradient, Gravity.*LEFT*, 1, -1); scale.setLevel((int)(this.progress * 10000)); this.setBackground(scale); } // Getter &amp; setter public void setProgress(float progress) { this.progress = progress; this.update(); } public void setCornerRadius(float cornerRadius) { this.cornerRadius = cornerRadius; this.update(); } public void setFromColor(int fromColor) { this.fromColor = fromColor; this.update(); } public void setToColor(int toColor) { this.toColor = toColor; this.update(); } }Pay attention to the setColors as it use an array of int Sets the colors used to draw the gradient.Each color is specified as an ARGB integer and the array must contain at least 2 colors. If we call setBackground with the GradientDrawable it will be stretched to fill the view. In our case we want to support progress which determines how long the gradient should show. To fix that we use ScaleDrawable which is a Drawable that changes the size of another Drawable based on its current level value. The same value for cornerRadius works in iOS, but for Android we need to use higher values, that‚Äôs why the multiplication in gradient.setCornerRadius(this.cornerRadius * 4) Shape drawableAnother way to implement gradient is to use Shape Drawable with xml , it‚Äôs the equivalent of using xib in iOS. We can create something like gradient.xml and put that inside /res/drawable &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;shape xmlns:android=&quot;[http://schemas.android.com/apk/res/android](http://schemas.android.com/apk/res/android)&quot; android:shape=&quot;rectangle&quot;&gt; &lt;gradient android:startColor=&quot;#3B5998&quot; android:endColor=&quot;#00000000&quot; android:angle=&quot;45&quot;/&gt; &lt;/shape&gt;For more information, you can readAndroid Shape Drawables TutorialHave you ever wanted to reduce your Android application‚Äôs size or make it look more interesting? If yes, then you‚Ä¶android.jlelse.eu We can also use the class directly ShapeDrawable in code A Drawable object that draws primitive shapes. A ShapeDrawable takes a Shape object and manages its presence on the screen. If no Shape is given, then the ShapeDrawable will default to a RectShape.This object can be defined in an XML file with the element. GradientManagerPackageIn iOS we use RCT_EXPORT_MODULE to register the component, but in Android, things are done explicitly using Package . A package can register both native module and native UI component. In this case we deal with just UI component, so let‚Äôs return RNGradientManager in createViewManagers GradientManagerPackage.java package com.onmyway133.myApp.nativeComponents; import com.facebook.react.ReactPackage; import com.facebook.react.bridge.NativeModule; import com.facebook.react.bridge.ReactApplicationContext; import com.facebook.react.uimanager.ViewManager; import java.util.Arrays; import java.util.Collections; import java.util.List; public class RNGradientViewPackage implements ReactPackage { [@Override](http://twitter.com/Override) public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) { return Collections.emptyList(); } [@Override](http://twitter.com/Override) public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) { return Arrays.&lt;ViewManager&gt;asList( new RNGradientViewManager() ); } }Then head over to MainApplication.java to declare our package [@Override](http://twitter.com/Override) protected List&lt;ReactPackage&gt; getPackages() { return Arrays.&lt;ReactPackage&gt;asList( new MainReactPackage(), new RNGradientViewPackage() ); }That‚Äôs it for Android. We already have the GradientView.js written earlier, when running the app in Android, it will look up and load our RNGradientView Where to go from hereHope you learn something about native UI component. In the post we only touch the surfaces on what native UI component can do, which is just passing configurations from Javascript to native. There are a lot more to discover, like event handling, thread, styles, custom types, please consult the official documentation for correct guidance. Native UI Components for iOS Native UI Components for Android","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"}]},{"title":"How to dismiss keyboard with react-navigation in React Native apps","slug":"How-to-dismiss-keyboard-with-react-navigation-in-React-Native-apps","date":"2019-05-23T15:57:01.000Z","updated":"2019-08-26T06:36:07.000Z","comments":true,"path":"blog/How-to-dismiss-keyboard-with-react-navigation-in-React-Native-apps/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-dismiss-keyboard-with-react-navigation-in-React-Native-apps/","excerpt":"","text":"Issue #263 Original post https://medium.com/react-native-training/how-to-dismiss-keyboard-with-react-navigation-in-react-native-apps-4b987bbfdc48 Showing and dismiss keyboard seems like a trivial thing to do in mobile apps, but it can be tricky in automatically dismissing it when it comes together with react-navigation and modal presentation. At least that‚Äôs according to my initial assumption. This article aims to detail what I have learned about keyboard handling and how to avoid extra tap when dealing with TextInput There will also be lots of code spelunking, thanks to the all the libraries being open source. The version of React Native I‚Äôm using at the time of writing is 0.57.5 The built in TextInput componentReact Native comes with a bunch of basic components, one of them is the TextInput for inputting text into the app via a keyboard. import React, { Component } from &apos;react&apos;; import { AppRegistry, TextInput } from &apos;react-native&apos;; export default class UselessTextInput extends Component { constructor(props) { super(props); this.state = { text: &apos;Useless Placeholder&apos; }; } render() { return ( &lt;TextInput style={{height: 40, borderColor: 'gray', borderWidth: 1}} onChangeText={(text) =&gt; this.setState({text})} value={this.state.text} /&gt; ); } }That‚Äôs it, whenever we click on the text input, keyboard appears allowing us to enter values. To dismiss the keyboard by pressing anywhere on the screen, the easy solution is to TouchableWithoutFeedback together with Keyboard . This is similar to having UITapGestureRecognizer in iOS UIView and calling view.endEditing import { Keyboard } from &apos;react-native&apos; Keyboard.dismiss()TextInput inside ScrollViewNormally we should have some text inputs inside a scrolling component, in React Native that is mostly ScrollView to be able to handle long list of content and avoid keyboard. If TextInput is inside ScrollView then the way keyboard gets dismissed behaves a bit differently, and depends on keyboardShouldPersistTaps Determines when the keyboard should stay visible after a tap. ‚Äònever‚Äô (the default), tapping outside of the focused text input when the keyboard is up dismisses the keyboard. When this happens, children won‚Äôt receive the tap. ‚Äòalways‚Äô, the keyboard will not dismiss automatically, and the scroll view will not catch taps, but children of the scroll view can catch taps. ‚Äòhandled‚Äô, the keyboard will not dismiss automatically when the tap was handled by a children, (or captured by an ancestor). The never mode should be the desired behaviour in most cases, clicking anywhere outside the focused text input should dismiss the keyboard. In my app, there are some text inputs and an action button. The scenario is that users enter some infos and then press that button to register data. With the never mode, we have to press button twice, one for dismissing the keyboard, and two for the onPress of the Button . So the solution is to use always mode. This way the Button always gets the press event first. &lt;ScrollView keyboardShouldPersistTaps=&apos;always&apos; /&gt;ScrollView cares about keyboardThe native RCTScrollView class that power react native ScrollView has code to handle dismiss mode RCT_SET_AND_PRESERVE_OFFSET(setKeyboardDismissMode, keyboardDismissMode, UIScrollViewKeyboardDismissMode)The option that it chooses is UIScrollViewKeyboardDismissMode for keyboardDismissMode property The manner in which the keyboard is dismissed when a drag begins in the scroll view. As you can see, the possible modes are onDrag and interactive . And react native exposes customization point for this via keyboardShouldPersistTaps case none The keyboard does not get dismissed with a drag. case onDrag The keyboard is dismissed when a drag begins. case interactive The keyboard follows the dragging touch offscreen, and can be pulled upward again to cancel the dismiss. ScrollView inside a ModalBut that does not work when ScrollView is inside Modal . By Modal I meant the Modal component in React Native. The only library that I use is react-navigation , and it supports Opening a full-screen modal too, but they way we declare modal in react-navigation looks like stack and it is confusing, so I would rather not use it. I use Modal in react-native and that works pretty well. So if we have TextInput inside ScrollView inside Modal then keyboardShouldPersistTaps does not work. Modal seems to be aware of parent ScrollView so we have to declare keyboardShouldPersistTaps=‚Äôalways‚Äô on every parent ScrollView . In React Native FlatList and SectionList uses ScrollView under the hood, so we need to be aware of all those ScrollView components. Spelunking react-navigationSince my app relies heavily on react-navigation , it‚Äôs good to have a deep understanding about its components so we make sure where the problem lies. I‚Äôve written a bit about react-navigation structure below.Using react-navigation 3.0 in React Native appsreact-navigation is probably the only dependency I use in React Native apps. I‚Äôm happy with it so far, then version 3.0‚Ä¶codeburst.io Like every traditional mobile apps, my app consists of many stack navigators inside tab navigator. In iOS that means many UINavigationViewController inside UITabbarController . In react-navigation I use createMaterialTopTabNavigator inside createBottomTabNavigator import { createMaterialTopTabNavigator } from &apos;react-navigation&apos; import { createBottomTabNavigator, BottomTabBar } from &apos;react-navigation-tabs&apos;The screen I have keyboard issue is a Modal presented from the 2nd screen in one of the stack navigators, so let‚Äôs examine every possible ScrollView up the hierarchy. This process involves lots of code reading and this‚Äôs how I love open source. First let‚Äôs start with createBottomTabNavigator which uses createTabNavigator together with its own TabNavigationView class TabNavigationView extends React.PureComponent&lt;Props, State&gt; export default createTabNavigator(TabNavigationView);Tab navigator has tab bar view below ScreenContainer , which is used to contain view. ScreenContainer is from react-native-screens ‚ÄúThis project aims to expose native navigation container components to React Native‚Äù. Below is how tab navigator works. render() { const { navigation, renderScene, lazy } = this.props; const { routes } = navigation.state; const { loaded } = this.state return ( &lt;View style={styles.container}&gt; &lt;ScreenContainer style={styles.pages}&gt; {routes.map((route, index) =&gt; { if (lazy &amp;&amp; !loaded.includes(index)) { // Don&apos;t render a screen if we&apos;ve never navigated to it return null; const isFocused = navigation.state.index === index return ( &lt;ResourceSavingScene key={route.key} style={StyleSheet.absoluteFill} isVisible={isFocused} &gt; {renderScene({ route })} &lt;/ResourceSavingScene&gt; ); })} &lt;/ScreenContainer&gt; {this._renderTabBar()} &lt;/View&gt; ); }Tab bar is rendered using BottomTabBar in _renderTabBar function. Looking at the code, the whole tab navigator has nothing to do with ScrollView . So there is only createMaterialTopTabNavigator left on the suspecting list. I use it in the app with swipeEnabled: true . And by looking at the imports, top tab navigator has import MaterialTopTabBar, { type TabBarOptions,} from &apos;../views/MaterialTopTabBar&apos;;MaterialTopTabBar has import from react-native-tab-view import { TabBar } from &apos;react-native-tab-view&apos;;which has ScrollView &lt;View style={styles.scroll}&gt; &lt;Animated.ScrollView horizontal keyboardShouldPersistTaps=&quot;handled&quot;The property keyboardShouldPersistTaps was initial set to always , then set back to handled to avoid the bug that we can‚Äôt press any button in tab bar while keyboard is open https://github.com/react-native-community/react-native-tab-view/issues/375 But this TabBar has nothing with our problem, because it‚Äôs just for containing tab bar buttons. Swiping in createMaterialTopTabNavigatorTaking another look at createMaterialTopTabNavigator we see more imports from react-native-tab-view import { TabView, PagerPan } from &apos;react-native-tab-view&apos;;TabView has swipeEnabled passed in return ( &lt;TabView {...rest} navigationState={navigation.state} animationEnabled={animationEnabled} swipeEnabled={swipeEnabled} onAnimationEnd={this._handleAnimationEnd} onIndexChange={this._handleIndexChange} onSwipeStart={this._handleSwipeStart} renderPager={renderPager} renderTabBar={this._renderTabBar} renderScene={ /* $FlowFixMe */ this._renderScene } /&gt; );and it renders PagerDefault, which in turn uses PagerScroll for iOS import { Platform } from &apos;react-native&apos;; let Pager; switch (Platform.OS) { case &apos;android&apos;: Pager = require(&apos;./PagerAndroid&apos;).default; break; case &apos;ios&apos;: Pager = require(&apos;./PagerScroll&apos;).default; break; default: Pager = require(&apos;./PagerPan&apos;).default; break; } export default Pager;So PagerScroll uses ScrollView to handle scrolling to match material style that user can scroll between pages, and it has keyboardShouldPersistTaps=‚Äùalways‚Äù which should be correct. return ( &lt;ScrollView horizontal pagingEnabled directionalLockEnabled keyboardDismissMode=&quot;on-drag&quot; keyboardShouldPersistTaps=&quot;always&quot;So nothing looks suspicious in react-navigation , which urges me to look at code from my project. Debugging FlatList, SectionList and ScrollViewLike I stated in the beginning of this article, the root problem is that we need to declare keyboardShouldPersistTaps for all parent ScrollView in the hierarchy. That means to look out for any FlatList, SectionList and ScrollView Luckily, there is react-devtools that shows tree of all rendered components in react app, and that is also guided in Debugging section of react native. You can use the standalone version of React Developer Tools to debug the React component hierarchy. To use it, install the react-devtools package globally: npm install -g react-devtoolsSo after searching I found out that there is a SectionList up the hierarchy that should have keyboardShouldPersistTaps=‚Äôalways‚Äô while it didn‚Äôt. Taking a thorough look at the code, I found out that the Modal is trigged from a SectionList item. We already know that triggering Modal in react native means that to embed that Modal inside the view hierarchy and control its visibility via a state. So in terms of view and component, that Modal is inside a SectionList . And for your interest, if you dive deep into react native code, SectionList in my case is just VirtualizedSectionList , which is VirtualizedList, which uses ScrollView So after I declare keyboardShouldPersistTaps=‚Äôalways‚Äô in that SectionList , the problem is solved. User can now just enters some values in the text inputs, then press once on the submit button to submit data. The button now captures touch events first instead of scrollview. Where to go from hereThe solution for this is fortunately simple as it involves fixing our code without having to alter react-navigation code. But it‚Äôs good to look at the library code to know what it does, and to trace where the problem originates. Thanks for following such long exploring and hope you learn something.","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"}]},{"title":"How to structure your project and manage static resources in React Native","slug":"How-to-structure-your-project-and-manage-static-resources-in-React-Native","date":"2019-05-23T05:48:09.000Z","updated":"2019-08-16T07:03:26.000Z","comments":true,"path":"blog/How-to-structure-your-project-and-manage-static-resources-in-React-Native/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-structure-your-project-and-manage-static-resources-in-React-Native/","excerpt":"","text":"Issue #256 Original post https://medium.freecodecamp.org/how-to-structure-your-project-and-manage-static-resources-in-react-native-6f4cfc947d92 React and React Native are just frameworks, and they do not dictate how we should structure our projects. It all depends on your personal taste and the project you‚Äôre working on. In this post, we will go through how to structure a project and how to manage local assets. This of course is not written in stone, and you are free to apply only the pieces that suit you. Hope you learn something. For a project bootstrapped with react-native init , we get only the basic structure. There is the ios folder for Xcode projects, the android folder for Android projects, and an index.js and an App.js file for the React Native starting point. ios/ android/ index.js App.jsAs someone who has worked with native on both Windows Phone, iOS and Android, I find that structuring a project all comes down to separating files by type or feature type vs featureSeparating by type means that we organise files by their type. If it is a component, there are container and presentational files. If it is Redux, there are action, reducer, and store files. If it is view, there are JavaScript, HTML, and CSS files. Group by typeredux actions store reducers components container presentational view javascript html cssThis way, we can see the type of each file, and easily run a script toward a certain file type. This is general for all projects, but it does not answer the question ‚Äúwhat is this project about?‚Äù Is it news application? Is it a loyalty app? Is it about nutrition tracking? Organising files by type is for a machine, not for a human. Many times we work on a feature, and finding files to fix in multiple directories is a hassle. It‚Äôs also a pain if we plan to make a framework out of our project, as files are spread across many places. Group by featureA more reasonable solution is to organise files by feature. Files related to a feature should be placed together. And test files should stay close to the source files. Check out this article to learn more. A feature can be related to login, sign up, onboarding, or a user‚Äôs profile. A feature can contain sub-features as long as they belong to the same flow. If we wanted to move the sub feature around, it would be easy, as all related files are already grouped together. My typical project structure based on features looks like this: index.js App.js ios/ android/ src screens login LoginScreen.js LoginNavigator.js onboarding OnboardingNavigator welcome WelcomeScreen.js term TermScreen.js notification NotificationScreen.js main MainNavigator.js news NewsScreen.js profile ProfileScreen.js search SearchScreen.js library package.json components ImageButton.js RoundImage.js utils moveToBottom.js safeArea.js networking API.js Auth.js res package.json strings.js colors.js palette.js fonts.js images.js images logo@2x.png logo@3x.png button@2x.png button@3x.png scripts images.js clear.jsBesides the traditional files App.js and index.js and the ios1 and android folders, I put all the source files inside the src folder. Inside src I have res for resources, library for common files used across features, and screens for a screen of content. As few dependencies as possibleSince React Native is heavily dependent on tons of dependencies, I try to be pretty aware when adding more. In my project I use just react-navigation for navigation. And I‚Äôm not a fan of redux as it adds unneeded complexity. Only add a dependency when you really need it, otherwise you are just setting yourself up for more trouble than value. The thing I like about React is the components. A component is where we define view, style and behavior. React has inline style ‚Äî it‚Äôs like using JavaScript to define script, HTML and CSS. This fits the feature approach we are aiming for. That‚Äôs why I don‚Äôt use styled-components. Since styles are just JavaScript objects, we can just share comment styles in library . srcI like Android a lot, so I name src and res to match its folder conventions. react-native init sets up babel for us. But for a typical JavaScript project, it‚Äôs good to organise files in the src folder. In my electron.js application IconGenerator, I put the source files inside the src folder. This not only helps in terms of organising, but also helps babel transpile the entire folder at once. Just a command and I have the files in src transpiled to dist in a blink. babel ./src --out-dir ./dist --copy-filesScreenReact is based around components. Yup. There are container and presentational components, but we can compose components to build more complex components. They usually end in showing in the full screen. It is called Page in Windows Phone, ViewController in iOS and Activity in Android. The React Native guide mentions screen very often as something that covers the entire space: Mobile apps are rarely made up of a single screen. Managing the presentation of, and transition between, multiple screens is typically handled by what is known as a navigator. index.js or not?Each screen is considered the entry point for each feature. You can rename the LoginScreen.js to index.js by leveraging the Node module feature: Modules don‚Äôt have to be files. We can also create a find-me folder under node_modules and place an index.js file in there. The same require(‚Äòfind-me‚Äô) line will use that folder‚Äôs index.js file So instead of import LoginScreen from ‚Äò./screens/LoginScreen‚Äô , we can just do import LoginScreen from ‚Äò./screens‚Äô. Using index.js results in encapsulation and provides a public interface for the feature. This is all personal taste. I myself prefer explicit naming for a file, hence the name LoginScreen.js. Navigatorreact-navigation seems to be the most popular choice for handling navigation in a React Native app. For a feature like onboarding, there are probably many screens managed by a stack navigation, so there is OnboardingNavigator . You can think of Navigator as something that groups sub screens or features. Since we group by feature, it‚Äôs reasonable to place Navigator inside the feature folder. It basically looks like this: import { createStackNavigator } from &apos;react-navigation&apos; import Welcome from &apos;./Welcome&apos; import Term from &apos;./Term&apos; const routeConfig = { Welcome: { screen: Welcome }, Term: { screen: Term } } const navigatorConfig = { navigationOptions: { header: null } } export default OnboardingNavigator = createStackNavigator(routeConfig, navigatorConfig)libraryThis is the most controversial part of structuring a project. If you don‚Äôt like the name library, you can name it utilities, common, citadel , whatever‚Ä¶ This is not meant for homeless files, but it is where we place common utilities and components that are used by many features. Things like atomic components, wrappers, quick fixes function, networking stuff, and login info are used a lot, and it‚Äôs hard to move them to a specific feature folder. Sometimes we just need to be practical and get the work done. In React Native, we often need to implement a button with an image background in many screens. Here is a simple one that stays inside library/components/ImageButton.js . The components folder is for reusable components, sometimes called atomic components. According to React naming conventions, the first letter should be uppercase. 1234567891011121314151617181920212223242526272829303132333435363738import React from 'react'import &#123; TouchableOpacity, View, Image, Text, StyleSheet &#125; from 'react-native'import images from 'res/images'import colors from 'res/colors'export default class ImageButton extends React.Component &#123; render() &#123; return ( &lt;TouchableOpacity style=&#123;styles.touchable&#125; onPress=&#123;this.props.onPress&#125;&gt; &lt;View style=&#123;styles.view&#125;&gt; &lt;Text style=&#123;styles.text&#125;&gt;&#123;this.props.title&#125;&lt;/Text&gt; &lt;/View&gt; &lt;Image source=&#123;images.button&#125; style=&#123;styles.image&#125; /&gt; &lt;/TouchableOpacity&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; view: &#123; position: 'absolute', backgroundColor: 'transparent' &#125;, image: &#123; &#125;, touchable: &#123; alignItems: 'center', justifyContent: 'center' &#125;, text: &#123; color: colors.button, fontSize: 18, textAlign: 'center' &#125;&#125;) And if we want to place the button at the bottom, we use a utility function to prevent code duplication. Here is library/utils/moveToBottom.js: import React from &apos;react&apos; import { View, StyleSheet } from &apos;react-native&apos; function moveToBottom(component) { return ( &lt;View style={styles.container}&gt; {component} &lt;/View&gt; ) } const styles = StyleSheet.create({ container: { flex: 1, justifyContent: &apos;flex-end&apos;, marginBottom: 36 } }) export default moveToBottomUse package.json to avoid relative pathThen somewhere in the src/screens/onboarding/term/Term.js , we can import by using relative paths: import moveToBottom from &apos;../../../../library/utils/move&apos; import ImageButton from &apos;../../../../library/components/ImageButton&apos;This is a big red flag in my eyes. It‚Äôs error prone, as we need to calculate how many .. we need to perform. And if we move feature around, all of the paths need to be recalculated. Since library is meant to be used many places, it‚Äôs good to reference it as an absolute path. In JavaScript there are usually 1000 libraries to a single problem. A quick search on Google reveals tons of libraries to tackle this issue. But we don‚Äôt need another dependency as this is extremely easy to fix. The solution is to turn library into a module so node can find it. Adding package.json to any folder makes it into a Node module . Add package.json inside the library folder with this simple content: { &quot;name&quot;: &quot;library&quot;, &quot;version&quot;: &quot;0.0.1&quot; }Now in Term.js we can easily import things from library because it is now a module: 1234567891011121314151617181920212223242526272829303132333435import React from 'react'import &#123; View, StyleSheet, Image, Text, Button &#125; from 'react-native'import strings from 'res/strings'import palette from 'res/palette'import images from 'res/images'import ImageButton from 'library/components/ImageButton'import moveToBottom from 'library/utils/moveToBottom'export default class Term extends React.Component &#123; render() &#123; return ( &lt;View style=&#123;styles.container&#125;&gt; &lt;Text style=&#123;styles.heading&#125;&gt;&#123;strings.onboarding.term.heading.toUpperCase()&#125;&lt;/Text&gt; &#123; moveToBottom( &lt;ImageButton style=&#123;styles.button&#125; title=&#123;strings.onboarding.term.button.toUpperCase()&#125; /&gt; ) &#125; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; container: &#123; flex: 1, alignItems: 'center' &#125;, heading: &#123; ...palette.heading, ...&#123; marginTop: 72 &#125; &#125;&#125;) resYou may wonder what res/colors, res/strings , res/images and res/fonts are in the above examples. Well, for front end projects, we usually have components and style them using fonts, localised strings, colors, images and styles. JavaScript is a very dynamic language, and it‚Äôs easy to use stringly types everywhere. We could have a bunch of #00B75D color across many files, or Fira as a fontFamily in many Text components. This is error-prone and hard to refactor. Let‚Äôs encapsulate resource usage inside the res folder with safer objects. They look like the examples below: res/colors const colors = { title: &apos;#00B75D&apos;, text: &apos;#0C222B&apos;, button: &apos;#036675&apos; } export default colorsres/strings const strings = { onboarding: { welcome: { heading: &apos;Welcome&apos;, text1: &quot;What you don&apos;t know is what you haven&apos;t learn&quot;, text2: &apos;Visit my GitHub at [https://github.com/onmyway133&apos;](https://github.com/onmyway133&apos;), button: &apos;Log in&apos; }, term: { heading: &apos;Terms and conditions&apos;, button: &apos;Read&apos; } } } export default stringsres/fonts const fonts = { title: &apos;Arial&apos;, text: &apos;SanFrancisco&apos;, code: &apos;Fira&apos; } export default fontsres/images const images = { button: require(&apos;./images/button.png&apos;), logo: require(&apos;./images/logo.png&apos;), placeholder: require(&apos;./images/placeholder.png&apos;) } export default imagesLike library , res files can be access from anywhere, so let‚Äôs make it a module . Add package.json to the res folder: { &quot;name&quot;: &quot;res&quot;, &quot;version&quot;: &quot;0.0.1&quot; }so we can access resource files like normal modules: import strings from &apos;res/strings&apos; import palette from &apos;res/palette&apos; import images from &apos;res/images&apos;Group colors, images, fonts with paletteThe design of the app should be consistent. Certain elements should have the same look and feel so they don‚Äôt confuse the user. For example, the heading Text should use one color, font, and font size. The Image component should use the same placeholder image. In React Native, we already use the name styles with const styles = StyleSheet.create({}) so let‚Äôs use the name palette. Below is my simple palette. It defines common styles for heading and Text: res/paletteimport colors from &apos;./colors&apos; const palette = { heading: { color: colors.title, fontSize: 20, textAlign: &apos;center&apos; }, text: { color: colors.text, fontSize: 17, textAlign: &apos;center&apos; } } export default paletteAnd then we can use them in our screen: const styles = StyleSheet.create({ container: { flex: 1, alignItems: &apos;center&apos; }, heading: {...palette.heading, ...{ marginTop: 72 }} })Here we use the object spread operator to merge palette.heading and our custom style object. This means that we use the styles from palette.heading but also specify more properties. If we were to reskin the app for multiple brands, we could have multiple palettes. This is a really powerful pattern. Generate imagesYou can see that in /src/res/images.js we have properties for each image in the src/res/images folder: const images = { button: require(&apos;./images/button.png&apos;), logo: require(&apos;./images/logo.png&apos;), placeholder: require(&apos;./images/placeholder.png&apos;) } export default imagesThis is tedious to do manually, and we have to update if there‚Äôs changes in image naming convention. Instead, we can add a script to generate the images.js based on the images we have. Add a file at the root of the project /scripts/images.js: 123456789101112131415161718192021222324252627282930313233const fs = require('fs')const imageFileNames = () =&gt; &#123; const array = fs .readdirSync('src/res/images') .filter((file) =&gt; &#123; return file.endsWith('.png') &#125;) .map((file) =&gt; &#123; return file.replace('[@2x](http://twitter.com/2x).png', '').replace('[@3x](http://twitter.com/3x).png', '') &#125;) return Array.from(new Set(array))&#125;const generate = () =&gt; &#123; let properties = imageFileNames() .map((name) =&gt; &#123; return `$&#123;name&#125;: require('./images/$&#123;name&#125;.png')` &#125;) .join(',\\n ') const string = `const images = &#123; $&#123;properties&#125; &#125; export default images ` fs.writeFileSync('src/res/images.js', string, 'utf8')&#125;generate() The cool thing about Node is that we have access to the fs module, which is really good at file processing. Here we simply traverse through images, and update /src/res/images.js accordingly. Whenever we add or change images, we can run: node scripts/images.jsAnd we can also declare the script inside our main package.json : &quot;scripts&quot;: { &quot;start&quot;: &quot;node node_modules/react-native/local-cli/cli.js start&quot;, &quot;test&quot;: &quot;jest&quot;, &quot;lint&quot;: &quot;eslint *.js **/*.js&quot;, &quot;images&quot;: &quot;node scripts/images.js&quot; }Now we can just run npm run images and we get an up-to-date images.js resource file. How about custom fontsReact Native has some custom fonts that may be good enough for your projects. You can also use custom fonts. One thing to note is that Android uses the name of the font file, but iOS uses the full name. You can see the full name in Font Book app, or by inspecting in running app for (NSString* family in [UIFont familyNames]) { NSLog(@&quot;%@&quot;, family); for (NSString* name in [UIFont fontNamesForFamilyName: family]) { NSLog(@&quot;Family name: %@&quot;, name); } }For custom fonts to be registered in iOS, we need to declare UIAppFonts in Info.plist using the file name of the fonts, and for Android, the fonts need to be placed at app/src/main/assets/fonts . It is good practice to name the font file the same as full name. React Native is said to dynamically load custom fonts, but in case you get ‚ÄúUnrecognized font family‚Äù, then simply add those fonts to target within Xcode. Doing this by hand takes time, luckily we have rnpm that can help. First add all the fonts inside res/fonts folder. Then simply declare rnpm in package.json and run react-native link . This should declare UIAppFonts in iOS and move all the fonts into app/src/main/assets/fonts for Android. &quot;rnpm&quot;: { &quot;assets&quot;: [ &quot;./src/res/fonts/&quot; ] }Accessing fonts by name is error prone, we can create a script similar to what we have done with images to generate a safer accession. Add fonts.js to our scripts folder 12345678910111213141516171819202122232425262728293031const fs = require('fs')const fontFileNames = () =&gt; &#123; const array = fs .readdirSync('src/res/fonts') .map((file) =&gt; &#123; return file.replace('.ttf', '') &#125;) return Array.from(new Set(array))&#125;const generate = () =&gt; &#123; const properties = fontFileNames() .map((name) =&gt; &#123; const key = name.replace(/\\s/g, '') return `$&#123;key&#125;: '$&#123;name&#125;'` &#125;) .join(',\\n ') const string = `const fonts = &#123; $&#123;properties&#125; &#125; export default fonts ` fs.writeFileSync('src/res/fonts.js', string, 'utf8')&#125;generate() Now you can use custom font via R namespace. 1234567import R from 'res/R'const styles = StyleSheet.create(&#123; text: &#123; fontFamily: R.fonts.FireCodeNormal &#125;&#125;) The R namespaceThis step depends on personal taste, but I find it more organised if we introduce the R namespace, just like how Android does for assets with the generated R class. Once you externalize your app resources, you can access them using resource IDs that are generated in your project‚Äôs Rclass. This document shows you how to group your resources in your Android project and provide alternative resources for specific device configurations, and then access them from your app code or other XML files. This way, let‚Äôs make a file called R.js in src/res: import strings from &apos;./strings&apos; import images from &apos;./images&apos; import colors from &apos;./colors&apos; import palette from &apos;./palette&apos; const R = { strings, images, colors, palette } export default RAnd access it in the screen: 12345678910111213import R from 'res/R'render() &#123; return ( &lt;SafeAreaView style=&#123;styles.container&#125;&gt; &lt;Image style=&#123;styles.logo&#125; source=&#123;R.images.logo&#125; /&gt; &lt;Image style=&#123;styles.image&#125; source=&#123;R.images.placeholder&#125; /&gt; &lt;Text style=&#123;styles.title&#125;&gt;&#123;R.strings.onboarding.welcome.title.toUpperCase()&#125;&lt;/Text&gt; )&#125; Replace strings with R.strings, colors with R.colors, and images with R.images. With the R annotation, it is clear that we are accessing static assets from the app bundle. This also matches the Airbnb convention for singleton, as our R is now like a global constant. 23.8 Use PascalCase when you export a constructor / class / singleton / function library / bare object. const AirbnbStyleGuide = { es6: { }, } export default AirbnbStyleGuideWhere to go from hereIn this post, I‚Äôve shown you how I think you should structure folders and files in a React Native project. We‚Äôve also learned how to manage resources and access them in a safer manner. I hope you‚Äôve found it useful. Here are some more resources to explore further: Organizing a React Native Project Structuring projects and naming components in React Using index.js for Fun and Public Interfaces","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"}]},{"title":"How to overlay view on another view in React Native","slug":"How-to-overlay-view-on-another-view-in-React-Native","date":"2019-05-22T17:14:43.000Z","updated":"2019-08-14T17:45:54.000Z","comments":true,"path":"blog/How-to-overlay-view-on-another-view-in-React-Native/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-overlay-view-on-another-view-in-React-Native/","excerpt":"","text":"Issue #254 Original post https://stackoverflow.com/a/54108708/1418457 Make our own convenient OverlayContainer. The trick is to use absolute with 100% size 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// @flowimport React from 'react'import &#123; View, StyleSheet &#125; from 'react-native'type Props = &#123; behind: React.Component, front: React.Component, under: React.Component&#125;// Show something on top of otherexport default class OverlayContainer extends React.Component&lt;Props&gt; &#123; render() &#123; const &#123; behind, front, under &#125; = this.props return ( &lt;View style=&#123;styles.container&#125;&gt; &lt;View style=&#123;styles.center&#125;&gt; &lt;View style=&#123;styles.behind&#125;&gt; &#123;behind&#125; &lt;/View&gt; &#123;front&#125; &lt;/View&gt; &#123;under&#125; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; container: &#123; flex: 1, alignItems: 'center', height: 100, justifyContent: 'center', &#125;, center: &#123; width: '100%', height: '100%', alignItems: 'center', justifyContent: 'center', &#125;, behind: &#123; alignItems: 'center', justifyContent: 'center', position: 'absolute', left: 0, top: 0, width: '100%', height: '100%' &#125;&#125;)","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"react native","slug":"react-native","permalink":"https://onmyway133.github.io/tags/react-native/"}]},{"title":"How to remove Cartography in iOS","slug":"How-to-remove-Cartography-in-iOS","date":"2019-05-21T09:11:44.000Z","updated":"2019-11-05T08:31:38.000Z","comments":true,"path":"blog/How-to-remove-Cartography-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-remove-Cartography-in-iOS/","excerpt":"","text":"Issue #252 Read more https://medium.com/flawless-app-stories/how-to-make-auto-layout-more-convenient-in-ios-df3b42fed37f DescriptionThis is a script to remove Cartography, and use plain NSLayoutAnchor syntax.Use Constraint.on() from Sugar.It will change all .swift files recursively under provided folder. 1234Constraint.on( logoImageView.widthAnchor.constraint(equalToConstant: 74), view1.leftAnchor.constraint(equalTo: view2.leftAnchor, constant: 20),) Features Parse recursively Parse a single file Parse each constrain block separately Handle ==, &gt;=, &lt;= Handle center, edges Infer indentation Handle relation with other item Handle relation with constant Handle multiplier Auto import Sugar Infer superView PrepareInstall tool if needed 1brew install yarn How to use 12yarn installyarn start /Users/khoa/path/to/project Code123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300const Glob = require('glob')const Fs = require('fs')function main() &#123; const projectPath = getProjectPath() const files = getAllFiles(projectPath) files.forEach((file) =&gt; &#123; handleFile(file) &#125;)&#125;/// The 1st argument is node, 2nd is index.js, 3rd is pathfunction getProjectPath() &#123; return process.argv[2]&#125;/// Only select `swift` filefunction getAllFiles(projectPath) &#123; if (projectPath.endsWith('.swift')) &#123; return [projectPath] &#125; else &#123; const files = Glob.sync(`$&#123;projectPath&#125;/**/*.swift`) return files &#125;&#125;/// Read file, replace by matches, and write againfunction handleFile(file) &#123; console.log(file) Fs.readFile(file, 'utf8', (error, data) =&gt; &#123; // non greedy `*?` const pattern = '(.)*constrain\\\\(.+\\\\) &#123;\\\\s(\\\\s|.)*?\\\\n(\\\\s)*&#125;' const regex = new RegExp(pattern) let matches = data.match(regex) // RegEx only return the 1st match per execution, let's do a recursion while (matches != null) &#123; const match = matches[0] const indentationLength = findIndentationLength(match) const rawTransforms = handleMatch(match) const transforms = handleSuperview(rawTransforms, match) const statements = handleTransforms(transforms, indentationLength) const string = handleStatements(statements, indentationLength) data = data.replace(match, string) // Examine again matches = data.match(regex) &#125; // Handle import data = handleImport(data) Fs.writeFile(file, data, 'utf8') &#125;)&#125;/// Replace or remove importfunction handleImport(data) &#123; if (data.includes('import Sugar')) &#123; return data.replace('import Cartography', '') &#125; else &#123; return data.replace('import Cartography', 'import Sugar') &#125;&#125;/// Format transform to have `,` and linebreaksfunction handleTransforms(transforms, indentationLength) &#123; let string = '' // Expect the first is always line break if (transforms[0] != '\\n') &#123; transforms.unshift('\\n') &#125; const indentation = makeIndentation(indentationLength + 2) transforms.forEach((line, index) =&gt; &#123; if (line.length &gt; 1) &#123; string = string.concat(indentation + line) if (index &lt; transforms.length - 1) &#123; string = string.concat(',\\n') &#125; &#125; else &#123; string = string.concat('\\n') &#125; &#125;) return string&#125;/// Replace superViewfunction handleSuperview(transforms, match) &#123; const superView = findSuperview(match) if (superView == null) &#123; return transforms &#125; const superViewPattern = ' superView.' transforms = transforms.map((transform) =&gt; &#123; if (transform.includes(superViewPattern)) &#123; return transform.replace(superViewPattern, ` $&#123;superView&#125;.`) &#125; else &#123; return transform &#125; &#125;) return transforms&#125;/// Embed the statements inside `Constraint.on`function handleStatements(statements, indentationLength) &#123; const indentation = makeIndentation(indentationLength) return `$&#123;indentation&#125;Constraint.on($&#123;statements&#125;\\n$&#123;indentation&#125;)`&#125;/// Turn every line into flatten transformed linefunction handleMatch(match) &#123; let lines = match.split('\\n') lines = lines.map((line) =&gt; &#123; return handleLine(line.trim()) &#125;).filter((transforms) =&gt; &#123; return transforms != null &#125;) let flatten = [].concat.apply([], lines) return flatten&#125;/// Check to handle lines, turn them into `LayoutAnchor` statementsfunction handleLine(line) &#123; const itemPattern = '\\\\w*\\\\.\\\\w* (=|&lt;|&gt;)= \\\\w*\\\\.*\\\\..*' const sizePattern = '\\w*\\.\\w* (=|&lt;|&gt;)= (\\s|.)*' if (line.includes('edges == ')) &#123; return handleEdges(line) &#125; else if (line.includes('center == ')) &#123; return handleCenter(line) &#125; else if (hasPattern(line, itemPattern) &amp;&amp; !hasSizeKeywords(line)) &#123; return handleItem(line) &#125; else if (hasPattern(line, sizePattern)) &#123; return handleSize(line) &#125; else if (line.includes('&gt;=') || line.includes('&gt;=')) &#123; return line &#125; else if (line.includes('.')) &#123; // return the line itself to let the human fix return line &#125; else if (line.length == 0) &#123; return ['\\n'] &#125; else &#123; return null &#125;&#125;/// For ex: listView.bottom == listView.superview!.bottom - 43/// listView.bottom == listView.superview!.bottom - Metrics.BackButtonWidthfunction handleItem(line) &#123; const equalSign = getEqualSign(line) const parts = line.split(` $&#123;equalSign&#125; `) const left = parts[0] let rightParts = parts[1].trim() let right = rightParts.split(' ')[0] let number = rightParts.replace(right, '').replace('- ', '-').trim() if (number.startsWith('+ ')) &#123; number = number.slice(2) &#125; let equal = getEqual(line) if (number == null || number.length == 0 ) &#123; return [ `$&#123;left&#125;Anchor.constraint($&#123;equal&#125;: $&#123;right&#125;Anchor)` ] &#125; else &#123; return [ `$&#123;left&#125;Anchor.constraint($&#123;equal&#125;: $&#123;right&#125;Anchor, constant: $&#123;number&#125;)` ] &#125;&#125;/// For ex: segmentedControl.height == 24/// backButton.width == Metrics.BackButtonWidthfunction handleSize(line) &#123; const equalSign = getEqualSign(line) const parts = line.split(` $&#123;equalSign&#125; `) const left = parts[0] const right = parts[1] let equal = getEqual(line) return [ `$&#123;left&#125;Anchor.constraint($&#123;equal&#125;Constant: $&#123;right&#125;)` ]&#125;/// For ex: mapView.edges == listView.edgesfunction handleEdges(line) &#123; const parts = line.split(' == ') const left = parts[0].split('.')[0] const right = removeLastPart(parts[1]) return [ `$&#123;left&#125;.topAnchor.constraint(equalTo: $&#123;right&#125;.topAnchor)`, `$&#123;left&#125;.bottomAnchor.constraint(equalTo: $&#123;right&#125;.bottomAnchor)`, `$&#123;left&#125;.leftAnchor.constraint(equalTo: $&#123;right&#125;.leftAnchor)`, `$&#123;left&#125;.rightAnchor.constraint(equalTo: $&#123;right&#125;.rightAnchor)` ]&#125;/// For ex: mapView.center == listView.centerfunction handleCenter(line) &#123; const parts = line.split(' == ') const left = parts[0].split('.')[0] const right = removeLastPart(parts[1]) return [ `$&#123;left&#125;.centerXAnchor.constraint(equalTo: $&#123;right&#125;.centerXAnchor)`, `$&#123;left&#125;.centerYAnchor.constraint(equalTo: $&#123;right&#125;.centerYAnchor)` ]&#125;function hasPattern(string, pattern) &#123; const regex = new RegExp(pattern) let matches = string.match(regex) if (matches == null) &#123; return false &#125; matches = matches.filter((match) =&gt; &#123; return match !== undefined &amp;&amp; match.length &gt; 1 &#125;) return matches.length &gt; 0&#125;function removeLastPart(string) &#123; const parts = string.split('.') parts.pop() return parts.join('.')&#125;function getEqual(line) &#123; if (line.includes('==')) &#123; return 'equalTo' &#125; else if (line.includes('&lt;=')) &#123; return 'lessThanOrEqualTo' &#125; else &#123; return 'greaterThanOrEqualTo' &#125;&#125;function getEqualSign(line) &#123; if (line.includes('==')) &#123; return '==' &#125; else if (line.includes('&gt;=')) &#123; return '&gt;=' &#125; else &#123; return '&lt;=' &#125;&#125;function findIndentationLength(match) &#123; return match.split('constrain')[0].length + 1&#125;function makeIndentation(length) &#123; return Array(length).join(' ')&#125;// For ex: constrain(tableView, headerView, view) &#123; tableView, headerView, superView infunction findSuperview(match) &#123; const line = match.split('\\n')[0] if (!line.includes(' superView in')) &#123; return null &#125; const pattern = ', \\\\w*\\\\)' const regex = RegExp(pattern) const string = line.match(regex)[0] // `, view) return string.replace(', ', '').replace(')', '')&#125;// Check special size keywordsfunction hasSizeKeywords(line) &#123; const keywords = ['Metrics', 'Dimensions', 'UIScreen'] return keywords.filter((keyword) =&gt; &#123; return line.includes(keyword) &#125;).length != 0&#125;main()","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"},{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"},{"name":"script","slug":"script","permalink":"https://onmyway133.github.io/tags/script/"}]},{"title":"How to sort strings with number in Javascript","slug":"How-to-sort-strings-with-number-in-Javascript","date":"2019-05-21T09:08:50.000Z","updated":"2019-09-03T10:36:30.000Z","comments":true,"path":"blog/How-to-sort-strings-with-number-in-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-sort-strings-with-number-in-Javascript/","excerpt":"","text":"Issue #251 123456789101112131415161718192021222324252627282930313233function sort() &#123; const string = `- Favorite WWDC 2017 sessions https://github.com/onmyway133/blog/issues/56- Favorite WWDC 2018 sessions https://github.com/onmyway133/blog/issues/245- How to do clustering with Google Maps in iOS https://github.com/onmyway133/blog/issues/191` const lines = string .split('\\n') .filter((line) =&gt; &#123; return line.length &gt; 0 &#125;) .map((line) =&gt; &#123; let parts = line.trimEnd().split(' ') let lastPart = parts[parts.length-1] let number = lastPart.replace('https://github.com/onmyway133/blog/issues/', '') return &#123; line, number: parseInt(number) &#125; &#125;) lines.sort((a, b) =&gt; &#123; return (a.number &lt; b.number) ? -1 : 1 &#125;) const sortedString = lines .map((tuple) =&gt; &#123; return tuple.line &#125;) .join('\\n') console.log(sortedString)&#125; Then node index.js","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"Favorite WWDC 2018 sessions","slug":"Favorite-WWDC-2018-sessions","date":"2019-05-19T16:33:17.000Z","updated":"2019-09-09T06:30:08.000Z","comments":true,"path":"blog/Favorite-WWDC-2018-sessions/","link":"","permalink":"https://onmyway133.github.io/blog/Favorite-WWDC-2018-sessions/","excerpt":"","text":"Issue #245 Original post https://medium.com/fantageek/my-favourite-wwdc-2018-sessions-363d3fc9c9d5 Favourite WWDC 2018 sessionsThis year I failed the lottery ticket to WWDC, and I also missed the keynote live stream because I was sailing on the Christian Radich outside Oslo fjord that day. Luckily all the videos are available on Apple Developer site very shortly, and we can watch them now on Chrome or the unofficial WWDC app on macOS. I recommend the WWDC macOS app as it allows to mark favourites and filter, also offers the ability to adjust play speed to 1.25 or 1.5 saves me some time watching. This year WWDC focuses a lot on privacy, stability, and speed, which are all I wish, so many thanks to Apple engineers who made that happen, and the resit to install the so called more stable iOS 12 is real. As an iOS engineers, I like to focus more about the necessary things to me, that is about the Swift programming language, new changes in Cocoa Touch, enhancements in Xcode and testing tricks. I also like to explore more about machine learning so I‚Äôm very glad that Apple is investing more into this technology with the introduction of Turi Create and Create ML. To me, APIs come and get deprecated very often and it‚Äôs good to know them, but the most important thing is to invest in your programming, debugging and testing skill which you can apply in many other platforms. Continued from last year favourites list, below are my favourite sessions with personal notes. Things are listed in no particular order. Hope you find it useful. Platforms State of the UnionIf you don‚Äôt have time, you should watch only this session. Platform State of the Union is like keynote for developers as it highlights important changes. Privacy: Apple confirms on its commitment in privacy and security, also introduces password management feature and auto fill on iOS 12. Generating strong password, integrating with 3rd password management and quickly populating OTP field from SMS message have never been easier. GateKeeper gets some improvements as well and begins to require app to be notarised. iOS 12: huge improvement in performance, Siri gets smarter with Shortcut support, group calling in FaceTime and grouped notification. Also for emoji fan, Memoji was introduced. macOS 10.14 Mojave: more with Dark Mode. They demo mostly with Xcode in dark mode, which looks so cool. This year WWDC banner give hints about iOS and macOS cross-platform apps, which is partially true with Marzipan, a way to allow iOS apps to run on the mac. Xcode 10: with improvements in code editing and source control changes bar indicator. Debugging with memory debug tool, LLDB performance enhancement and particular the new build system completely rewritten in Swift with parallel tasks are exciting news. Swift 4.2: if you follow swift repo then Swift 4.2 may not be very surprising. There are also announcements for Swift 5 plan. Machine Learning: is never hotter than this. This year we see huge investments in machine learning with Create ML, Turi Create, Natural Language frameworks, CoreML 2, new detection capabilities in Vision. ARKit 2, watchOS 5, tvOS 12, AppStore Connect and AppStore Connect APIs are some other important news you don‚Äôt want to miss. What‚Äôs new in Swift Together with this session, I recommend you to read What‚Äôs new in Swift 4.2 summary which is very succinct. Besides improvement in complication and runtime, Swift 4.2 offers some new features: iterable enum case, synthesised Equatable and Hashable, handy functions for shuffling, random generating. To me, the need to explicitly handle Implicitly unwrapped optional is also a reasonable change. What‚Äôs New in Cocoa Touch This is a brief introduction to all changes coming to iOS 12, together with tips on how to be a good iOS citizen. Learn what can affect scrolling experience and prefetching technique, memory consumption and automatic backing stores, how to get the best from UIImage and UIImageView . AutoLayout engine got a lot of performance improvement so it won‚Äôt bother you any more. To me the most satisfying is to get all the UIKit notifications and classes reorganised under nested types, which makes code reasoning very easy. Getting the Most out of Playgrounds in Xcode I‚Äôve written about Playground before and I‚Äôm very glad that Apple also invests a lot in it. The way people can interact and train model [Create ML](http://Introducing Create ML) in Playground is mesmerising. People may question how Playground works so well in session‚Äôs demos, but we can‚Äôt resist the new changes coming to Playground like Step by Step execution, markup rendering improvements and also how easy it is to consume custom frameworks. We can also now publish our own Playground through subscription. What‚Äôs New in Core ML Apple starts the machine learning trend last year with the introduction of Core ML. We might be excited and frustrated at the same time as Core ML is powerful but there‚Äôs no way we can customise it. Now the 2 parts tell us how to implement custom layer and model, techniques to reduce model size like quantisation and flexible model. This makes the foundation for improvement in Vision in object tracking and the debut of Natural Language framework. Machine learning has never been easier. What‚Äôs New in TestingI can‚Äôt miss any testing sessions as it is part of every day‚Äôs work. How can your program avoids regression bugs and ready for refactoring without any tests? This session shows improvement in coverage and the introduction of xccov tool to help us build automation on top of coverage report. Parallel distributed testing in Xcode 10 can save us some time to have coffee. Another wonderful news is that tests have multiple order execution mode to avoid bugs due to implicit dependencies. Testing Tips &amp; Tricks üåü This is my most favourite. The session starts with a pyramid of tests with unit integration and end-to-end test analogy explanation, then to some very cool tips and tricks. Testing network request: I like the separation of APIRequest and APIRequestLoader with URLSession , dependency injection with default parameter and the customisation of URLProtocol in URLSessionConfiguration Testing notification: Notification is system wide and I try to avoid it as much as possible. This shows how to inject dependency with default parameter and use of own NotificationCenter instead of NotificationCenter.default to ease testing Testing location: build abstraction with LocationProvider and LocationFetcher . How to use custom protocol and protocol for delegate to mock during test Testing timer: how to use and mock RunLoop behaviour with Timer Advanced Debugging with Xcode and LLDB LLDB has been improved to enable to debugging reliability experience, issues with AST context corruption, Swift type resolution are now things in the past. We can review how to use some common LLDB commands with handy arguments, and how to use Xcode breakpoint to its best. A Tour of UICollectionView üåü I begin to use UICollectionView more than UITableView , and it also has same code as NSCollectionView,which is more comfortable solution than the horrible NSTableView . Item size in UICollectionViewLayout : I often rely on UICollectionViewDelegateFlowLayout to specify item size but after watching this session, I feel like moving size related code to Layout object feels more like a good way to go Mosaic layout: This is not new, but good to watch again. You learn how to implement custom layout using cached layout attributes Data Source update: I didn‚Äôt expect Apple mentions this, but it is a good lesson on how UICollectionView handles batch update. I ‚Äòve written about this before in my A better way to update UICollectionView data in Swift with diff framework and that post gets a lot of attractions. In this session we need to remember that *ordering matters in data source update, but not in collection view update *‚ùóÔ∏è‚ùóÔ∏è‚ùóÔ∏è Swift Generics Generic was a core feature of Swift since the beginning, we all know that it helps us to implement generic code that can work with many types in a type safe manner. This session reminds that I ‚Äòve never learned enough, especially the reasonable design behind it. The sessions showcases Collection protocol and its protocol inheritances: MutableCollection , BidirectionalCollection , RandomAccessCollection and how they can be combined to provide generic functionalities for conformers. The associatedtype requirement in each protocol, especially Index and Element, is very minimal and has enough constraints for the protocol to implement lots of necessary functionalities in its protocol extension, which is eye opening for me. I very like to read open source, so looking at the source code for such protocols helps me understand more. The part about Fisher Yates shuffle algorithm details how we can come up with necessary protocol while still make them generic Pay attention to when they mention count and map , you can learn more how each concrete type can hook into the customisation point in protocol extension Finally learn the Liskov substitution principle with protocol in class inheritance. You should also Using Collections Effectively for how to utilise handy functions in Collection. Data You Can Trust Although Codable has a lot to offers in term of data integrity, this is good to know about to make sure the data you receive is actually the right data in correct format and structure. CommonCrypto is also part of new iOS SDK so you don‚Äôt need my Arcane library to handle encryption and hashing in your apps. Embracing Algorithms This is the most pleasant to watch as it is like a conversation between the speaker and the imaginary manager Crusty. Here I learn how to be aware of algorithm complexity and also how to utilise built in Foundation functions which are already optimised for performance. After this session I can‚Äôt help myself but going to Swift repo to read the Algorithms.swift file immediately. Image and Graphics Best Practices Learn how image encoding and decoding works through data and image buffer and how that affects memory and performance. There are techniques like downsampling that can tackle this problem. This also recommends against using backing store, and instead, use UIImageView A Guide to Turi Create I‚Äôve written about Turi Create before, but it is just scratching the surface of the many tasks offered by Turi. This year Apple releases Turi Create 5 with style transfer task, Vision Feature Print, GPU acceleration and recommender model improvements. I can‚Äôt wait to explore. And if you take a look at MLDataTable in Create ML framework, it looks like this has Turi ‚Äòs SFrame under the hood. That‚Äôs it. Thanks for reading. What are your favourite sessions this year? Please share in the comment section below","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to shake NSView in macOS","slug":"How-to-shake-NSView-in-macOS","date":"2019-05-15T06:00:57.000Z","updated":"2019-06-26T06:10:00.000Z","comments":true,"path":"blog/How-to-shake-NSView-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-shake-NSView-in-macOS/","excerpt":"","text":"Issue #233 12345678910let midX = box.layer?.position.x ?? 0let midY = box.layer?.position.y ?? 0let animation = CABasicAnimation(keyPath: \"position\")animation.duration = 0.06animation.repeatCount = 4animation.autoreverses = trueanimation.fromValue = CGPoint(x: midX - 10, y: midY)animation.toValue = CGPoint(x: midX + 10, y: midY)box.layer?.add(animation, forKey: \"position\") And for iOS 12345678extension UIView &#123; func shake() &#123; self.transform = CGAffineTransform(translationX: 16, y: 0) UIView.animate(withDuration: 0.4, delay: 0, usingSpringWithDamping: 0.2, initialSpringVelocity: 1, options: .curveEaseInOut, animations: &#123; self.transform = CGAffineTransform.identity &#125;, completion: nil) &#125;&#125;","categories":[],"tags":[]},{"title":"How to make simple search box in iOS","slug":"How-to-make-simple-search-box-in-iOS","date":"2019-05-07T12:30:28.000Z","updated":"2019-08-01T04:48:11.000Z","comments":true,"path":"blog/How-to-make-simple-search-box-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-simple-search-box-in-iOS/","excerpt":"","text":"Issue #227 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162final class SearchBox: UIView &#123; lazy var textField: UITextField = &#123; let textField = UITextField() let imageView = UIImageView(image: R.image.search()!) imageView.frame.size = CGSize(width: 20 + 8, height: 20) imageView.contentMode = .scaleAspectFit textField.leftView = imageView textField.leftViewMode = .always return textField &#125;() lazy var filterButton: UIButton = &#123; let button = UIButton(type: .custom) button.setImage(R.image.filter()!, for: .normal) button.imageEdgeInsets = UIEdgeInsets(top: 10, left: 10, bottom: 10, right: 10) return button &#125;() lazy var backView: UIView = &#123; let view = UIView() view.backgroundColor = .white view.layer.cornerRadius = 10 view.layer.borderColor = R.color.lightGray.cgColor view.layer.borderWidth = 0.5 view.layer.shadowOffset = CGSize(width: 1, height: 1) view.layer.shadowOpacity = 0.8 view.layer.shadowColor = R.color.lightGray.cgColor return view &#125;() override init(frame: CGRect) &#123; super.init(frame: frame) setup() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; private func setup() &#123; addSubviews([backView, textField, filterButton]) NSLayoutConstraint.on([ filterButton.rightAnchor.constraint(equalTo: rightAnchor, constant: -8), filterButton.centerYAnchor.constraint(equalTo: centerYAnchor), filterButton.heightAnchor.constraint(equalToConstant: 44), filterButton.widthAnchor.constraint(equalToConstant: 44), textField.centerYAnchor.constraint(equalTo: centerYAnchor), textField.leftAnchor.constraint(equalTo: leftAnchor, constant: 16), textField.rightAnchor.constraint(equalTo: filterButton.leftAnchor, constant: -8) ]) NSLayoutConstraint.on([ backView.pinEdges(view: self, inset: UIEdgeInsets(top: 4, left: 4, bottom: -4, right: -4)) ]) &#125;&#125; To apply padding to leftView, increase width and use contentMode 12imageView.frame.size = CGSize(width: 20 + 8, height: 20)imageView.contentMode = .scaleAspectFit To make image in button smaller, use imageEdgeInsets with all positive valuesTo have round and shadow, specify shadowOpacity, cornerRadius, shadowOffset","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use Stripe and Apple Pay in iOS","slug":"How-to-use-Stripe-and-Apple-Pay-in-iOS","date":"2019-04-30T09:12:12.000Z","updated":"2019-08-14T08:58:44.000Z","comments":true,"path":"blog/How-to-use-Stripe-and-Apple-Pay-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Stripe-and-Apple-Pay-in-iOS/","excerpt":"","text":"Issue #219 iOS Integration Setting Up Apple Pay Requirements Apple Pay Show basic add card in iOS12345678910111213141516171819202122232425import UIKitimport Stripefinal class MainController: UIViewController &#123; func showPayment() &#123; let addCardViewController = STPAddCardViewController() addCardViewController.delegate = self let navigationController = UINavigationController(rootViewController: addCardViewController) present(navigationController, animated: true, completion: nil) &#125;&#125;extension MainController: STPAddCardViewControllerDelegate &#123; func addCardViewControllerDidCancel(_ addCardViewController: STPAddCardViewController) &#123; dismiss(animated: true, completion: nil) &#125; func addCardViewController(_ addCardViewController: STPAddCardViewController, didCreateToken token: STPToken, completion: @escaping STPErrorBlock) &#123; _ = token.tokenId completion(nil) dismiss(animated: true, completion: nil) &#125;&#125; Generate ephemeral keyhttps://stripe.com/docs/mobile/ios/standard#ephemeral-key In order for our prebuilt UI elements to function, you‚Äôll need to provide them with an ephemeral key, a short-lived API key with restricted API access. You can think of an ephemeral key as a session, authorizing the SDK to retrieve and update a specific Customer object for the duration of the session. Backend in Gohttps://github.com/stripe/stripe-go Need a secret key by going to Stripe dashboard -&gt; Developers -&gt; API keys -&gt; Secret key 1stripe.Key = &quot;sk_key&quot; Need customer id. We can manually create one in Stripe dashboard -&gt; Customers 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package mainimport ( \"net\" \"encoding/json\" \"fmt\" \"net/http\" \"github.com/stripe/stripe-go\" \"github.com/stripe/stripe-go/ephemeralkey\")func main() &#123; stripe.Key = \"sk_test_mM2MkqO61n7vvbVRfeYmBgWm00Si2PtWab\" http.HandleFunc(\"/ephemeral_keys\", generateEphemeralKey) if err := http.ListenAndServe(\":8080\", nil); err != nil &#123; panic(err) &#125;&#125;type EphemeralKeysRequest struct &#123; ApiVersion string `json:\"api_version\"`&#125;func generateEphemeralKey(w http.ResponseWriter, r *http.Request) &#123; customerId := \"cus_Eys6aeP5xR89ab\" decoder := json.NewDecoder(r.Body) var t EphemeralKeysRequest err := decoder.Decode(&amp;t) if err != nil &#123; panic(err) &#125; stripeVersion := t.ApiVersion if stripeVersion == \"\" &#123; log.Printf(\"Stripe-Version not found\\n\") w.WriteHeader(400) return &#125; params := &amp;stripe.EphemeralKeyParams&#123; Customer: stripe.String(customerId), StripeVersion: stripe.String(stripeVersion), &#125; key, err := ephemeralkey.New(params) if err != nil &#123; log.Printf(\"Stripe bindings call failed, %v\\n\", err) w.WriteHeader(500) return &#125; w.Write(key.RawJSON)&#125; iOS clientNetworking client uses How to make simple networking client in Swift Need an object that conforms to STPCustomerEphemeralKeyProvider 123456789101112131415161718192021final class EphemeralKeyClient: NSObject, STPCustomerEphemeralKeyProvider &#123; let client = NetworkClient(baseUrl: URL(string: \"http://localhost:8080\")!) func createCustomerKey(withAPIVersion apiVersion: String, completion: @escaping STPJSONResponseCompletionBlock) &#123; var options = Options() options.httpMethod = .post options.path = \"ephemeral_keys\" options.parameters = [ \"api_version\": apiVersion ] client.makeJson(options: options, completion: &#123; result in switch result &#123; case .success(let json): completion(json, nil) case .failure(let error): completion(nil, error) &#125; &#125;) &#125;&#125; Setting up STPCustomerContext and STPPaymentContext 123456789101112131415161718192021final class MainController: UIViewController &#123; let client = EphemeralKeyClient() let customerContext: STPCustomerContext let paymentContext: STPPaymentContext init() &#123; self.customerContext = STPCustomerContext(keyProvider: client) self.paymentContext = STPPaymentContext(customerContext: customerContext) super.init(nibName: nil, bundle: nil) paymentContext.delegate = self paymentContext.hostViewController = self &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError(\"init(coder:) has not been implemented\") &#125; func start() &#123; paymentContext.presentShippingViewController() &#125;&#125; Handle chargehttps://stripe.com/docs/charges Backend in GoIf we use stripe_id from card, which has the form of card_xxx, we need to include customer info If we use token, which has the form tok_xxx, then no need for customer info From STPPaymentResult When you‚Äôre using STPPaymentContext to request your user‚Äôs payment details, this is the object that will be returned to your application when they‚Äôve successfully made a payment. It currently just contains a source, but in the future will include any relevant metadata as well. You should pass source.stripeID to your server, and call the charge creation endpoint. This assumes you are charging a Customer, so you should specify the customer parameter to be that customer‚Äôs ID and the source parameter to the value returned here. For more information, see https://stripe.com/docs/api#create_charge 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package mainimport ( \"net\" \"encoding/json\" \"fmt\" \"net/http\" \"log\" \"os\" \"github.com/stripe/stripe-go/charge\")func main() &#123; stripe.Key = \"sk_test_mM2MkqO61n7vvbVRfeYmBgWm00Si2PtWab\" http.HandleFunc(\"/request_charge\", handleCharge) if err := http.ListenAndServe(\":8080\", nil); err != nil &#123; panic(err) &#125;&#125;var customerId = \"cus_Eys6aeP5xR89ab\"type PaymentResult struct &#123; StripeId string `json:\"stripe_id\"`&#125;func handleCharge(w http.ResponseWriter, r *http.Request) &#123; decoder := json.NewDecoder(r.Body) var t PaymentResult err := decoder.Decode(&amp;t) if err != nil &#123; panic(err) &#125; params := &amp;stripe.ChargeParams&#123; Amount: stripe.Int64(150), Currency: stripe.String(string(stripe.CurrencyUSD)), Description: stripe.String(\"Charge from my Go backend\"), Customer: stripe.String(customerId), &#125; params.SetSource(t.StripeId) ch, err := charge.New(params) if err != nil &#123; fmt.Fprintf(w, \"Could not process payment: %v\", err) fmt.Println(ch) w.WriteHeader(400) &#125; w.WriteHeader(200)&#125; iOS client12345678910111213141516171819202122232425262728293031final class PaymentClient &#123; let client = NetworkClient(baseUrl: URL(string: \"http://192.168.210.219:8080\")!) func requestCharge(source: STPSourceProtocol, completion: @escaping (Result&lt;(), Error&gt;) -&gt; Void) &#123; var options = Options() options.httpMethod = .post options.path = \"request_charge\" options.parameters = [ \"stripe_id\": source.stripeID ] client.makeJson(options: options, completion: &#123; result in completion(result.map(&#123; _ in () &#125;)) &#125;) &#125;&#125;paymentContext.requestPayment()extension MainController: STPPaymentContextDelegate &#123; func paymentContext(_ paymentContext: STPPaymentContext, didCreatePaymentResult paymentResult: STPPaymentResult, completion: @escaping STPErrorBlock) &#123; client.requestCharge(source: paymentResult.source, completion: &#123; result in switch result &#123; case .success: completion(nil) case .failure(let error): completion(error) &#125; &#125;) &#125;&#125; Token from cardUse STPAPIClient.shared().createToken to get token from card https://stripe.com/docs/mobile/ios/custom#collecting-card-details 123456789101112131415161718192021let cardParams = STPCardParams()cardParams.number = \"4242424242424242\"cardParams.expMonth = 10cardParams.expYear = 2021cardParams.cvc = \"123\"STPAPIClient.shared().createToken(withCard: cardParams) &#123; (token: STPToken?, error: Error?) in guard let token = token, error == nil else &#123; // Present error to user... return &#125; submitTokenToBackend(token, completion: &#123; (error: Error?) in if let error = error &#123; // Present error to user... &#125; else &#123; // Continue with payment... &#125; &#125;)&#125; Payment options and shipping view controllersInstead of using paymentContext 12paymentContext.pushShippingViewController()paymentContext.pushPaymentOptionsViewController() We can use view controllers https://stripe.com/docs/mobile/ios/custom#stppaymentoptionsviewcontroller directly with STPPaymentOptionsViewController and STPShippingAddressViewController. Then implement STPPaymentOptionsViewControllerDelegate and STPShippingAddressViewControllerDelegate Register merchant Id and Apple Pay certificatehttps://stripe.com/docs/apple-pay/apps Get Certificate signing request file from Stripe https://dashboard.stripe.com/account/apple_pay We can‚Äôt register merchant id with Enterprise account Use Apple PayGo backendUse token 12345678910111213141516171819202122232425262728type ApplePayRequest struct &#123; Token string `json:\"token\"`&#125;func handleChargeUsingApplePay(w http.ResponseWriter, r *http.Request) &#123; decoder := json.NewDecoder(r.Body) var t ApplePayRequest err := decoder.Decode(&amp;t) if err != nil &#123; panic(err) &#125; params := &amp;stripe.ChargeParams&#123; Amount: stripe.Int64(150), Currency: stripe.String(string(stripe.CurrencyUSD)), Description: stripe.String(\"Charge from my Go backend for Apple Pay\"), &#125; params.SetSource(t.Token) ch, err := charge.New(params) if err != nil &#123; fmt.Fprintf(w, \"Could not process payment: %v\", err) fmt.Println(ch) w.WriteHeader(400) &#125; w.WriteHeader(200)&#125; iOS clientUpdate client to send STPToken 1234567891011121314151617181920212223242526final class PaymentClient: NSObject &#123; let client = NetworkClient(baseUrl: URL(string: \"localhost:8080\")!) func requestCharge(token: STPToken, completion: @escaping (Result&lt;(), Error&gt;) -&gt; Void) &#123; var options = Options() options.httpMethod = .post options.path = \"request_charge_apple_pay\" options.parameters = [ \"token\": token.tokenId ] client.make(options: options, completion: &#123; result in completion(result.map(&#123; _ in () &#125;)) &#125;) &#125; func useApplePay(payment: PKPayment, completion: @escaping (Result&lt;(), Error&gt;) -&gt; Void) &#123; STPAPIClient.shared().createToken(with: payment, completion: &#123; (token: STPToken?, error: Error?) in guard let token = token, error == nil else &#123; return &#125; self.requestCharge(token: token, completion: completion) &#125;) &#125;&#125; Use PKPaymentAuthorizationViewController, not PKPaymentAuthorizationController https://developer.apple.com/documentation/passkit/pkpaymentauthorizationcontroller The PKPaymentAuthorizationController class performs the same role as the PKPaymentAuthorizationViewController class, but it does not depend on the UIKit framework. This means that the authorization controller can be used in places where a view controller cannot (for example, in watchOS apps or in SiriKit extensions). 12345678910111213141516171819202122232425262728293031323334353637383940414243extension MainController &#123; func showApplePay() &#123; let merchantId = \"merchant.com.onmyway133.MyApp\" let paymentRequest = Stripe.paymentRequest(withMerchantIdentifier: merchantId, country: \"US\", currency: \"USD\") paymentRequest.paymentSummaryItems = [ PKPaymentSummaryItem(label: \"Rubber duck\", amount: 1.5) ] guard Stripe.canSubmitPaymentRequest(paymentRequest) else &#123; assertionFailure() return &#125; guard let authorizationViewController = PKPaymentAuthorizationViewController(paymentRequest: paymentRequest) else &#123; assertionFailure() return &#125; authorizationViewController.delegate = self innerNavigationController.present(authorizationViewController, animated: true, completion: nil) &#125;&#125;extension MainController: PKPaymentAuthorizationViewControllerDelegate &#123; func paymentAuthorizationViewControllerDidFinish(_ controller: PKPaymentAuthorizationViewController) &#123; controller.dismiss(animated: true, completion: nil) &#125; func paymentAuthorizationViewController( _ controller: PKPaymentAuthorizationViewController, didAuthorizePayment payment: PKPayment, handler completion: @escaping (PKPaymentAuthorizationResult) -&gt; Void) &#123; client.useApplePay(payment: payment, completion: &#123; result in switch result &#123; case .success: completion(.init(status: .success, errors: nil)) case .failure(let error): completion(.init(status: .failure, errors: [error])) &#125; &#125;) &#125;&#125; Showing Apple Pay optionFrom appleMerchantIdentifier The Apple Merchant Identifier to use during Apple Pay transactions. To create one of these, see our guide at https://stripe.com/docs/mobile/apple-pay . You must set this to a valid identifier in order to automatically enable Apple Pay. 12345if Stripe.deviceSupportsApplePay() &#123; STPPaymentConfiguration.shared().appleMerchantIdentifier = \"merchant.com.onmyway133.MyApp\"&#125;paymentContext.pushPaymentOptionsViewController() requestPayment not showing UIFrom requestPayment Requests payment from the user. This may need to present some supplemental UI to the user, in which case it will be presented on the payment context‚Äôs hostViewController. For instance, if they‚Äôve selected Apple Pay as their payment method, calling this method will show the payment sheet. If the user has a card on file, this will use that without presenting any additional UI. After this is called, the paymentContext:didCreatePaymentResult:completion: and paymentContext:didFinishWithStatus:error: methods will be called on the context‚Äôs delegate. Use STPPaymentOptionsViewController to show cards and Apple Pay options Code for requestPayment 12345678910111213141516171819202122232425262728293031323334353637- (void)requestPayment &#123; WEAK(self); [[[self.didAppearPromise voidFlatMap:^STPPromise * _Nonnull&#123; STRONG(self); return self.loadingPromise; &#125;] onSuccess:^(__unused STPPaymentOptionTuple *tuple) &#123; STRONG(self); if (!self) &#123; return; &#125; if (self.state != STPPaymentContextStateNone) &#123; return; &#125; if (!self.selectedPaymentOption) &#123; [self presentPaymentOptionsViewControllerWithNewState:STPPaymentContextStateRequestingPayment]; &#125; else if ([self requestPaymentShouldPresentShippingViewController]) &#123; [self presentShippingViewControllerWithNewState:STPPaymentContextStateRequestingPayment]; &#125; else if ([self.selectedPaymentOption isKindOfClass:[STPCard class]] || [self.selectedPaymentOption isKindOfClass:[STPSource class]]) &#123; self.state = STPPaymentContextStateRequestingPayment; STPPaymentResult *result = [[STPPaymentResult alloc] initWithSource:(id&lt;STPSourceProtocol&gt;)self.selectedPaymentOption]; [self.delegate paymentContext:self didCreatePaymentResult:result completion:^(NSError * _Nullable error) &#123; stpDispatchToMainThreadIfNecessary(^&#123; if (error) &#123; [self didFinishWithStatus:STPPaymentStatusError error:error]; &#125; else &#123; [self didFinishWithStatus:STPPaymentStatusSuccess error:nil]; &#125; &#125;); &#125;]; &#125; else if ([self.selectedPaymentOption isKindOfClass:[STPApplePayPaymentOption class]]) &#123; // .... Payment options123func paymentOptionsViewController(_ paymentOptionsViewController: STPPaymentOptionsViewController, didSelect paymentOption: STPPaymentOption) &#123; // No op&#125; After user selects payment option, the change is saved in dashboard https://dashboard.stripe.com/test/customers, but for card only. Select Apple Pay does not reflect change in web dashboard. Apple pay option is added manually locally, from STPCustomer+SourceTuple.m üò≤ 123456789101112131415161718192021222324252627- (STPPaymentOptionTuple *)filteredSourceTupleForUIWithConfiguration:(STPPaymentConfiguration *)configuration &#123; id&lt;STPPaymentOption&gt; _Nullable selectedMethod = nil; NSMutableArray&lt;id&lt;STPPaymentOption&gt;&gt; *methods = [NSMutableArray array]; for (id&lt;STPSourceProtocol&gt; customerSource in self.sources) &#123; if ([customerSource isKindOfClass:[STPCard class]]) &#123; STPCard *card = (STPCard *)customerSource; [methods addObject:card]; if ([card.stripeID isEqualToString:self.defaultSource.stripeID]) &#123; selectedMethod = card; &#125; &#125; else if ([customerSource isKindOfClass:[STPSource class]]) &#123; STPSource *source = (STPSource *)customerSource; if (source.type == STPSourceTypeCard &amp;&amp; source.cardDetails != nil) &#123; [methods addObject:source]; if ([source.stripeID isEqualToString:self.defaultSource.stripeID]) &#123; selectedMethod = source; &#125; &#125; &#125; &#125; return [STPPaymentOptionTuple tupleWithPaymentOptions:methods selectedPaymentOption:selectedMethod addApplePayOption:configuration.applePayEnabled];&#125; STPApplePayPaymentOptionis not available inpaymentContext.paymentOptions` immediately Change selected payment optionIn STPPaymentContext setSelectedPaymentOption is read only and trigger paymentContextDidChange, but it checks if the new selected payment option is equal to existing selected payment option 1234567891011- (void)setSelectedPaymentOption:(id&lt;STPPaymentOption&gt;)selectedPaymentOption &#123; if (selectedPaymentOption &amp;&amp; ![self.paymentOptions containsObject:selectedPaymentOption]) &#123; self.paymentOptions = [self.paymentOptions arrayByAddingObject:selectedPaymentOption]; &#125; if (![_selectedPaymentOption isEqual:selectedPaymentOption]) &#123; _selectedPaymentOption = selectedPaymentOption; stpDispatchToMainThreadIfNecessary(^&#123; [self.delegate paymentContextDidChange:self]; &#125;); &#125;&#125; There is retryLoading which is called at init 12345678910111213141516171819202122232425262728293031323334353637383940414243444546- (void)retryLoading &#123; // Clear any cached customer object before refetching if ([self.apiAdapter isKindOfClass:[STPCustomerContext class]]) &#123; STPCustomerContext *customerContext = (STPCustomerContext *)self.apiAdapter; [customerContext clearCachedCustomer]; &#125; WEAK(self); self.loadingPromise = [[[STPPromise&lt;STPPaymentOptionTuple *&gt; new] onSuccess:^(STPPaymentOptionTuple *tuple) &#123; STRONG(self); self.paymentOptions = tuple.paymentOptions; self.selectedPaymentOption = tuple.selectedPaymentOption; &#125;] onFailure:^(NSError * _Nonnull error) &#123; STRONG(self); if (self.hostViewController) &#123; [self.didAppearPromise onSuccess:^(__unused id value) &#123; if (self.paymentOptionsViewController) &#123; [self appropriatelyDismissPaymentOptionsViewController:self.paymentOptionsViewController completion:^&#123; [self.delegate paymentContext:self didFailToLoadWithError:error]; &#125;]; &#125; else &#123; [self.delegate paymentContext:self didFailToLoadWithError:error]; &#125; &#125;]; &#125; &#125;]; [self.apiAdapter retrieveCustomer:^(STPCustomer * _Nullable customer, NSError * _Nullable error) &#123; stpDispatchToMainThreadIfNecessary(^&#123; STRONG(self); if (!self) &#123; return; &#125; if (error) &#123; [self.loadingPromise fail:error]; return; &#125; if (!self.shippingAddress &amp;&amp; customer.shippingAddress) &#123; self.shippingAddress = customer.shippingAddress; self.shippingAddressNeedsVerification = YES; &#125; STPPaymentOptionTuple *paymentTuple = [customer filteredSourceTupleForUIWithConfiguration:self.configuration]; [self.loadingPromise succeed:paymentTuple]; &#125;); &#125;];&#125; Which in turns call STPCustomerEphemeralKeyProvider. As stripe does not save Apple Pay option in dashboard, this method return list of card payment options, together with the default card as selected payment option üò≤ Although the new STPCard has a different address, it is the exact same card with the same info, and the isEqual method of STPCard is 1234567891011- (BOOL)isEqualToCard:(nullable STPCard *)other &#123; if (self == other) &#123; return YES; &#125; if (!other || ![other isKindOfClass:self.class]) &#123; return NO; &#125; return [self.stripeID isEqualToString:other.stripeID];&#125; I raised an issue How to change selected payment option? hope it gets resolved soon üò¢","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use Sonarqube in Swift projects","slug":"How-to-use-Sonarqube-in-Swift-projects","date":"2019-04-29T06:20:52.000Z","updated":"2019-10-30T09:02:31.000Z","comments":true,"path":"blog/How-to-use-Sonarqube-in-Swift-projects/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Sonarqube-in-Swift-projects/","excerpt":"","text":"Issue #216 Install Sonarqubehttps://docs.sonarqube.org/latest/setup/get-started-2-minutes/ Download Sonarqube for macOS https://www.sonarqube.org/downloads/ Put it in ~/sonarqube Run localhost server ~/sonarqube/bin/macosx-universal-64/sonar.sh console Login http://localhost:9000 with admin/admin Create new project Install Sonar scannerhttps://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner Download for macOS 64 bit Put it in ~/sonarscanner export PATH=$PATH:/Users/khoa/sonarscanner/bin Go to project, create sonar-project.properties 123456789101112# must be unique in a given SonarQube instancesonar.projectKey=my-app# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.sonar.projectName=My Appsonar.projectVersion=1.0 # Path is relative to the sonar-project.properties file. Replace &quot;\\&quot; by &quot;/&quot; on Windows.# This property is optional if sonar.modules is set. sonar.sources=. # Encoding of the source code. Default is default system encoding#sonar.sourceEncoding=UTF-8 Run sonar-scanner Install swift pluginhttps://github.com/Backelite/sonar-swift Download jar file https://github.com/Backelite/sonar-swift/releases Follow https://docs.sonarqube.org/latest/setup/install-plugin/ Put jar file into ~/sonarqube/extensions/plugins Restart server Copy run-sonar-swift.sh https://github.com/Backelite/sonar-swift/blob/develop/sonar-swift-plugin/src/main/shell/run-sonar-swift.sh to project folder Go to Quality Profile http://localhost:9000/profiles?language=swift Skip some toolsModify run-sonar-swift.sh 123456789vflag=&quot;&quot;nflag=&quot;&quot;unittests=&quot;on&quot;swiftlint=&quot;on&quot;tailor=&quot;off&quot;lizard=&quot;on&quot;oclint=&quot;off&quot;fauxpas=&quot;off&quot;sonarscanner=&quot;&quot; Git ignore123.scannerwork/sonar-reports/compile_commands.json run-sonar-swift.sh Update sonar-project.properties 1234sonar.swift.appScheme=MyApp Stagingsonar.swift.project=MyApp.xcodeprojsonar.swift.workspace=MyApp.xcworkspacesonar.swift.simulator=platform=iOS Simulator,name=iPhone X Ä Run chmod +x run-sonar-swift.sh Run ./run-sonar-swift.sh Troubleshootingfailed with error code: 64 https://github.com/Backelite/sonar-swift/issues/222When run ./run-sonar-swift.sh 1234xcodebuild: error: &apos;&apos;MyApp.xcodeproj&apos;&apos; does not exist.2019-04-29 12:10:17.486 defaults[4134:569992]Domain CFBundleShortVersionString does not exist.Extracting Xcode project informationxcodebuild: error: option &apos;Destination&apos; requires at least one parameter of the form &apos;key=value&apos; üëâ Remove quotes in sonar-project.propertiesüëâ Modify run-sonar-swift.sh, add these before Check for mandatory parameters section Surround by double quotes 1234projectFile=&quot;\\&quot;$projectFile\\&quot;&quot;workspaceFile=&quot;\\&quot;$workspaceFile\\&quot;&quot;appScheme=&quot;\\&quot;$appScheme\\&quot;&quot;destinationSimulator=&quot;\\&quot;$destinationSimulator\\&quot;&quot; üò¢ Does not worküëâ Need to create a scheme name without space Error code 65üëâSpecify team in Xcode project destinationNeed double quotes destinationSimulator=&quot;\\&quot;$destinationSimulator\\&quot;&quot; Use equal sign = 1-destination=&quot;$destinationSimulator&quot; instead of space ‚Äò ‚Äò 1-destination &quot;$destinationSimulator&quot; Metric ‚Äòfiles‚Äô should not be computed by a SensorWhen run sonar-scanner https://github.com/Backelite/sonar-swift/issues/212 1234567891011121314151617181920212223242526272829303132333435363738394041424311:01:14.406 INFO: Sensor JaCoCo XML Report Importer [jacoco]11:01:14.409 DEBUG: No reports found11:01:14.409 INFO: Sensor JaCoCo XML Report Importer [jacoco] (done) | time=3ms11:01:14.409 INFO: Sensor SwiftLint [backelitesonarswiftplugin]11:01:14.417 INFO: Sensor SwiftLint [backelitesonarswiftplugin] (done) | time=8ms11:01:14.417 INFO: Sensor Tailor [backelitesonarswiftplugin]11:01:14.418 INFO: Sensor Tailor [backelitesonarswiftplugin] (done) | time=1ms11:01:14.418 INFO: Sensor OCLint [backelitesonarswiftplugin]11:01:14.419 INFO: Sensor OCLint [backelitesonarswiftplugin] (done) | time=1ms11:01:14.419 INFO: Sensor FauxPas [backelitesonarswiftplugin]11:01:14.419 INFO: Sensor FauxPas [backelitesonarswiftplugin] (done) | time=0ms11:01:14.419 INFO: Sensor Swift Squid [backelitesonarswiftplugin]11:01:14.526 INFO: ------------------------------------------------------------------------11:01:14.526 INFO: EXECUTION FAILURE11:01:14.526 INFO: ------------------------------------------------------------------------11:01:14.527 INFO: Total time: 6.180s11:01:14.603 INFO: Final Memory: 25M/566M11:01:14.603 INFO: ------------------------------------------------------------------------11:01:14.603 ERROR: Error during SonarQube Scanner executionjava.lang.UnsupportedOperationException: Metric &apos;files&apos; should not be computed by a Sensor at org.sonar.scanner.sensor.DefaultSensorStorage.saveMeasure(DefaultSensorStorage.java:168)``` üëâInstall maven https://maven.apache.org/download.cgiEdit `ObjectiveCSquidSensor.java` and `SwiftSquidSensor`, remove line with `CoreMetrics.FILES`Run `export PATH=$PATH:/Users/khoa/apache-maven/bin`Run `./build-and-deploy.sh`Or `~/apache-maven/bin/mvn clean install`üéâ Built jar is in `sonar-swift-plugin/target/backelite-sonar-swift-plugin-0.4.4.jar`, copy back to `extensions/plugins`### How to enable SwiftLint as default profile ü§îüëâ Need to close current Sonar tab and restart server### Testing failed: unable to attach DBModify `run-sonar-swift.sh` to add `-UseModernBuildSystem=NO` to `buildCmd+=(-destination`### slather No coverage directory foundTry running slather coverage ‚Äìinput-format profdata ‚Äìcobertura-xml ‚Äìoutput-directory sonar-reports ‚Äìworkspace MyApp.xcworkspace ‚Äìscheme MyAppStaging MyApp.xcodeproj 12345678üëâ Enable coverage option in scheme -&gt; Test![](https://github.com/SlatherOrg/slather/raw/master/README_Images/test_scheme.png)Optional: declare `.slather.yml` file https://github.com/SlatherOrg/slather### Unable to execute SonarQube 14:53:23.251 ERROR: Error during SonarQube Scanner executionorg.sonarsource.scanner.api.internal.ScannerException: Unable to execute SonarQube at org.sonarsource.scanner.api.internal.IsolatedLauncherFactory.lambda$createLauncher$0(IsolatedLauncherFactory.java:85) 1234üëâStart sonar server### LizardReportParser$SwiftFunction cannot be cast Error during SonarQube Scanner executionjava.lang.ClassCastException: com.backelite.sonarqube.swift.complexity.LizardReportParser$SwiftFunction cannot be cast to org.sonar.api.batch.fs.internal.DefaultInputComponent 12üëâ Run [lizard](https://github.com/terryyin/lizard) manually lizard ‚Äìxml sonar-reports/lizard-report.xml```","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to overload functions in Swift","slug":"How-to-overload-functions-in-Swift","date":"2019-04-18T17:51:10.000Z","updated":"2019-06-27T08:37:06.000Z","comments":true,"path":"blog/How-to-overload-functions-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-overload-functions-in-Swift/","excerpt":"","text":"Issue #211 FunctionFunctions in Swift are distinguishable by parameter label parameter type return type so that these are all valid, and works for subscript as well 12345678910111213141516171819202122232425262728struct A &#123; // return type func get() -&gt; String &#123; return \"\" &#125; func get() -&gt; Int &#123; return 1 &#125; // mix of parameter type and return type func get(param: String) -&gt; String &#123; return \"\" &#125; func get(param: String) -&gt; Int &#123; return 1 &#125; func get(param: Int) -&gt; Int &#123; return 1 &#125; func get(param: Int) -&gt; String &#123; return \"\" &#125; subscript(param: String) -&gt; String &#123; return \"\" &#125; subscript(param: String) -&gt; Int &#123; return 1 &#125; subscript(param: Int) -&gt; Int &#123; return 1 &#125; subscript(param: Int) -&gt; String &#123; return \"\" &#125; // parameter label func set(int: Int) &#123;&#125; func set(string: String) &#123;&#125; // concrete type from generic func get(param: Array&lt;String&gt;) -&gt; String &#123; return \"\" &#125; func get(param: Array&lt;Int&gt;) -&gt; Int &#123; return 1 &#125; subscript(param: Array&lt;String&gt;) -&gt; String &#123; return \"\" &#125; subscript(param: Array&lt;Int&gt;) -&gt; Int &#123; return 1 &#125;&#125; When you specialize a generic type, like Array&lt;Int&gt;, you‚Äôre actually using a concrete type Unfortunately, this does not work for NSObject subclass Method ‚Äòget()‚Äô with Objective-C selector ‚Äòget‚Äô conflicts with previous declaration with the same Objective-C selector 12345class B: NSObject &#123; func get() -&gt; String &#123; return \"\" &#125; func get() -&gt; Int &#123; return 1 &#125;&#125; Generic functionWe can overload generic functions as well 1234567891011func f&lt;T&gt;(t: T) &#123; print(\"T\")&#125;func f(string: String) &#123; print(\"String\")&#125;func f(int: Int) &#123; print(\"Int\")&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to notarize macOS app","slug":"How-to-notarize-macOS-app","date":"2019-04-11T07:17:24.000Z","updated":"2019-08-21T05:58:55.000Z","comments":true,"path":"blog/How-to-notarize-macOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-notarize-macOS-app/","excerpt":"","text":"Issue #203 New Notarization Requirementshttps://developer.apple.com/news/?id=04102019a With the public release of macOS 10.14.5, we require that all developers creating a Developer ID certificate for the first time notarize their apps, and that all new and updated kernel extensions be notarized as well Signing Your Apps for Gatekeeperhttps://developer.apple.com/developer-id/ Unpublished Software. It‚Äôs easy to get unpublished software notarized with the Export process or xcodebuild. Custom build workflows are supported by the xcrun altool command line tool for uploading, and you can use xcrun stapler to attach the ticket to the package. Published Software. To submit software you‚Äôve already published, upload it using the xcrun altool command line tool. Several file types are supported, including .zip, .pkg, and .dmg, so you can upload the same package you already distribute to users. Notarizing Your App Before Distributionhttps://developer.apple.com/documentation/security/notarizing_your_app_before_distribution When you click Next, Xcode uploads your archive to the notary service. When the upload is complete, the notary service begins the scanning process, which usually takes less than an hour. While the notary service scans your software, you can continue to prepare your archive for distribution. For example, you can export the archive and perform any final testing that you require prior to making your software available to customers. When the notarization process finishes, Xcode downloads the ticket and staples it to your archive. At that point, export your archive again to receive a distributable version of your software that includes the notary ticket. Upload a macOS app to be notarizedhttps://help.apple.com/xcode/mac/current/#/dev88332a81e First, upload your macOS app to Apple to be notarized. If the upload fails, view the upload logs to find the problem. For example, you must enable hardened runtime (macOS) before you upload the app. Otherwise, check the notarization status and when the status is ‚ÄúReady for distribution‚Äù, export the app for distribution. Distribute outside the Mac App Store (macOS)https://help.apple.com/xcode/mac/current/#/dev033e997ca In some cases, you may want to distribute an app outside of the Mac App Store. Because the app won‚Äôt be distributed by Apple, assure users that you are a trusted developer by signing your app with a Developer ID certificate. Users gain additional assurance if your Developer ID-signed app is also notarized by Apple. On macOS, if your app isn‚Äôt downloaded from the Mac App Store or signed with a Developer ID certificate, it won‚Äôt launch unless the user completely disables Gatekeeper. Users have the option of enabling or disabling identified developers in System Preferences.","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"How to check file under Library in macOS","slug":"How-to-check-file-under-Library-in-macOS","date":"2019-04-10T18:54:10.000Z","updated":"2019-04-10T18:54:10.000Z","comments":true,"path":"blog/How-to-check-file-under-Library-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-check-file-under-Library-in-macOS/","excerpt":"","text":"Issue #200 123let home = NSSearchPathForDirectoriesInDomains(.applicationScriptsDirectory, .userDomainMask, true).first!let path = home.appending(\".XcodeWayExtensions/XcodeWayScript.scpt\")let exists = FileManager.default.fileExists(atPath: path)","categories":[],"tags":[]},{"title":"How to parse json in Go","slug":"How-to-parse-json-in-Go","date":"2019-04-09T06:29:22.000Z","updated":"2019-04-09T06:59:53.000Z","comments":true,"path":"blog/How-to-parse-json-in-Go/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-parse-json-in-Go/","excerpt":"","text":"Issue #199 Unmarshal using encoding/json property in struct needs to be first letter capitalized 123456789101112131415161718192021222324252627282930313233import ( \"net/http\" \"encoding/json\" \"io/ioutil\" \"fmt\")type MyJsonObject struct &#123; Id string `json:\"id\"` Name string `json:\"name\"`&#125;type MyJsonArray struct &#123; Data []MyJsonObject `json:\"data\"`&#125;func FetchJson() &#123; url := \"https://myapp.com/json\" client := http.Client&#123; Timeout: time.Second * 10 &#125; request, requestError := http.NewRequest(http.MethodGet, url, nil) request.Header.Set(\"User-Agent\", \"myapp\") response, responseError := client.Do(request) body, readError := ioutil.ReadAll(response.Body) fmt.Println(requestError, responseError, readError) myJsonArray := MyJsonArray&#123;&#125; marshalError := json.Unmarshal(body, &amp;myJsonArray) fmt.Println(jsonResponse, marshalError) &#125; MapAnd how to map to another structhttps://gobyexample.com/collection-functions 123456789101112131415161718func Map(vs []JsonStop, f func(JsonStop) *api.Stop) []*api.Stop &#123; vsm := make([]*api.Stop, len(vs)) for i, v := range vs &#123; vsm[i] = f(v) &#125; return vsm&#125;stops := Map(jsonResponse.Data, func(jsonStop JsonStop) *api.Stop &#123; stop := api.Stop&#123; Id: jsonStop.Id, Name: jsonStop.Name, Address: jsonStop.Address, Lat: jsonStop.Lat, Long: jsonStop.Long&#125; return &amp;stop &#125;) json to protobuf Use https://godoc.org/github.com/golang/protobuf/jsonpb","categories":[],"tags":[]},{"title":"How to resolve deep json object in Dart","slug":"How-to-resolve-deep-json-object-in-Dart","date":"2019-04-08T19:50:13.000Z","updated":"2019-09-09T06:29:37.000Z","comments":true,"path":"blog/How-to-resolve-deep-json-object-in-Dart/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-resolve-deep-json-object-in-Dart/","excerpt":"","text":"Issue #198 If we are not on the edge with GRPC and Protocol Buffer, then most likely we are going to deal with Restful and JSON. In one of my Flutter apps I needed to consume JSON JSON and serializationThe guide at https://flutter.dev/docs/development/data-and-backend/json is definitely the way to go. Currently there are 2 ways. One is to manually use dart:convert package 1Map&lt;String, dynamic&gt; user = jsonDecode(jsonString); The other way is to use json_serializable to generate parsing code 123456789101112131415161718192021222324252627import 'package:json_annotation/json_annotation.dart';/// This allows the `User` class to access private members in/// the generated file. The value for this is *.g.dart, where/// the star denotes the source file name.part 'user.g.dart';/// An annotation for the code generator to know that this class needs the/// JSON serialization logic to be generated.@JsonSerializable()class User &#123; User(this.name, this.email); String name; String email; /// A necessary factory constructor for creating a new User instance /// from a map. Pass the map to the generated `_$UserFromJson()` constructor. /// The constructor is named after the source class, in this case User. factory User.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$UserFromJson(json); /// `toJson` is the convention for a class to declare support for serialization /// to JSON. The implementation simply calls the private, generated /// helper method `_$UserToJson`. Map&lt;String, dynamic&gt; toJson() =&gt; _$UserToJson(this);&#125; json_resolveThe problem with manual approach is that it involves lot of boilerplate code, especially when accessing property inside deeply nested json. The problem with code generation approach is that it does not always fit our need and may lack of customization. Therefore I created json_resolve which allows us to access json using keypath, with type checking and safety in mind. The code is small, simple to reason and tested. 1234567891011final String byProperty = resolve(json: json, path: \"movie\", defaultValue: \"error\");expect(byProperty, \"isFun\");final int byInt = resolve(json: json, path: \"earth\", defaultValue: 0);expect(byInt, 199999);final String byIndex = resolve(json: json, path: \"dc.2.name\", defaultValue: \"error\");expect(byIndex, \"Wonder Woman\");final String byIndexThenProperty = resolve(json: json, path: \"marvel.0.appear.1.title\", defaultValue: \"error\");expect(byIndexThenProperty, \"The Dark World\");","categories":[],"tags":[{"name":"dart","slug":"dart","permalink":"https://onmyway133.github.io/tags/dart/"},{"name":"flutter","slug":"flutter","permalink":"https://onmyway133.github.io/tags/flutter/"}]},{"title":"How to generate grpc protobuf files","slug":"How-to-generate-grpc-protobuf-files","date":"2019-04-08T08:40:12.000Z","updated":"2019-08-08T09:07:54.000Z","comments":true,"path":"blog/How-to-generate-grpc-protobuf-files/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-generate-grpc-protobuf-files/","excerpt":"","text":"Issue #197 protochttps://grpc.io/docs/quickstart/go.html Install the protoc compiler that is used to generate gRPC service code. The simplest way to do this is to download pre-compiled binaries for your platform(protoc--.zip) from here: https://github.com/google/protobuf/releases Unzip this file.Update the environment variable PATH to include the path to the protoc binary file. Go protoc pluginhttps://github.com/golang/protobuf 123go get -u github.com/golang/protobuf/protoc-gen-goexport PATH=$PATH:$GOPATH/binsource ~/.zshrc Swift protoc pluginhttps://github.com/grpc/grpc-swift The recommended way to use Swift gRPC is to first define an API using theProtocol Bufferlanguage and then use theProtocol Buffer Compilerand the Swift Protobufand Swift gRPC plugins togenerate the necessary support code. 1234git clone https://github.com/grpc/grpc-swift.gitcd grpc-swiftmakesudo cp protoc-gen-swift protoc-gen-swiftgrpc /usr/local/bin Generate1protoc --swift_out=MyApp/Api --swiftgrpc_out=Client=true,Server=false:MyApp/Api --go_out=plugins=grpc:server/api api.proto In case we need to cd 123cd MyApp/Library/Models/Protoprotoc --swift_out=../Generated --swiftgrpc_out=Client=true,Server=false:../Generated api.proto EmptyIf remote import is needed, then the workaround is to download the that proto locally, for example empty.proto https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/empty.proto Inside SwiftProtobuf pod, there is generated empty.pb.swift 123456789public struct Google_Protobuf_Empty &#123; // SwiftProtobuf.Message conformance is added in an extension below. See the // `Message` and `Message+*Additions` files in the SwiftProtobuf library for // methods supported on all messages. public var unknownFields = SwiftProtobuf.UnknownStorage() public init() &#123;&#125;&#125; To consume, we can 123import SwiftProtobuflet empty = Google_Protobuf_Empty() oneof mode123456message Person &#123; oneof mode &#123; Human human = 1; Superman superman = 2; &#125;&#125; Cannot convert value of type ‚ÄòServer_Person.OneOf_Mode‚Äô to expected argument type ‚ÄòServer_Human‚Äô Need to assign the mode 12var person = Person()person.mode = Person.OneOf_Mode.Human()","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to cache CocoaPods","slug":"How-to-cache-CocoaPods","date":"2019-04-05T08:08:09.000Z","updated":"2019-04-05T08:18:14.000Z","comments":true,"path":"blog/How-to-cache-CocoaPods/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-cache-CocoaPods/","excerpt":"","text":"Issue #196 CocoaPods vs Carthage Carthage or CocoaPods: That is the question CocoaPods will build and compile our frameworks every time whenever you are doing the clean build or run pod install or pod update for the project. Cache Carthage Speeding up Carthage for iOS Applications Faster builds in Xcode with Carthage Cache CocoaPods Improve iOS CI build times with CocoaPods caching üëç Any way to clean only current Xcode project but not Cocoapods dependencies? Pre-compiling dependencies cocoapods-binary üöÄ It will compile the source code of pods during the pod install process, and make CocoaPods use them. Which pod should be compiled is controlled by the flag in Podfile. Xcode 10 new build system CocoaPods and the new Xcode build system Xcode 10 - Clean (missing) vs Clean Build Folder Understanding framework It Looks Like You Are Trying to Use a Framework üöÄ","categories":[],"tags":[]},{"title":"How to build a networking in Swift","slug":"How-to-build-a-networking-in-Swift","date":"2019-04-05T08:03:48.000Z","updated":"2019-07-03T09:05:53.000Z","comments":true,"path":"blog/How-to-build-a-networking-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-build-a-networking-in-Swift/","excerpt":"","text":"Issue #195 Miami https://github.com/onmyway133/Miami Future based builders Should not wrap system API URLSession offer tons of thing that it‚Äôs hard to use with wrappers like Alamofire Parameter encoding is confusing-https://github.com/Alamofire/Alamofire/blob/master/Documentation/Usage.md#parameter-encoding Query and body builder Understanding HTML Form Encoding: URL Encoded and Multipart Forms https://stackoverflow.com/questions/14551194/how-are-parameters-sent-in-an-http-post-request https://stackoverflow.com/questions/1617058/ok-to-skip-slash-before-query-string https://stackoverflow.com/questions/3508338/what-is-the-boundary-in-multipart-form-data How to construct URL with URLComponents and appendPathComponent in Swift HTTP Case sensitivity in HTTP Lazy execution Promise https://github.com/onmyway133/Then Signal and Future https://github.com/onmyway133/archives/tree/master/Signal Catch error How to catch error in ApolloClient Implementation How to cancel DispatchWorkItem and NSOperation Understanding DispatchQueues","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to cancel DispatchWorkItem and NSOperation","slug":"How-to-cancel-DispatchWorkItem-and-NSOperation","date":"2019-04-03T06:50:01.000Z","updated":"2019-09-03T09:40:37.000Z","comments":true,"path":"blog/How-to-cancel-DispatchWorkItem-and-NSOperation/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-cancel-DispatchWorkItem-and-NSOperation/","excerpt":"","text":"Issue #194 DispatchWorkItem https://stackoverflow.com/questions/48844169/swift-ios-dispatchworkitem-is-still-running-even-though-its-getting-cancelled https://stackoverflow.com/questions/29492707/how-to-stop-cancel-suspend-resume-tasks-on-gcd-queue NSOperation https://developer.apple.com/documentation/foundation/nsoperation/1411672-cancel?language=objc Grand Central Dispatch vs NSOperation https://stackoverflow.com/questions/43226434/2017-swift-3-1-gcd-vs-nsoperation https://medium.com/@johnsundell/a-deep-dive-into-grand-central-dispatch-in-swift-dead7f6e1ca7","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to construct URL with URLComponents and appendPathComponent in Swift","slug":"How-to-construct-URL-with-URLComponents-and-appendPathComponent-in-Swift","date":"2019-03-29T10:32:29.000Z","updated":"2019-03-29T10:33:16.000Z","comments":true,"path":"blog/How-to-construct-URL-with-URLComponents-and-appendPathComponent-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-construct-URL-with-URLComponents-and-appendPathComponent-in-Swift/","excerpt":"","text":"Issue #193 123var components = URLComponents(string: \"https://google.com/\")components?.path = \"abc/\"components?.url -&gt; nil 1234var components = URLComponents(string: \"https://google.com/\")components?.path = \"/abc/\"components?.urlcomponents?.queryItems = [URLQueryItem(name: \"q\", value: \"pokemon\")] -&gt; https://google.com/abc/?q=pokemon 123var url = URL(string: \"https://google.com/\")url?.appendPathComponent(\"/abc?q=pokemon\")url -&gt; https://google.com//abc%3Fq=pokemon","categories":[],"tags":[]},{"title":"How to catch error in ApolloClient","slug":"How-to-catch-error-in-ApolloClient","date":"2019-03-28T12:34:07.000Z","updated":"2019-03-28T12:35:55.000Z","comments":true,"path":"blog/How-to-catch-error-in-ApolloClient/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-catch-error-in-ApolloClient/","excerpt":"","text":"Issue #192 Read https://www.apollographql.com/docs/react/features/error-handlingHow to catch actual error https://github.com/apollographql/apollo-client/issues/4016 ü§î 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475import &#123; Observable &#125; from 'apollo-link'import ApolloClient from 'apollo-boost'import Token from 'library/models/Token'import TokenService from './TokenService'import &#123; TokenRefreshException &#125; from 'library/utils/Exception'const client = new ApolloClient(&#123; uri: 'https://www.myapp.no/api/', request: async (operation) =&gt; &#123; const token = await TokenService.loadToken() updateOperation(operation, token) &#125;, onError: (error) =&gt; &#123; console.log('ApolloClient error', error) if (isAuthError(error)) &#123; return handleAuthError(error) &#125; else &#123; return error.forward(error.operation) &#125; &#125;, fetchOptions: &#123; mode: 'no-cors', &#125;&#125;)const isValidErrorCode = (statusCode) =&gt; &#123; if (typeof (statusCode) === 'undefined' || statusCode === null) &#123; return false &#125; else &#123; return true &#125;&#125;const isAuthError = (error) =&gt; &#123; console.log('client error', error) if (error.networkError) &#123; return error.networkError.statusCode === 401 &#125; else &#123; return false &#125;&#125;const handleAuthError = (error) =&gt; &#123; return new Observable((observer) =&gt; &#123; TokenService.refreshToken() .then((token) =&gt; &#123; updateOperation(error.operation, token) &#125;) .then(() =&gt; &#123; const subscriber = &#123; next: observer.next.bind(observer), error: observer.error.bind(observer), complete: observer.complete.bind(observer) &#125; error.forward(error.operation).subscribe(subscriber) &#125;) .catch((e) =&gt; &#123; observer.error(e) &#125;) &#125;)&#125;const updateOperation = (operation, token: Token) =&gt; &#123; const tokenHeader = `$&#123;token.token_type&#125; $&#123;token.access_token&#125;` operation.setContext((context) =&gt; &#123; return &#123; headers: &#123; authorization: tokenHeader, 'Content-Type': 'application/json' &#125; &#125; &#125;)&#125;","categories":[],"tags":[]},{"title":"How to do clustering with Google Maps in iOS","slug":"How-to-do-clustering-with-Google-Maps-in-iOS","date":"2019-03-26T13:23:03.000Z","updated":"2019-10-25T08:47:53.000Z","comments":true,"path":"blog/How-to-do-clustering-with-Google-Maps-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-clustering-with-Google-Maps-in-iOS/","excerpt":"","text":"Issue #191 Basic with Google MapsAdd to Podfile pod &#39;GoogleMaps&#39; Add a custom marker 1234567891011121314151617import GoogleMapsfinal class StopMarker: GMSMarker &#123; let stop: Stop init(stop: Stop) &#123; self.stop = stop super.init() self.title = stop.name self.position = stop.toCoordinate() let imageView = UIImageView(frame: CGRect(x: 0, y: 0, width: 30, height: 30)) imageView.layer.cornerRadius = 15 imageView.image = UIImage(named: \"pin\") self.iconView = imageView &#125;&#125; Show markers 123456789func handle(stops: [Stop]) &#123; self.stops = stops stops .map(&#123; StopMarker(stop: $0) &#125;) .forEach &#123; $0.map = mapView &#125; &#125; Assigning $0.map = mapView means telling GMSMapView to start rendering markers Handle tap 123456789101112131415extension ViewController: GMSMapViewDelegate &#123; func mapView(_ mapView: GMSMapView, didTap marker: GMSMarker) -&gt; Bool &#123; zoomIn(coordinate: marker.position) return false &#125; func mapView(_ mapView: GMSMapView, didTapInfoWindowOf marker: GMSMarker) &#123; guard let stopMarker = marker as? StopMarker else &#123; return &#125; let detailViewController = StopDetailViewController(stop: stopMarker.stop) presentPanModal(detailViewController) &#125;&#125; ClusteringAdd google-maps-ios-utils manually by following https://github.com/googlemaps/google-maps-ios-utils/blob/master/Swift.md Otherwise, with CocoaPods, we get error 1[!] The &apos;Pods-MyApp&apos; target has transitive dependencies that include static binaries: (/Users/khoa/Projects/MyApp/Pods/GoogleMaps/Base/Frameworks/GoogleMapsBase.framework, /Users/khoa/Projects/MyApp/Pods/GoogleMaps/Maps/Frameworks/GoogleMaps.framework, and /Users/khoa/Projects/MyApp/Pods/GoogleMaps/Maps/Frameworks/GoogleMapsCore.framework) Add ClusterItem 123456789101112import Foundationimport CoreLocationclass ClusterItem: NSObject, GMUClusterItem &#123; let position: CLLocationCoordinate2D let stop: Stop init(stop: Stop) &#123; self.stop = stop self.position = stop.toCoordinate() &#125;&#125; Set up cluster manager 123456let iconGenerator = GMUDefaultClusterIconGenerator()let algorithm = GMUNonHierarchicalDistanceBasedAlgorithm()let renderer = GMUDefaultClusterRenderer(mapView: mapView, clusterIconGenerator: iconGenerator)renderer.delegate = selfclusterManager = GMUClusterManager(map: mapView, algorithm: algorithm, renderer: renderer)clusterManager.setDelegate(self, mapDelegate: self) Default algorithm GMUNonHierarchicalDistanceBasedAlgorithm 123456789A simple clustering algorithm with O(nlog n) performance. Resulting clusters are not* hierarchical.* High level algorithm:* 1. Iterate over items in the order they were added (candidate clusters).* 2. Create a cluster with the center of the item.* 3. Add all items that are within a certain distance to the cluster.* 4. Move any items out of an existing cluster if they are closer to another cluster.* 5. Remove those items from the list of candidate clusters.* Clusters have the center of the first element (not the centroid of the items within it). Make ClusterItem and add to clusterManager. In the end, call clusterManager.cluster() 1234567891011func handle(stops: [Stop]) &#123; self.stops = stops stops .map(&#123; StopMarker(stop: $0) &#125;) .forEach &#123; let item = ClusterItem(stop: $0.stop) clusterManager.add(item) &#125; clusterManager.cluster()&#125; By default, clusterManager uses renderer to render default pin marker. Implement GMUClusterRendererDelegate to use our custom StopMarker 12345678910extension ViewController: GMUClusterRendererDelegate &#123; func renderer(_ renderer: GMUClusterRenderer, markerFor object: Any) -&gt; GMSMarker? &#123; switch object &#123; case let clusterItem as ClusterItem: return StopMarker(stop: clusterItem.stop) default: return nil &#125; &#125;&#125; Finally handle tapping on cluster and cluster item 1234567891011extension ViewController: GMUClusterManagerDelegate &#123; func clusterManager(_ clusterManager: GMUClusterManager, didTap cluster: GMUCluster) -&gt; Bool &#123; print(\"tap cluster\") return false &#125; func clusterManager(_ clusterManager: GMUClusterManager, didTap clusterItem: GMUClusterItem) -&gt; Bool &#123; print(\"tap cluster item\") return false &#125;&#125;","categories":[],"tags":[]},{"title":"How to handle file picker in React","slug":"How-to-handle-file-picker-in-React","date":"2019-03-25T12:51:01.000Z","updated":"2019-03-25T12:53:34.000Z","comments":true,"path":"blog/How-to-handle-file-picker-in-React/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-file-picker-in-React/","excerpt":"","text":"Issue #190 1234567891011121314render() &#123; &lt;Button color=\"inherit\" onClick=&#123;this.onImagePress&#125; &gt;Image&lt;/Button&gt; &lt;input ref=\"fileInput\" type=\"file\" id=\"myFile\" multiple accept=\"image/*\" style=&#123;&#123;display: 'none'&#125;&#125; onChange=&#123;this.handleFiles&#125;&gt;&lt;/input&gt;&#125;onImagePress = () =&gt; &#123; const fileInput = this.refs.fileInput fileInput.click()&#125;handleFiles = (e) =&gt; &#123; e.persist() const file = e.target.files[0]&#125;","categories":[],"tags":[]},{"title":"OSS","slug":"OSS","date":"2019-03-25T07:19:13.000Z","updated":"2019-04-15T06:26:17.000Z","comments":true,"path":"blog/OSS/","link":"","permalink":"https://onmyway133.github.io/blog/OSS/","excerpt":"","text":"Issue #189 https://github.com/digipost/ios https://github.com/wwdc/2019 https://github.com/google/science-journal-ios","categories":[],"tags":[]},{"title":"How to fix ApiException  10 in Flutter for Android","slug":"How-to-fix-ApiException-10-in-Flutter-for-Android","date":"2019-03-24T20:17:22.000Z","updated":"2019-10-15T06:27:12.000Z","comments":true,"path":"blog/How-to-fix-ApiException-10-in-Flutter-for-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-ApiException-10-in-Flutter-for-Android/","excerpt":"","text":"Issue #188 Get error com.google.android.gms.common.api.ApiException: 10 with google_sign_in package. Read https://developers.google.com/android/guides/client-auth Certain Google Play services (such as Google Sign-in and App Invites) require you to provide the SHA-1 of your signing certificate so we can create an OAuth2 client and API key for your app console.developers.google.com/apis/credentials Credentials -&gt; OAuth client idIf we specify SHA1 in firebase, then console.developers.google.com will generate an Android oauth for us 1keytool -list -v -keystore &#123;keystore_name&#125; -alias &#123;alias_name&#125; Use correct keystore for debug and release 12345678910buildTypes &#123; release &#123; // TODO: Add your own signing config for the release build. // Signing with the debug keys for now, so `flutter run --release` works. signingConfig signingConfigs.release &#125; debug &#123; signingConfig signingConfigs.debug &#125; &#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"dart","slug":"dart","permalink":"https://onmyway133.github.io/tags/dart/"},{"name":"flutter","slug":"flutter","permalink":"https://onmyway133.github.io/tags/flutter/"}]},{"title":"How to get Google account photo in Flutter","slug":"How-to-get-Google-account-photo-in-Flutter","date":"2019-03-24T20:12:58.000Z","updated":"2019-09-09T06:29:50.000Z","comments":true,"path":"blog/How-to-get-Google-account-photo-in-Flutter/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-Google-account-photo-in-Flutter/","excerpt":"","text":"Issue #187 If you use Flutter, then you can access it via people.googleapis.com endpoint, code uses google_sign_in library 12345678910111213import 'package:google_sign_in/google_sign_in.dart';Future&lt;String&gt; getPhotoUrl(GoogleSignInAccount account, String userId) async &#123; // final authentication = await account.authentication; final url = 'https://people.googleapis.com/v1/people/$&#123;userId&#125;?personFields=photos'; final response = await http.get( url, headers: await account.authHeaders ); final data = json.decode(response.body); return data['photos'].first['url'];&#125; You will get something like 123456&#123; resourceName: people/998812322529259873423, etag: %EgQBAzcabcQBAgUH, photos: [&#123;metadata: &#123;primary: true, source: &#123;type: PROFILE, id: 107721622529987673423&#125;&#125;, url: https://lh3.googleusercontent.com/a-/abcdefmB2p1VWxLsNT9WSV0yqwuwo6o2Ba21sh_ra7CnrZ=s100&#125;]&#125; where url is an accessible image url.","categories":[],"tags":[{"name":"dart","slug":"dart","permalink":"https://onmyway133.github.io/tags/dart/"},{"name":"flutter","slug":"flutter","permalink":"https://onmyway133.github.io/tags/flutter/"}]},{"title":"Getting activity name through HKWorkoutActivityType in HealthKit","slug":"Getting-activity-name-through-HKWorkoutActivityType-in-HealthKit","date":"2019-03-24T20:08:58.000Z","updated":"2019-03-24T20:11:20.000Z","comments":true,"path":"blog/Getting-activity-name-through-HKWorkoutActivityType-in-HealthKit/","link":"","permalink":"https://onmyway133.github.io/blog/Getting-activity-name-through-HKWorkoutActivityType-in-HealthKit/","excerpt":"","text":"Issue #186 After fetching workouts with HKObjectType.workoutType() , we get HKWorkoutActivityType , which is an enum enum HKWorkoutActivityType : UInt . As of Swift 4.2, there are no way to get enum case as String because this enum has type UInt . Though there will be some manual involved, we can build a generator to get all the enum case names. Here we will write code to generate code, and use that generated code to examine all the values. Execute this Swift code in our iOS app 12345678910111213141516func makeCode(string: String) &#123; let pattern = ‚Äúcase \\\\w*‚Äù let range = NSMakeRange(0, string.count-1) let regex = try! NSRegularExpression(pattern: pattern, options: []) regex .matches(in: string, options: [], range: range) .forEach(&#123; result in let start = string.index(string.startIndex, offsetBy: result.range.lowerBound) let end = string.index(string.startIndex, offsetBy: result.range.upperBound) let substring = String(string[start‚Ä¶end]) let name = substring .replacingOccurrences(of: ‚Äúcase‚Äù, with: ‚Äú‚Äù) .replacingOccurrences(of: ‚Äú ‚Äú, with: ‚Äú‚Äù) .replacingOccurrences(of: ‚Äú\\n‚Äù, with: ‚Äú‚Äù print(‚Äúdictionary[HKWorkoutActivityType.\\(name).rawValue] = \\‚Äù\\(name)\\‚Äù‚Äù) &#125;) Where string is all the cases from HKWorkoutActivityType, for example case archeryThe constant for shooting archery. case bowlingThe constant for bowling case fencingThe constant for fencing. case gymnasticsPerforming gymnastics. case trackAndFieldParticipating in track and field events, including shot put, javelin, pole vaulting, and related sports. What the code does is to use regular expression to examine all the names after case , and build our code 12345dictionary[HKWorkoutActivityType.americanFootball.rawValue] = ‚ÄúamericanFootball‚Äùdictionary[HKWorkoutActivityType.archery.rawValue] = ‚Äúarchery‚Äùdictionary[HKWorkoutActivityType.australianFootball.rawValue] = ‚ÄúaustralianFootball‚Äùdictionary[HKWorkoutActivityType.badminton.rawValue] = ‚Äúbadminton‚Äùdictionary[HKWorkoutActivityType.baseball.rawValue] = ‚Äúbaseball‚Äù The above generated code with dictionary contains rawValue as key and the enum case name as value . Later when we get any HKWorkoutActivityType , we can compare with this dictionary to find the actual name. This is better than hardcode activity name with numbers because those rawValue are just implementation detail","categories":[],"tags":[]},{"title":"Curry in Swift and Javascript","slug":"Curry-in-Swift-and-Javascript","date":"2019-03-24T20:08:27.000Z","updated":"2019-09-03T09:44:04.000Z","comments":true,"path":"blog/Curry-in-Swift-and-Javascript/","link":"","permalink":"https://onmyway133.github.io/blog/Curry-in-Swift-and-Javascript/","excerpt":"","text":"Issue #185 You may encounter curry in everyday code without knowing it. Here is a bit of my reflections on curry and how to apply it in Javascript and Swift. Taking one parameter in HaskellIn Haskell, all function officially takes only 1 parameter. Function with many parameters are just curried, which means they will be partially applied. Calling sum 1 just returns a function with 1 parameter, then 2is passed into this function. The following 2 function calls are the same. ghci&gt; sum 1 2 3 ghci&gt; (max 1) 2 3I tend to think of curried function or partially applied function as something that carry dependencies at each application step. Each curried function can be assigned to variable or pass around, or as returned value. Curry in Swift for predicateWhen I was trying to make my own Signal library, I have and Event filterThen there should be a filter for Signal. The idea of filter is that we should update signal if the Event is Next with right filtered value public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt;{ let signal = Signal&lt;T&gt;() subscribe { result in switch(result) { case let .Success(value): if f(value) { signal.update(result) } case let .Error(error): signal.update(.Error(error)) } } return signal }2 parametersBut having Event as another monad, I think it should be more encapsulated if that switching logic gets moved into the Event. Here the filter takes 2 params Event.swift func filter(f: T -&gt; Bool, callback: (Event&lt;T&gt; -&gt; Void)) { switch self { case let .Next(value) where f(value): callback(self) case .Failed: callback(self) default: break } }Signal.swift public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; { let signal = Signal&lt;T&gt;() subscribe { event in event.filter(f, callback: signal.update) } return signal }CurryingWith currying, we can make filter a more abstract function, and defer the decision to pass the callback param. It is a little carried away but I find it helpful this way Now filter accepts 1 param, and it returns a function that takes callback as its param Event.swift func filter(f: T -&gt; Bool) -&gt; ((Event&lt;T&gt; -&gt; Void) -&gt; Void) { return { g in switch self { case let .Next(value) where f(value): g(self) case .Failed: g(self) default: break } } }Signal.swift public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; { let signal = Signal&lt;T&gt;() subscribe { event in event.filter(f)(signal.update) } return signal }Curry syntax in Swift 2 and aboveSwift 2 supports curry syntax function func sum(a: Int)(b: Int) -&gt; Int { return a + b } let sumWith5 = sum(5) let result = sumWith5(b: 10)Unfortunately, the syntactic sugar for declaring curry has been dropped since Swift 3. You may want to find out in Bidding farewell to currying. But it‚Äôs not a big deal as we can easily create curry function. It is just a function that returns another function. Using curry for partial application in UIKitI used this curry technique in my Xkcd app. See MainController.swift. MainController is vanilla UITabBarController with ComicsController and FavoriteController , all embedded in UINavigationViewController . The feature is that when a comic is selected, a comic detail screen should be pushed on top of the navigation stack. For example in ComicsController /// Called when a comic is selected var selectComic: ((Comic) -&gt; Void)?All ComicsController needs to know is to call that selectComic closure with the chosen Comic, and someone should know how to handle that selection. Back to the handleFlow function inside MainController. private func handleFlow() { typealias Function = (UINavigationController) -&gt; (Comic) -&gt; Void let selectComic: Function = { [weak self] navigationController in return { (comic: Comic) in guard let self = self else { return } let detailController = self.makeDetail(comic: comic) navigationController.pushViewController(detailController, animated: true) } } comicsController.selectComic = selectComic(comicNavigationController) favoriteController.selectComic = selectComic(favoriteNavigationController) }I declared Function as typealias to explicitly state the curry function that we are going to build typealias Function = (UINavigationController) -&gt; (Comic) -&gt; VoidWe build selectComic as curried function, that takes UINavigationViewController and returns a function that takes Comic and returns Void . This way when we partially apply selectComic with the a navigationController , we get another function that has navigationController as dependency, and ready to be assigned to selectComic property in comicsController . Curry promised function in JavascriptI like to work with Promise and async/await in Javascript. It allows chainable style and easy to reason about. So when working with callbacks in Javascript, for example callback from native modules in React Native, I tend to convert them into Promise. For example when working with HealthKit, we need to expose a native modules around it // [@flow](http://twitter.com/flow) import { NativeModules } from &apos;react-native&apos; type HealthManagerType = { checkAuthorisation: ((string) =&gt; void)) =&gt; void, authorise: ((boolean) =&gt; void)) =&gt; void, readWorkout: (Date, Date, () =&gt; void)) =&gt; void, readDailySummary: (Date, Date, () =&gt; void)) =&gt; void, readMeasurement: (Date, Date, () =&gt; void)) =&gt; void } const HealthManager: HealthManagerType = NativeModules.HealthManager export default HealthManagerWe can build a toPromise function that can convert a function with callback into Promise // [@flow](http://twitter.com/flow) const toPromise = (f: (any) =&gt; void) =&gt; { return new Promise&lt;any&gt;((resolve, reject) =&gt; { try { f((result) =&gt; { resolve(result) }) } catch (e) { reject(e) } }) } export default toPromiseHowever, as you can see in the signature, it only works with a callback of type (any) =&gt; void In other words, this callback must have exactly 1 parameter, because a Promise can either returns a value or throws an error. To remedy this, we can build a curry function that can turns function with either 1, 2, 3 parameters into curried function. Thanks to the dynamic nature of Javascript, we have // [@flow](http://twitter.com/flow) function curry0(f: () =&gt; void) { return f() } function curry1(f: (any) =&gt; void) { return (p1: any) =&gt; { return f(p1) } } function curry2(f: (any, any) =&gt; void) { return (p1: any) =&gt; { return (p2: any) =&gt; { return f(p1, p2) } } } function curry3(f: (any, any, any) =&gt; void) { return (p1: any) =&gt; { return (p2: any) =&gt; { return (p3: any) =&gt; { return f(p1, p2, p3) } } } } export default { curry0, curry1, curry2, curry3 }So with a function that have 3 parameters, we can use curry3 to partially apply the first 2 parameters. Then we have a function that accepts just a callback, and this is turned into Promise via toPromise const readWorkout = curry.curry3(HealthManager.readWorkout)(DateUtils.startDate))(DateUtils.endDate)) const workouts = await toPromise(readWorkout)Where to go from hereHere are some of my favorite posts to read more about curry Higher order functions Introduction to Function Currying in Swift Swift Function Currying Currying in JavaScript: I like how he uses memory and slice to gradually build more generic curry function","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"How to fix SSLPeerUnverifiedException in Android","slug":"How-to-fix-SSLPeerUnverifiedException-in-Android","date":"2019-03-24T20:00:49.000Z","updated":"2019-03-24T20:04:29.000Z","comments":true,"path":"blog/How-to-fix-SSLPeerUnverifiedException-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-SSLPeerUnverifiedException-in-Android/","excerpt":"","text":"Issue #184 Get error javax.net.ssl.SSLPeerUnverifiedException: No peer certificate in Android API 16 to API 19 Getting startedRead about HTTPS and SSL https://developer.android.com/training/articles/security-sslCheck backend TLS https://www.ssllabs.com/index.htmlTLS by default in Android P https://android-developers.googleblog.com/2018/04/protecting-users-with-tls-by-default-in.html TLS versionRead https://developer.android.com/reference/javax/net/ssl/SSLSocket.html This class extends Sockets and provides secure socket using protocols such as the ‚ÄúSecure Sockets Layer‚Äù (SSL) or IETF ‚ÄúTransport Layer Security‚Äù (TLS) protocols. TLS 1.1 and 1.2 are supported from API 16, but not enabled by default until API 20. Install TLS 1.2 when neededRead https://medium.com/tech-quizlet/working-with-tls-1-2-on-android-4-4-and-lower-f4f5205629a The first thing we realized was that despite documentation suggesting otherwise, not all devices on Android 4.1+ actually support TLS 1.2. Even though it is likely due to device manufacturers not fully following the official Android specs, we had to do what we could to ensure this would work for our users. Luckily, Google Play Services provides a way to do this. The solution is to use ProviderInstaller from Google Play Services to try to update the device to support the latest and greatest security protocols. 1234567891011fun Context.installTls12() &#123; try &#123; ProviderInstaller.installIfNeeded(this) &#125; catch (e: GooglePlayServicesRepairableException) &#123; // Prompt the user to install/update/enable Google Play services. GoogleApiAvailability.getInstance() .showErrorNotification(this, e.connectionStatusCode) &#125; catch (e: GooglePlayServicesNotAvailableException) &#123; // Indicates a non-recoverable error: let the user know. &#125;&#125; Does not seem to work, as the root problem was that TLS was not enabled Try normal HttpsUrlConnectionIf we use any networking library and suspect it is the cause, then try using normal HttpsUrlConnection to check. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798class MyHttpRequestTask extends AsyncTask&lt;String,Integer,String&gt; &#123; @Override protected String doInBackground(String... params) &#123; String my_url = params[0]; try &#123; URL url = new URL(my_url); HttpsURLConnection httpURLConnection = (HttpsURLConnection) url.openConnection(); httpURLConnection.setSSLSocketFactory(new MyFactory()); // setting the Request Method Type httpURLConnection.setRequestMethod(\"GET\"); // adding the headers for request httpURLConnection.setRequestProperty(\"Content-Type\", \"application/json\"); String result = readStream(httpURLConnection.getInputStream()); Log.e(\"HttpsURLConnection\", \"data\" + result.toString()); &#125;catch (Exception e)&#123; e.printStackTrace(); Log.e(\"HttpsURLConnection \", \"error\" + e.toString()); &#125; return null; &#125; private static String readStream(InputStream is) throws IOException &#123; final BufferedReader reader = new BufferedReader(new InputStreamReader(is, Charset.forName(\"US-ASCII\"))); StringBuilder total = new StringBuilder(); String line; while ((line = reader.readLine()) != null) &#123; total.append(line); &#125; if (reader != null) &#123; reader.close(); &#125; return total.toString(); &#125;&#125;class MyFactory extends SSLSocketFactory &#123; private javax.net.ssl.SSLSocketFactory internalSSLSocketFactory; public MyFactory() throws KeyManagementException, NoSuchAlgorithmException &#123; SSLContext context = SSLContext.getInstance(\"TLS\"); context.init(null, null, null); internalSSLSocketFactory = context.getSocketFactory(); &#125; @Override public String[] getDefaultCipherSuites() &#123; return internalSSLSocketFactory.getDefaultCipherSuites(); &#125; @Override public String[] getSupportedCipherSuites() &#123; return internalSSLSocketFactory.getSupportedCipherSuites(); &#125; @Override public Socket createSocket() throws IOException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket()); &#125; @Override public Socket createSocket(Socket s, String host, int port, boolean autoClose) throws IOException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket(s, host, port, autoClose)); &#125; @Override public Socket createSocket(String host, int port) throws IOException, UnknownHostException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket(host, port)); &#125; @Override public Socket createSocket(String host, int port, InetAddress localHost, int localPort) throws IOException, UnknownHostException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket(host, port, localHost, localPort)); &#125; @Override public Socket createSocket(InetAddress host, int port) throws IOException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket(host, port)); &#125; @Override public Socket createSocket(InetAddress address, int port, InetAddress localAddress, int localPort) throws IOException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket(address, port, localAddress, localPort)); &#125; private Socket enableTLSOnSocket(Socket socket) &#123; if(socket != null &amp;&amp; (socket instanceof SSLSocket)) &#123; ((SSLSocket)socket).setEnabledProtocols(new String[] &#123;\"TLSv1.1\", \"TLSv1.2\"&#125;); &#125; return socket; &#125;&#125; The key is setEnabledProtocols. Then use 12String url = \"https://www.myserver.com/data\"new MyHttpRequestTask().execute(url); Use custom SSLSocketFactory in some networking librariesIf our custom MyFactory works for HttpsUrlConnection, then the problem lies in some 3rd party networking libraries. Read https://blog.dev-area.net/2015/08/13/android-4-1-enable-tls-1-1-and-tls-1-2/ The Android documentation for SSLSocket says that TLS 1.1 and TLS 1.2 is supported within android starting API level 16+ (Android 4.1, Jelly Bean). But it is by default disabled but starting with API level 20+ (Android 4.4 for watch, Kitkat Watch and Android 5.0 for phone, Lollipop) they are enabled. But it is very hard to find any documentation about how to enable it for phones running 4.1 for example. The first thing you need to do is to make sure that your minimum required API level is 16 to have the following code working in your project. To enable TLS 1.1 and 1.2 you need to create a custom SSLSocketFactory that is going to proxy all calls to a default SSLSocketFactory implementation. In addition to that do we have to override all createSocket methods and callsetEnabledProtocols on the returned SSLSocket to enable TLS 1.1 and TLS 1.2. For an example implementation just follow the link below. 12345678910111213141516171819202122232425262728293031323334353637383940414243import javax.net.ssl.SSLSocketFactory;class MyFactory extends org.apache.http.conn.ssl.SSLSocketFactory &#123; public static KeyStore getKeyStore() &#123; KeyStore trustStore = null; try &#123; trustStore = KeyStore.getInstance(KeyStore.getDefaultType()); trustStore.load(null, null); &#125; catch (Throwable t) &#123; t.printStackTrace(); &#125; return trustStore; &#125; private SSLSocketFactory internalSSLSocketFactory; public MyFactory(KeyStore truststore) throws NoSuchAlgorithmException, KeyManagementException, KeyStoreException, UnrecoverableKeyException &#123; super(truststore); SSLContext context = SSLContext.getInstance(\"TLS\"); context.init(null, null, null); internalSSLSocketFactory = context.getSocketFactory(); &#125; @Override public Socket createSocket() throws IOException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket()); &#125; @Override public Socket createSocket(Socket socket, String host, int port, boolean autoClose) throws IOException, UnknownHostException &#123; return enableTLSOnSocket(internalSSLSocketFactory.createSocket(socket, host, port, autoClose)); &#125; private Socket enableTLSOnSocket(Socket socket) &#123; if(socket != null &amp;&amp; (socket instanceof SSLSocket)) &#123; ((SSLSocket)socket).setEnabledProtocols(new String[] &#123;\"TLSv1.1\", \"TLSv1.2\"&#125;); &#125; return socket; &#125;&#125; Then maybe use it in a library, for example the ancient AsyncHttpClient 123asyncHttpClient = new AsyncHttpClient();asyncHttpClient.setTimeout(HTTP_GET_TIMEOUT);asyncHttpClient.setSSLSocketFactory(new MyFactory(MyFactory.getKeyStore()));","categories":[],"tags":[]},{"title":"How to zoom in double in MapKit","slug":"How-to-zoom-in-double-in-MapKit","date":"2019-03-22T10:10:38.000Z","updated":"2019-03-22T10:10:38.000Z","comments":true,"path":"blog/How-to-zoom-in-double-in-MapKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-zoom-in-double-in-MapKit/","excerpt":"","text":"Issue #183 123456789101112func zoomInDouble(coordinate: CLLocationCoordinate2D) &#123; let region = mapView.region let zoomInRegion = MKCoordinateRegion( center: coordinate, span: MKCoordinateSpan( latitudeDelta: region.span.latitudeDelta * 0.5, longitudeDelta: region.span.longitudeDelta * 0.5 ) ) mapView.setRegion(zoomInRegion, animated: true)&#125;","categories":[],"tags":[]},{"title":"How to select cluster annotation in MapKit","slug":"How-to-select-cluster-annotation-in-MapKit","date":"2019-03-22T10:09:56.000Z","updated":"2019-03-22T10:09:56.000Z","comments":true,"path":"blog/How-to-select-cluster-annotation-in-MapKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-select-cluster-annotation-in-MapKit/","excerpt":"","text":"Issue #182 123456789func mapView(_ mapView: MKMapView, didSelect view: MKAnnotationView) &#123; guard let coordinate = view.annotation?.coordinate else &#123; return &#125; if (view.annotation is MKClusterAnnotation) &#123; zoomInDouble(coordinate: coordinate) &#125;&#125;","categories":[],"tags":[]},{"title":"How to cluster annotations in MapKit in iOS 11","slug":"How-to-cluster-annotations-in-MapKit-in-iOS-11","date":"2019-03-22T10:09:01.000Z","updated":"2019-03-22T10:24:27.000Z","comments":true,"path":"blog/How-to-cluster-annotations-in-MapKit-in-iOS-11/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-cluster-annotations-in-MapKit-in-iOS-11/","excerpt":"","text":"Issue #181 https://developer.apple.com/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering 1234567891011final class AnnotationView: MKMarkerAnnotationView &#123; override init(annotation: MKAnnotation?, reuseIdentifier: String?) &#123; super.init(annotation: annotation, reuseIdentifier: reuseIdentifier) clusteringIdentifier = String(describing: ClusterView.self) &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940final class ClusterView: MKAnnotationView &#123; override init(annotation: MKAnnotation?, reuseIdentifier: String?) &#123; super.init(annotation: annotation, reuseIdentifier: reuseIdentifier) displayPriority = .defaultHigh &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; override func prepareForDisplay() &#123; super.prepareForDisplay() guard let annotation = annotation as? MKClusterAnnotation else &#123; return &#125; let count = annotation.memberAnnotations.count image = self.image(annotation: annotation, count: count) &#125; func image(annotation: MKClusterAnnotation, count: Int) -&gt; UIImage? &#123; let renderer = UIGraphicsImageRenderer(size: CGSize(width: 40.0, height: 40.0)) image = renderer.image &#123; _ in UIColor.purple.setFill() UIBezierPath(ovalIn: CGRect(x: 0.0, y: 0.0, width: 40.0, height: 40.0)).fill() let attributes: [NSAttributedString.Key: Any] = [ NSAttributedString.Key.foregroundColor: UIColor.white, NSAttributedString.Key.font: UIFont.boldSystemFont(ofSize: 20.0) ] let text = \"\\(count)\" let size = text.size(withAttributes: attributes) let rect = CGRect(x: 20 - size.width / 2, y: 20 - size.height / 2, width: size.width, height: size.height) text.draw(in: rect, withAttributes: attributes) &#125; return image &#125;&#125; 1mapView.register(ClusterView.self, forAnnotationViewWithReuseIdentifier: String(describing: ClusterView.self))","categories":[],"tags":[]},{"title":"Understanding CanvasRenderingContext2D and UIBezierPath","slug":"Understanding-CanvasRenderingContext2D-and-UIBezierPath","date":"2019-03-21T07:30:00.000Z","updated":"2019-03-21T07:32:20.000Z","comments":true,"path":"blog/Understanding-CanvasRenderingContext2D-and-UIBezierPath/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-CanvasRenderingContext2D-and-UIBezierPath/","excerpt":"","text":"Issue #180 CanvasRenderingContext2Dhttps://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/bezierCurveTo The CanvasRenderingContext2D.bezierCurveTo() method of the Canvas 2D API adds a cubic B√©zier curve to the current sub-path. It requires three points: the first two are control points and the third one is the end point. The starting point is the latest point in the current path, which can be changed using moveTo() before creating the B√©zier curve. 1void ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y); Where order is control point 1, control point 2 and end point UIBezierPathhttps://developer.apple.com/documentation/uikit/uibezierpath/1624357-addcurve Appends a cubic B√©zier curve to the receiver‚Äôs path. 1addCurve(to:controlPoint1:controlPoint2:) The same for void ctx.quadraticCurveTo(cpx, cpy, x, y); and addQuadCurve(to:controlPoint:)","categories":[],"tags":[]},{"title":"How to get properties of JSValue in JavascriptCore","slug":"How-to-get-properties-of-JSValue-in-JavascriptCore","date":"2019-03-19T10:55:25.000Z","updated":"2019-03-19T10:55:25.000Z","comments":true,"path":"blog/How-to-get-properties-of-JSValue-in-JavascriptCore/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-properties-of-JSValue-in-JavascriptCore/","excerpt":"","text":"Issue #179 12let rough = context.objectForKeyedSubscript(\"myObject\")myObject.toDictionary()","categories":[],"tags":[]},{"title":"How to run ffmpeg in macOS app","slug":"How-to-run-ffmpeg-in-macOS-app","date":"2019-03-19T08:43:24.000Z","updated":"2019-03-19T08:45:20.000Z","comments":true,"path":"blog/How-to-run-ffmpeg-in-macOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-ffmpeg-in-macOS-app/","excerpt":"","text":"Issue #178 Install ffmpeg, which installs ffprobe 1brew install ffmpeg Find location of installed ffmpeg 1which ffmpeg Add all executables to project Get error unable to obtain file audio codec with ffprobe Run in verbose mode 1ffmpeg -v Get [debug] Encodings: locale US-ASCII, fs utf-8, out None, pref US-ASCII[debug] Python version 2.7.10 (CPython) - Darwin-18.2.0-x86_64-i386-64bit[debug] exe versions: ffmpeg present, ffprobe present Run version of ffprobe 1ffprobe --version Get dylb not found dyld: Library not loaded: /usr/local/Cellar/ffmpeg/4.1.1/lib/libavdevice.58.dylib Similar issue https://techglimpse.com/ffprobe-command-error-linux-solution/Read dylib path https://stackoverflow.com/questions/23777191/dyld-library-not-loaded-when-trying-to-run-fortran-executable-from-objective-c","categories":[],"tags":[]},{"title":"How to get path to resource in running macOS app","slug":"How-to-get-path-to-resource-in-running-macOS-app","date":"2019-03-19T08:11:19.000Z","updated":"2019-03-19T08:11:19.000Z","comments":true,"path":"blog/How-to-get-path-to-resource-in-running-macOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-get-path-to-resource-in-running-macOS-app/","excerpt":"","text":"Issue #177 This is useful to refer to another executable in a running executable in Process 1Bundle.main.path(forResource: \"ffmpeg\", ofType: \"\")!","categories":[],"tags":[]},{"title":"How to run executable in macOS","slug":"How-to-run-executable-in-macOS","date":"2019-03-19T07:58:44.000Z","updated":"2019-03-19T07:58:44.000Z","comments":true,"path":"blog/How-to-run-executable-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-executable-in-macOS/","excerpt":"","text":"Issue #176 Enable executable 1chmod +x executable Add executable file to targetUse Process with correct launchPad 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475import Foundationprotocol TaskDelegate: class &#123; func task(task: Task, didOutput string: String) func taskDidComplete(task: Task)&#125;class Task &#123; weak var delegate: TaskDelegate? let process = Process() func run(arguments: [String]) &#123; DispatchQueue.background.async &#123; let launchPath = Bundle.main.path(forResource: \"executable\", ofType: \"\")! self.run(launchPath: launchPath, arguments: arguments) &#125; &#125; func stop() &#123; DispatchQueue.background.async &#123; if self.process.isRunning &#123; self.process.terminate() &#125; &#125; &#125; // MARK: - Helper private func run(launchPath: String, arguments: [String]) &#123; let process = Process() process.launchPath = launchPath process.arguments = arguments let stdOut = Pipe() process.standardOutput = stdOut let stdErr = Pipe() process.standardError = stdErr let handler = &#123; [weak self] (file: FileHandle!) -&gt; Void in let data = file.availableData guard let output = NSString(data: data, encoding: String.Encoding.utf8.rawValue) else &#123; return &#125; guard let strongSelf = self, let string = output.components(separatedBy: \"\\n\").first else &#123; return &#125; DispatchQueue.main.async &#123; strongSelf.delegate?.task(task: strongSelf, didOutput: string) &#125; &#125; stdErr.fileHandleForReading.readabilityHandler = handler stdOut.fileHandleForReading.readabilityHandler = handler process.terminationHandler = &#123; [weak self] (task: Process?) -&gt; () in stdErr.fileHandleForReading.readabilityHandler = nil stdOut.fileHandleForReading.readabilityHandler = nil guard let strongSelf = self else &#123; return &#125; DispatchQueue.main.async &#123; strongSelf.delegate?.taskDidComplete(task: strongSelf) &#125; &#125; process.launch() process.waitUntilExit() &#125;&#125;","categories":[],"tags":[]},{"title":"How to print current directory using Process in macOS","slug":"How-to-print-current-directory-using-Process-in-macOS","date":"2019-03-19T07:56:00.000Z","updated":"2019-03-19T08:05:22.000Z","comments":true,"path":"blog/How-to-print-current-directory-using-Process-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-print-current-directory-using-Process-in-macOS/","excerpt":"","text":"Issue #175 123let process = Process()process.launchPath = \"/bin/pwd\"process.arguments = [] Should be the same as FileManager.default.currentDirectoryPath","categories":[],"tags":[]},{"title":"How to change NSTextField backgroundColor in NSPopover","slug":"How-to-change-NSTextField-backgroundColor-in-NSPopover","date":"2019-03-19T07:05:27.000Z","updated":"2019-03-19T07:05:27.000Z","comments":true,"path":"blog/How-to-change-NSTextField-backgroundColor-in-NSPopover/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-change-NSTextField-backgroundColor-in-NSPopover/","excerpt":"","text":"Issue #174 Disable vibrancy mode of NSPopover 12let popover = NSPopover()popover.appearance = NSAppearance(named: NSAppearance.Name.aqua)","categories":[],"tags":[]},{"title":"How to make scrollable vertical NSStackView","slug":"How-to-make-scrollable-vertical-NSStackView","date":"2019-03-18T13:59:00.000Z","updated":"2019-09-18T19:08:24.000Z","comments":true,"path":"blog/How-to-make-scrollable-vertical-NSStackView/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-scrollable-vertical-NSStackView/","excerpt":"","text":"Issue #173 You might need to flip NSClipView 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import AppKitimport Anchorsimport Omniafinal class ScrollableStackView: NSView &#123; final class FlippedClipView: NSClipView &#123; override var isFlipped: Bool &#123; return true &#125; &#125; override init(frame frameRect: NSRect) &#123; super.init(frame: frameRect) setup() &#125; required init?(coder decoder: NSCoder) &#123; fatalError() &#125; let stackView: NSStackView = withObject(NSStackView()) &#123; $0.orientation = .vertical &#125; private let scrollView: NSScrollView = NSScrollView() private func setup() &#123; addSubview(scrollView) scrollView.hasVerticalScroller = true scrollView.drawsBackground = false activate( scrollView.anchor.edges ) let clipView = FlippedClipView() clipView.translatesAutoresizingMaskIntoConstraints = false clipView.drawsBackground = false scrollView.contentView = clipView activate( clipView.anchor.edges.equal.to(scrollView.anchor) ) scrollView.documentView = stackView stackView.translatesAutoresizingMaskIntoConstraints = false activate( clipView.anchor.left.top.right.equal.to(stackView.anchor) ) &#125;&#125; Read more https://stackoverflow.com/questions/10016475/create-nsscrollview-programmatically-in-an-nsview-cocoa/55219153#55219153","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to make view take up full width in vertical NSStackView","slug":"How-to-make-view-take-up-full-width-in-vertical-NSStackView","date":"2019-03-18T13:58:20.000Z","updated":"2019-04-24T19:11:04.000Z","comments":true,"path":"blog/How-to-make-view-take-up-full-width-in-vertical-NSStackView/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-view-take-up-full-width-in-vertical-NSStackView/","excerpt":"","text":"Issue #172 https://stackoverflow.com/questions/51644692/nsstackview-subviews-not-resizing-sub-stack-views/55220837#55220837 If you want child view inside vertical NSStackView to fill its parent width, then reduce contentCompressionResistancePriority 1234567891011121314151617myChildView.translatesAutoresizingMaskIntoConstraints = falsemyChildView.setContentCompressionResistancePriority( NSLayoutConstraint.Priority(rawValue: 1), for: .horizontal)NSLayoutConstraint.activate([ myChildView.heightAnchor.constraint(equalToConstant: 50)])NSAnimationContext.runAnimationGroup(&#123;context in context.duration = 0.25 context.allowsImplicitAnimation = true stackView.insertArrangedSubview(myChildView, at: 1) view.layoutSubtreeIfNeeded()&#125;, completionHandler: nil)","categories":[],"tags":[]},{"title":"How to load top level view from xib in macOS","slug":"How-to-load-top-level-view-from-xib-in-macOS","date":"2019-03-18T13:57:09.000Z","updated":"2019-03-18T14:04:11.000Z","comments":true,"path":"blog/How-to-load-top-level-view-from-xib-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-load-top-level-view-from-xib-in-macOS/","excerpt":"","text":"Issue #171 123var views: NSArray?NSNib(nibNamed: NSNib.Name(\"ProfileView\"), bundle: nil)?.instantiate(withOwner: nil, topLevelObjects: &amp;views)let profileView = views!.compactMap(&#123; $0 as? ProfileView &#125;).first!","categories":[],"tags":[]},{"title":"How to fix MethodError - undefined method `real_path` with CocoaPods?","slug":"How-to-fix-MethodError-undefined-method-real_path-with-CocoaPods","date":"2019-02-25T13:55:08.000Z","updated":"2019-02-25T14:03:10.000Z","comments":true,"path":"blog/How-to-fix-MethodError-undefined-method-real_path-with-CocoaPods/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-MethodError-undefined-method-real_path-with-CocoaPods/","excerpt":"","text":"Issue #170 I‚Äôm using cocoapods 1.6.0.beta.2 in a React Native apps and it has been working fine. The pods that I need is Firebase and FacebookSDK. Today after pod install, I got error 1NoMethodError - undefined method `real_path&apos; for nil:NilClass I then tried running pod deintegrate to start from scratch, but that command fails as well. My next try is with cocoapods 1.6.0 and cocoapods 1.6.1 but the problem still persists. undefined method in Ruby means that we are calling a method on an object that is nil. I like to track down problems via reading code, but this error is very vague. Looking thorough at the log, I see CocoaPods has done fetching dependencies, but fails at the integration step, so it must be something wrong with my project file. Then I trace back commits to project.pbxproj to see if there‚Äôs anything wrong. It turns out that there was a commit that accidentally removes Pods-MyApp Staging.release.xcconfig from project. That also comes with removal of 1baseConfigurationReference = B7FC69316CC27F11022F8A82 /* Pods-MyApp Staging.release.xcconfig */; CocoaPods uses xcconfigAs you know, CocoaPods uses xcconfig files to declare pod related information like FRAMEWORK_SEARCH_PATHS, OTHER_LDFLAGS and other variables like 1234PODS_BUILD_DIR = $&#123;BUILD_DIR&#125;PODS_CONFIGURATION_BUILD_DIR = $&#123;PODS_BUILD_DIR&#125;/$(CONFIGURATION)$(EFFECTIVE_PLATFORM_NAME)PODS_PODFILE_DIR_PATH = $&#123;SRCROOT&#125;/.PODS_ROOT = $&#123;SRCROOT&#125;/Pods And for a normal pod install, CocoaPods adds some xcconfig files to your project, and the path is Pods/Target Support Files/Pods-DeepDiffDemo. There will always be debug.xcconfig and release.xcconfig for each of your project target. If your project MyApp has a production target called MyApp Production and MyApp Staging, then you should have these files 1234Pods-MyApp Staging.debug.xcconfigPods-MyApp Staging.release.xcconfigPods-MyApp Production.debug.xcconfigPods-MyApp Production.release.xcconfig These are added to projects but not checked to any targets. Just like plist, you don‚Äôt need to add xcconfig files to target. If you go to project Info page, you will see that these xcconfig files are selected Missing xcconfigIn my case, Pods-MyApp Staging.release.xcconfig was somehow missing from project, hence all pod commands fail. The fix is to re-add that file and select that xcconfig in project Info page","categories":[],"tags":[]},{"title":"Testimonial","slug":"Testimonial","date":"2018-12-18T16:16:33.000Z","updated":"2019-03-06T05:25:07.000Z","comments":true,"path":"blog/Testimonial/","link":"","permalink":"https://onmyway133.github.io/blog/Testimonial/","excerpt":"","text":"Issue #169 https://medium.com/@kylpo/wow-i-learned-so-much-from-this-article-thank-you-595f29077633 https://stackoverflow.com/questions/34990175/test-target-x-encountered-an-error-early-unexpected-exit-operation-never-finis/36343395?noredirect=1#comment94467666_36343395 https://github.com/onmyway133/notes/issues/2 https://stackoverflow.com/questions/49478/git-ignore-file-for-xcode-projects/26034755#26034755 https://stackoverflow.com/a/46122458/1418457","categories":[],"tags":[]},{"title":"Questions","slug":"Questions","date":"2018-11-09T07:03:13.000Z","updated":"2019-05-11T14:35:27.000Z","comments":true,"path":"blog/Questions/","link":"","permalink":"https://onmyway133.github.io/blog/Questions/","excerpt":"","text":"Issue #168 What is the difference between a front end dev from Stanford and from bootcamp? Ask HN: What if there is no inheritance? What if there is no inheritance, so that everybody has the same start, does that make life fairer? Is it true that programming is easy to do?","categories":[],"tags":[]},{"title":"Understanding weak and strong in Objective C","slug":"Understanding-weak-and-strong-in-Objective-C","date":"2018-05-31T10:41:57.000Z","updated":"2019-09-12T06:32:48.000Z","comments":true,"path":"blog/Understanding-weak-and-strong-in-Objective-C/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-weak-and-strong-in-Objective-C/","excerpt":"","text":"Issue #164 From my own blog post https://github.com/Fantageek/fantageek.github.io/blob/source/source/_posts/2014-06-27-understanding-weak-self-and-strong-self.markdown Blocks are wonderful. To avoid retain cycle you often see the weakSelf - strongSelf dance like this 123456__weak __typeof__(self) weakSelf = self; self.block = ^&#123; __typeof__(self) strongSelf = weakSelf; [strongSelf doSomething]; [strongSelf doSomethingElse]; &#125;; When block is createdBlock is object when it is copiedBlocks are created on the stack and will go away when their stack frame returns. While on the stack, a block has no effect on the storage or lifetime of anything it accesses. If blocks need to exist after the stack frame returns, they can be copied to the heap and this action is an explicit operation. This way, a block will gain reference-counting as all objects in Cocoa. When they are copied, they take their captured scope with them, retaining any objects they refer Blocks can capture values from the enclosing scopeAs well as containing executable code, a block also has the ability to capture state from its enclosing scope. Note that block captures the variable along with its decorators (i.e. weak qualifier), =&gt; This explains why you need to declare self as __weak When block is executedWhen block is executed, it is possible for weakSelf to be non-nil for the first method (doSomething), but not for the second (doSomethingElse) You may think, at first, this is a trick to use self inside the block avoiding the retain cycle warning. This is not the case. The strong reference to self is created at block execution time while using self in the block is evaluated at block declaration time, thus retaining the object. For best practice, however, you should create a strong reference of your object using the weak one. This won‚Äôt create a retain cycle either as the strong pointer within the block will only exist until the block completes (it‚Äôs only scope is the block itself). =&gt; This explains why you need to declare another __strong self More explanationThis is my answer to reader Nikita As many people point out, ‚ÄúBlocks are created on the stack and will go away when their stack frame returns. While on the stack, a block has no effect on the storage or lifetime of anything it accesses.‚ÄùEven if block (declared on the stack) increase reference count to all the object it accesses, this would be useless, because this block will be discard when function returns When block are copied (You see that people usually declare property (copy) for block), it will increase reference count to all the objects it accesses. Why? because block are mean to be executed at a later time, so it need to keep strong reference to all the object it access. Block can be executed MANY TIMES, so IT WON‚ÄôT RELEASE self AFTER this ran. When you nil out the block, it will be dealloc, hence it will decrease the reference count to all the objects it access. AFNetworking nil out the block after it is called, so you don‚Äôt have to use weakself inside block http://www.fantageek.com/1376/afnetworking-gotcha-2/ So there are cases when you don‚Äôt have to use weakself inside blocka. Make sure the block is not copied, you simply declare and run itb. Make sure the block is nil out after it is called Reference I finally figured out weakSelf and strongSelf Working with Blocks Objective-C Blocks Caveat Objective-C Blocks Under the Hood A look inside blocks: Episode 1 A look inside blocks: Episode 2 A look inside blocks: Episode 3 From C Declarators to Objective-C Blocks Syntax The Syntax of Objective-C Blocks Referring to weak self inside a nested block Capturing My(self)","categories":[],"tags":[{"name":"objc","slug":"objc","permalink":"https://onmyway133.github.io/tags/objc/"}]},{"title":"Interesting, how did you managed to plug GitHub issues into the dev.to platform","slug":"Interesting-how-did-you-managed-to-plug-GitHub-issues-into-the-dev.to-platform","date":"2018-05-26T20:14:56.000Z","updated":"2018-06-06T07:18:18.000Z","comments":true,"path":"blog/Interesting-how-did-you-managed-to-plug-GitHub-issues-into-the-dev.to-platform/","link":"","permalink":"https://onmyway133.github.io/blog/Interesting-how-did-you-managed-to-plug-GitHub-issues-into-the-dev.to-platform/","excerpt":"","text":"Issue #163 I‚Äôve found your post https://dev.to/onmyway133/changing-electron-app-icon and fist thought there is some static site generator which uses GitHub‚Äôs issues as a datasource. Am I right?","categories":[],"tags":[]},{"title":"Trying IBM Watson","slug":"Trying-IBM-Watson","date":"2018-05-02T11:46:54.000Z","updated":"2018-05-03T03:43:08.000Z","comments":true,"path":"blog/Trying-IBM-Watson/","link":"","permalink":"https://onmyway133.github.io/blog/Trying-IBM-Watson/","excerpt":"","text":"Issue #162","categories":[],"tags":[]},{"title":"Request and Task","slug":"Request-and-Task","date":"2018-05-02T08:50:05.000Z","updated":"2018-05-02T08:50:05.000Z","comments":true,"path":"blog/Request-and-Task/","link":"","permalink":"https://onmyway133.github.io/blog/Request-and-Task/","excerpt":"","text":"Issue #161 https://developer.apple.com/documentation/foundation/urlsessionhttps://developer.apple.com/documentation/speech","categories":[],"tags":[]},{"title":"Learning from Open Source  Colocate test files","slug":"Learning-from-Open-Source-Colocate-test-files","date":"2018-04-12T06:55:32.000Z","updated":"2018-04-12T06:55:32.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Colocate-test-files/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Colocate-test-files/","excerpt":"","text":"Issue #160 Why you should co-locate your Xcode tests Files https://github.com/kickstarter/ios-oss/blob/master/Kickstarter-iOS/ViewModels/RootViewModel.swifthttps://github.com/kickstarter/ios-oss/blob/master/Kickstarter-iOS/ViewModels/RootViewModelTests.swift","categories":[],"tags":[]},{"title":"Using CircleCI 2.0","slug":"Using-CircleCI-2.0","date":"2018-04-03T11:29:58.000Z","updated":"2019-10-18T09:17:39.000Z","comments":true,"path":"blog/Using-CircleCI-2.0/","link":"","permalink":"https://onmyway133.github.io/blog/Using-CircleCI-2.0/","excerpt":"","text":"Issue #158 We ‚Äòve been using CircleCI for many of our open source projects. Since the end of last year 2017, version 2.0 began to come out, and we think it‚Äôs good time to try it now together with Swift 4.1 and Xcode 9.3 The problem with version 2.0 is it‚Äôs so powerful and has lots of cool new features like jobs and workflows, but that requires going to documentation for how to migrate configuration file, especially Search and Replace Deprecated 2.0 Keys Creating config.ymlThe first thing is to create a new config.yml inside folder .circleci Copy your existing circle.yml file into a new directory called .circleci at the root of your project repository. Next is to declare version and jobs Add version: 2 to the top of the .circleci/config.yml file. Checking xcodebuildFor simple cases, we just use xcodebuild to build and test the project, so it‚Äôs good to try it locally to avoid lots of trial commits to trigger CircleCI. You can take a look at this PR https://github.com/hyperoslo/Cheers/pull/20 Before our configuration file for version 1.0 looks like this 1- set -o pipefail &amp;&amp; xcodebuild -project Cheers.xcodeproj -scheme \"Cheers-iOS\" -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 8,OS=11.0' -enableCodeCoverage YES test Now we should put pipefail inside shell, follow https://github.com/CircleCI-Public/circleci-demo-ios/blob/master/.circleci/config.yml shell: /bin/bash ‚Äìlogin -o pipefail Now is the actual trying xcodebuild, after many failures due to destination param 123456xcodebuild: error: Unable to find a destination matching the provided destination specifier: &#123; platform:iOS Simulator, OS:11.3 &#125; Missing required device specifier option. The device type ‚ÄúiOS Simulator‚Äù requires that either ‚Äúname‚Äù or ‚Äúid‚Äù be specified. Please supply either ‚Äúname‚Äù or ‚Äúid‚Äù. 1xcodebuild: error: option &apos;Destination&apos; requires at least one parameter of the form &apos;key=value&apos; I found this to work, run this in the same folder as your xcodeproj 1xcodebuild -project Cheers.xcodeproj -scheme \"Cheers-iOS\" -sdk iphonesimulator -destination \"platform=iOS Simulator,OS=11.3,name=iPhone X\" -enableCodeCoverage YES test Adding workflowVersion 2.0 introduces workflow which helps organising jobs A workflow is a set of rules for defining a collection of jobs and their run order. Workflows support complex job orchestration using a simple set of configuration keys to help you resolve failures sooner. For our simple use cases, we add this workflow 12345workflows: version: 2 build-and-test: jobs: - build-and-test Collecting Test Metadata https://circleci.com/docs/2.0/collect-test-data/ CircleCI collects test metadata from XML files and uses it to provide insights into your job FinalUse below as template 12345678910111213141516171819202122version: 2.1jobs: build_test: macos: xcode: \"11.0\" shell: /bin/bash --login -o pipefail steps: - checkout - run: command: | curl https://cocoapods-specs.circleci.com/fetch-cocoapods-repo-from-s3.sh | bash -s cf pod install - run: command: xcodebuild -workspace MyApp.xcworkspace -scheme \"MyApp\" -sdk iphonesimulator -destination \"platform=iOS Simulator,name=iPhone X,OS=12.2\" -enableCodeCoverage YES test - store_test_results: path: test-resultsworkflows: version: 2.1 primary: jobs: - build_test Read more https://circleci.com/docs/2.0/ios-migrating-from-1-2/","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"xcode","slug":"xcode","permalink":"https://onmyway133.github.io/tags/xcode/"},{"name":"ci","slug":"ci","permalink":"https://onmyway133.github.io/tags/ci/"}]},{"title":"Jitter buffer in VoIP","slug":"Jitter-buffer-in-VoIP","date":"2018-02-27T11:30:02.000Z","updated":"2019-09-12T07:08:50.000Z","comments":true,"path":"blog/Jitter-buffer-in-VoIP/","link":"","permalink":"https://onmyway133.github.io/blog/Jitter-buffer-in-VoIP/","excerpt":"","text":"Issue #157 This post was from long time ago when I did pjsip A jitter buffer temporarily stores arriving packets in order to minimize delay variations. If packets arrive too late then they are discarded. A jitter buffer may be mis-configured and be either too large or too small. ImpactIf a jitter buffer is too small then an excessive number of packets may be discarded, which can lead to call quality degradation. Lower settings cause less delay in the meeting, but meetings with lower settings are more susceptible to jitter effects caused by network congestion. Less data is buffered, increasing the likelihood that delayed or lost packets will produce a jitter effect in the media stream. If a jitter buffer is too large then the additional delay can lead to conversational difficulty. Higher settings are more effective at reducing jitter effects. With higher settings, more data is buffered, which allows more time for delayed packets to arrive at the client. However, higher settings also result in more delay (or latency) in the meeting. A user who is speaking will not be heard immediately by the other meeting participants. The delay in the meeting increases with the amount of time that data is held in the buffer. ResolutionA typical jitter buffer configuration is 30mS to 50mS in size. In the case of an adaptive jitter buffer then the maximum size may be set to 100-200mS. Note that if the jitter buffer size exceeds 100mS then the additional delay introduced can lead to conversational difficulty. Reference lib.boulder.ibm.com/infocenter/sametime http://www.voiptroubleshooter.com","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"Some Windows Phone 7 development tips","slug":"Some-Windows-Phone-7-development-tips","date":"2018-02-27T11:27:46.000Z","updated":"2018-02-27T11:27:46.000Z","comments":true,"path":"blog/Some-Windows-Phone-7-development-tips/","link":"","permalink":"https://onmyway133.github.io/blog/Some-Windows-Phone-7-development-tips/","excerpt":"","text":"Issue #156 This post was from long time ago when I did Windows Phone 7 Welcome back, today I will start writing all stuff, all the secret I ‚Äòve revealed when developing for Windows Phone 7. When setting UIElement‚Äòs Visibility to Collapsed, the OS set its Height to 0. So if you need to have a Height of 0, simply set Height=&quot;0&quot;, which is faster in term of show time. When clearing data source, ListBox which uses VirtualizingStackPanel does not rememeber its last view, whereas StackPanel does ListBox which is inside ScrollViewer will lose its UI virtualization, even if you use VirtualizingStackPanel Using GestureListener incorrectly will cause other UIElement to not work, i.e Slider, ‚Ä¶ AdControl, ContextMenu may be a source of memory leak. Panorama control still enable swiping when there is only 1 PanoramaItem, whereas Pivot does not. Pivot control will load the current PivotItem, as well as its direct left and right PivotItem. Sometimes SIP keyboard does not show up, check your phone for physical keyboard problem. There is no way to rate a Song for 3rd app When emulator rendering has overlap issue, the workaround is to set LayoutRoot ‚Äòs Background to a solid color Supposed you‚Äôre using ObservableCollection bindSource as binding source for ListBox. When adding items to bindSource quickly, ListBox seems to suppress creating ListBoxItem until all items are added. It is advised to add items in batch WebBrowser control does not have scroll bar Using StoryBoard when ever possible, because all of its animation is done in Compositor Thread, which leverages GPU Use ProgressIndicator for best performance and UX familiarity Collapse unimportant UIElement to decrease load time, and show them when Page is completely loaded. Always unsubscribe to event source that can continue to run when the Page is navigated from, because that may cause memory leak. Examples are timer, BackgroundAudioPlayer.PlayeStateChanged, ‚Ä¶ Using file is much faster than Local Database Remember the limit 260 characters of query string","categories":[],"tags":[]},{"title":"How to calculate packet size in VoIP","slug":"How-to-calculate-packet-size-in-VoIP","date":"2018-02-27T11:25:18.000Z","updated":"2019-09-12T06:29:39.000Z","comments":true,"path":"blog/How-to-calculate-packet-size-in-VoIP/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-calculate-packet-size-in-VoIP/","excerpt":"","text":"Issue #155 As you have probably observed in your studies, there is a determined method for calculating VoIP packet sizes. The packet size depends on many different variables, so there is no great answer for an ‚Äúaverage‚Äù packet size ‚Äì average depends on the environment. Just as an example, if you currently have VoIP running within a LAN and want to provision a new WAN so you can use VoIP to another site, knowing how big your VoIP packets are on the LAN won‚Äôt help. See below for a VoIP packet size calculation for a typical LAN, which will get you started. Packet sizeThe general formula for VoIP packet size is this 1Frame overhead + Encapsulation overhead + IP overhead + Voice payload. Let‚Äôs say the packet is going across our LAN, so right now the frame overhead is 18 Bytes, for Ethernet II. (This size would change later if the packet crosses a trunk with 802.1Q tagging or ISL encapsulation, or is destined for the WAN, where a different link layer framing will probably be in use.) EncapsulationEncapsulation overhead would include things like IPSec tunnels for security. Suppose we are not encapsulating this voice packet, so there is no overhead here. ‚ÄúIP overhead‚Äù has overhead occurring at layer 3 and above, so for SIP phones this means IP (20 Bytes), UDP (8 Bytes), and RTP (12 Bytes). This is a total of 40 Bytes of IP overhead. Lastly, you must calculate the size of the actual voice payload. Suppose we use the G.711 codec, which gives us a codec bandwidth of 64kbps. Also suppose our phones have a packetisation period of 20ms (meaning 20ms worth of voice goes into every packet). With these two numbers, we can figure out the size of the voice payload. Since one second of voice contains 64 kilobits of data (‚Äú64 kbps‚Äù), it is easy to calculate how many bits Find the amount of Bytes per payload: 1264000 bits * .02 seconds = 1280 bits of voice per payload 1280 bits / 8 bits per byte = 160 Bytes of voice per payload The total overhead is 58 Bytes (18 + 40)The total VoIP packet size is 218 Bytes (160 + 58 ) In the interest of full disclosure, it is easy to get a bit rate per second from here; just convert 218 Bytes into bits and multiply by the packetization rate (which is the inverse of your packetization period, in this case 50 packets per second). The bit rate for ONE stream of this voice is 87.2kbps‚Ä¶ we hope the user isn‚Äôt just talking to himself, so double that for an actual phone conversation. There are lots of other little things, like VAD and various header compressions, that you may need to factor into these calculations as well. As you can see, any one of these many things being off will give you a different answer, so knowing how to go about the entire process is important. Reference www.techexams.net","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"UITableViewCell and Model","slug":"UITableViewCell-and-Model","date":"2018-02-27T11:21:02.000Z","updated":"2019-09-12T06:29:33.000Z","comments":true,"path":"blog/UITableViewCell-and-Model/","link":"","permalink":"https://onmyway133.github.io/blog/UITableViewCell-and-Model/","excerpt":"","text":"Issue #154 The most common UI element in iOS is UITableView, and the most common task is to display the UITableViewCell using the model. Although the title specifies UITableViewCell, but the problem involves other views (UICollectionView, custom view, ‚Ä¶) as well There are many debates about this, so here I want to make a summary, all in my opinion It started withUITableViewCell Is Not a ControllerThis article follows strict MVC and states we should not pass model object to cell and let cell manipulate directly on the model. He shows several examples that point out this job is not suitable for the cell. Instead this job should be done on the Controller (UIViewController, UITableViewDataSource, ‚Ä¶) Category for simple caseSkinnier Controllers Using View CategoriesThis article states that we should keep ViewController skinnier by transfering the job (mapping model object to cell) to the cell category Using subclassingUITableViewCell Is Not a Controller, But‚Ä¶This articles explains the beauty of subclassing to take advantage of Polymorphism. In the theming example he gives, we see that Controller ‚Äòs job now is to select the correct cell subclass, and the subclass ‚Äòs job is to know how to use the model‚ÄúWhen a UITableViewCell subclass accepts a model object parameter and updates its constituent subviews as I have described, it is behaving as a data transformer, not a controller‚Äù Model PresenterModel View Controller PresenterThis article shows that using subclassing and category will have duplication implementation when you have more cells and models. After several optimizations, he finally gets to the Model Presenter, which is the center object who knows how to represent the model in different view.‚ÄúThis is an object that knows how to represent every aspect of a certain model‚Äù MVVMMVC, MVVM, FRP, And Building BridgesThis article explains MVVM but it touches our problem directly. The problem with cell and model actually is How to map the model to the cell Who will do this job? The cell, Controller or another Model Mapping object ? The ViewModel is actually who does this work, which is to transform the model to something the view can easily use ‚ÄúA table view data source is none of these things. It‚Äôs purely a layer between the table view and the model. The model defines lists of things, but the table view data source transform those lists into sections and rows. It also returns the actual table view cells, but that‚Äôs not what I‚Äôm focusing on here. The key is its role as a middle-tier data transformer.‚Äù Do we access the cell ‚Äòs subviewsPaul on UITableViewCellBrent follows with another post explaining how cell ‚Äòs subviews should not be accessed outside of the cell Data SourceClean table view codeThis article deals with Bridging the Gap Between Model Objects and Cells.‚ÄúAt some point we have to hand over the data we want to display into the view layer. Since we still want to maintain a clear separation between the model and the view, we often offload this task to the table view‚Äôs data source. This kind of code clutters the data source with specific knowledge about the design of the cell. We are better off factoring this out into a category of the cell class‚Äù This together with Lighter View Controllers shows a practical example that deals with most cases Reference Should UITableViewCells Know About Model Objects?","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Netcut and ARP","slug":"Netcut-and-ARP","date":"2018-02-27T11:18:35.000Z","updated":"2019-09-12T06:29:21.000Z","comments":true,"path":"blog/Netcut-and-ARP/","link":"","permalink":"https://onmyway133.github.io/blog/Netcut-and-ARP/","excerpt":"","text":"Issue #153 Bad people can use Netcut to limit other ‚Äòs internet access in same network How does Netcut workNetcut uses attacking technique called ARP Spoofing. ARP (Address Resolution Protocol) is a link layer procotol, it is used for resolving network layer address (IP) into link layer address (MAC). When we want to send IP packet to another host (a computer in the same LAN, or the Gateway), we must know the destination IP address. In order for the packet to reach the destination, the destination IP address must be converted to the corresponding MAC address, so the transmission can be processed in the data link layer. To setup this mapping IP-MAC in the ARP table, we must first send ARP request as broadcast one to the LAN. In the happy case, the one with the IP in the ARP request will reply us with his MAC address. Unfortunately, ARP is a stateless protocol. This means we continue to accept ARP replies and overwrite the old ones, even they have not expired yet. Worse, ARP does not define any authentication method to check whether the replies come from the trusted one (the one we want to receive the replies). These offer chances for the attacker to perform ARP Spoofing. The theory behind ARP SpoofingFrom the machine in the LAN, the attacker associate his MAC address and IP address of the target host (usually the Gateway), so that any traffic sent to that target host will come to the attacker. Here the attacker can decide whether to modify the packet, send or not. There are 3 types of ARP Spoofing Spoof the host computer Spoof the Gateway Spoof both the host computer and the Gateway To see the ARP tableOpen Command line (Windows) or Terminal (Mac OSX), and type 1arp -a This will list the MAC address associated with a specific IP. Note that some mappings maybe wrong due to ARP Spoofing How to prevent against this ?To prevent spoofing our computer, we can use softwares (search for Anti Netcut, Anti ARP spoofing, ‚Ä¶) or set the static ARP ourselves. In fact, those softwares are based on setting static ARP. This way we set the static mapping IP-MAC for a specific host (computer or Gateway), and the OS definitely ignores all ARP replies for that IP. Example of static ARP mapping associated with the Gateway, performed on the computer host 1192.168.1.1 B4-B3-62-7C-CE-55 Here 192.168.1.1 and B4-B3-62-7C-CE-55 are the Gateway‚Äôs IP and MAC address To prevent spoofing the Gateway, we must set static ARP on that Gateway. Go to the Gateway/Router interface, in its ARP setting, fill in the mapping IP-MAC for a specific host Look for that Gateway manual or the related guide on how to perform this. This is devices dependent-method, but the theory remains the same. Example of static ARP mapping associated with the computer host, performed on the Gateway 1192.168.1.2 64-70-02-B2-9B-E1 Here 192.168.1.2 and 64-70-02-B2-9B-E1 are the machine host ‚Äòs IP and MAC address. The machine host can be any computer in the LAN How to set static ARPProposed that 192.168.1.1 The destination host ‚Äòs IP B4-B3-62-7C-CE-55 The destination host ‚Äòs MAC Local Area Connection Our network interface name Open Terminal (Mac OSX) To delete specific mapping 1sudo arp -d 192.168.1.1 To set specific mapping 1sudo arp -s 192.168.1.1 B4-B3-62-7C-CE-55 Reference http://en.wikipedia.org/wiki/ARP_spoofing","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"Make your own sliding menu on Android tutorial ‚Äì Part 2","slug":"Make-your-own-sliding-menu-on-Android-tutorial-Part-2","date":"2018-02-27T11:08:13.000Z","updated":"2019-06-21T07:56:09.000Z","comments":true,"path":"blog/Make-your-own-sliding-menu-on-Android-tutorial-Part-2/","link":"","permalink":"https://onmyway133.github.io/blog/Make-your-own-sliding-menu-on-Android-tutorial-Part-2/","excerpt":"Issue #152 This is the part 2 of the tutorial. If you forget, here is the link to part 1. Link to Github In the first part, we learn about the idea, the structure of the project and how MainActivity uses the MainLayout. Now we learn how to actually implement the MainLayout DISPLAY MENU AND CONTENT VIEWFirst we have MainLayout as a subclass of LinearLayout 1public class MainLayout extends LinearLayout We then need declare the constructors","text":"Issue #152 This is the part 2 of the tutorial. If you forget, here is the link to part 1. Link to Github In the first part, we learn about the idea, the structure of the project and how MainActivity uses the MainLayout. Now we learn how to actually implement the MainLayout DISPLAY MENU AND CONTENT VIEWFirst we have MainLayout as a subclass of LinearLayout 1public class MainLayout extends LinearLayout We then need declare the constructors 1234567public MainLayout(Context context, AttributeSet attrs) &#123; super(context, attrs); &#125; public MainLayout(Context context) &#123; super(context); &#125; and override some useful methods 1234567891011@Override protected void onAttachedToWindow() &#123; super.onAttachedToWindow(); // Get our 2 child View menu = this.getChildAt(0); content = this.getChildAt(1); // Initially hide the menu menu.setVisibility(View.GONE); &#125; onAttachedToWindow() is called when MainLayout is attached to window. At this point it has a Surface and will start drawing. Note that this function is guaranteed to be called before onDraw. Here we set child views to our view and content variable 12menu = this.getChildAt(0);content = this.getChildAt(1); and initially hide the menu. Note that View.GONE tells the view to not take up space in the layout 1menu.setVisibility(View.GONE); In onMeasure(), we compute menuRightMargin, this variable is the amount of right space the menu should not occupy. In this case, we want the menu to take up 90% amount of the screen width. onMeasure() is called to ask all children to measure themselves and compute the measurement of this layout based on the children 12345@Override protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; super.onMeasure(widthMeasureSpec, heightMeasureSpec); menuRightMargin = mainLayoutWidth * 10 / 100; &#125; Finally, we need to override onLayout(), this is called from layout when this view should assign a size and position to each of its children. This is where we position the menu and content view. 1234567891011121314151617181920212223@Override protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123; // True if MainLayout 's size and position has changed // If true, calculate child views size if(changed) &#123; // Note: LayoutParams are used by views to tell their parents how they want to be laid out // content View occupies the full height and width LayoutParams contentLayoutParams = (LayoutParams)content.getLayoutParams(); contentLayoutParams.height = this.getHeight(); contentLayoutParams.width = this.getWidth(); // menu View occupies the full height, but certain width LayoutParams menuLayoutParams = (LayoutParams)menu.getLayoutParams(); menuLayoutParams.height = this.getHeight(); menuLayoutParams.width = this.getWidth() - menuRightMargin; &#125; // Layout the child views menu.layout(left, top, right - menuRightMargin, bottom); content.layout(left + contentXOffset, top, right + contentXOffset, bottom); &#125; Note for the use of the contentXOffset variable. It is the content that is moving, not the menu. So contentXOffset is used to translate the content horizontally when it is moving ADDING ANIMATIONSo the main idea of sliding menu is to change contentXOffset and call offsetLeftAndRight for the content to move the content. But for the content ‚Äòs new position to survive, we need to actually layout it on onLayout(), as shown in previous code snippet For more information, see Flyin menu using offsetLeftAndRight not preserving after a layout To better control sliding state, we declare MenuState enumeration 123456private enum MenuState &#123; HIDING, HIDDEN, SHOWING, SHOWN, &#125;; HIDDEN state is when menu is fully hidden, and SHOWN state is when menu is fully shown. HIDDING state is when menu is about to hide, and SHOWING state is when menu is about to show. Initially currentMenuState is set to HIDDEN so that the menu won‚Äôt show up on first launch. The main method of our MainLayout is toggleMenu, which, as it name implied, allow us to toggle menu 123456789101112131415161718192021222324252627public void toggleMenu() &#123; // Do nothing if sliding is in progress if(currentMenuState == MenuState.HIDING || currentMenuState == MenuState.SHOWING) return; switch(currentMenuState) &#123; case HIDDEN: currentMenuState = MenuState.SHOWING; menu.setVisibility(View.VISIBLE); menuScroller.startScroll(0, 0, menu.getLayoutParams().width, 0, SLIDING_DURATION); break; case SHOWN: currentMenuState = MenuState.HIDING; menuScroller.startScroll(contentXOffset, 0, -contentXOffset, 0, SLIDING_DURATION); break; default: break; &#125; // Begin querying menuHandler.postDelayed(menuRunnable, QUERY_INTERVAL); // Invalite this whole MainLayout, causing onLayout() to be called this.invalidate(); &#125; Here we use a Scroller to faciliate sliding animation. Note that Scroller does not perform any visual effect, it is just a base for us to track animation by querying the Scroller‚Äôs methods. Bills has a good answer on SO Android: Scroller Animation? The Scroller uses a custom Interpolator to make the sliding more natural. It moves faster in the end. The formula is here 1interpolator(t) = (t-1)5 + 1 If the menu is in HIDDEN state, we set its visibility to VISIBLE and start scrolling. Here the content is moving horizontally, so we scroll from left edge to menu width. Note that menu takes up only 90% of the screen width. If the menu is in SHOWN state, we start scrolling from the content ‚Äòs current x position to the left edge. The 3rd parameter to the startScroll() method is the distance we want to scroll, a negative sign indicates that we want to scroll from right to left. You can tweak SLIDING_DURATION and QUERY_INTERVAL to your desire. SLIDING_DURATION is the duration of the scrolling. QUERY_INTERVAL is how often we perform querying the Scroller for information. I set it to 16ms so that we have an fps of about 60, which is too high :D Here the querying is achieved via calling adjustContentPosition() in MenuRunnable 12// Begin queryingmenuHandler.postDelayed(menuRunnable, QUERY_INTERVAL); 12345678// Query Scrollerprotected class MenuRunnable implements Runnable &#123; @Override public void run() &#123; boolean isScrolling = menuScroller.computeScrollOffset(); adjustContentPosition(isScrolling); &#125; &#125; Here we call computeScrollOffset to check if the scrolling is finished or not 12345678910111213141516171819private void adjustContentPosition(boolean isScrolling) &#123; int scrollerXOffset = menuScroller.getCurrX(); //Log.d(\"MainLayout.java adjustContentPosition()\", \"scrollerOffset \" + scrollerOffset); // Translate content View accordingly content.offsetLeftAndRight(scrollerXOffset - contentXOffset); contentXOffset = scrollerXOffset; // Invalite this whole MainLayout, causing onLayout() to be called this.invalidate(); // Check if animation is in progress if (isScrolling) menuHandler.postDelayed(menuRunnable, QUERY_INTERVAL); else this.onMenuSlidingComplete(); &#125; We base on getCurrX to update out contentXOffset and translate content view. Remember to call invalidate() everytime the content position is changed. We continue moving the content view until scrolling is finished Finally, in onMenuSlidingComplete(), we set the currentMenuState accordingly 12345678910111213private void onMenuSlidingComplete() &#123; switch (currentMenuState) &#123; case SHOWING: currentMenuState = MenuState.SHOWN; break; case HIDING: currentMenuState = MenuState.HIDDEN; menu.setVisibility(View.GONE); break; default: return; &#125; &#125; HANDLING GESTURETo support gesture, we first attach OnTouchListener to the content view. We do this in onMeasure() 123456content.setOnTouchListener(new OnTouchListener() &#123; @Override public boolean onTouch(View v, MotionEvent event) &#123; return MainLayout.this.onContentTouch(v, event); &#125; &#125;); And in onContentTouch() we handle the ACTION_DOWN, ACTION_MOVE and ACTION_UP to allow dragging the content view Please note that we use getRawX() instead of getX() for consistent behavior. More information see PeyloW ‚Äòs answer here How do I know if a MotionEvent is relative or absolute? Here I use curX and diffX to track previous position and how the difference in distance. When user is dragging, we continuously update the content view ‚Äòs position. Please also prevent user from dragging beyond the left edge and right margin border When the user release his/her finger, we base on lastDiffX to decide if the menu should show or hide. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public boolean onContentTouch(View v, MotionEvent event) &#123; // Do nothing if sliding is in progress if(currentMenuState == MenuState.HIDING || currentMenuState == MenuState.SHOWING) return false; // getRawX returns X touch point corresponding to screen // getX sometimes returns screen X, sometimes returns content View X int curX = (int)event.getRawX(); int diffX = 0; switch(event.getAction()) &#123; case MotionEvent.ACTION_DOWN: //Log.d(\"MainLayout.java onContentTouch()\", \"Down x \" + curX); prevX = curX; return true; case MotionEvent.ACTION_MOVE: //Log.d(\"MainLayout.java onContentTouch()\", \"Move x \" + curX); // Set menu to Visible when user start dragging the content View if(!isDragging) &#123; isDragging = true; menu.setVisibility(View.VISIBLE); &#125; // How far we have moved since the last position diffX = curX - prevX; // Prevent user from dragging beyond border if(contentXOffset + diffX &lt;= 0) &#123; // Don't allow dragging beyond left border // Use diffX will make content cross the border, so only translate by -contentXOffset diffX = -contentXOffset; &#125; else if(contentXOffset + diffX &gt; mainLayoutWidth - menuRightMargin) &#123; // Don't allow dragging beyond menu width diffX = mainLayoutWidth - menuRightMargin - contentXOffset; &#125; // Translate content View accordingly content.offsetLeftAndRight(diffX); contentXOffset += diffX; // Invalite this whole MainLayout, causing onLayout() to be called this.invalidate(); prevX = curX; lastDiffX = diffX; return true; case MotionEvent.ACTION_UP: //Log.d(\"MainLayout.java onContentTouch()\", \"Up x \" + curX); Log.d(\"MainLayout.java onContentTouch()\", \"Up lastDiffX \" + lastDiffX); // Start scrolling // Remember that when content has a chance to cross left border, lastDiffX is set to 0 if(lastDiffX &gt; 0) &#123; // User wants to show menu currentMenuState = MenuState.SHOWING; // No need to set to Visible, because we have set to Visible in ACTION_MOVE //menu.setVisibility(View.VISIBLE); //Log.d(\"MainLayout.java onContentTouch()\", \"Up contentXOffset \" + contentXOffset); // Start scrolling from contentXOffset menuScroller.startScroll(contentXOffset, 0, menu.getLayoutParams().width - contentXOffset, 0, SLIDING_DURATION); &#125; else if(lastDiffX &lt; 0) &#123; // User wants to hide menu currentMenuState = MenuState.HIDING; menuScroller.startScroll(contentXOffset, 0, -contentXOffset, 0, SLIDING_DURATION); &#125; // Begin querying menuHandler.postDelayed(menuRunnable, QUERY_INTERVAL); // Invalite this whole MainLayout, causing onLayout() to be called this.invalidate(); // Done dragging isDragging = false; prevX = 0; lastDiffX = 0; return true; default: break; &#125; return false; &#125;","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"Make your own sliding menu on Android tutorial - Part 1","slug":"Make-your-own-sliding-menu-on-Android-tutorial-Part-1","date":"2018-02-27T11:07:48.000Z","updated":"2019-06-21T07:55:59.000Z","comments":true,"path":"blog/Make-your-own-sliding-menu-on-Android-tutorial-Part-1/","link":"","permalink":"https://onmyway133.github.io/blog/Make-your-own-sliding-menu-on-Android-tutorial-Part-1/","excerpt":"Issue #151 This post was from long time ago when I did Android I can‚Äôt deny that Facebook is so amazing, they made trends and people want to follow. That is the case of the sliding menu. Searching many threads on SO, like these create android Sliding Menu like Facebook,gmail, Android sliding menu similar to the one on facebook, Android - Sliding menu with sub menu ‚Ä¶ they will mostly introduce you to some good sliding menu libraries, like this SlidingMenu and some tutorials on how to use it. And of course, not forget to mention the Navigation Drawer that shipped with the Android SDK If you are a do-it-yourself guy like me, then here is the tutorial for you. It is mostly based on the following Youtube videos and guides","text":"Issue #151 This post was from long time ago when I did Android I can‚Äôt deny that Facebook is so amazing, they made trends and people want to follow. That is the case of the sliding menu. Searching many threads on SO, like these create android Sliding Menu like Facebook,gmail, Android sliding menu similar to the one on facebook, Android - Sliding menu with sub menu ‚Ä¶ they will mostly introduce you to some good sliding menu libraries, like this SlidingMenu and some tutorials on how to use it. And of course, not forget to mention the Navigation Drawer that shipped with the Android SDK If you are a do-it-yourself guy like me, then here is the tutorial for you. It is mostly based on the following Youtube videos and guides Creating a Slide-In Menu in Android - Part 1: Showing the menu Creating a Slide-In Menu in Adnroid - Part 2: Adding animation The Making of Prixing #1: Fly-in App Menu The Making of Prixing #2: Swiping the Fly-in App Menu The Making of Prixing #3: Polishing the Sliding App Menu WHAT WILL WE ACHIEVEThe final result of this tutorial will look like this. User will then be able to get the menu by touching the Menu button, or just by dragging. The menu contains a list of Android UI controls and when selected, the main content view will shows the according screen. The source code is available on Github THE IDEAA sliding menu app typically has 2 views : the menu view (the green rectangle) and the content view (the red rectangle) We have many ways to implement the sliding effect, all depend on your intention Let the menu view hold still, while moving the content view. The content view usually sits on top of the menu view and cover the entire screen Opposite of 1. Let the content view hold still, while moving the menu view. The menu usually sits on top of the content view and occupy some amount of space, so that user can touch and drag it The same as 2. but when the menu is moving, the content is moving, too. When the menu is shown, we should disable interacting with the content view. The 1st solution is what we will do in this tutorial. It‚Äôs much the same with Facebook sliding menu OVERVIEW OF THE PROJECTFor better understanding, you should take a look at the project to see how things are organized /src/com.entropy.slidingmenu2 MainActivity.java : this should be your first screen. It contains the MainLayout and handle ListView click event to display the right content /src/com.entropy.slidingmenu2.fragment FragmentMain.java : the default content view FragmentButton.java : show one button on the content view The content view is really simple since it‚Äôs just for demo. I use Fragment so we can easily change the content view according to the ListView item selected /src/com.entropy.slidingmenu2.layout MainLayout.java : the most important part of this tutorial. For ease and reusability, it‚Äôs best to create a custom LinearLayout. This will be used to position the menu and content views appropriately and handle sliding effect /res/layout activity.main: represent the visual structure for MainLayout fragment_main: represent the content view THE PREPARATIONI list here the required knowledge just for reference Fragment : used to show the content view Support library : we use v4 in this tutorial to support Fragment for older devices Custom layout : our MainLayout is a custom layout Scroller : to facilitate the sliding animation Gesture : to allow drag and drop Without further ado, let‚Äôs get started DESIGNING activity_main.xmlThe activity_main.xml represents the content of our custom layout. Since its a custom layout, we must declare like this 123&lt;com.entropy.slidingmenu2.layout.MainLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" &gt; Inside it are the 2 LinearLayout. Both are declared with attributes but the final display will be decided by the code :) 12android:layout_width=\"match_parent\"android:layout_height=\"match_parent\" The first is for the menu, which holds a ListView The second is for the content, which holds the simulated action bar ^^ and the FrameLayout. The FrameLayout is where fragments will show up WORKING WITH MainActivity.javaThe MainActivity is the default activity, it contains our MainLayout and handle menu item selection In the onCreate() method, we do the following Inflate the MainLayout and its as the contentView for our activity 12mainLayout = (MainLayout)this.getLayoutInflater().inflate(R.layout.activity_main, null);setContentView(mainLayout); Init the ListView for the menu 1234567891011lvMenuItems = getResources().getStringArray(R.array.menu_items); lvMenu = (ListView) findViewById(R.id.activity_main_menu_listview); lvMenu.setAdapter(new ArrayAdapter(this, android.R.layout.simple_list_item_1, lvMenuItems)); lvMenu.setOnItemClickListener(new OnItemClickListener() &#123; @Override public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123; onMenuItemClick(parent, view, position, id); &#125; &#125;); Init the menu button 12345678btMenu = (Button) findViewById(R.id.activity_main_content_button_menu); btMenu.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; // Show/hide the menu toggleMenu(v); &#125; &#125;); Display FragmentMain as the initial Fragment for our content view 123456FragmentManager fm = MainActivity.this.getSupportFragmentManager();FragmentTransaction ft = fm.beginTransaction();FragmentMain fragment = new FragmentMain();ft.add(R.id.activity_main_content_fragment, fragment);ft.commit(); The toggleMenu() is a utility method to toggle the menu, it will calls MainLayout ‚Äòs toggleMenu() method. We ‚Äòll talk about this later onMenuItemClick() is used to handle menu item selection. What it does is to create the according Fragment and replace it with the current one Handle the Back button. If the menu is shown, we should hide it, or we can quit the app 123456789@Override public void onBackPressed() &#123; if (mainLayout.isMenuShown()) &#123; mainLayout.toggleMenu(); &#125; else &#123; super.onBackPressed(); &#125; &#125; Let‚Äôs continue to part 2","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"Some interesting repositories","slug":"Some-interesting-repositories","date":"2018-02-15T12:48:02.000Z","updated":"2018-04-13T12:17:33.000Z","comments":true,"path":"blog/Some-interesting-repositories/","link":"","permalink":"https://onmyway133.github.io/blog/Some-interesting-repositories/","excerpt":"","text":"Issue #150 Cool https://github.com/GoogleChrome/puppeteer üôÑ https://github.com/kelseyhightower/nocode https://github.com/jackdclark/five https://github.com/auchenberg/volkswagen","categories":[],"tags":[]},{"title":"Dealing with updated pod in BuddyBuild","slug":"Dealing-with-updated-pod-in-BuddyBuild","date":"2018-02-01T11:37:57.000Z","updated":"2018-02-01T11:37:57.000Z","comments":true,"path":"blog/Dealing-with-updated-pod-in-BuddyBuild/","link":"","permalink":"https://onmyway133.github.io/blog/Dealing-with-updated-pod-in-BuddyBuild/","excerpt":"","text":"Issue #149 We‚Äôre using BuddyBuild as our CI. Today one of our dependencies gets a sweat update https://github.com/hyperoslo/BarcodeScanner/releases/tag/4.1.1. So we pod update BarcodeScanner in one of our projects that depends on it. All is fine when running locally. So I make a Pull Request and wait for the build to kick off in BuddyBuild. For some reason, BuddyBuild can‚Äôt pick up the right version of Cocoapods, hence can‚Äôt update the new pods. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[!] The version of CocoaPods used to generate the lockfile (1.3.1) is higher than the version of the current executable (1.1.1). Incompatibility issues may arise.=== CocoaPods ===104 Switching CocoaPods version to 1.1.1105 Using Command Line: gem cleanup &quot;cocoapods&quot;106 Using Command Line: gem uninstall &quot;cocoapods&quot; --all --executables --force107 Using Command Line: gem install &quot;cocoapods&quot; --no-rdoc --no-ri --version &quot;1.1.1&quot;108 Unpacking caches - cocoapods pod specs109 Using Command Line: pod install --no-repo-update110 Analyzing dependencies111 Pre-downloading: `Tailor` from `https://github.com/zenangst/Tailor`, tag `3.0.0`112 [!] Unable to satisfy the following requirements:113 - `BarcodeScanner (~&gt; 4.0)` required by `Podfile`114 - `BarcodeScanner (~&gt; 4.0)` required by `Podfile`115 - `BarcodeScanner (~&gt; 4.0)` required by `Podfile`116 - `BarcodeScanner (~&gt; 4.0)` required by `Podfile`117 - `BarcodeScanner (~&gt; 4.0)` required by `Podfile`118 - `BarcodeScanner (~&gt; 4.0)` required by `Podfile`119 - `BarcodeScanner (= 4.1.1)` required by `Podfile.lock`120 None of your spec sources contain a spec satisfying the dependencies: `BarcodeScanner (~&gt; 4.0), BarcodeScanner (= 4.1.1)`.121 You have either:122 * out-of-date source repos which you can update with `pod repo update`.123 * mistyped the name or version.124 * not added the source repo that hosts the Podspec to your Podfile.125 Note: as of CocoaPods 1.0, `pod repo update` does not happen on `pod install` by default. Trying scriptSo I thought I could run some custom script to force BuddyBuild to update the pods. Start with https://docs.buddybuild.com/builds/custom_build_steps.html I commit the file buddybuild_postclone.sh with 1234#!/usr/bin/env bash pod repo updatepod update BarcodeScanner Didn‚Äôt work. I then update the script with 12345#!/usr/bin/env bash pod repo remove masterpod setuppod install Didn‚Äôt work. Taking a closer look at the log. I see 1Switching CocoaPods version to 1.1.1 It seems BuddyBuild is using cocoapods 1.1.1. Mine is 1.4.0. Specifying cocoapods versionSo I need to specify the correct cocoapods version to make sure I and BuddyBuild are on the same page 12gem install bundlerbundler init And in my Gemfile 1234567# frozen_string_literal: truesource &quot;https://rubygems.org&quot;git_source(:github) &#123;|repo_name| &quot;https://github.com/#&#123;repo_name&#125;&quot; &#125;gem &quot;cocoapods&quot;, &apos;~&gt; 1.0&apos; Then run 1bundler install And check Gemfile.lock to make sure everything is OK FinallyCommit the changes, and now BuddyBuild is picking up the right cocoapods version, hence using the new pods 123456789101112131415=== CocoaPods ===45 Switching CocoaPods version to 1.4.046 Using Command Line: gem cleanup &quot;cocoapods&quot;47 Using Command Line: gem uninstall &quot;cocoapods&quot; --all --executables --force48 Using Command Line: gem install &quot;cocoapods&quot; --no-rdoc --no-ri --version &quot;1.4.0&quot;49 Unpacking caches - cocoapods pod specs50 Using Command Line: pod install --no-repo-update","categories":[],"tags":[]},{"title":"Learning from Open Source  Generic Factory","slug":"Learning-from-Open-Source-Generic-Factory","date":"2018-01-26T12:40:28.000Z","updated":"2019-09-12T06:25:25.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Generic-Factory/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Generic-Factory/","excerpt":"","text":"Issue #148 From https://github.com/devxoul/Pure/blob/master/Sources/Pure/FactoryModule.swift 12345678public protocol FactoryModule: Module &#123; /// A factory for `Self`. associatedtype Factory = Pure.Factory&lt;Self&gt; /// Creates an instance of a module with a dependency and a payload. init(dependency: Dependency, payload: Payload)&#125; From https://github.com/devxoul/Pure/blob/master/Sources/Pure/Factory.swift 12345678910111213141516171819202122open class Factory&lt;Module: FactoryModule&gt; &#123; private let dependencyClosure: () -&gt; Module.Dependency /// A static dependency of a module. open var dependency: Module.Dependency &#123; return self.dependencyClosure() &#125; /// Creates an instance of `Factory`. /// /// - parameter dependency: A static dependency which should be resolved in a composition root. public init(dependency: @autoclosure @escaping () -&gt; Module.Dependency) &#123; self.dependencyClosure = dependency &#125; /// Creates an instance of a module with a runtime parameter. /// /// - parameter payload: A runtime parameter which is required to construct a module. open func create(payload: Module.Payload) -&gt; Module &#123; return Module.init(dependency: self.dependency, payload: payload) &#125;&#125; From https://github.com/devxoul/Pure/blob/master/Tests/PureTests/PureSpec.swift#L72 123456let factory = FactoryFixture&lt;Dependency, Payload&gt;.Factory(dependency: .init( networking: \"Networking A\"))let instance = factory.create(payload: .init(id: 100))expect(instance.dependency.networking) == \"Networking A\"expect(instance.payload.id) == 100","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Using camelCase for abbreviations","slug":"Using-camelCase-for-abbreviations","date":"2018-01-26T12:02:44.000Z","updated":"2019-09-12T06:25:13.000Z","comments":true,"path":"blog/Using-camelCase-for-abbreviations/","link":"","permalink":"https://onmyway133.github.io/blog/Using-camelCase-for-abbreviations/","excerpt":"","text":"Issue #147 Each language and platform has its own coding style guide. This goes true when it comes to abbreviations. I‚Äôve had some debates about whether to use JSON or Json, URL or Url, HTTP or Http. I personally prefer camelCase, so I‚Äôm very happy to see that Kotlin is on my side. See Kotlin Style guide, I think this guide should be applied in other languages, such as Swift üòõ Sometimes there is more than one reasonable way to convert an English phrase into camel case, such as when acronyms or unusual constructs like ‚ÄúIPv6‚Äù or ‚ÄúiOS‚Äù are present. To improve predictability, use the following scheme. Beginning with the prose form of the name: Convert the phrase to plain ASCII and remove any apostrophes. For example, ‚ÄúM√ºller‚Äôs algorithm‚Äù might become ‚ÄúMuellers algorithm‚Äù. Divide this result into words, splitting on spaces and any remaining punctuation (typically hyphens). Recommended: if any word already has a conventional camel-case appearance in common usage, split this into its constituent parts (e.g., ‚ÄúAdWords‚Äù becomes ‚Äúad words‚Äù). Note that a word such as ‚ÄúiOS‚Äù is not really in camel case per se; it defies any convention, so this recommendation does not apply. Now lowercase everything (including acronyms), then uppercase only the first character of: ‚Ä¶each word, to yield pascal case, or ‚Ä¶each word except the first, to yield camel case Finally, join all the words into a single identifier. Note that the casing of the original words is almost entirely disregarded. Prose form Correct Incorrect ‚ÄúXML Http Request‚Äù XmlHttpRequest XMLHTTPRequest ‚Äúnew customer ID‚Äù newCustomerId newCustomerID ‚Äúinner stopwatch‚Äù innerStopwatch innerStopWatch ‚Äúsupports IPv6 on iOS‚Äù supportsIpv6OnIos supportsIPv6OnIOS ‚ÄúYouTube importer‚Äù YouTubeImporterYoutubeImporter* About iOS or IOS, I think I would go with IOS. I think React Native thinks so too NavigatorIOS looks and feels just like UINavigationController, because it is actually built on top of it. Read more https://softwareengineering.stackexchange.com/questions/186277/should-the-variable-be-named-id-or-id https://swift.org/documentation/api-design-guidelines/#promote-clear-usage https://github.com/raywenderlich/swift-style-guide#naming","categories":[],"tags":[{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Learning sine","slug":"Learning-sine","date":"2018-01-26T11:53:54.000Z","updated":"2019-09-12T06:29:25.000Z","comments":true,"path":"blog/Learning-sine/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-sine/","excerpt":"","text":"Issue #146 To be written ‚Ä¶ Old math equations become useful today üòç v = 1 - x From https://www.desmos.com/calculator","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"How to fix Uncaught Error Cannot find module react","slug":"How-to-fix-Uncaught-Error-Cannot-find-module-react","date":"2018-01-17T14:24:55.000Z","updated":"2019-05-23T17:13:25.000Z","comments":true,"path":"blog/How-to-fix-Uncaught-Error-Cannot-find-module-react/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-fix-Uncaught-Error-Cannot-find-module-react/","excerpt":"","text":"Issue #145 This is my story through dealing with many dependencies when trying to package an electron app. Thanks to my friend https://github.com/timkurvers for helping me out ‚ù§Ô∏è This is like a note for my future self Fixing eventThe other I got an issue https://github.com/onmyway133/PushNotifications/issues/3 that reports there‚Äôs something wrong with production environment. The problem is that I used RadioButton and its onChange callback takes 2 parameters instead of 1. Trying packagingAfter the fix, I bump version in package.json and run yarn release. To my surprise, the built app was just blank. I tried win.toggleDevTools() to see what‚Äôs going on. I can‚Äôt use shortcut to open the dev tool any more in production, but there are tools https://github.com/sindresorhus/electron-debug. The console says that it can‚Äôt find the module ‚Äòreact‚Äô. I then submitted an issue https://github.com/electron-userland/electron-packager/issues/787 Uncaught Error: Cannot find module ‚Äòreact‚Äô My environment Node v8.4.0 npm 5.3.0 yarn 1.3.2 macOS 10.13.2 Inspecting with debug modeI then need to run in debug mode to see what‚Äôs really happening 1DEBUG=electron-packager npm run release The log says something about npm Command failed: npm prune ‚Äìproduction Digging a little, I found that this is quite a common issue https://github.com/electron-userland/electron-packager/issues/686 https://github.com/npm/npm/issues/17781 I think the issue may be because of I changed from https://github.com/creationix/nvm to https://github.com/nodenv/nodenv Updating nodenvThe latest stable version of https://nodejs.org/en/ is 8.9.4. To enable nodenv to see it, we need 1brew upgrade node-build Run the following so that you actually see the 8.9.4 1nodenv install --list Updating node.jsInstall version 8.9.4 123nodenv install 8.9.4nodenv global 8.9.4nodenv rehash Updating npmRun the following to update npm to 5.6.0 1npm update -g np Installing dependencies from scratchClear old node_modules and package-lock.json 12rm -rf node_modulesrm -rf package-lock.json Then install again 1npm install PackagingThe final step is to package the app again 1yarn release","categories":[],"tags":[]},{"title":"How to use standalone UINavigationBar in iOS","slug":"How-to-use-standalone-UINavigationBar-in-iOS","date":"2018-01-10T12:40:08.000Z","updated":"2019-10-01T08:25:05.000Z","comments":true,"path":"blog/How-to-use-standalone-UINavigationBar-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-standalone-UINavigationBar-in-iOS/","excerpt":"","text":"Issue #144 There are times we want the same UIViewController to look good when it‚Äôs presented modally or pushed from UINavigationController stack. Take a look at BarcodeScanner and the PR https://github.com/hyperoslo/BarcodeScanner/pull/82 When it is presented, we need a header view so that we can show a title and a close button. We can create a custom HeaderView that inherits from UIView or either embed it in a UINavigationController before presenting. If we go with the controller being embedded in UINavigationController approach, it will collide with the other UINavigationController when it is pushed. If we go with custom HeaderView, then we need to layout the view so that it looks good on both portrait and landscape, and on iPhone X that as safeAreaLayoutGuide. Using standalone UINavigationBarSince UINavigationController uses UINavigationBar under the hood, which uses UINavigationItem info to present the content. We can imitate this behavior by using a standalone UINavigationBar. See Adding Content to a Standalone Navigation Bar In the vast majority of scenarios you will use a navigation bar as part of a navigation controller. However, there are situations for which you might want to use the navigation bar UI and implement your own approach to content navigation. In these situations, you can use a standalone navigation bar. A navigation bar manages a stack of UINavigationItem objects The beauty is that our standalone UINavigationBar and that of UINavigationController are the same, use the same UINavigationItem and no manual layout are needed Declare UINavigationItemWe can just set properties like we did with a normal navigationItem 123let standaloneItem = UINavigationItem()standaloneItem.leftBarButtonItem = UIBarButtonItem(customView: closeButton)standaloneItem.titleView = UILabel() Adding UINavigationBarCustomise your bar, then declare layout constraints. You only need to pin left, right, and top. Note that you need to implement UINavigationBarDelegate to attach bar to status bar, so that it appears good on iPhone X too 123456789101112131415let navigationBar = UINavigationBar()navigationBar.isTranslucent = falsenavigationBar.delegate = selfnavigationBar.backgroundColor = .whitenavigationBar.items = [standaloneItem] navigationBar.translatesAutoresizingMaskIntoConstraints = falsenavigationBar.leftAnchor.constraint(equalTo: view.leftAnchor).isActive = truenavigationBar.rightAnchor.constraint(equalTo: view.rightAnchor).isActive = true if #available(iOS 11, *) &#123; navigationBar.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor).isActive = true&#125; else &#123; navigationBar.topAnchor.constraint(equalTo: view.topAnchor).isActive = true&#125; 12345extension BarcodeScannerController: UINavigationBarDelegate &#123; public func position(for bar: UIBarPositioning) -&gt; UIBarPosition &#123; return .topAttached &#125;&#125; Inside UINavigationControllerWhen this UIViewController is pushed from a UINavigationController stack, we just need to hide our standalone navigationBar. If we prefer the default back button, we don‚Äôt need to set leftBarButtonItem On iOS 10, you need to call sizeToFit for any items in UINavigationItem for it to get actual size 123456789101112override func viewWillAppear(_ animated: Bool) &#123; super.viewWillAppear(animated) if navigationController != nil &#123; let label = HeaderElement.makeLabel() label.sizeToFit() navigationItem.titleView = label navigationBar.isHidden = true &#125; else &#123; navigationBar.isHidden = false &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to deal with animation in UITests in iOS","slug":"How-to-deal-with-animation-in-UITests-in-iOS","date":"2018-01-08T14:12:54.000Z","updated":"2019-09-23T12:50:16.000Z","comments":true,"path":"blog/How-to-deal-with-animation-in-UITests-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-animation-in-UITests-in-iOS/","excerpt":"","text":"Issue #143 Today I was writing tests and get this error related to app idle 1t = 23.06s Assertion Failure: &lt;unknown&gt;:0: Failed to scroll to visible (by AX action) Button, 0x6000003827d0, traits: 8858370049, label: &apos;cart&apos;, error: Error -25204 performing AXAction 2003 on element &lt;XCAccessibilityElement: 0x7fc391a2bd60&gt; pid: 91461, elementOrHash.elementID: 140658975676048.128 It turns out that the project uses a HUD that is performing some progress animation. Even it was being called HUD.hide(), the problem still exists. 1234t = 31.55s Wait for no.example.MyApp to idle t = 91.69s App animations complete notification not received, will attempt to continue. t = 91.70s Tap Target Application 0x6040002a1260 t = 91.70s Wait for no.example.MyApp to id No matter how I call sleep,wait`, still the problem 123sleep(10)app.tap()_ = checkoutButton.waitForExistence(timeout: 10) The fix is to disable animation. Start with setting argument when running tests 12app.launchArguments.append(\"--UITests\")app.launch Then in AppDelegate 12345func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool &#123; if CommandLine.arguments.contains(\"--UITests\") &#123; UIView.setAnimationsEnabled(false) &#125;&#125;","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"},{"name":"testing","slug":"testing","permalink":"https://onmyway133.github.io/tags/testing/"}]},{"title":"How to generate QR code in AppKit","slug":"How-to-generate-QR-code-in-AppKit","date":"2018-01-06T17:41:50.000Z","updated":"2019-09-12T07:10:14.000Z","comments":true,"path":"blog/How-to-generate-QR-code-in-AppKit/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-generate-QR-code-in-AppKit/","excerpt":"","text":"Issue #140 I need to generate QR code in https://github.com/onmyway133/AddressGenerator. Fortunately with CoreImage filter, it is very easy. Code is in Swift 4 123456789101112131415161718192021222324252627282930313233343536import AppKitfinal class QRCodeGenerator &#123; func generate(string: String, size: CGSize) -&gt; NSImage? &#123; guard let data = string.data(using: .utf8) else &#123; return nil &#125; // Filter guard let filter = CIFilter(name: \"CIQRCodeGenerator\") else &#123; return nil &#125; filter.setValue(data, forKey: \"inputMessage\") filter.setValue(\"Q\", forKey: \"inputCorrectionLevel\") // CIImage guard let ciImage = filter.outputImage else &#123; return nil &#125; // NSImage let rep = NSCIImageRep(ciImage: ciImage) let image = NSImage(size: rep.size) image.addRepresentation(rep) // Scale let finalImage = NSImage(size: size) finalImage.lockFocus() NSGraphicsContext.current?.imageInterpolation = .none image.draw(in: NSRect(origin: .zero, size: size)) finalImage.unlockFocus() return finalImage &#125;&#125;","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to use Function Literals with Receiver in Kotlin","slug":"How-to-use-Function-Literals-with-Receiver-in-Kotlin","date":"2018-01-05T12:54:26.000Z","updated":"2019-09-12T07:10:39.000Z","comments":true,"path":"blog/How-to-use-Function-Literals-with-Receiver-in-Kotlin/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Function-Literals-with-Receiver-in-Kotlin/","excerpt":"","text":"Issue #139 From https://kotlinlang.org/docs/reference/lambdas.html 1234567891011121314class HTML &#123; fun body() &#123; ... &#125;&#125;fun html(init: HTML.() -&gt; Unit): HTML &#123; val html = HTML() // create the receiver object html.init() // pass the receiver object to the lambda return html&#125;html &#123; // lambda with receiver begins here body() // calling a method on the receiver object&#125; From https://github.com/JetBrains/kotlin/blob/master/libraries/stdlib/src/kotlin/util/Standard.kt 12345678910111213@kotlin.internal.InlineOnlypublic inline fun &lt;T&gt; T.apply(block: T.() -&gt; Unit): T &#123; contract &#123; callsInPlace(block, InvocationKind.EXACTLY_ONCE) &#125; block() return this&#125;val person = Person().apply &#123; name = \"Superman\" age = 20&#125; From https://academy.realm.io/posts/kau-jake-wharton-testing-robots/ 1234567891011121314151617181920212223242526272829fun payment(func: PaymentRobot.() -&gt; Unit) = PaymentRobot().apply &#123; func() &#125;class PaymentRobot &#123; fun amount(amount: Long) &#123; &#125; fun recipient(recipient: String) &#123; &#125; infix fun send(func: ResultRobot.() -&gt; Unit): ResultRobot &#123; // ... return ResultRobot().apply &#123; func() &#125; &#125;&#125;class ResultRobot &#123; func isSuccess() &#123; &#125;&#125;payment &#123; amount(4200) recipient(superman@google.com)&#125; send &#123; isSuccess()&#125;","categories":[],"tags":[{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"How to use R.swift in UITest in iOS","slug":"How-to-use-R.swift-in-UITest-in-iOS","date":"2018-01-05T10:22:38.000Z","updated":"2019-08-26T10:28:43.000Z","comments":true,"path":"blog/How-to-use-R.swift-in-UITest-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-R.swift-in-UITest-in-iOS/","excerpt":"","text":"Issue #138 Here is how to use R.swift in UITest target Add Localizable.strings to UITest target Declare pod 123target 'MyAppUITests' do pod 'R.swift', '~&gt; 4.0'end In UITest target settings, add $(FRAMEWORK_SEARCH_PATHS) to Runpath Search Path Add R.generated.swift to UITest target","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Hiding back button in navigation bar in iOS","slug":"Hiding-back-button-in-navigation-bar-in-iOS","date":"2018-01-04T08:25:12.000Z","updated":"2019-09-12T06:24:36.000Z","comments":true,"path":"blog/Hiding-back-button-in-navigation-bar-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/Hiding-back-button-in-navigation-bar-in-iOS/","excerpt":"","text":"Issue #137 Use a custom NavigationController 12345678910111213141516import UIKitclass NavigationController: UINavigationController &#123; override func viewDidLoad() &#123; super.viewDidLoad() navigationBar.tintColor = .white navigationBar.barStyle = .black navigationBar.isTranslucent = false &#125; override func pushViewController(_ viewController: UIViewController, animated: Bool) &#123; viewController.navigationItem.backBarButtonItem = UIBarButtonItem(title: \"\", style: .plain, target: nil, action: nil) super.pushViewController(viewController, animated: animated) &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Some Swift tips","slug":"Some-Swift-tips","date":"2018-01-03T14:09:55.000Z","updated":"2019-09-12T06:24:30.000Z","comments":true,"path":"blog/Some-Swift-tips/","link":"","permalink":"https://onmyway133.github.io/blog/Some-Swift-tips/","excerpt":"","text":"Issue #136 Adding final https://gist.github.com/krzysztofzablocki/8c9a6c428cf5fcf19effca223a5548cd","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Learning from Open Source  Making Deferred in Kotlin","slug":"Learning-from-Open-Source-Making-Deferred-in-Kotlin","date":"2018-01-03T12:52:21.000Z","updated":"2019-09-12T06:23:30.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Making-Deferred-in-Kotlin/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Making-Deferred-in-Kotlin/","excerpt":"","text":"Issue #135 From https://github.com/JakeWharton/retrofit2-kotlin-coroutines-adapter/blob/master/src/main/java/com/jakewharton/retrofit2/adapter/kotlin/coroutines/experimental/CoroutineCallAdapterFactory.kt#L86 12345678910111213141516171819202122232425override fun adapt(call: Call&lt;T&gt;): Deferred&lt;T&gt; &#123; val deferred = CompletableDeferred&lt;T&gt;() deferred.invokeOnCompletion &#123; if (deferred.isCancelled) &#123; call.cancel() &#125; &#125; call.enqueue(object : Callback&lt;T&gt; &#123; override fun onFailure(call: Call&lt;T&gt;, t: Throwable) &#123; deferred.completeExceptionally(t) &#125; override fun onResponse(call: Call&lt;T&gt;, response: Response&lt;T&gt;) &#123; if (response.isSuccessful) &#123; deferred.complete(response.body()!!) &#125; else &#123; deferred.completeExceptionally(HttpException(response)) &#125; &#125; &#125;) return deferred&#125;","categories":[],"tags":[{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"Learning from Open Source  Using dylib in macOS applications","slug":"Learning-from-Open-Source-Using-dylib-in-macOS-applications","date":"2018-01-03T11:37:12.000Z","updated":"2019-09-12T06:23:44.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Using-dylib-in-macOS-applications/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Using-dylib-in-macOS-applications/","excerpt":"","text":"Issue #134 https://github.com/mortenjust/androidtool-mac https://github.com/mortenjust/droptogif","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"Using dlopen in iOS","slug":"Using-dlopen-in-iOS","date":"2018-01-02T07:48:51.000Z","updated":"2018-01-02T07:48:51.000Z","comments":true,"path":"blog/Using-dlopen-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/Using-dlopen-in-iOS/","excerpt":"","text":"Issue #133 With dlopen we can make uses of some private frameworks. It will be fun From iPhone X home button 1234567#import &lt;dlfcn.h&gt;// somewhere in viewDidLoaddlopen([binaryPath cStringUsingEncoding:NSUTF8StringEncoding], RTLD_NOW);UIView *const view = [[NSClassFromString(@\"SBHomeGrabberView\") alloc] init];[view sizeToFit];[self.view addSubview:view];","categories":[],"tags":[]},{"title":"Learning from Open Source  Hit testing with UIWindow","slug":"Learning-from-Open-Source-Hit-testing-with-UIWindow","date":"2017-12-22T11:10:43.000Z","updated":"2017-12-22T11:13:51.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Hit-testing-with-UIWindow/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Hit-testing-with-UIWindow/","excerpt":"","text":"Issue #132 From https://github.com/Flipboard/FLEX/blob/master/Classes/ExplorerInterface/FLEXWindow.m 12345678910111213141516171819202122- (id)initWithFrame:(CGRect)frame&#123; self = [super initWithFrame:frame]; if (self) &#123; self.backgroundColor = [UIColor clearColor]; // Some apps have windows at UIWindowLevelStatusBar + n. // If we make the window level too high, we block out UIAlertViews. // There's a balance between staying above the app's windows and staying below alerts. // UIWindowLevelStatusBar + 100 seems to hit that balance. self.windowLevel = UIWindowLevelStatusBar + 100.0; &#125; return self;&#125;- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event&#123; BOOL pointInside = NO; if ([self.eventDelegate shouldHandleTouchAtPoint:point]) &#123; pointInside = [super pointInside:point withEvent:event]; &#125; return pointInside;&#125; From https://github.com/Flipboard/FLEX/blob/master/Classes/ExplorerInterface/FLEXExplorerViewController.m 12345678910111213141516171819202122232425262728- (BOOL)shouldReceiveTouchAtWindowPoint:(CGPoint)pointInWindowCoordinates&#123; BOOL shouldReceiveTouch = NO; CGPoint pointInLocalCoordinates = [self.view convertPoint:pointInWindowCoordinates fromView:nil]; // Always if it's on the toolbar if (CGRectContainsPoint(self.explorerToolbar.frame, pointInLocalCoordinates)) &#123; shouldReceiveTouch = YES; &#125; // Always if we're in selection mode if (!shouldReceiveTouch &amp;&amp; self.currentMode == FLEXExplorerModeSelect) &#123; shouldReceiveTouch = YES; &#125; // Always in move mode too if (!shouldReceiveTouch &amp;&amp; self.currentMode == FLEXExplorerModeMove) &#123; shouldReceiveTouch = YES; &#125; // Always if we have a modal presented if (!shouldReceiveTouch &amp;&amp; self.presentedViewController) &#123; shouldReceiveTouch = YES; &#125; return shouldReceiveTouch;&#125;","categories":[],"tags":[]},{"title":"How to make NSCollectionView programatically in Swift","slug":"How-to-make-NSCollectionView-programatically-in-Swift","date":"2017-12-21T12:54:45.000Z","updated":"2019-05-16T12:09:50.000Z","comments":true,"path":"blog/How-to-make-NSCollectionView-programatically-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-NSCollectionView-programatically-in-Swift/","excerpt":"","text":"Issue #131 Here‚Äôs how to create NSCollectionView programatically. We need to embed it inside NScrollView for scrolling to work. Code is in Swift 4 NSCollectionView1234567891011121314let layout = NSCollectionViewFlowLayout()layout.minimumLineSpacing = 4collectionView = NSCollectionView()collectionView.dataSource = selfcollectionView.delegate = selfcollectionView.collectionViewLayout = layoutcollectionView.allowsMultipleSelection = falsecollectionView.backgroundColors = [.clear]collectionView.isSelectable = truecollectionView.register( Cell.self, forItemWithIdentifier: NSUserInterfaceItemIdentifier(rawValue: \"Cell\")) NScrollView123scrollView = NSScrollView()scrollView.documentView = collectionViewview.addSubview(scrollView) NSCollectionViewItem123456789final class Cell: NSCollectionViewItem &#123; let label = Label() let myImageView = NSImageView() override func loadView() &#123; self.view = NSView() self.view.wantsLayer = true &#125;&#125; NSCollectionViewDataSource12345678910111213141516171819func collectionView(_ collectionView: NSCollectionView, numberOfItemsInSection section: Int) -&gt; Int &#123; return coins.count&#125;func collectionView(_ collectionView: NSCollectionView, itemForRepresentedObjectAt indexPath: IndexPath) -&gt; NSCollectionViewItem &#123; let cell = collectionView.makeItem( withIdentifier: NSUserInterfaceItemIdentifier(rawValue: \"Cell\"), for: indexPath ) as! Cell let coin = coins[indexPath.item] cell.label.stringValue = coin.name cell.coinImageView.image = NSImage(named: NSImage.Name(rawValue: \"USD\")) ?? NSImage(named: NSImage.Name(rawValue: \"Others\")) return cell&#125; NSCollectionViewDelegateFlowLayout123456789101112131415161718192021func collectionView(_ collectionView: NSCollectionView, didSelectItemsAt indexPaths: Set&lt;IndexPath&gt;) &#123; guard let indexPath = indexPaths.first, let cell = collectionView.item(at: indexPath) as? Cell else &#123; return &#125;&#125;func collectionView(_ collectionView: NSCollectionView, didDeselectItemsAt indexPaths: Set&lt;IndexPath&gt;) &#123; guard let indexPath = indexPaths.first, let cell = collectionView.item(at: indexPath) as? Cell else &#123; return &#125;&#125;func collectionView(_ collectionView: NSCollectionView, layout collectionViewLayout: NSCollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; NSSize &#123; return NSSize( width: collectionView.frame.size.width, height: 40 )&#125;","categories":[],"tags":[]},{"title":"UnsafePointer in Swift","slug":"UnsafePointer-in-Swift","date":"2017-12-20T15:58:30.000Z","updated":"2019-09-12T06:25:05.000Z","comments":true,"path":"blog/UnsafePointer-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/UnsafePointer-in-Swift/","excerpt":"","text":"Issue #130 Code is in Swift 4 Constructing UnsafeMutablePointer12let byteCount = 32let result = UnsafeMutablePointer&lt;UInt8&gt;.allocate(capacity: byteCount) Data to UnsafePointer123456789101112131415extension Data &#123; func toPointer() -&gt; UnsafePointer&lt;UInt8&gt;? &#123; let buffer = UnsafeMutablePointer&lt;UInt8&gt;.allocate(capacity: count) let stream = OutputStream(toBuffer: buffer, capacity: count) stream.open() withUnsafeBytes(&#123; (p: UnsafePointer&lt;UInt8&gt;) -&gt; Void in stream.write(p, maxLength: count) &#125;) stream.close() return UnsafePointer&lt;UInt8&gt;(buffer) &#125;&#125; UnsafePointer to Data12345extension UnsafePointer &#123; func toData() -&gt; Data &#123; return Data(bytes: UnsafeRawPointer(self), count: 32) &#125;&#125; Dealing with C APIThis is how to do keccak hash using C API from https://github.com/ethereum/ethash/blob/master/src/libethash/sha3.c 12345678910111213class KeccakHash &#123; func hash(data: Data) throws -&gt; Data &#123; guard let dataPointer = data.toPointer() else &#123; throw InteralError.invalid &#125; let byteCount = 32 let result = UnsafeMutablePointer&lt;UInt8&gt;.allocate(capacity: byteCount) sha3_256(result, byteCount, dataPointer, data.count) return result.toData() &#125;&#125; Read more See https://github.com/onmyway133/Reindeers/blob/master/Sources/Extensions.swift How to import a C library in Swift using the Swift Package Manager","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to prevent UIVisualEffectView crash","slug":"How-to-prevent-UIVisualEffectView-crash","date":"2017-12-20T09:40:35.000Z","updated":"2019-09-12T07:10:27.000Z","comments":true,"path":"blog/How-to-prevent-UIVisualEffectView-crash/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-prevent-UIVisualEffectView-crash/","excerpt":"","text":"Issue #124 We all know that there‚Äôs a potential crash with UIVisualEffectView on iOS 11. The fix is to not add sub views directly to UIVisualEffectView, but to its contentView. So we should change 1effectView.addSubview(button) to 1effectView.contentView.addubView(button) Here we don‚Äôt need to perform iOS version check, because effectView.contentView works for any iOS versions. Potential cases for crashesHere are some cases you can potentially cause the crashes Strange namings Normally we name our UIVisualEffectView as blurView, effectView. But there‚Äôs times we name it differently like navigationView, containerView, boxView, ‚Ä¶ This way we may completely forget that it‚Äôs a UIVisualEffectView üôÄ 12containerView.addSubview(button)boxView.insertSubview(label, at: 0) Custom loadView Sometimes it‚Äôs convenient to have our UIViewController &#39;s view as a whole blur view, so that all things inside have a nice blur effect background 12345678910111213class OverlayController: UIViewController &#123; let blurView = UIVisualEffectView(effect: UIBlurEffect(style: .dark)) override func loadView() &#123; super.loadView() self.view = blurView &#125; override func viewDidLoad() &#123; super.viewDidLoad() view.addSubview(button) &#125;&#125; By setting our blurView as view in loadView, we have no idea afterwards that view is actually a UIVisualEffectView üôÄ Inheritance What happen if we have another UIViewController that inherits from our OverlayController, all it knows about view is UIView, it does not know that it is a disguising UIVisualEffectView üôÄ 1234567class ClocksController: OverlayController &#123; override func viewDidLoad() &#123; super.viewDidLoad() view.addSubview(timeLabel) &#125;&#125; Superclass type Sometimes declare our things but with protocol or superclass types. Consumers of our API have no clue to know that it is UIVisualEffectView üôÄ 1let view: UIView = UIVisualEffectView(effect: UIBlurEffect(style: .dark)) Here it appears to us that view is of type UIView Legacy codebase Now imagine you ‚Äòve handled a legacy codebase to deal with. Perform finding and replacing all those things related to UIVisualEffectView is very hard task. Especially since we tend to write less tests for UI Making it impossible to crashI like concept like Phantom type to limit interface. Here we‚Äôre not using type but a wrapper 123456789101112131415161718192021222324final class BlurView: UIView &#123; private let effectView: UIVisualEffectView init(style: UIBlurEffectStyle, backgroundColor: UIColor? = nil) &#123; self.effectView = UIVisualEffectView(effect: UIBlurEffect(style: style)) self.effectView.backgroundColor = backgroundColor super.init(frame: .zero) insertSubview(effectView, at: 0) &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125; override func addSubview(_ view: UIView) &#123; effectView.contentView.addSubview(view) &#125; override func layoutSubviews() &#123; super.layoutSubviews() effectView.frame = bounds &#125;&#125; Here we override addSubview to always add views to effectView.contentView. In the init method, we need to call insertSubview instead because of our overriden addSubview Now BlurView has a blur effect thanks to is underlying UIVisualEffectView, but expose only addSubview because of its UIView interface. This way it is impossible to cause crashes üòé 12let blurView = BlurView(style: .dark)blurView.addSubview(button(","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Understanding suspend function in Kotlin Coroutine in Android","slug":"Understanding-suspend-function-in-Kotlin-Coroutine-in-Android","date":"2017-12-18T14:41:21.000Z","updated":"2019-08-18T20:12:31.000Z","comments":true,"path":"blog/Understanding-suspend-function-in-Kotlin-Coroutine-in-Android/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-suspend-function-in-Kotlin-Coroutine-in-Android/","excerpt":"","text":"Issue #123 Getting to know CoroutineFrom https://kotlinlang.org/docs/reference/coroutines.html To continue the analogy, await() can be a suspending function (hence also callable from within an async {} block) that suspends a coroutine until some computation is done and returns its result: From https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html We are using the delay() function that‚Äôs like Thread.sleep(), but better: it doesn‚Äôt block a thread, but only suspends the coroutine itself. The thread is returned to the pool while the coroutine is waiting, and when the waiting is done, the coroutine resumes on a free thread in the pool. await() can not be called outside a coroutine, because it needs to suspend until the computation finishes, and only coroutines can suspend in a non-blocking way What does suspend function mean in Kotlin Coroutine ü§îhttps://stackoverflow.com/questions/47871868/what-does-suspend-function-mean-in-kotlin-coroutine I‚Äôm reading Kotlin Coroutine and know that it is based on suspend function. But what does suspend mean? Coroutine or function gets suspended? From https://kotlinlang.org/docs/reference/coroutines.html Basically, coroutines are computations that can be suspended without blocking a thread I heard people often say ‚Äúsuspend function‚Äù. But I think it is the coroutine who gets suspended because it is waiting for the function to finished? ‚Äúsuspend‚Äù usually means ‚Äúcease operation‚Äù, in this case the coroutine is idle. Should we say the coroutine is suspended ? Which coroutine gets suspended? From https://kotlinlang.org/docs/reference/coroutines.html To continue the analogy, await() can be a suspending function (hence also callable from within an async {} block) that suspends a coroutine until some computation is done and returns its result: 123456async &#123; // Here I call it the outer async coroutine ... // Here I call computation the inner coroutine val result = computation.await() ...&#125; ü§î It says ‚Äúthat suspends a coroutine until some computation is done‚Äù, but coroutine is like a lightweight thread. So if the coroutine is suspended, how can the computation is done ? We see await is called on computation, so it might be async that returns Deferred, which means it can start another coroutine 12345fun computation(): Deferred&lt;Boolean&gt; &#123; return async &#123; true &#125;&#125; ü§î The quote say that suspends a coroutine. Does it mean suspend the outer async coroutine, or suspend the inner computation coroutine? Does suspend mean that while outer async coroutine is waiting (await) for the inner computation coroutine to finish, it (the outer async coroutine) idles (hence the name suspend) and returns thread to the thread pool, and when the child computation coroutine finishes, it (the outer async coroutine) wakes up, takes another thread from the pool and continues? The reason I mention the thread is because of https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html The thread is returned to the pool while the coroutine is waiting, and when the waiting is done, the coroutine resumes on a free thread in the pool Understanding asyncFrom https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md Conceptually, async is just like launch. It starts a separate coroutine which is a light-weight thread that works concurrently with all the other coroutines. The difference is that launch returns a Job and does not carry any resulting value, while async returns a Deferred ‚Äì a light-weight non-blocking future that represents a promise to provide a result later. You can use .await() on a deferred value to get its eventual result, but Deferred is also a Job, so you can cancel it if needed. 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val time = measureTimeMillis &#123; val one = async &#123; doSomethingUsefulOne() &#125; val two = async &#123; doSomethingUsefulTwo() &#125; println(\"The answer is $&#123;one.await() + two.await()&#125;\") &#125; println(\"Completed in $time ms\")&#125; There is a laziness option to async using an optional start parameter with a value of CoroutineStart.LAZY. It starts coroutine only when its result is needed by some await or if a start function is invoked. Run the following example that differs from the previous one only by this option: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val time = measureTimeMillis &#123; val one = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulOne() &#125; val two = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulTwo() &#125; println(\"The answer is $&#123;one.await() + two.await()&#125;\") &#125; println(\"Completed in $time ms\")&#125; What is the difference between launch/join and async/await in Kotlin coroutineshttps://stackoverflow.com/a/48079738/1418457 I find this guide https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md to be useful. I will quote the essential parts ü¶Ñ coroutine Essentially, coroutines are light-weight threads. So you can think of coroutine as something that manages thread in a very efficient way. üê§ launch 12345678fun main(args: Array&lt;String&gt;) &#123; launch &#123; // launch new coroutine in background and continue delay(1000L) // non-blocking delay for 1 second (default time unit is ms) println(\"World!\") // print after delay &#125; println(\"Hello,\") // main thread continues while coroutine is delayed Thread.sleep(2000L) // block main thread for 2 seconds to keep JVM alive&#125; So launch starts a background thread, does something, and returns a token immediately as Job. You can call join on this Job to block until this launch thread completes 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = launch &#123; // launch new coroutine and keep a reference to its Job delay(1000L) println(\"World!\") &#125; println(\"Hello,\") job.join() // wait until child coroutine completes&#125; ü¶Ü async Conceptually, async is just like launch. It starts a separate coroutine which is a light-weight thread that works concurrently with all the other coroutines. The difference is that launch returns a Job and does not carry any resulting value, while async returns a Deferred ‚Äì a light-weight non-blocking future that represents a promise to provide a result later. So async starts a background thread, does something, and returns a token immediately as Deferred. 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val time = measureTimeMillis &#123; val one = async &#123; doSomethingUsefulOne() &#125; val two = async &#123; doSomethingUsefulTwo() &#125; println(\"The answer is $&#123;one.await() + two.await()&#125;\") &#125; println(\"Completed in $time ms\")&#125; You can use .await() on a deferred value to get its eventual result, but Deferred is also a Job, so you can cancel it if needed. So Deferred is actually a Job. See https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-deferred/index.html 1interface Deferred&lt;out T&gt; : Job (source) ü¶ã async is eager by default There is a laziness option to async using an optional start parameter with a value of CoroutineStart.LAZY. It starts coroutine only when its result is needed by some await or if a start function is invoked. Understand Kotlin Coroutines on Android (Google I/O‚Äô19)https://www.youtube.com/watch?v=BOHK_w09pVA","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"Hashable and Set in Swift","slug":"Hashable-and-Set-in-Swift","date":"2017-12-13T14:10:40.000Z","updated":"2019-09-12T06:24:22.000Z","comments":true,"path":"blog/Hashable-and-Set-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Hashable-and-Set-in-Swift/","excerpt":"","text":"Issue #122 From Set You can create a set with any element type that conforms to the Hashable protocol. By default, most types in the standard library are hashable, including strings, numeric and Boolean types, enumeration cases without associated values, and even sets themselves. From Hashable The Hashable protocol inherits from the Equatable protocol, so you must also add an equal-to operator (==) function for your custom type. 12345678public protocol Hashable : Equatable &#123; /// The hash value. /// /// Hash values are not guaranteed to be equal across different executions of /// your program. Do not save hash values to use during a future execution. public var hashValue: Int &#123; get &#125;&#125; Read more https://useyourloaf.com/blog/swift-hashable/ http://kelan.io/2015/swift-hashable-for-sets/","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Generic declaration in Swift","slug":"Generic-declaration-in-Swift","date":"2017-12-13T11:53:23.000Z","updated":"2017-12-13T11:53:23.000Z","comments":true,"path":"blog/Generic-declaration-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Generic-declaration-in-Swift/","excerpt":"","text":"Issue #121 These are different 1class DiffService&lt;T: MKAnnotation &amp; Equatable&gt; 1class DiffService&lt;T: MKAnnotation, Equatable&gt;","categories":[],"tags":[]},{"title":"A taste of MVVM and Reactive paradigm","slug":"A-taste-of-MVVM-and-Reactive-paradigm","date":"2017-12-07T16:41:32.000Z","updated":"2019-05-23T14:50:14.000Z","comments":true,"path":"blog/A-taste-of-MVVM-and-Reactive-paradigm/","link":"","permalink":"https://onmyway133.github.io/blog/A-taste-of-MVVM-and-Reactive-paradigm/","excerpt":"","text":"Issue #120 Original post https://medium.com/flawless-app-stories/a-taste-of-mvvm-and-reactive-paradigm-5288a819cca1 A taste of MVVM and Reactive paradigmI like Swift, like many other object oriented programming languages. Swift allows you to represent real world objects that have some characteristics and can perform some action. I tend to think of an app as a world where each object is a person. They work and communicate. If a person can‚Äôt do the work alone, he needs to ask for help. Take a project, for example, if the manager has to do all of the work by himself, he will go crazy. So there is a need to organise and delegate tasks, and for many persons to collaborate on the project: designer, tester, scrum master, developer. After the task is done, the manager needs to be informed. This may not a good example. But at least you get the importance of communication and delegation in OOP. I was very intrigued by the word ‚Äúarchitecture‚Äù when I started iOS programming. But after doing for a while, it all comes down to identifying and splitting responsibilities. This article tells a bit about MVC and simple Extract Classrefactoring to MVVM, and how to go further with Rx. You are free to create your own architecture, but whatever you do, consistence is key as to not confuse or surprise your teammates. Model View ControllerTake a look at the architecture you know the best, MVC, short for Model View Controller. You always get one when you create a new iOS project. View is where you present your data, using UIView, UIButton, UILabel. Model is just a fancy word for data. It can be your entity, data from networking, object from database, or from cache. The controller is the thing that mediates between the model and the view. UIViewController is the center of the universeThe problem with ViewController is that it tends to be huge. Apple puts it as the center of the universe, where it has lots of properties and responsibilities. There are many things that you can only do with a UIViewController. Things like interacting with storyboard, managing the view, configuring view rotation, state restoration. UIViewController is designed with lots of hooks for you to override and customize. Take a look at the many sections in UIViewController documentation, you can‚Äôt do the following without a UIViewController. func viewDidLoad() var preferredStatusBarStyle: UIStatusBarStyle { get } UITableViewDataSource var presentationController: UIPresentationController? { get } func childViewControllerForScreenEdgesDeferringSystemGestures() -&gt; UIViewController? func didMove(toParentViewController parent: UIViewController?) var systemMinimumLayoutMargins: NSDirectionalEdgeInsets var edgesForExtendedLayout: UIRectEdge var previewActionItems: [UIPreviewActionItem] var navigationItem: UINavigationItem var shouldAutorotate: BoolAs your app grows, we need to add more code for other logic. Such as networking, data source, handling multiple delegates, presenting child view controllers. We can, of course, put all the stuff on the view controller, but that results in big view controller and improvement in your scrolling skill. This is where you lose the big picture of responsibilities because all stuff stays in the mega view controller. You tend to introduce code duplication and bugs are hard to fix because they are all over the places. The same goes with Page in Windows Phone or Activity in Android. They are intended for a screen or partial screen of functionality. There are certain actions that can only be done through them like Page.OnNavigatedTo, Activity.onCreate. The buzzwords of architectureWhat do you do when the ViewController is doing a lot? You offset the work to other components. By the way, if you want another object to do the user input handling, you can use the Presenter. If the Presenter is doing too much, then it can offset the business logic to the Interactor. Also, there are more buzzwords that can be used. let buzzWords = [ &quot;Model&quot;, &quot;View&quot;, &quot;Controller&quot;, &quot;Entity&quot;, &quot;Router&quot;, &quot;Clean&quot;, &quot;Reactive&quot;, &quot;Presenter&quot;, &quot;Interactor&quot;, &quot;Megatron&quot;, &quot;Coordinator&quot;, &quot;Flow&quot;, &quot;Manager&quot; ] let architecture = buzzWords.shuffled().takeRandom() let acronym = architecture.makeAcronym() After all the buzzwords are assembled, we get an architecture. There are many of them, ranging from simple extract class refactoring, embracing MVC or taking inspiration from Clean Code, Rx, EventBus or Redux. The choice depends on project, and some teams prefer one architecture over the other. The pragmatic programmerPeople have different opinion about what is good architecture. For me, it is about clear separation of concern, good communication pattern and being comfortable to use. Each component in the architecture should be identifiable and have a specific role. The communication must be clear so that we know which object is talking to each other. This together with good dependency injection will make testing easier. Things that sound good in theory may not work well in practice. Separated domain objects are cool, protocol extensions are cool, multiple layers of abstraction are cool. But too many of them can be a problem. If you read enough about design patterns, you know they all come down to these simple principles: Encapsulate what varies: identify the aspects of your application that vary and separate them from what stays the same. Program to an interface, not an implementation Prefer composition over inheritance If there‚Äôs one thing we should master, it‚Äôs composition. The key is to identify responsibility and compose them in a reasonable and consistent way. Consult with your team mates on what suits the most. Always writing code with the thought that you will also be the future maintainer. Then you will write it differently. Don‚Äôt fight against the systemSome architectures introduce completely new paradigm. Some of them are cumbersome that there people write scripts to generate boiler plate code. It‚Äôs good that there are many approaches to a problem. But for me sometimes it feels they are fighting the system. Some tasks are made easy while some trivial tasks become extremely hard. We should not constrain ourselves to one architecture simply because it are trendy. Be pragmatic, not dogmatic. In iOS, we should embrace MVC. UIViewController is not meant for a full screen of content. They can contain and be composed to split the functionalities. We can use Coordinator and FlowController to manage dependencies and handle flow. Containerfor state transition, embedded logic controller, part of full screen content. This embracing ViewController approach play nicely with MVC in iOS and is my preferable way of doing. Model View ViewModel Another good-enough way is to offload some of the tasks to another object, let‚Äôs call it ViewModel. The name does not matter, you can name it Reactor, Maestro, Dinosaur. The important thing is your team get an agreed name. ViewModel takes some tasks from the ViewController and reports when it‚Äôs done. There are communication patterns in Cocoa Touch such as delegate, closures to use. ViewModel is self-contained, has no reference to UIKit, and has just input and output. We can put a lot of things into ViewModel like calculation, formatting, networking, business logic. Also, if you don‚Äôt like the ViewModel to become massive, you surely need to create some dedicated objects. ViewModel is the first step to get a slim ViewController. SynchronouslyBelow is a very simple ViewModel, which formats data based on User model. This is done synchronously. class ProfileController: UIViewController { override func viewDidLoad() { super.viewDidLoad() let viewModel = ViewModel(user: user) nameLabel.text = viewModel.name birthdayLabel.text = viewModel.birthdayString salaryLabel.text = viewModel.salary piLabel.text = viewModel.millionthDigitOfPi } }AsynchronouslyWe work with asynchronous API all the time. What if we want to show the user‚Äôs number of Facebook friends? For this to work we need to call Facebook API and this operation takes time. The ViewModel can report back via closure. viewModel.getFacebookFriends { friends in self.friendCountLabel.text = &quot;\\(friends.count)&quot; }Internally, the ViewModel may offload the task to a dedicated Facebook API client object. class ViewModel { func getFacebookFriends(completion: [User] -&gt; Void) { let client = APIClient() client.getFacebookFriends(for: user) { friends in DispatchQueue.main.async { completion(friends) } } } }Jetpack in Android Google introduced Android Architecture Component, now part of Jetpack, at Google IO 2017. It has ViewModel and LiveData, which is also a type of MVVM applied in Android. ViewModel survives through configuration changes, and notify results in terms of LiveData for Activity to consume. class MyActivity : AppCompatActivity() { override fun onCreate(savedInstanceState: Bundle?, persistentState: PersistableBundle?) { super.onCreate(savedInstanceState, persistentState) val model = ViewModelProviders.of(this).get(MyViewModel::class.java) model.getUsers().observe(this, { users -&gt; // update UI }) } }This is one of the reason I like ViewModel. If we follow ViewModel like this, then code structures between iOS and Android become similar. There should be no need for some random Javascript cross platform solutions. You learn the concept once, and apply it on both iOS and Android. I learn ViewModel, RxSwift on iOS and feel right at home when I work with RxJava and RxBinding on Android. The Kickstarter project also proves that this works well in their iOS and Android apps. BindingTo encapsulate the closure, we can create a class called Binding, which can notify one or multiple listeners. It takes advantage of didSet, and the observable property becomes clear. class Binding&lt;T&gt; { var value: T { didSet { listener?(value) } } private var listener: ((T) -&gt; Void)? init(value: T) { self.value = value } func bind(_ closure: @escaping (T) -&gt; Void) { closure(value) listener = closure } }Here is how to use it inside ViewModel: class ViewModel { let friends = Binding&lt;[User]&gt;(value: []) init() { getFacebookFriends { friends.value = $0 } } func getFacebookFriends(completion: ([User]) -&gt; Void) { // Do the work } }When ever friends are fetched, or changed, the ViewController is updated accordingly. This is called reaction to changes. override func viewDidLoad() { super.viewDidLoad() viewModel.friends.bind { friends in self.friendsCountLabel.text = &quot;\\(friends.count)&quot; } }You often see MVVM introduction with reactive frameworks, and it is for a reason. They offer many chaining operators and make reactive programming easier and more declarative. RxSwiftPerhaps the most common reactive framework in Swift is RxSwift. The thing I like about it is that it follows ReactiveX pattern. So you will feel more familiar if you already use RxJava, RxJs, or RxKotlin. Observable RxSwift unifies sync and async operations through Observable. This is how you make one. class ViewModel { let friends: Observable&lt;[User]&gt; init() { let client = APIClient() friends = Observable&lt;[User]&gt;.create({ subscriber in client.getFacebookFriends(completion: { friends in subscriber.onNext(friends) subscriber.onCompleted() }) return Disposables.create() }) } }The power of RxSwift lies in its numerous operators, which help you chain Observables. Here you can call 2 network requests, wait for both of them to finish, then sum up the friends. This is very streamlined and saves you lots of time. Here you can just subscribe to the Observable, it will be triggered when the request completes: override func viewDidLoad() { super.viewDidLoad() viewModel.friends.subscribe(onNext: { friends in self.friendsCountLabel.text = &quot;\\(friends.count)&quot; }) }Input and outputOne thing that is nice about ViewModel and Rx is that we can separate input and output using Observable, which gives a clear interface. Read more at Learning from Open Source: Input and output container. Below it is clear that we fetch is an input, and friends is the viable output. class ViewModel { class Input { let fetch = PublishSubject&lt;()&gt;() } class Output { let friends: Driver&lt;[User]&gt; } let apiClient: APIClient let input: Input let output: Output init(apiClient: APIClient) { self.apiClient = apiClient // Connect input and output } } class ProfileViewController: BaseViewController&lt;ProfileView&gt; { let viewModel: ProfileViewModelType init(viewModel: ProfileViewModelType) { self.viewModel = viewModel } override func viewDidLoad() { super.viewDidLoad() // Input viewModel.input.fetch.onNext(()) // Output viewModel.output.friends.subscribe(onNext: { friends in self.friendsCountLabel.text = &quot;\\(friends.count)&quot; }) } }How reactive worksIf you feel like Rx, it‚Äôs good to get an understanding of them after using some frameworks for a while. There are some concepts like Signal, SignalProducer, Observable, Promise, Future, Task, Job, Launcher, Async and some people can have a very distinction about them. Here I simply call it Signal, which is something that can signal values. MonadSignal and its Result are just monads, which are thing that can be mapped and chained. Signal makes use of deferred execution callback closures. It can be pushed or pulled. Which is just how the Signal updates its value and the order the callbacks are called. Execution callback closure means that we pass a function to another function. And the passed in function will get called when appropriated. Sync vs AsyncMonad can be in either sync or async mode. Sync is easier to understand, but async is somewhat you‚Äôre already familiar and used in practice. Basically, Sync: you get the returned value right away via return Async: you get the returned value via callback block Here is an example of simple sync and async free functions: // Sync func sum(a: Int, b: Int) -&gt; Int { return a + b } // Async func sum(a: Int, b: Int, completion: Int -&gt; Void) { // Assumed it is a very long task to get the result let result = a + b completion(result) }And how sync and async apply to Result type. Notice the async version, we get the transformed value in a completion closure instead of immediate return from function. enum Result&lt;T&gt; { case value(value: T) case failure(error: Error) // Sync public func map&lt;U&gt;(f: (T) -&gt; U) -&gt; Result&lt;U&gt; { switch self { case let .value(value): return .value(value: f(value)) case let .failure(error): return .failure(error: error) } } // Async public func map&lt;U&gt;(f: @escaping ((T), (U) -&gt; Void) -&gt; Void) -&gt; (((Result&lt;U&gt;) -&gt; Void) -&gt; Void) { return { g in // g: Result&lt;U&gt; -&gt; Void switch self { case let .value(value): f(value) { transformedValue in // transformedValue: U g(.value(value: transformedValue)) } case let .failure(error): g(.failure(error: error)) } } } }Push SignalGiven a chained signals like this: A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe) Push Signal, means that when the source signal A is sent an event, it propagates that event via callbacks. PushSignal is similar to PublishSubject in RxSwift. Triggered by sending event to the source signal. We must keep A as it keeps the others around We subscribe the last D We send event to the first A A ‚Äòs callback gets called, it it in turn calls callback of B with the result of A ‚Äòs map, then B ‚Äòs callback calls C ‚Äòs callback with the result of B‚Äòs flatMap, and so on. It is similar to Promise A+, you can see my Swift implementation of Promise A+ in my Then framework. For now, here is the Swift 4 implementation of a simple PushSignal. public final class PushSignal&lt;T&gt; { var event: Result&lt;T&gt;? var callbacks: [(Result&lt;T&gt;) -&gt; Void] = [] let lockQueue = DispatchQueue(label: &quot;Serial Queue&quot;) func notify() { guard let event = event else { return } callbacks.forEach { callback in callback(event) } } func update(event: Result&lt;T&gt;) { lockQueue.sync { self.event = event } notify() } public func subscribe(f: @escaping (Result&lt;T&gt;) -&gt; Void) -&gt; Signal&lt;T&gt; { // Callback if let event = event { f(event) } callbacks.append(f) return self } public func map&lt;U&gt;(f: @escaping (T) -&gt; U) -&gt; Signal&lt;U&gt; { let signal = Signal&lt;U&gt;() _ = subscribe { event in signal.update(event: event.map(f: f)) } return signal } }Below is how a PushSignal is used to transform a chain from string to its length, you should see 4, the length of the string ‚Äútest‚Äù printed. let signal = PushSignal&lt;String&gt;() _ = signal.map { value in return value.count }.subscribe { event in if case let .value(value) = event { print(value) } else { print(&quot;error&quot;) } } signal.update(event: .value(value: &quot;test&quot;))Pull SignalGiven a chained signals like this: A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe) Pull Signal, sometimes called Future, means when we subscribe to the final signal D, it causes the previous signals to action: Triggered by subscribing to the final signal D; We must keep D as it keeps the others around; We subscribe the last D; D ‚Äòs operation runs, and it cause C ‚Äòs operation to runs, ‚Ä¶ then A ‚Äòs operation runs. It is in A that the task is performed (like fetching network, retrieving database, file access, heavy computation, ‚Ä¶) to get the result, and A ‚Äòs completion gets called. Then A‚Äôs completion calls B ‚Äòs completion with the result mapped by B ‚Äòs map, ‚Ä¶ all the way to the subscriber ‚Äòs completion block. Here is a Swift 4 implementation of PullSignal. PullSignal is similar to Observablein RxSwift and SignalProducer in ReactiveSwift. public struct PullSignal&lt;T&gt; { let operation: ((Result&lt;T&gt;) -&gt; Void) -&gt; Void public init(operation: @escaping ((Result&lt;T&gt;) -&gt; Void) -&gt; Void) { self.operation = operation } public func start(completion: (Result&lt;T&gt;) -&gt; Void) { operation() { event in completion(event) } } public func map&lt;U&gt;(f: @escaping (T) -&gt; U) -&gt; PullSignal&lt;U&gt; { return PullSignal&lt;U&gt; { completion in self.start { event in completion(event.map(f: f)) } } } }The chain is inactive until you call start at the last signal in the chain, which triggers operation flow all over to the first signal. Run this snippet and you should see 4, the length of the string ‚Äútest‚Äù printed on the console. let signal = PullSignal&lt;String&gt; { completion in // There should be some long running operation here completion(Result.value(value: &quot;test&quot;)) } signal.map { value in value.count }.start { event in if case let .value(value) = event { print(value) } else { print(&quot;error&quot;) } }I hope those snippets are simple enough to help you understand how signal works under the hood, and how to differentiate hot and cold signals. To get a fully working Signal framework, you need to implement more operations. Such as retry, rebounce, throttle, queue, flatten, filter, delay, combine and add support for UIKit like RxCocoa does. Find out how to implement in my Signal repo. Where to go from hereArchitecture is a very opinionated topic. Hopefully this article gives you some ideas to add into your decision points. MVC is dominant in iOS, MVVM is a good friend and Rx is a powerful tool. Here are some more interesting readings: MVVM is Exceptionally OK Good iOS Application Architecture: MVVM vs. MVC vs. VIPER A Better MVC Taming Great Complexity: MVVM, Coordinators and RxSwift Rx ‚Äî for beginners (part 9): Hot Vs. Cold observable Hot and Cold Observables When to use IEnumerable vs IObservable? Functional Reactive Programming without Black Magic Swift Sync and Async Error Handling","categories":[],"tags":[]},{"title":"Collection Update","slug":"Collection-Update","date":"2017-12-07T15:22:39.000Z","updated":"2019-02-15T05:53:56.000Z","comments":true,"path":"blog/Collection-Update/","link":"","permalink":"https://onmyway133.github.io/blog/Collection-Update/","excerpt":"","text":"Issue #119 This is about collection update, how to provide correct IndexPath and a simple diffing algorithm Excerpt from my talk at CocoaHeads, Oslo https://www.meetup.com/CocoaHeads-Oslo/events/244892347/ Slide https://speakerdeck.com/onmyway133/collection-update CollectionViewIt‚Äôs hard to imagine of any apps that don‚Äôt use Table View or CollectionView. And by CollectionView, I actually mean UICollectionView üòâ . Most of the time, we show something with response from backend, then potentially update and insert new items as data changed. We can totally call reloadData to reflect the changes, but an animation is better here as it gives user better understanding of what‚Äôs going on, and to not surprise them. This talks about UICollectionView, but UITableView behaves the same Drag and DropLet‚Äôs imagine an app where user are allowed to customise their experience by moving items from one collection to another. You can take a look at the example DragAndDrop which is using the new drag and drop API in iOS 11. You must ensure that your data is changed before calling update methods on UICollectionView. And then we call deleteItems and insertItems to reflect data changes. UICollectionView performs a nice animation for you 12345678910111213func collectionView(_ collectionView: UICollectionView, performDropWith coordinator: UICollectionViewDropCoordinator) &#123; let destinationIndexPath = coordinator.destinationIndexPath let sourceIndexPath = coordinator.items.last?.dragItem.localObject as! IndexPath // remove sourceItems.remove(at: sourceIndexPath.item) sourceCollectionView.deleteItems(at: [sourceIndexPath]) // insert destinationItems.insert(draggedItem, at: destinationIndexPath.item) destinationCollectionView.insertItems(at: [destinationIndexPath])&#125; NSInternalInconsistencyExceptionIf you have large number of items with many insertions and deletions from backend response, you need to calculate the correct IndexPath to call, which are not easy thing. Most the time you will get the following crashes Terminating app due to uncaught exception ‚ÄòNSInternalInconsistencyException‚Äô,reason: ‚ÄòInvalid update: invalid number of items in section 0.The number of items contained in an existing section after the update (213)must be equal to the number of items contained in that section beforethe update (154), plus or minus the number of items inserted ordeleted from that section (40 inserted, 0 deleted) and plusor minus the number of items moved into or out ofthat section (0 moved in, 0 moved out).‚Äô In my experience it happened randomly because everyone has different data. Although the message is very descriptive, it may take a while to figure it out. Game of IndexPathLet‚Äôs refine our knowledge of IndexPath by going through some examples. With a collection of 6 items, we perform some update operations and figure out what IndexPath should be. 1items = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"] Take a look at my example here CollectionUpdateExample, there are many more examples index vs offsetBefore we go any further, I just want to mention that, by index I actually mean offset from the start. If you take a look at the enumerated function, it suggests the name as offset instead of index 123Array(0..&lt;10).enumerated().forEach &#123; (offset, element) in&#125; This zero based numbering could shed some light on this matter Particularly in C, where arrays are closely tied to pointer arithmetic, this makes for a simpler implementation: the subscript refers to an offset from the starting position of an array, so the first element has an offset of zero. 1. Insert 3 items at the end123456items.append(contentsOf: [\"g\", \"h\", \"i\"])// a, b, c, d, e, f, g, h, ilet indexPaths = Array(6...8).map &#123; IndexPath(item: $0, section: 0) &#125;collectionView.insertItems(at: indexPaths) 2. Delete 3 items at the end12345678items.removeLast()items.removeLast()items.removeLast()// a, b, clet indexPaths = Array(3...5).map &#123; IndexPath(item: $0, section: 0) &#125;collectionView.deleteItems(at: indexPaths) 3. Update item at index 2123456items[2] = \"üëª\"// a, b, üëª, d, e, flet indexPath = IndexPath(item: 2, section: 0)collectionView.reloadItems(at: [indexPath]) 4. Move item ‚Äúc‚Äù to the end123456789items.remove(at: 2)items.append(\"c\")// a, b, d, e, f, ccollectionView.moveItem( at: IndexPath(item: 2, section: 0), to: IndexPath(item: 5, section :0)) 5. Delete 3 items at the beginning, then insert 3 items at the endWith multiple different operations, we should use performBatchUpdates You can use this method in cases where you want to make multiple changes to the collection view in one single animated operation, as opposed to in several separate animations. You might use this method to insert, delete, reload, or move cells or use it to change the layout parameters associated with one or more cells 123456789101112131415items.removeFirst()items.removeFirst()items.removeFirst()items.append(contentsOf: [\"g\", \"h\", \"i\"])// d, e, f, g, h, icollectionView.performBatchUpdates(&#123; let deleteIndexPaths = Array(0...2).map &#123; IndexPath(item: $0, section: 0) &#125; collectionView.deleteItems(at: deleteIndexPaths) let insertIndexPaths = Array(3...5).map &#123; IndexPath(item: $0, section: 0) &#125; collectionView.insertItems(at: insertIndexPaths)&#125;, completion: nil) 6. Insert 3 items at the end, then delete 3 items beginning123456789101112131415items.append(contentsOf: [\"g\", \"h\", \"i\"])items.removeFirst()items.removeFirst()items.removeFirst()// d, e, f, g, h, icollectionView.performBatchUpdates(&#123; let insertIndexPaths = Array(6...8).map &#123; IndexPath(item: $0, section: 0) &#125; collectionView.insertItems(at: insertIndexPaths) let deleteIndexPaths = Array(0...2).map &#123; IndexPath(item: $0, section: 0) &#125; collectionView.deleteItems(at: deleteIndexPaths)&#125;, completion: nil) üôÄIf you run the example 6, you will get a crash 1234Terminating app due to uncaught exception &apos;NSInternalInconsistencyException&apos;, reason: &apos;attempt to insert item 6 into section 0, but there are only 6 items in section 0 after the update&apos; performBatchUpdatesIt is because the way performBatchUpdates works. If you take a look at the documentation Deletes are processed before inserts in batch operations. This means the indexes for the deletions are processed relative to the indexes of the collection view‚Äôs state before the batch operation, and the indexes for the insertions are processed relative to the indexes of the state after all the deletions in the batch operation. No matter how we call insert or delete, performBatchUpdates always performs deletions first. So we need to call deleteItems and insertItems as if the deletions occur first. 123456789101112131415items.append(contentsOf: [\"g\", \"h\", \"i\"])items.removeFirst()items.removeFirst()items.removeFirst()// d, e, f, g, h, icollectionView.performBatchUpdates(&#123; let deleteIndexPaths = Array(0...2).map &#123; IndexPath(item: $0, section: 0) &#125; collectionView.deleteItems(at: deleteIndexPaths) let insertIndexPaths = Array(3...5).map &#123; IndexPath(item: $0, section: 0) &#125; collectionView.insertItems(at: insertIndexPaths)&#125;, completion: nil) OperationsThere are many operations on UICollectionView, and there are operations to update whole section as well. Take a look Ordering of Operations and Index Paths 12345insertItems(at indexPaths: [IndexPath])deleteItems(at indexPaths: [IndexPath])reloadItems(at indexPaths: [IndexPath])moveItem(at indexPath: IndexPath, to newIndexPath: IndexPath)performBatchUpdates(_ updates, completion) 1234insertSections(_ sections: IndexSet)deleteSections(_ sections: IndexSet)reloadSections(_ sections: IndexSet)moveSection(_ section: Int, toSection newSection: Int) Edit distanceDoing these calculations by hand is quite tedious and error prone. We can build our own abstraction using some algorithms. The naive one is Wagner‚ÄìFischer algorithm which uses Dynamic Programming to tell the edit distance between two strings of characters. Edit distance means the number of steps needed to change from one string to another. String is just a collection of characters, so we can generalise this concept to make it work for any collection of items. Instead of comparing character, we require items to conform to Equatable ‚Äúkit‚Äù -&gt; ‚Äúkat‚ÄùHow can we transform form the word ‚Äúkit‚Äù to ‚Äúkat‚Äù? What kinds of operations do we nede to perform? You may tell ‚Äújust change the i to a‚Äù, but this trivial example helps you understand the algorithm. Let‚Äôs get started. DeletionsIf we go from ‚Äúkit‚Äù to an empty string ‚Äú‚Äù, we need 3 deletions ‚Äúk‚Äù -&gt; ‚Äú‚Äù üëâ 1 deletion‚Äúki‚Äù -&gt; ‚Äú‚Äù üëâ 2 deletions‚Äúkit‚Äù -&gt; ‚Äú‚Äù üëâ 3 deletions InsertionsIf we go from an empty string ‚Äú‚Äù to ‚Äúkat‚Äù, we need 3 insertions ‚Äú‚Äù -&gt; ‚Äúk‚Äù üëâ 1 insertion‚Äú‚Äù -&gt; ‚Äúka‚Äù üëâ 2 insertions‚Äú‚Äù -&gt; ‚Äúkat‚Äù üëâ 3 insertions If equal, take value from the top leftYou can think of the algorithm as if we go from source string, to empty string, to destination string. We try to find the minimum steps to update. Going horizontally means insertions, vertically means deletions and diagonally means substitutions This way we can build our matrix, iterate from row to row, column by column. First, the letter ‚Äúk‚Äù from source collection is the same with letter ‚Äúk‚Äù from destination collection, we simply take value from the top left, which is 0 substituion If not equalWe continue with the next letter from the destination collection. Here ‚Äúk‚Äù and ‚Äúa‚Äù are not the same. We take minimum value from left, top, top left. Then increase by one Here we take value from left, which is horizontally, so we increase by 1 insertion ‚Äúk‚Äù -&gt; ‚Äúkat‚Äù üëâ 2 insertionsContinue, they are not the same, so we take value from left horizontally. Here you can see it kind makes sense, as to go from ‚Äúk‚Äù to ‚Äúkat‚Äù, we need 2 insertions, which is to insert letters ‚Äúa‚Äù and ‚Äút‚Äù The bottom right valueContinue with the next row, and next row until we got to the bottom right value, which gives you the edit distance. Here 1 substitution means that we need to perform 1 substitution to go from ‚Äúkit‚Äù to ‚Äúkat‚Äù, which is update ‚Äúi‚Äù with ‚Äúa‚Äô You can easily see that we need to update index 1. But how do we know that it is index 1 ü§î Edit stepsIn each step, we need to associate the index of item in source and destination collection. You can take a look at my implementation DeepDiff ComplexityWe iterate through the matrix, with m and n are the length of source and destination collection respectively, we can see that the complexity of this algorithm is 0(mn). Also the performance greatly depends on the size of the collection and how complex the item is. The more complex and how deep you want to perform Equatable can greatly affect your performance. Improving performanceThe section How does it work shows several ways we can improve performance. Firstly, instead of building a matrix, which costs memory m*n, we can just use temporary arrays as holder. Secondly, to quickly compare 2 items, we can use Hashable, as 2 identical items will always have the same hash. More performanceIf you want better performance, then algorithms with linear complexity may be interested to you. Take a look at Diff algorithm Heckel Wu Myers","categories":[],"tags":[]},{"title":"Commit as another user on GitHub","slug":"Commit-as-another-user-on-GitHub","date":"2017-12-07T15:19:40.000Z","updated":"2017-12-07T15:20:57.000Z","comments":true,"path":"blog/Commit-as-another-user-on-GitHub/","link":"","permalink":"https://onmyway133.github.io/blog/Commit-as-another-user-on-GitHub/","excerpt":"","text":"Issue #118 GitHub identifies users by email, so you can totally commit using someone ‚Äòs email. This is how to configure in SourceTree https://help.github.com/articles/signing-commits-using-gpg/ https://help.github.com/articles/why-are-my-commits-linked-to-the-wrong-user/","categories":[],"tags":[]},{"title":"Badge in GitHub","slug":"Badge-in-GitHub","date":"2017-12-07T15:17:57.000Z","updated":"2017-12-07T15:17:57.000Z","comments":true,"path":"blog/Badge-in-GitHub/","link":"","permalink":"https://onmyway133.github.io/blog/Badge-in-GitHub/","excerpt":"","text":"Issue #117 GitHub is so awesome. It is where people around the world collaborate with each other.It is more awesome to show more about you in your GitHub profile. How about a badge? a welcome text?It is doable with organization. GitHub takes time and name of the organiazations you joined to determined how it displays on your profile This used to be what shown on my GitHub profile https://github.com/onmyway133 For me, I display the text ‚ÄúHello World‚Äù, so I have to create organizations for ‚Äúh‚Äù, ‚Äúe‚Äù, ‚Äúl‚Äù, ‚Äúl‚Äù, ‚Äúo‚Äù, ‚Äúw‚Äù, ‚Äúo‚Äù, ‚Äúr‚Äù, ‚Äúl‚Äù, ‚Äúd‚ÄùTo ensure the order, you can name your organization like ‚Äúorg-h‚Äù, ‚Äúorg-he‚Äù, ‚Äúorg-hel‚Äù, ‚Äúorg-hell‚Äù, ‚Äúorg-hello‚Äù, ‚Ä¶ and you must join the organization in the correct orderI create another GitHub account called https://github.com/fantabot to manage my organizationsYour imaginary is your limit. May your code continue to compile :grin:","categories":[],"tags":[]},{"title":"Case sensitivity in HTTP","slug":"Case-sensitivity-in-HTTP","date":"2017-12-06T13:59:24.000Z","updated":"2019-09-12T06:32:09.000Z","comments":true,"path":"blog/Case-sensitivity-in-HTTP/","link":"","permalink":"https://onmyway133.github.io/blog/Case-sensitivity-in-HTTP/","excerpt":"","text":"Issue #115 Is URL case sensitive ?According to HTML and URLs URLs in general are case-sensitive (with the exception of machine names). There may be URLs, or parts of URLs, where case doesn‚Äôt matter, but identifying these may not be easy. Users should always consider that URLs are case-sensitive. Is header case sensitive?According to RFC 7230 Each header field consists of a case-insensitive field name followed by a colon (‚Äú:‚Äù), optional leading whitespace, the field value, and optional trailing whitespace. Is method case sensitive?Using URLSession, mostly we will get 200 with request.httpMethod = &quot;GET&quot; and 400 with request.httpMethod = &quot;get&quot;. Generally speaking, you should use some popular wrappers Alamofire or Malibu as they are mature enough. Spend your precious time solving more important problems instead. According to RFC 7231 The method token is case-sensitive because it might be used as a gateway to object-based systems with case-sensitive method names.","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"Understanding let, apply, with, run in Kotlin","slug":"Understanding-let-apply-with-run-in-Kotlin","date":"2017-12-05T07:33:40.000Z","updated":"2019-09-12T06:24:44.000Z","comments":true,"path":"blog/Understanding-let-apply-with-run-in-Kotlin/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-let-apply-with-run-in-Kotlin/","excerpt":"","text":"Issue #114 Picture worths thousand words. Code worths thousand pictures. I don‚Äôt understand much until I take a look at Standard.kt in Kotlin standard library. 12345678910111213141516171819202122/** * Calls the specified function [block] with `this` value as its receiver and returns `this` value. */@kotlin.internal.InlineOnlypublic inline fun &lt;T&gt; T.apply(block: T.() -&gt; Unit): T &#123; contract &#123; callsInPlace(block, InvocationKind.EXACTLY_ONCE) &#125; block() return this&#125;/** * Calls the specified function [block] with `this` value as its argument and returns its result. */@kotlin.internal.InlineOnlypublic inline fun &lt;T, R&gt; T.let(block: (T) -&gt; R): R &#123; contract &#123; callsInPlace(block, InvocationKind.EXACTLY_ONCE) &#125; return block(this)&#125; apply returns T and accepts a block of type T.() -&gt; Unit. This is called Function Literals with Receiver Kotlin provides the ability to call a function literal with a specified receiver object. Inside the body of the function literal, you can call methods on that receiver object without any additional qualifiers. This is similar to extension functions, which allow you to access members of the receiver object inside the body of the function let returns R and accepts a block of type T -&gt; R. Inside the block, you can access it which is it: implicit name of a single parameter","categories":[],"tags":[{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"Using Playground with CocoaPods","slug":"Using-Playground-with-CocoaPods","date":"2017-12-01T12:41:58.000Z","updated":"2019-02-18T08:23:19.000Z","comments":true,"path":"blog/Using-Playground-with-CocoaPods/","link":"","permalink":"https://onmyway133.github.io/blog/Using-Playground-with-CocoaPods/","excerpt":"","text":"Issue #113 This is a follow up from my post Learning from Open Source: Using Playground on how to actually add a playground to your production project. The idea is simple: create a framework so that Playground can access the code. This demo an iOS project with CocoaPods. See the demo https://github.com/onmyway133/UsingPlayground This is also my question to this question https://stackoverflow.com/questions/47589855/how-to-expose-your-project-code-to-a-xcode-playground-when-using-cocoapods/47595120#47595120 1. Add a podCreate a new project called UsingPlayground. Create a Podfile with a pod Cheers because we want something fun üòÑ 123456platform :ios, '9.0'use_frameworks!pod 'Cheers'target 'UsingPlayground' 2. Use the pod in your projectThis is very straightforward. Just to make sure the pod work 12345678910111213141516171819import UIKitimport Cheersclass ViewController: UIViewController &#123; override func viewDidLoad() &#123; super.viewDidLoad() let cheerView = CheerView() view.addSubview(cheerView) cheerView.frame = view.bounds // Configure cheerView.config.particle = .confetti // Start cheerView.start() &#125;&#125; Build and run the project to enjoy a very fascinating confetti üéä 3. Add a CocoaTouch frameworkIn your workspace, select the UsingPlayground project, add new CocoaTouch framework. Let‚Äôs call it AppFramework. Then add source files to this framework. For now, just check file ViewController.swift add add it to the AppFramework target too. 4. PublicSwift types and methods are internal by default. So in order for them to be visible in the Playground, we need to declare them as public. 123public class ViewController: UIViewController &#123; ...&#125; 5. Add pod to AppFrameworkIn order for AppFramework to use our pods, we need to add those pods into framework target as well. Add target &#39;AppFramework&#39; to your Podfile 123456789platform :ios, '9.0'use_frameworks!pod 'Cheers'target 'UsingPlayground'target 'AppFramework' Now run pod install again. In some rare cases, you need to run pod deintegrate and pod install to start from a clean slate 6. Add a PlaygroundAdd a Playground and drag that to our workspace. Let‚Äôs call it MyPlayground 6. EnjoyNow edit our MyPlayground. You can import frameworks from pod and our AppFramework 1234567891011121314151617import UIKitimport Cheersimport AppFrameworkimport PlaygroundSupportlet cheerView = CheerView()cheerView.frame = CGRect(x: 0, y: 50, width: 200, height: 400)// ConfigurecheerView.config.particle = .confetti// StartcheerView.start()let myController = ViewController()PlaygroundPage.current.liveView = myController.view Remember to toggle Editor Mode so you can see Playground result","categories":[],"tags":[]},{"title":"Using assembly","slug":"Using-assembly","date":"2017-11-30T13:46:09.000Z","updated":"2019-09-12T06:31:11.000Z","comments":true,"path":"blog/Using-assembly/","link":"","permalink":"https://onmyway133.github.io/blog/Using-assembly/","excerpt":"","text":"Issue #112 I‚Äôm very fascinated when people use assembly to perform investigation, that‚Äôs just mind blowing üí• . Here are some of the favorite use cases Why blank Gets You Root","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"Talks","slug":"Talks","date":"2017-11-27T16:07:53.000Z","updated":"2019-05-30T15:23:00.000Z","comments":true,"path":"blog/Talks/","link":"","permalink":"https://onmyway133.github.io/blog/Talks/","excerpt":"","text":"Issue #111 Please visit https://onmyway133.github.io/speaking","categories":[],"tags":[]},{"title":"URL Routing with Compass","slug":"URL-Routing-with-Compass","date":"2017-11-27T15:20:15.000Z","updated":"2019-09-12T06:30:58.000Z","comments":true,"path":"blog/URL-Routing-with-Compass/","link":"","permalink":"https://onmyway133.github.io/blog/URL-Routing-with-Compass/","excerpt":"","text":"Issue #110 Medium version https://medium.com/@onmyway133/url-routing-with-compass-d59c0061e7e2 Apps often have many screens, and UIViewController works well as the basis for a screen, together with presentation and navigation APIs. Things are fine until you get lost in the forest of flows, and code becomes hard to maintain. One way to avoid this is the central URL routing approach. Think of it as a network router that handles and resolves all routing requests. This way, the code becomes declarative and decoupled, so that the list component does not need to know what it‚Äôs presenting. URL routing also makes logging and tracking easy along with ease of handling external requests such as deep linking. There are various frameworks that perform URL routing. In this tutorial you‚Äôll use Compass for its simplicity. You‚Äôll refactor an existing app, which is a simplified Instagram app named PhotoFeed. When you‚Äôve finished this tutorial, you‚Äôll know how to declare and use routers with Compass and handle deep linking. Getting StartedDownload the starter project and unzip it. Go to the PhotoFeed folder and run pod install to install the particular dependencies for this project. Open PhotoFeed.xcworkspace and run the project. Tap Login to go to the Instagram login page and enter your Instagram credentials, then have a look around the app. The main app is made of a UITabBarController that shows the feed, the currently logged-in user profile and a menu. This is a typical Model View Controller project where UIViewController handles Cell delegates and takes responsibility for the navigation. For simplicity, all view controllers inherit from TableController and CollectionController that know how to manage list of a particular model and cell. All models conform to the new Swift 4 Codable protocol. Registering Your App on InstagramIn order to use the Instagram API, you‚Äôll need to register your app at Instagram Developer. After obtaining your client id, switch back to the project. Go to APIClient.swift and modify your clientId. Note: The project comes with a default app with limited permissions. The app can‚Äôt access following or follower APIs, and you can only see your own posts and comments Compass 101The concept of Compass is very simple: you have a set of routes and central place for handling these routes. Think of a route as a navigation request to a specific screen within the app. The idea behind URL routing is borrowed from the modern web server. When user enters a URL into the browser, such as https://flawlessapp.io/category/ios, that request is sent from the browser to the web server. The server parses the URL and returns the requested content, such as HTML or JSON. Most web server frameworks have URL routing support, including ASP.NET, Express.js, and others. For example, here is how you handle a URL route in express.js: 1234app.get('/api/category/:categoryTag', function (req, res) &#123; const page = getCategoryPageFor(req.params.categoryTag) res.send(page)&#125;) Users or apps request a specific URL that express an intent about what should be returned or displayed. But instead of returning web pages, Compass constructs screens in terms of UIViewController and presents them. Route PatternsThis is how you declare a routing schema in Compass: 1Navigator.routes = [\"profile:&#123;userId&#125;\", \"post:&#123;postId&#125;\", \"logout\"] This is simply as array of patterns you register on the Navigator. This is the central place where you define all your routes. Since they are in one place, all your navigations are kept in one place and can easily be understood. Looking at the example above, {userId}, {postId} are placeholders that will be resolved to actual parameters. For example with post:BYOkwgXnwr3, you get userId of BYOkwgXnwr3. Compass also performs pattern matching, in that post:BYOkwgXnwr3 matches post:{postId}, not comment:{postId}, blogpost:{postId}, ‚Ä¶This will become to make sense in following sections. The NavigatorThe Navigator is a the central place for routes registration, navigating and handling. The next step is to trigger a routing request. You can do that via the Navigator. For example, this is how you do in the feed to request opening a specific post: 1Navigator.navigate(urn: \"post:BYOkwgXnwr3\") Compass uses the user-friendly urn, short for Uniform Resource Name to make itwork seamlessly with Deep Linking. This urn matches the routing schema post:{postId}. Compass uses {param} as the special token to identifier the parameter and : as the delimiter. You can change the delimiter to something else by configuring Navigator.delimiter. You have learned how to register routes and navigate in Compass. Next, you will learn how to customize the handling code to your need. LocationNavigator parses and works with Location under the hood. Given the URN of post:BYOkwgXnwr3, you get a Location where path is the route pattern, and arguments contain the resolved parameters. 1234path = \"post:&#123;postId&#125;\"arguments = [ \"postId\": \"BYOkwgXnwr3\"] To actually perform the navigation, you assign a closure that takes a Location to Navigator.handle. 123456789101112131415Navigator.handle = &#123; [weak self] location in guard let `self` = self else &#123; return &#125; let arguments = location.arguments switch location.path &#123; case \"post:&#123;postId&#125;\": let postController = PostController(postId: postID) self.rootController.pushViewController(postController, animated: true) default: break &#125;&#125; The letself= self dance is to ensure self isn‚Äôt released by the time this closure is executed. If it is released, the routing it‚Äôs about to perform is likely invalid, and you return without doing anything instead. You should typically do the above in the components that own the root controller, such as AppDelegate as seen above. That‚Äôs the basic of Compass. Astute readers may have noticed that it does not scale, as the number of switch statements will grow as the number of routes and endpoints increase in your app. This is where the Routable protocol comes in. Anything conforming to Routable knows how to handle a specific route. Apps may have many modular sections, and each section may have a set of routes. Compass handles these scenario by using a composite Routable named Router that groups them . You can have a router for a pre-login module, a post-login module, premium features module, and so on. In the next section, you‚Äôll change PhotoFeed to use Router and Routable. Router to the RescueThe first step is to include Compass in your project. Using CocoaPods, this is an easy task. Edit the Podfile with the project and type pod &#39;Compass&#39;, &#39;~&gt; 5.0&#39; just before the end statement. Then open Terminal and execute the following: 1pod install The version of Compass used in this tutorial is 5.1.0. Registering a Router To start, you‚Äôll create a simple router to handle all post-login routes. Open AppDelegate.swift, and import Compass at the top of the file: 1import Compass Next, add the following router declaration under the var mainController: MainController? declaration: 1var postLoginRouter = Router() Then declare a function called setupRouting, you ‚Äòll do this in an extension to separate the routing setup from the main code in AppDelegate. 1234567891011121314151617181920212223242526extension AppDelegate &#123; func setupRouting() &#123; // [1] Register scheme Navigator.scheme = \"photofeed\" // [2] Configure routes for Router postLoginRouter.routes = [:] // [3] Register routes you 'd like to support Navigator.routes = Array(postLoginRouter.routes.keys) // [4] Do the handling Navigator.handle = &#123; [weak self] location in guard let selectedController = self?.mainController?.selectedViewController else &#123; return &#125; // [5] Choose the current visible controller let currentController = (selectedController as? UINavigationController)?.topViewController ?? selectedController // [6] Navigate self?.postLoginRouter.navigate(to: location, from: currentController) &#125; &#125;&#125; Here‚Äôs what you do in the above method: Declare a scheme for Compass to work. This is your application URL scheme. This shines when you wish to support deep linking . Register all the routes in your app. Router accepts a mapping of route and Routable conformers. This is empty for now, but you will add several routes in a moment. A Navigator can manage multiple routers. In this case, you only register one router. This is where you supply the handling closure. Navigator uses this to handle a resolved location request. Screens in one modular section originate from one root or parent view controller. In order to show something from the route, you should try to push or present it from the selected most-visible view controller. In this project, the root is a UITabBarController, so you try to get the top controller from the current selected navigation. The selection of current controller depends on the module and your app use cases, so Compass let you decide it. If you use the side menu drawer, then you can just change the selected view controller. Finally, since Router is a composite Routable, you dispatch to it the Location. Finally, you need to call this newly added function. Add the following line right above window?.makeKeyAndVisible(): 1setupRouting() Build and run. Nothing seems to work yet! To make things happen, you‚Äôll need to add all the route handlers. You‚Äôll do this in the next section. Implementing the Route HandlersFirst, create a new file and name it Routers.swift. This is where you‚Äôll declare all of your route handlers. At the beginning of the file, add import Compass. Compass declares a simple protocol ‚Äî Routable ‚Äî that decides what to do with a given Location request from a Current Controller. If a request can‚Äôt be handled, it will throw with RouteError. Its implementation looks like this: 123public protocol Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws&#125; It‚Äôs an incredibly simple protocol. Any routes you create only need to implement that single method. Now create your first handler to deal with user info request. 12345678910111213struct UserRoute: Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws &#123; // [1] Examine arguments guard let userId = location.arguments[\"userId\"] else &#123; return &#125; // [2] Create the controller let controller = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(withIdentifier: \"UserController\") as! UserController controller.userId = userId currentController.navigationController?.pushViewController(controller, animated: true) &#125;&#125; This is called when you touch the post author on the feed. Here‚Äôs what‚Äôs happening: UserRoute deals with user:{userId} urn, so location.arguments[&quot;userId&quot;] should contain the correct userId to inject into UserController. This app uses storyboards to make the UI, so get the correct view controller based on its identifier. Remember tha currentController is the current visible controller in the navigation stack. So you ask for its UINavigationController to push a new view controller. Right below this router, add one more route for the screen shown when the user wants to see who likes a particular post: 1234567891011struct LikesRoute: Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws &#123; guard let mediaId = location.arguments[\"mediaId\"] else &#123; return &#125; let controller = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(withIdentifier: \"LikesController\") as! LikesController controller.mediaId = mediaId currentController.navigationController?.pushViewController(controller, animated: true) &#125;&#125; The remaining RouteNow it‚Äôs your turn to write the other route handlers: CommentsRoute, FollowingRoute, FollowerRoute. See if you can figure it out first, you can find the solution below. Here‚Äôs what you should have: 1234567891011121314151617181920212223242526272829303132333435struct CommentsRoute: Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws &#123; guard let mediaId = location.arguments[\"mediaId\"] else &#123; return &#125; let controller = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(withIdentifier: \"CommentsController\") as! CommentsController controller.mediaId = mediaId currentController.navigationController?.pushViewController(controller, animated: true) &#125;&#125;struct FollowingRoute: Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws &#123; guard let userId = location.arguments[\"userId\"] else &#123; return &#125; let controller = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(withIdentifier: \"FollowingController\") as! FollowingController controller.userId = userId currentController.navigationController?.pushViewController(controller, animated: true) &#125;&#125;struct FollowerRoute: Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws &#123; guard let userId = location.arguments[\"userId\"] else &#123; return &#125; let controller = UIStoryboard(name: \"Main\", bundle: nil).instantiateViewController(withIdentifier: \"FollowerController\") as! FollowerController controller.userId = userId currentController.navigationController?.pushViewController(controller, animated: true) &#125;&#125; The LogoutRouteThere is one more route to add: the one you‚Äôll use for logout. LogoutRoute is quite tricky, as it usually involves changing the current root view controller. Who knows this better than the app delegate? Open AppDelegate.swift and add the following code at the very bottom: 123456struct LogoutRoute: Routable &#123; func navigate(to location: Location, from currentController: CurrentController) throws &#123; APIClient.shared.accessToken = nil (UIApplication.shared.delegate as! AppDelegate).showLogin() &#125;&#125; Now that you‚Äôve implemented all of the route handlers, you will have to tell Navigator which route is used for which URN. Still in AppDelegate.swift, find postLoginRouter.routes = [:] and replace it with the following: 12345678postLoginRouter.routes = [ \"user:&#123;userId&#125;\": UserRoute(), \"comments:&#123;mediaId&#125;\": CommentsRoute(), \"likes:&#123;mediaId&#125;\": LikesRoute(), \"following:&#123;userId&#125;\": FollowingRoute(), \"follower:&#123;userId&#125;\": FollowerRoute(), \"logout\": LogoutRoute()] Build the app and everything should compile. Now all that‚Äôs left is to actually all all of the code you‚Äôve written! Refactoring TimeIt‚Äôs time to refactor all the code in UIViewController by replacing all the navigation code with your new routing instructions. Start by freeing the FeedController from the unnecessary tasks of navigation. Open FeedController.swift and add the following import to the top of the file: 1import Compass Next, look for // MARK: - MediaCellDelegate and replace the three MediaCell delegate methods with the following: 1234567891011func mediaCell(_ cell: MediaCell, didViewLikes mediaId: String) &#123; try? Navigator.navigate(urn: \"likes:\\(mediaId)\")&#125;func mediaCell(_ cell: MediaCell, didViewComments mediaId: String) &#123; try? Navigator.navigate(urn: \"comments:\\(mediaId)\")&#125;func mediaCell(_ cell: MediaCell, didSelectUserName userId: String) &#123; try? Navigator.navigate(urn: \"user:\\(userId)\")&#125; For these three cases, you simply want to navigate to another screen. Therefore, all you need to do is tell the Navigator where you want to go. For simplicity, you use try? to deal with any code that throws. Build and run the app. Search for your favorite post in the feed, and tap on the author, the post comments or likes to go to the target screen. The app behaves the same as it did before, but the code is now clean and declarative. Now do the same with UserController.swift. Add the following import to the top of the file: 1import Compass Replace the code after // MARK: - UserViewDelegate with the following: 1234567func userView(_ view: UserView, didViewFollower userId: String) &#123; try? Navigator.navigate(urn: \"follower:\\(userId)\")&#125;func userView(_ view: UserView, didViewFollowing userId: String) &#123; try? Navigator.navigate(urn: \"following:\\(userId)\")&#125; Your task now is to refactor with the last route LogoutRoute. Open MenuController.swift and add the following to the top: 1import Compass Remove the logout method altogether. Find the following: indexPath.section 12 logout()&#125; ‚Ä¶and replace it with: 123if indexPath.section == Section.account.rawValue, indexPath.row == 0 &#123; try? Navigator.navigate(urn: \"logout\")&#125; Build and run the app, navigate to the menu and tap Logout. You should be taken to the login screen. Handling Deep LinkingDeep linking allows your apps to be opened via a predefined URN. The system identifies each app via its URL scheme. For web pages, the scheme is usually http, https. For Instagram it is, quite handily, instagram. Use cases for this are inter-app navigation and app advertisements. For examples, the Messenger app uses this to open the user profile in the Facebook app, and Twitter uses this to open the App Store to install another app from an advertisement. In order for user to be redirected back to PhotoFeed, you need to specify a custom URL scheme for your app. Remember where you declared Navigator.scheme = &quot;photofeed&quot;? PhotoFeed just so happens to conform to this URL scheme, so deep links already worked ‚Äî and you didn‚Äôt even know it! Build and run the app, then switch to Safari. Type photofeed:// in the address bar, then tap Go. That will trigger your app to open. The app opens, but PhotoFeed doesn‚Äôt parse any parameters in the URL to go anywhere useful. Time to change that! Your app responds to the URL scheme opening by implementing a UIApplicationDelegate method. Add the following after setupRouting in AppDelegate.swift: 1234func application(_ app: UIApplication, open url: URL, options: [UIApplicationOpenURLOptionsKey : Any] = [:]) -&gt; Bool &#123; try? Navigator.navigate(url: url) return true&#125; Navigator parses and handles this for you. Build and run again. Go to Safari app, type photofeed://user:self and tap Go. Photofeed will open and show the currently logged in users‚Äô profile. Because you already had UserRoute, the requested URL was handled gracefully. Your app may already be presenting a particular screen when a routing request comes, but you‚Äôve anticipated this by resetting the navigation controller or presentation stack to show the requested screen. This simple solution works for most cases. Again, it‚Äôs recommended you pick the topmost visible view controller as the current controller in Navigator.handle. Deep linking is usually considered external navigation, in that the routing requests come from outside your app. Thanks to the central routing system that you developed, the code to handle external and internal routing requests is very much the same and involves no code duplication at all. Routing with Push NotificationsPush notifications help engage users with your app. You may have received messages like ‚ÄúHey, checkout today ‚Äòs most popular stories‚Äù on Medium, ‚ÄúYour friend has a birthday today‚Äù on Facebook, ‚Ä¶ and when you tap those banners, you are taken straight to that particular screen. How cool is that? This is achievable with your URL routing approach. Imagine users tapping a push notification banner saying ‚ÄúYou‚Äôre a celebrity on PhotoFeed ‚Äî check out your profile now!‚Äù and being sent directly to their profile screen. To accomplish this, you simply have to embed the URN info into the push payload and handle that in your app. Setting upTo start, you‚Äôll need to specify your bundle ID. Go to Target Settings\\General to change your bundle ID as push notification requires a unique bundle ID to work. Your project uses com.fantageek.PhotoFeed by default. Next, you‚Äôll need to register your App ID. Go to Member Center and register your App ID. Remember your Team ID, as you will need it in the final step. Also tick the Push Notification checkbox under Application Services. Now you‚Äôll need to generate your Authentication Key. Apple provides Token Authentication as a new authentication mechanism for push notifications. The token is easy to generate, works for all your apps, and mostly, it never expires. Still in Member Center, create a new Key and download it as a .p8 file. Remember your Key ID as you will need it in the final step. Next up: enabling push notification capability. Back in Xcode, go to Target Settings\\Capabilities and enable Push Notifications, which will add PhotoFeed.entitlements to your project. The next step is to register for push notifications. Open MainController.swift and add the following import to the top of MainController.swift: 1import UserNotifications You want to enable push notification only after login, so MainController is the perfect place. UserNotifications is recommended for app targeting iOS 10 and above. 123456789101112override func viewDidLoad() &#123; super.viewDidLoad() // [1] Register to get device token for remote notifications UIApplication.shared.registerForRemoteNotifications() // [2] Register to handle push notification UI let options: UNAuthorizationOptions = [.alert, .sound, .badge] UNUserNotificationCenter.current().requestAuthorization(options: options) &#123; (granted, error) in print(error as Any) &#125;&#125; The permission dialog is shown once, so make sure you accept it. It‚Äôs time to handle the device token. Open AppDelegate.swift, and add the following to the end of extension AppDelegate: 123456789func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) &#123; // [1] Parse to token string let token = deviceToken.map &#123; return String(format: \"%02.2hhx\", $0) &#125;.joined() // [2] Log it print(\"Your device token is \\(token)\")&#125; This is where you get device token if your app successfully connects to APNs. Normally, you would send this device token to the backend so they can organize , but in this tutorial we just log it. It is required in the tool to be able to target a particular device. Handling payloadOpen AppDelegate.swift and add the following to th end of extension AppDelegate: 1234567891011121314151617181920212223func application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable : Any], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -&gt; Void) &#123; // [1] Always call the completion handler defer &#123; completionHandler(.newData) &#125; // [2] Convert into JSON dictionary guard let json = userInfo as? [String: Any] else &#123; return &#125; // [3] Parse to aps guard let aps = json[\"aps\"] as? [String: Any] else &#123; return &#125; // [4] Parse to urn guard let urn = aps[\"urn\"] as? String else &#123; return &#125; try? Navigator.navigate(urn: urn)&#125; This method is called when your app receives push notification payload and is running. The above code is relatively straightforward: it first tries to parse the urn information from the payload, then tells Navigator to do the job . Build and run the app on the device, since push notifications won‚Äôt work on the simulator. Log in to the app if prompted. Once on the main screen, grant push notification permissions to the app in order to receive alerts. You should see the device token logged to your Xcode console. Testing Push NotificationsIn this tutorial, you‚Äôll use a tool called PushNotifications to help you easily create push notifications for your app. Download the tool PushNotifications from here. This tool sends payloads directly to APNs. Choose iOS\\Token to use Token Authentication, you get that by creating and downloading your Key from Certificates, Identifiers &amp; Profiles. Browse for the .p8 auth key file that you downloaded earlier. Enter Team ID, you can check it by going to Membership Details Enter Key ID, this is the ID associated with the Key from the first step. Enter Bundle ID and device token. Paste the following into as. It is a traditional payload associated with the URN. 123456&#123; \"aps\":&#123; \"alert\":\"You become a celebrity on PhotoFeed, checkout your profile now\", \"urn\": \"user:self\" &#125;&#125; Since you‚Äôre debugging with Xcode, select Sandbox as environment. Tap Send now. If your app is in the background, an alert will appear. Tapping it will take you to your app and show you your user profile. Bravo! You just implemented deep linking in push notification, thanks again to the URL routing. Read moreHere is the final project with all the code from this tutorial. You now understand central routing patterns, have mastered Compass and even refactored a real-world app. However, there is no silver bullet that works well for all apps. You need to understand your requirements and adjust accordingly. If you want to learn more about other navigation patterns, here are a few suggestions: Coordinator Flow controller Routing in VIPER Remember, it‚Äôs not only about the code, but also about the user experience that your app provides. So please make sure you conform to the guidelines Navigation in Human Interface Guidelines iOS.","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"BuddyBuild and gradle.properties","slug":"BuddyBuild-and-gradle.properties","date":"2017-11-23T09:37:59.000Z","updated":"2019-09-12T06:24:18.000Z","comments":true,"path":"blog/BuddyBuild-and-gradle.properties/","link":"","permalink":"https://onmyway133.github.io/blog/BuddyBuild-and-gradle.properties/","excerpt":"","text":"Issue #109 People advise against storing keys inside build.gradles. We should store them on 1Password and populate our gradle.properties, so don‚Äôt track this file in git. Here is .gitignore file 12345678*.iml/build/gradle.properties/local.properties.gradle.idea There are several ways to help BuddyBuild know about our gradle.properties 1. Using Environment variablesBut when configuring the project on BuddyBuild, it complains about key not found. The solution is to use Environment variables Then in your build.gradle, you can 1buildConfigField &apos;String&apos;, &apos;MY_KEY&apos;, System.getenv(&quot;MY_KEY&quot;) ?: MY_KEY This is because gradle does not know about environment variables. The System.getenv(&quot;MY_KEY&quot;) is for BuddyBuild, and the default MY_KEY is for gradle.properties. Next is to remove this duplication. We can use Groovy Binding. build.gradle does the import import groovy.lang.Binding automatically for us 12345678String environmentKey(variable) &#123; for (Object var : binding.variables) &#123; if (var.value == variable) &#123; return System.getenv(var.key) ?: variable &#125; &#125; return \"\"&#125; 1buildConfigField &apos;String&apos;, &apos;MY_KEY&apos;, environmentKey(MY_KEY) 2. Using Secured File üëçBuddyBuild allows us to define Secured File, here we can upload our gradle.properties And we can use Prebuild script to copy this secured file to our project. BuddyBuild suggests using buddybuild_prebuild.sh but then build fails in Build file &#39;/tmp/sandbox/workspace/app/build.gradle&#39; So, create a script called buddybuild_postclone.sh 123#!/usr/bin/env bashcp $BUDDYBUILD_SECURE_FILES/gradle.properties $BUDDYBUILD_WORKSPACE/gradle.properties","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"}]},{"title":"Communication between Fragment and Activity","slug":"Communication-between-Fragment-and-Activity","date":"2017-11-21T13:24:04.000Z","updated":"2019-08-15T19:21:22.000Z","comments":true,"path":"blog/Communication-between-Fragment-and-Activity/","link":"","permalink":"https://onmyway133.github.io/blog/Communication-between-Fragment-and-Activity/","excerpt":"","text":"Issue #108 There‚Äôs always need for communication, right üòâ Suppose we have OnboardingActivity that has several OnboardingFragment. Each Fragment has a startButton telling that the onboarding flow has finished, and only the last Fragment shows this button. Here are several ways you can do that 1. EventBus üôÑNearly all articles I found propose this https://github.com/greenrobot/EventBus, but I personally don‚Äôt like this idea because components are loosely coupled, every component and broadcast can listen to event from a singleton, which makes it very hard to reason when the project scales 1data class OnboardingFinishEvent() 1234567891011121314151617class OnboardingActivity: AppCompatActivity() &#123; override fun onStart() &#123; super.onStart() EventBus.getDefault().register(this) &#125; override fun onStop() &#123; EventBus.getDefault().unregister(this) super.onStop() &#125; @Subscribe(threadMode = ThreadMode.MAIN) fun onOnboardingFinishEvent(event: OnboardingFinishEvent) &#123; // finish &#125;&#125; 123456789class OnboardingFragment: Fragment() &#123; override fun onViewCreated(view: View?, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) startButton.onClick &#123; EventBus.getDefault().post(OnboardingFinishEvent()) &#125; &#125;&#125; Read more https://gunhansancar.com/ease-communication-between-activities-fragments-services/ 2. Otto üôÑThis https://github.com/square/otto was deprecated in favor of RxJava and RxAndroid 3. RxJava üôÑWe can use simple PublishSubject to create our own RxBus 12345678910111213141516import io.reactivex.Observableimport io.reactivex.subjects.PublishSubject// Use object so we have a singleton instanceobject RxBus &#123; private val publisher = PublishSubject.create&lt;Any&gt;() fun publish(event: Any) &#123; publisher.onNext(event) &#125; // Listen should return an Observable and not the publisher // Using ofType we filter only events that match that class type fun &lt;T&gt; listen(eventType: Class&lt;T&gt;): Observable&lt;T&gt; = publisher.ofType(eventType)&#125; 1234// OnboardingFragment.ktstartButton.onClick &#123; RxBus.publish(OnboardingFinishEvent())&#125; 12345678// OnboardingActivity.ktoverride fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) RxBus.listen(OnboardingFinishEvent::class.java).subscribe(&#123; // finish &#125;)&#125; 4. InterfaceThis is advised here Communicating with Other Fragments. Basically you define an interface OnboardingFragmentDelegate that whoever conforms to that, can be informed by the Fragment of events. This is similar to Delegate pattern in iOS üòâ 1234567891011121314151617181920212223interface OnboardingFragmentDelegate &#123; fun onboardingFragmentDidClickStartButton(fragment: OnboardingFragment)&#125;class OnboardingFragment: Fragment() &#123; var delegate: OnboardingFragmentDelegate? = null override fun onAttach(context: Context?) &#123; super.onAttach(context) if (context is OnboardingFragmentDelegate) &#123; delegate = context &#125; &#125; override fun onViewCreated(view: View?, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) startButton.onClick &#123; delegate?.onboardingFragmentDidClickStartButton(this) &#125; &#125;&#125; 123456class OnboardingActivity: AppCompatActivity(), OnboardingFragmentDelegate &#123; override fun onboardingFragmentDidClickStartButton(fragment: OnboardingFragment) &#123; onboardingService.hasShown = true startActivity&lt;LoginActivity&gt;() &#125;&#125; 5. ViewModelWe can learn from Share data between fragments to to communication between Fragment and Activity, by using a shared ViewModel that is scoped to the activity. This is a bit overkill 123class OnboardingSharedViewModel: ViewModel() &#123; val finish = MutableLiveData&lt;Unit&gt;()&#125; 12345678910class OnboardingActivity: AppCompatActivity(), OnboardingFragmentDelegate &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) val viewModel = ViewModelProviders.of(this).get(OnboardingSharedViewModel::class.java) viewModel.finish.observe(this, Observer &#123; startActivity&lt;LoginActivity&gt;() &#125;) &#125;&#125; Note that we need to call ViewModelProviders.of(activity) to get the same ViewModel with the activity 12345678910class OnboardingFragment: Fragment() &#123; override fun onViewCreated(view: View?, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) val viewModel = ViewModelProviders.of(activity).get(OnboardingSharedViewModel::class.java) startButton.onClick(&#123; viewModel.finish.value = Unit &#125;) &#125;&#125; 7. LambdaCreate a lambda in Fragment, then set it on onAttachFragment. It does not work for now as there is no OnboardingFragment in onAttachFragment üò¢ 1234567891011class OnboardingFragment: Fragment() &#123; var didClickStartButton: (() -&gt; Unit)? = null override fun onViewCreated(view: View?, savedInstanceState: Bundle?) &#123; super.onViewCreated(view, savedInstanceState) startButton.onClick &#123; didClickStartButton?.invoke() &#125; &#125;&#125; 1234567891011class OnboardingActivity: AppCompatActivity() &#123; override fun onAttachFragment(fragment: Fragment?) &#123; super.onAttachFragment(fragment) (fragment as? OnboardingFragment).let &#123; it?.didClickStartButton = &#123; // finish &#125; &#125; &#125;&#125; 8. Listener in Bundle üôÑRead more https://medium.com/groupon-eng/from-fragments-to-activity-the-lambda-way-32c768c72aa9 How to communicate between fragments and activity using ViewModel","categories":[],"tags":[{"name":"android","slug":"android","permalink":"https://onmyway133.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://onmyway133.github.io/tags/kotlin/"}]},{"title":"Coordinator and FlowController","slug":"Coordinator-and-FlowController","date":"2017-11-14T13:40:31.000Z","updated":"2019-09-24T06:52:58.000Z","comments":true,"path":"blog/Coordinator-and-FlowController/","link":"","permalink":"https://onmyway133.github.io/blog/Coordinator-and-FlowController/","excerpt":"","text":"Issue #106 Every new architecture that comes out, either iOS or Android, makes me very excited. I‚Äôm always looking for ways to structure apps in a better way. But after some times, I see that we‚Äôre too creative in creating architecture, aka constraint, that is too far away from the platform that we‚Äôre building. I often think ‚ÄúIf we‚Äôre going too far from the system, then it‚Äôs very hard to go back‚Äù I like things that embrace the system. One of them is Coordinator which helps in encapsulation and navigation. Thanks to my friend Vadym for showing me Coordinator in action. The below screenshot from @khanlou ‚Äòs talk at CocoaHeads Stockholm clearly says many things about Coordinator But after reading A Better MVC, I think we can leverage view controller containment to do navigation using UIViewController only. Since I tend to call view controllers as LoginController, ProfileController, ... and the term flow to group those related screens, what should we call a Coordinator that inherits from UIViewController ü§î Let‚Äôs call it FlowController üòé . The name is not that important, but the concept is simple. FlowController was also inspired by this Flow Controllers on iOS for a Better Navigation Control back in 2014. The idea is from awesome iOS people, this is just a sum up from my experience üòá So FlowController can just a UIViewController friendly version of Coordinator. Let see how FlowController fits better into MVC ¬´UIViewController is the center of the universe.¬ª‚Äî @onmyway133&mdash; Elvis Nu√±ez (@3lvis) 6. oktober 2017 1. FlowController and AppDelegateYour application starts from AppDelegate, in that you setup UIWindow. So we should follow the same ‚Äútop down‚Äù approach for FlowController, starting with AppFlowController. You can construct all dependencies that your app need for AppFlowController, so that it can pass to other child FlowController. AppDelegate is also considered Composition Root Here is how to declare AppFlowController in AppDelegate 123456789101112131415161718192021222324252627282930313233343536struct DependencyContainer: AuthServiceContainer, PhoneServiceContainer, NetworkingServiceContainer, LocationServiceContainer, MapServiceContainer, HealthServiceContainer &#123; let authService: AuthServiceProtocol let phoneService: PhoneService let networkingService: NetworkingService let locationService: LocationService let mapService: MapService let healthService: HealthService static func make() -&gt; DependencyContainer &#123; // Configure and make DependencyContainer here &#125;&#125;@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123; var window: UIWindow? var appFlowController: AppFlowController! func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool &#123; appFlowController = AppFlowController( dependencyContainer: DependencyContainer.make() ) window = UIWindow(frame: UIScreen.main.bounds) window?.rootViewController = appFlowController window?.makeKeyAndVisible() appFlowController.start() return true &#125;&#125; Here are some hypothetical FlowController that you may encounter AppFlowController: manages UIWindow and check whether to show onboarding, login or main depending on authentication state OnboardingFlowController: manages UIPageViewController and maybe ask for some permissions LoginFlowController: manages UINavigationController to show login, sms verification, forget password, and optionally start SignUpFlowController MainFlowController: manages UITabBarController with each tab serving main features FeedFlowController: show feed with list of items ProfileFlowController: show profile SettingsFlowController: show settings, and maybe call logout, this will delegates up the FlowController chain. The cool thing about FlowController is it makes your code very self contained, and grouped by features. So it‚Äôs easy to move all related things to its own package if you like. 2. FlowController as container view controller In general, a view controller should manage either sequence or UI, but not both. Basically, FlowController is just a container view controller to solve the sequence, based on a simple concept called composition. It manages many child view controllers in its flow. Let‚Äô say we have a ProductFlowController that groups together flow related to displaying products, ProductListController, ProductDetailController, ProductAuthorController, ProductMapController, ‚Ä¶ Each can delegate to the ProductFlowController to express its intent, like ProductListController can delegate to say ‚Äúproduct did tap‚Äù, so that ProductFlowController can construct and present the next screen in the flow, based on the embedded UINavigationController inside it. Normally, a FlowController just displays 1 child FlowController at a time, so normally we can just update its frame 1234567final class AppFlowController: UIViewController &#123; override func viewDidLayoutSubviews() &#123; super.viewDidLayoutSubviews() childViewControllers.first?.view.frame = view.bounds &#125;&#125; 3. FlowController as dependency containerEach view controller inside the flow can have different dependencies, so it‚Äôs not fair if the first view controller needs to carry all the stuff just to be able to pass down to the next view controllers. Here are some dependencies ProductListController: ProductNetworkingService ProductDetailController: ProductNetworkingService, ImageDowloaderService, ProductEditService ProductAuthorController: AuthorNetworkingService, ImageDowloaderService ProductMapController: LocationService, MapService Instead the FlowController can carry all the dependencies needed for that whole flow, so it can pass down to the view controller if needed. 1234567891011121314151617181920212223242526272829struct ProductDependencyContainer &#123; let productNetworkingService: ProductNetworkingService let imageDownloaderService: ImageDownloaderService let productEditService: ProductEditService let authorNetworkingService: AuthorNetworkingService let locationService: LocationService let mapService: MapService&#125;class ProductFlowController &#123; let dependencyContainer: ProductDependencyContainer init(dependencyContainer: ProductDependencyContainer) &#123; self.dependencyContainer = dependencyContainer &#125;&#125;extension ProductFlowController: ProductListControllerDelegate &#123; func productListController(_ controller: ProductListController, didSelect product: Product) &#123; let productDetailController = ProductDetailController( productNetworkingService: dependencyContainer.productNetworkingService, productEditService: dependencyContainer.productEditService, imageDownloaderService: dependencyContainer.imageDownloaderService ) productDetailController.delegate = self embeddedNavigationController.pushViewController(productDetailController, animated: true) &#125;&#125; Here are some ways that you can use to pass dependencies into FlowController Using protocol compositon for dependency injection Dependency injection using factories in Swift 4. Adding or removing child FlowControllerCoordinator With Coordinator, you need to keep an array of child Coordinators, and maybe use address (=== operator) to identify them 1234567891011121314151617181920212223class Coordinator &#123; private var children: [Coordinator] = [] func add(child: Coordinator) &#123; guard !children.contains(where: &#123; $0 === child &#125;) else &#123; return &#125; children.append(child) &#125; func remove(child: Coordinator) &#123; guard let index = children.index(where: &#123; $0 === child &#125;) else &#123; return &#125; children.remove(at: index) &#125; func removeAll() &#123; children.removeAll() &#125;&#125; FlowController With FlowController, since it is UIViewController subclass, it has viewControllers to hold all those child FlowController. Just add these extensions to simplify your adding or removing of child UIViewController 12345678910111213extension UIViewController &#123; func add(childController: UIViewController) &#123; addChildViewController(childController) view.addSubview(childController.view) childController.didMove(toParentViewController: self) &#125; func remove(childController: UIViewController) &#123; childController.willMove(toParentViewController: nil) childController.view.removeFromSuperview() childController.removeFromParentViewController() &#125;&#125; And see in action how AppFlowController work with adding 1234567891011121314151617181920212223final class AppFlowController: UIViewController &#123; func start() &#123; if authService.isAuthenticated &#123; startMain() &#125; else &#123; startLogin() &#125; &#125; private func startLogin() &#123; let loginFlowController = LoginFlowController( loginFlowController.delegate = self add(childController: loginFlowController) loginFlowController.start() &#125; fileprivate func startMain() &#123; let mainFlowController = MainFlowController() mainFlowController.delegate = self add(childController: mainFlowController) mainFlowController.start() &#125;&#125; and with removing when the child FlowController finishes 123456extension AppFlowController: LoginFlowControllerDelegate &#123; func loginFlowControllerDidFinish(_ flowController: LoginFlowController) &#123; remove(childController: flowController) startMain() &#125;&#125; 5. AppFlowController does not need to know about UIWindowCoordinator Usually you have an AppCoordinator, which is held by AppDelegate, as the root of your Coordinator chain. Based on login status, it will determine which LoginController or MainController will be set as the rootViewController, in order to do that, it needs to be injected a UIWindow 1234window = UIWindow(frame: UIScreen.main.bounds)appCoordinator = AppCoordinator(window: window!)appCoordinator.start()window?.makeKeyAndVisible() You can guess that in the start method of AppCoordinator, it must set rootViewController before window?.makeKeyAndVisible() is called. 123456789101112131415final class AppCoordinator: Coordinator &#123; private let window: UIWindow init(window: UIWindow) &#123; self.window = window &#125; func start() &#123; if dependencyContainer.authService.isAuthenticated &#123; startMain() &#125; else &#123; startLogin() &#125; &#125;&#125; FlowController But with AppFlowController, you can treat it like a normal UIViewController, so just setting it as the rootViewController 123456appFlowController = AppFlowController(window = UIWindow(frame: UIScreen.main.bounds)window?.rootViewController = appFlowControllerwindow?.makeKeyAndVisible()appFlowController.start() 6. LoginFlowController can manage its own flowSupposed we have login flow based on UINavigationController that can display LoginController, ForgetPasswordController, SignUpController Coordinator What should we do in the start method of LoginCoordinator? Construct the initial controller LoginController and set it as the rootViewController of the UINavigationController? LoginCoordinator can create this embedded UINavigationController internally, but then it is not attached to the rootViewController of UIWindow, because UIWindow is kept privately inside the parent AppCoordinator. We can pass UIWindow to LoginCoordinator but then it knows too much. One way is to construct UINavigationController from AppCoordinator and pass that to LoginCoordinator 1234567891011121314151617181920212223242526272829final class AppCoordinator: Coordinator &#123; private let window: UIWindow private func startLogin() &#123; let navigationController = UINavigationController() let loginCoordinator = LoginCoordinator(navigationController: navigationController) loginCoordinator.delegate = self add(child: loginCoordinator) window.rootViewController = navigationController loginCoordinator.start() &#125;&#125;final class LoginCoordinator: Coordinator &#123; private let navigationController: UINavigationController init(navigationController: UINavigationController) &#123; self.navigationController = navigationController &#125; func start() &#123; let loginController = LoginController(dependencyContainer: dependencyContainer) loginController.delegate = self navigationController.viewControllers = [loginController] &#125;&#125; FlowController LoginFlowController leverages container view controller so it fits nicely with the way UIKit works. Here AppFlowController can just add LoginFlowController and LoginFlowController can just create its own embeddedNavigationController. 1234567891011121314151617181920212223242526272829303132final class AppFlowController: UIViewController &#123; private func startLogin() &#123; let loginFlowController = LoginFlowController( dependencyContainer: dependencyContainer ) loginFlowController.delegate = self add(childController: loginFlowController) loginFlowController.start() &#125;&#125;final class LoginFlowController: UIViewController &#123; private let dependencyContainer: DependencyContainer private var embeddedNavigationController: UINavigationController! weak var delegate: LoginFlowControllerDelegate? init(dependencyContainer: DependencyContainer) &#123; self.dependencyContainer = dependencyContainer super.init(nibName: nil, bundle: nil) embeddedNavigationController = UINavigationController() add(childController: embeddedNavigationController) &#125; func start() &#123; let loginController = LoginController(dependencyContainer: dependencyContainer) loginController.delegate = self embeddedNavigationController.viewControllers = [loginController] &#125;&#125; 7. FlowController and responder chainCoordinator Sometimes we want a quick way to bubble up message to parent Coordinator, one way to do that is to replicate UIResponder chain using associated object and protocol extensions, like Inter-connect with Coordinator 12345678910111213141516171819202122extension UIViewController &#123; private struct AssociatedKeys &#123; static var ParentCoordinator = \"ParentCoordinator\" &#125; public var parentCoordinator: Any? &#123; get &#123; return objc_getAssociatedObject(self, &amp;AssociatedKeys.ParentCoordinator) &#125; set &#123; objc_setAssociatedObject(self, &amp;AssociatedKeys.ParentCoordinator, newValue, .OBJC_ASSOCIATION_ASSIGN) &#125; &#125;&#125;open class Coordinator&lt;T: UIViewController&gt;: UIResponder, Coordinating &#123; open var parent: Coordinating? override open var coordinatingResponder: UIResponder? &#123; return parent as? UIResponder &#125;&#125; FlowController Since FlowController is UIViewController, which inherits from UIResponder, responder chain happens out of the box Responder objects‚Äîthat is, instances of UIResponder‚Äîconstitute the event-handling backbone of a UIKit app. Many key objects are also responders, including the UIApplication object, UIViewController objects, and all UIView objects (which includes UIWindow). As events occur, UIKit dispatches them to your app‚Äôs responder objects for handling. 8. FlowController and trait collectionFlowController I very much like how Kickstarter uses trait collection in testing. Well, since FlowController is a parent view controller, we can just override its trait collection, and that will affect the size classes of all view controllers inside that flow. As in A Better MVC, Part 2: Fixing Encapsulation The huge advantage of this approach is that system features come free. Trait collection propagation is free. View lifecycle callbacks are free. Safe area layout margins are generally free. The responder chain and preferred UI state callbacks are free. And future additions to UIViewController are also free. From setOverrideTraitCollection When implementing a custom container view controller, you can use this method to change the traits of any embedded child view controllers to something more appropriate for your layout. Making such a change alters other view controller behaviors associated with that child 1234567let trait = UITraitCollection(traitsFrom: [ .init(horizontalSizeClass: .compact), .init(verticalSizeClass: .regular), .init(userInterfaceIdiom: .phone)])appFlowController.setOverrideTraitCollection(trait, forChildViewController: loginFlowController) 9. FlowController and back buttonCoordinator One problem with UINavigationController is that clicking on the default back button pops the view controller out of the navigation stack, so Coordinator is not aware of that. With Coordinator you needs to keep Coordinator and UIViewController in sync, add try to hook up UINavigationControllerDelegate in order to clean up. Like in Back Buttons and Coordinators 1234567891011121314151617extension Coordinator: UINavigationControllerDelegate &#123; func navigationController(navigationController: UINavigationController, didShowViewController viewController: UIViewController, animated: Bool) &#123; // ensure the view controller is popping guard let fromViewController = navigationController.transitionCoordinator?.viewController(forKey: .from), !navigationController.viewControllers.contains(fromViewController) else &#123; return &#125; // and it's the right type if fromViewController is FirstViewControllerInCoordinator) &#123; //deallocate the relevant coordinator &#125; &#125;&#125; Or creating a class called NavigationController that inside manages a list of child coordinators. Like in Navigation coordinators 12345678910111213141516171819202122final class NavigationController: UIViewController &#123; // MARK: - Inputs private let rootViewController: UIViewController // MARK: - Mutable state private var viewControllersToChildCoordinators: [UIViewController: Coordinator] = [:] // MARK: - Lazy views private lazy var childNavigationController: UINavigationController = UINavigationController(rootViewController: self.rootViewController) // MARK: - Initialization init(rootViewController: UIViewController) &#123; self.rootViewController = rootViewController super.init(nibName: nil, bundle: nil) &#125;&#125; FlowController Since FlowController is just plain UIViewController, you don‚Äôt need to manually manage child FlowController. The child FlowController is gone when you pop or dismiss. If we want to listen to UINavigationController events, we can just handle that inside the FlowController 1234567891011121314151617181920final class LoginFlowController: UIViewController &#123; private let dependencyContainer: DependencyContainer private var embeddedNavigationController: UINavigationController! weak var delegate: LoginFlowControllerDelegate? init(dependencyContainer: DependencyContainer) &#123; self.dependencyContainer = dependencyContainer super.init(nibName: nil, bundle: nil) embeddedNavigationController = UINavigationController() embeddedNavigationController.delegate = self add(childController: embeddedNavigationController) &#125;&#125;extension LoginFlowController: UINavigationControllerDelegate &#123; func navigationController(_ navigationController: UINavigationController, willShow viewController: UIViewController, animated: Bool) &#123; &#125;&#125; 10. FlowController and callbackWe can use delegate pattern to notify FlowController to show another view controller in the flow 123456789101112extension ProductFlowController: ProductListControllerDelegate &#123; func productListController(_ controller: ProductListController, didSelect product: Product) &#123; let productDetailController = ProductDetailController( productNetworkingService: dependencyContainer.productNetworkingService, productEditService: dependencyContainer.productEditService, imageDownloaderService: dependencyContainer.imageDownloaderService ) productDetailController.delegate = self embeddedNavigationController.pushViewController(productDetailController, animated: true) &#125;&#125; Another approach is to use closure as callback, as proposed by @merowing_, and also in his post Improve your iOS Architecture with FlowControllers Using closures as triggers rather than delegate allows for more readable and specialized implementation, and multiple contexts 12345678910111213final class ProductFlowController &#123; func start() &#123; let productListController = ProductListController( productNetworkingService: dependencyContainer.productNetworkingService ) productListController.didSelectProduct = &#123; [weak self] product in self?.showDetail(for: product) &#125; embeddedNavigationController.viewControllers = [productListController] &#125;&#125; 11. FlowController and deep linkingTBD. In the mean while, here are some readings about the UX Navigation with Back and Up UserNotification","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Please reconsidering your choice of libraries","slug":"Please-reconsidering-your-choice-of-libraries","date":"2017-11-10T11:43:26.000Z","updated":"2019-01-09T05:54:50.000Z","comments":true,"path":"blog/Please-reconsidering-your-choice-of-libraries/","link":"","permalink":"https://onmyway133.github.io/blog/Please-reconsidering-your-choice-of-libraries/","excerpt":"","text":"Issue #105 Are you willing to take vaccines you don‚Äôt know about? I like open source. I ‚Äòve made some and contributed to some. I also use other people ‚Äòs open source libraries and learn a lot from them üòá Open source can help us build better, faster and maybe more performant software by basing on other people ‚Äòs hard work. We can also collaborate and make it better. But it‚Äôs also a double edges sword if you‚Äôre not judging carefully. Putting a little bit more dedicationYou can skip this post if your project is just for fun, and you don‚Äôt care about future maintenance. If you‚Äôre making client or product projects, you should care and put a little more dedication into it. The company and your teammates trust you to do the good work. I‚Äôve admitted that I ‚Äòve done node.js and electron.js. The choice is because it‚Äôs just a utility that I want to make quickly, and there ‚Äòs many node.js packages that I can use immediately. I have little experience in node.js, so I accept the risk do get the work done. But if you‚Äôre experienced developer in your platform, and it‚Äôs your important project, then it‚Äôs a different story üí• I‚Äôm kind of experimental person, so I always want to try new things. But I also learn the hard way to not over engineer, and to live as close to the system as possible. I just read Much ado about iOS app architecture and I agree with most of the points, that we shouldn‚Äôt fight the SDK and replace system frameworks. To me, using 3rd libraries is like giving your life to someone else ‚Äòs hands, that you can‚Äôt make any decision for your future. Please don‚Äôt just pod install and consider it done üôè What about the starsPeople tend to follow those that have lots of followers, and to star a project with lots of stars. Don‚Äôt trust the stars. It means nearly nothing. The star is just the result of some marketing effort. Being featured or not in a newsletter can make 1k stars difference. Just because it was featured in a newsletter does not necessarily mean that it is good üò¨ You should judge it yourself by checking how good the source code is, how many documentation are available, and whether there is unit tests or not. The author is just human, so he can‚Äôt help maintain the library forever. You‚Äôre taking a big risk if you don‚Äôt have good picture of the library. The system, especially iOS, changes very often. There are some libraries that try to ‚Äúreplicate‚Äù system APIs or perform type checking for every possible types. It can be that the author pick the most common use cases, or just trying to provide a cleaner APIs to the user. But if things change, will that author be willing to fix that? Will you be stuck there and making another issue asking for help? We‚Äôre making life better, not traps for everyone to fall into üôÄ Here I don‚Äôt try to blame anyone, ‚Äúyou is not your work‚Äù. I just say that you should check it more thoroughly. You can consult your colleagues and discuss if it‚Äôs good to integrate. Most of the time, pulling a huge library just for some tiny syntactic sugar does not worth it I just put some random links here and you can determine if you like or not https://github.com/radex/SwiftyUserDefaults/blob/master/Sources/SwiftyUserDefaults.swift#L145 https://github.com/jiecao-fm/SwiftTheme/blob/master/Source/UIKit%2BTheme.swift#L183 https://github.com/erichoracek/Motif/blob/7ec2dfce45cd93cb5ae22f4f512a41a499138fd5/Examples/ButtonsExample/ThemeThemeSymbols.m#L10 https://github.com/vhesener/Closures/blob/master/Xcode/Closures/Source/UITableView.swift#L251 https://github.com/Draveness/DKNightVersion/blob/master/DKNightVersion/UIKit/UITableView%2BNight.m#L29 https://github.com/tombenner/nui/blob/master/NUI/Core/NUISwizzler.m#L15 https://github.com/square/SuperDelegate/blob/master/Sources/SuperDelegate%2BLocalNotifications.swift#L53 https://github.com/orta/ARAnalytics/blob/master/ARDSL.m#L113 https://github.com/SnapKit/SnapKit/blob/develop/Source/ConstraintMakerRelatable.swift#L43 https://github.com/saoudrizwan/DynamicJSON/blob/master/Sources/DynamicJSON.swift#L54 PleaseWould you take a very big risk for so little return ? Always implement and imagine that you will be the next maintainer for the project, then you will act differently. So the next time, please reconsider your choice of libraries. Take 1 step back and analyse a bit ‚ù§Ô∏è","categories":[],"tags":[]},{"title":"How to make generic extension with associatedtype protocol in Swift","slug":"How-to-make-generic-extension-with-associatedtype-protocol-in-Swift","date":"2017-11-10T09:37:54.000Z","updated":"2019-05-23T16:55:10.000Z","comments":true,"path":"blog/How-to-make-generic-extension-with-associatedtype-protocol-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-generic-extension-with-associatedtype-protocol-in-Swift/","excerpt":"","text":"Issue #104 I like extensions, and I like to group them under 1 common property to easily access. This also makes it clear that these all belong to the same feature and not to confuse with Apple properties. Grouping all related extensionsThis is how I do it in Anchor and On 123456activate( a.anchor.top.left, b.anchor.top.right, c.anchor.bottom.left, d.anchor.bottom.right) 1234567textField.on.text &#123; text in print(\"textField text has changed\")&#125;textField.on.didEndEditing &#123; text in print(\"texField has ended editing\")&#125; Generic extensionFor On, it is a bit tricky as it needs to adapt to different NSObject subclasses. And to make auto completion work, meaning that each type of subclass gets its own function hint, we need to use generic and associatedtype protocol. You can take a look at Container and OnAware 1234567public class Container&lt;Host: AnyObject&gt;: NSObject &#123; unowned let host: Host init(host: Host) &#123; self.host = host &#125;&#125; 12345public protocol OnAware: class &#123; associatedtype OnAwareHostType: AnyObject var on: Container&lt;OnAwareHostType&gt; &#123; get &#125;&#125; RxCocoaRxSwift has its RxCocoa that does this trick too, so that you can just declare 123button.rx.taptextField.rx.textalertAction.rx.isEnabled The power lies in the struct Reactive and ReactiveCompatible protocol 1234567891011121314151617181920212223242526272829303132333435363738394041424344public struct Reactive&lt;Base&gt; &#123; /// Base object to extend. public let base: Base /// Creates extensions with base object. /// /// - parameter base: Base object. public init(_ base: Base) &#123; self.base = base &#125;&#125;public protocol ReactiveCompatible &#123; /// Extended type associatedtype CompatibleType /// Reactive extensions. static var rx: Reactive&lt;CompatibleType&gt;.Type &#123; get set &#125; /// Reactive extensions. var rx: Reactive&lt;CompatibleType&gt; &#123; get set &#125;&#125;extension ReactiveCompatible &#123; /// Reactive extensions. public static var rx: Reactive&lt;Self&gt;.Type &#123; get &#123; return Reactive&lt;Self&gt;.self &#125; set &#123; // this enables using Reactive to \"mutate\" base type &#125; &#125; /// Reactive extensions. public var rx: Reactive&lt;Self&gt; &#123; get &#123; return Reactive(self) &#125; set &#123; // this enables using Reactive to \"mutate\" base object &#125; &#125;&#125; Here UIButton+Rx you can see how it can be applied to UIButton 1234567extension Reactive where Base: UIButton &#123; /// Reactive wrapper for `TouchUpInside` control event. public var tap: ControlEvent&lt;Void&gt; &#123; return controlEvent(.touchUpInside) &#125;&#125;","categories":[],"tags":[]},{"title":"How to make simple Binding in MVVM in iOS","slug":"How-to-make-simple-Binding-in-MVVM-in-iOS","date":"2017-11-10T09:22:19.000Z","updated":"2019-05-23T16:54:29.000Z","comments":true,"path":"blog/How-to-make-simple-Binding-in-MVVM-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-simple-Binding-in-MVVM-in-iOS/","excerpt":"","text":"Issue #103 If you use MVVM or any other kinds of helper classes, then there‚Äôs need to report back the result to the caller. In simple cases, without asynchronous chaining, RxSwift is a bit overkill, you can just implement your own Binding. Basically, it is just observer pattern, or closure in its simplest form. 123456789101112131415161718class Binding&lt;T&gt; &#123; var value: T &#123; didSet &#123; listener?(value) &#125; &#125; private var listener: ((T) -&gt; Void)? init(value: T) &#123; self.value = value &#125; func bind(_ closure: @escaping (T) -&gt; Void) &#123; closure(value) listener = closure &#125;&#125; Then you can declare it like 12345678910111213class ViewModel &#123; let friends = Binding&lt;[User]&gt;(value: []) init() &#123; getFacebookFriends &#123; friends.value = $0 &#125; &#125; func getFacebookFriends(completion: ([User]) -&gt; Void) &#123; // Do the work &#125;&#125; Finally, this is how you listen to the result via callback 1234567override func viewDidLoad() &#123; super.viewDidLoad() viewModel.friends.bind &#123; friends in self.friendsCountLabel.text = \"\\(friends.count)\" &#125;&#125;","categories":[],"tags":[]},{"title":"How to use custom UINavigationBar in iOS","slug":"How-to-use-custom-UINavigationBar-in-iOS","date":"2017-11-08T11:09:04.000Z","updated":"2019-05-23T16:54:17.000Z","comments":true,"path":"blog/How-to-use-custom-UINavigationBar-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-custom-UINavigationBar-in-iOS/","excerpt":"","text":"Issue #102 Today I was reading the project in IGListKit Tutorial: Better UICollectionViews, I encounter something I often overlook 12let nav = UINavigationController(navigationBarClass: CustomNavigationBar.self, toolbarClass: nil)nav.pushViewController(FeedViewController(), animated: false) So we can provide custom navigationBarClass and toolbarClass for UINavigationController. This RRMaterialNavigationBar also has cool implementation of a material UINavigationBar. Together with UINavigationBarDelegate we can do some cool things","categories":[],"tags":[]},{"title":"It's good to have a CI","slug":"It's-good-to-have-a-CI","date":"2017-11-02T09:42:34.000Z","updated":"2019-09-12T06:31:39.000Z","comments":true,"path":"blog/It's-good-to-have-a-CI/","link":"","permalink":"https://onmyway133.github.io/blog/It's-good-to-have-a-CI/","excerpt":"","text":"Issue #101 I have Unit tests and UI tests pass on my simulator and device, locally. But when I make the build on Buddybuild, it fails with the reason Activity cannot be used after its scope has completed. People seem to have the same issue too. Taking a look at the log in Buddybuild 123456789101112131415161718192021222324252627 t = 8.89s Staging: UIStatusBarWindowt = 8.95s Staging: (CoreFoundation) Sending Updated Preferences to System CFPrefsDt = 8.95s Staging: Setup BuddybuildSDKt = 8.98s Staging: [BuddyBuildSDK] In app store - Instant Replay Disabledt = 8.98s Staging: Setting up the remote notifications for UI Tests video recordingt = 9.07s CL: CLLocationManagert = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;CLLocationManager&quot;, &quot;event&quot;:activity, &quot;_cmd&quot;:initWithEffectiveBundleIdentifier:bundle:, &quot;self&quot;:&quot;0x600000205140&quot;, &quot;identifier&quot;:(null), &quot;bundle&quot;:(null)&#125;t = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Core] &#123;&quot;msg&quot;:&quot;state transition&quot;, &quot;event&quot;:state_transition, &quot;state&quot;:LocationManager, &quot;id&quot;:&quot;0x600000205140&quot;, &quot;property&quot;:init, &quot;new&quot;:&apos;00 00 00 00 00 00 F0 BF 00 00 00 00 00 00 F0 BF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 F0 3F 01 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00&apos;&#125;t = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Core] &#123;&quot;msg&quot;:&quot;state transition&quot;, &quot;event&quot;:state_transition, &quot;state&quot;:LocationManager, &quot;id&quot;:&quot;0x600000205140&quot;, &quot;property&quot;:lifecycle, &quot;old&quot;:&quot;0x0&quot;, &quot;new&quot;:&quot;0x6040000ddd50&quot;&#125;t = 9.07s CL: _CLClientCreateWithBundleIdentifierAndPatht = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;_CLClientCreateWithBundleIdentifierAndPath&quot;, &quot;event&quot;:activity, &quot;effectiveBundleIdentifier&quot;:(null), &quot;effectiveBundlePath&quot;:(null)&#125;t = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;client allocated&quot;, &quot;client&quot;:&quot;0x7f84c64e0990&quot;&#125;t = 9.07s CL: _CLClientCreateConnectiont = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;_CLClientCreateConnection&quot;, &quot;event&quot;:activity, &quot;client&quot;:&quot;0x7f84c64e0990&quot;&#125;t = 9.07s CL: Sending cached messages to daemont = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;Sending cached messages to daemon&quot;, &quot;event&quot;:activity&#125;t = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Client] #Warning No cached registration messaget = 9.07s Staging: (CoreLocation) [com.apple.locationd.Core.Core] &#123;&quot;msg&quot;:&quot;state transition&quot;, &quot;event&quot;:state_transition, &quot;state&quot;:LocationManager, &quot;id&quot;:&quot;0x600000205140&quot;, &quot;property&quot;:pausesLocationUpdatesAutomatically, &quot;old&quot;:0, &quot;new&quot;:1&#125;t = 9.10s CL: CLLocationManagert = 9.11s Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;CLLocationManager&quot;, &quot;event&quot;:activity, &quot;_cmd&quot;:setDelegate:, &quot;self&quot;:&quot;0x600000205140&quot;, &quot;delegate&quot;:&quot;0x60400028bef0&quot;&#125;t = 9.12s error: unexpectedly found nil while unwrapping an Optional valuet = 9.12s Unable to monitor event loopt = 10.13s Tap &quot;Onboarding.Continue&quot; Buttont = 10.13s Wait for no.hyper.MyApp-Staging to idlet = 10.16s Find the &quot;Onboarding.Continue&quot; Buttont = 11.28s Assertion Failure: &lt;unknown&gt;:0: no.hyper.MyApp-Staging crashed in MyApp_Staging.AppDelegate.(makeDependencyContainer in _5D394B3D7D393F9C3C550E61780517BB)() -&gt; MyApp_Staging.DependencyContainert = 11.33s Wait for com.apple.springboard to idle Did you see unexpectedly found nil while unwrapping an Optional value? It crashed in CLLocationManager. It is because when location changes, CLLocationManager needs to report it via didUpdateLocations function, but we haven‚Äôt implemented it. Strangely that it didn‚Äôt happen when testing locally. The proposed fix is to implement a dummy method with no operation 123func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) &#123; // No op&#125; But it is not the solution. It appears that BuddyBuild is doing some hacks with how push notification and UIWindow, hence causing the issue.","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Why native?","slug":"Why-native","date":"2017-11-01T08:09:59.000Z","updated":"2019-02-11T12:32:34.000Z","comments":true,"path":"blog/Why-native/","link":"","permalink":"https://onmyway133.github.io/blog/Why-native/","excerpt":"","text":"Issue #100 For now, I still believe in native. Here are some interesting links Why we are not cross-platform developers Why I‚Äôm not a React Native Developer We are ditching Xamarin. Why? https://en.wikipedia.org/wiki/Leaky_abstraction I‚Äôm harvesting credit card numbers and passwords from your site. Here‚Äôs how. How one developer just broke Node, Babel and thousands of projects in 11 lines of JavaScript React Native https://medium.com/snipe-gg/should-you-use-react-native-to-build-your-startups-mobile-app-c0baf9f4d9ad https://blog.discordapp.com/using-react-native-one-year-later-91fd5e949933","categories":[],"tags":[]},{"title":"Diff algorithm","slug":"Diff-algorithm","date":"2017-10-31T12:56:13.000Z","updated":"2019-02-22T08:09:00.000Z","comments":true,"path":"blog/Diff-algorithm/","link":"","permalink":"https://onmyway133.github.io/blog/Diff-algorithm/","excerpt":"","text":"Issue #99 I‚Äôve been searching for efficient ways to diff collections, here are some interesting papers that I find Myers An O(ND) Difference Algorithm and Its Variations https://github.com/wokalski/Diff.swift https://github.com/kpdecker/jsdiff https://github.com/raywenderlich/swift-algorithm-club/pull/693/files Wu An O(NP) Sequence Comparison Algorithm https://github.com/kazuhiro4949/EditDistance https://github.com/cubicdaiya/onp https://github.com/hattya/go.diff/blob/master/diff.go https://gist.github.com/tociyuki/acedd33ca4913f1ab8e9 http://t2y.hatenablog.jp/entry/20090802/1249146010 Wagner‚ÄìFischer https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm) http://davedelong.tumblr.com/post/134367865668/edit-distance-and-edit-steps https://github.com/osteslag/Changeset https://github.com/onmyway133/DeepDiff Common Longest Subsequence https://en.wikipedia.org/wiki/Longest_common_subsequence_problem https://github.com/jflinter/Dwifft https://github.com/Frugghi/SwiftLCS Heckel http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf A technique for isolating differences between files https://github.com/mcudich/HeckelDiff IGListDiff https://github.com/andre-alves/PHDiff https://gist.github.com/ndarville/3166060 https://github.com/myndzi/heckel-diff https://johnresig.com/projects/javascript-diff-algorithm/ https://stackoverflow.com/questions/42755035/difficulty-understanding-paul-heckels-diff-algorithm https://github.com/RACCommunity/FlexibleDiff/blob/diffing/FlexibleDiff/Changeset.swift https://github.com/onmyway133/DeepDiff https://github.com/ra1028/DifferenceKit Hunt-Szymanski The Hunt-Szymanski Algorithm for LCS Read more http://wiki.c2.com/?DiffAlgorithm https://stackoverflow.com/questions/9065536/text-comparison-algorithm https://neil.fraser.name/writing/diff/ https://github.com/davedelong/SE-0240 https://forums.swift.org/t/se-0240-ordered-collection-diffing/19514","categories":[],"tags":[]},{"title":"How to use safeAreaLayoutGuide in iOS 10","slug":"How-to-use-safeAreaLayoutGuide-in-iOS-10","date":"2017-10-31T10:46:53.000Z","updated":"2019-09-12T07:10:32.000Z","comments":true,"path":"blog/How-to-use-safeAreaLayoutGuide-in-iOS-10/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-safeAreaLayoutGuide-in-iOS-10/","excerpt":"","text":"Issue #98 The safeAreaLayoutGuide was introduced in iOS 11. And it is advised to stop using topLayoutGuide bottomLayoutGuide as these are deprecated. To use safeAreaLayoutGuide, you need to do iOS version check 12345if #available(iOS 11.0, *) &#123; headerView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor, constant: 20)&#125; else &#123; headerView.topAnchor.constraint(equalTo: view.topAnchor, constant: 20)&#125; Maybe we can introduce a common property that can be used across many iOS versions, let‚Äôs call it compatibleSafeAreaLayoutGuide 1234567891011121314151617181920212223242526272829303132333435363738394041424344extension UIView &#123; /// Use safeAreaLayoutGuide on iOS 11+, otherwise default to dummy layout guide var compatibleSafeAreaLayoutGuide: UILayoutGuide &#123; if #available(iOS 11, *) &#123; return safeAreaLayoutGuide &#125; else &#123; if let layoutGuide = self.associatedLayoutGuide &#123; return layoutGuide &#125; else &#123; let layoutGuide = UILayoutGuide() Constraint.on( layoutGuide.topAnchor.constraint(equalTo: topAnchor), layoutGuide.bottomAnchor.constraint(equalTo: bottomAnchor), layoutGuide.leftAnchor.constraint(equalTo: leftAnchor), layoutGuide.rightAnchor.constraint(equalTo: rightAnchor) ) self.associatedLayoutGuide = layoutGuide return layoutGuide &#125; &#125; &#125; private struct AssociatedKeys &#123; static var layoutGuide = \"layoutGuide\" &#125; fileprivate var associatedLayoutGuide: UILayoutGuide? &#123; get &#123; return objc_getAssociatedObject(self, &amp;AssociatedKeys.layoutGuide) as? UILayoutGuide &#125; set &#123; if let newValue = newValue &#123; objc_setAssociatedObject( self, &amp;AssociatedKeys.layoutGuide, newValue as UILayoutGuide?, .OBJC_ASSOCIATION_RETAIN_NONATOMIC ) &#125; &#125; &#125;&#125; This way we can simply do 1headerView.topAnchor.constraint(equalTo: view.compatibleSafeAreaLayoutGuide.topAnchor, constant: 20) Read more https://useyourloaf.com/blog/safe-area-layout-guide/","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Learning from Open Source  Using Coordinator","slug":"Learning-from-Open-Source-Using-Coordinator","date":"2017-10-25T10:19:33.000Z","updated":"2017-11-06T09:35:56.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Using-Coordinator/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Using-Coordinator/","excerpt":"","text":"Issue #97 The Coordinator pattern can be useful to manage dependencies and handle navigation for your view controllers. It can be seen from BackchannelSDK-iOS, take a look at BAKCreateProfileCoordinator for example 123456789101112131415161718192021222324252627282930@implementation BAKCreateProfileCoordinator- (instancetype)initWithUser:(BAKUser *)user navigationController:(UINavigationController *)navigationController configuration:(BAKRemoteConfiguration *)configuration &#123; self = [super init]; if (!self) return nil; _navigationController = navigationController; _user = user; _profileViewController = [[BAKProfileFormViewController alloc] init]; [self configureProfileForm]; _configuration = configuration; return self;&#125;- (void)start &#123; [self.profileViewController updateDisplayName:self.user.displayName]; [self.navigationController pushViewController:self.profileViewController animated:YES];&#125;- (void)profileViewControllerDidTapAvatarButton:(BAKProfileFormViewController *)profileViewController &#123; BAKChooseImageCoordinator *imageChooser = [[BAKChooseImageCoordinator alloc] initWithViewController:self.navigationController]; imageChooser.delegate = self; [self.childCoordinators addObject:imageChooser]; [imageChooser start];&#125;- (void)imageChooserDidCancel:(BAKChooseImageCoordinator *)imageChooser &#123; [self.childCoordinators removeObject:imageChooser];&#125; Look how it holds navigationController as root element to do navigation, and how it manages childCoordinators Read more Coordinators ‚Äì Soroush Khanlou","categories":[],"tags":[]},{"title":"Learning from Open Source  Managing dependencies","slug":"Learning-from-Open-Source-Managing-dependencies","date":"2017-10-25T09:54:22.000Z","updated":"2017-10-25T10:00:00.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Managing-dependencies/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Managing-dependencies/","excerpt":"","text":"Issue #96 Another cool thing about ios-oss is how it manages dependencies. Usually you have a lot of dependencies, and it‚Äôs good to keep them in one place, and inject it to the objects that need. The Environment is simply a struct that holds all dependencies throughout the app 123456789101112131415161718/** A collection of **all** global variables and singletons that the app wants access to. */public struct Environment &#123; /// A type that exposes endpoints for fetching Kickstarter data. public let apiService: ServiceType /// The amount of time to delay API requests by. Used primarily for testing. Default value is `0.0`. public let apiDelayInterval: DispatchTimeInterval /// A type that exposes how to extract a still image from an AVAsset. public let assetImageGeneratorType: AssetImageGeneratorType.Type /// A type that stores a cached dictionary. public let cache: KSCache /// ...&#125; Then there‚Äôs global object called AppEnvironment that manages all these Environment in a stack 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public struct AppEnvironment &#123; /** A global stack of environments. */ fileprivate static var stack: [Environment] = [Environment()] /** Invoke when an access token has been acquired and you want to log the user in. Replaces the current environment with a new one that has the authenticated api service and current user model. - parameter envelope: An access token envelope with the api access token and user. */ public static func login(_ envelope: AccessTokenEnvelope) &#123; replaceCurrentEnvironment( apiService: current.apiService.login(OauthToken(token: envelope.accessToken)), currentUser: envelope.user, koala: current.koala |&gt; Koala.lens.loggedInUser .~ envelope.user ) &#125; /** Invoke when we have acquired a fresh current user and you want to replace the current environment's current user with the fresh one. - parameter user: A user model. */ public static func updateCurrentUser(_ user: User) &#123; replaceCurrentEnvironment( currentUser: user, koala: current.koala |&gt; Koala.lens.loggedInUser .~ user ) &#125; public static func updateConfig(_ config: Config) &#123; replaceCurrentEnvironment( config: config, koala: AppEnvironment.current.koala |&gt; Koala.lens.config .~ config ) &#125; // Invoke when you want to end the user's session. public static func logout() &#123; let storage = AppEnvironment.current.cookieStorage storage.cookies?.forEach(storage.deleteCookie) replaceCurrentEnvironment( apiService: AppEnvironment.current.apiService.logout(), cache: type(of: AppEnvironment.current.cache).init(), currentUser: nil, koala: current.koala |&gt; Koala.lens.loggedInUser .~ nil ) &#125; // The most recent environment on the stack. public static var current: Environment! &#123; return stack.last &#125;&#125; Then whenever there‚Äôs event that triggers dependencies update, we call it like 12345self.viewModel.outputs.logIntoEnvironment .observeValues &#123; [weak self] accessTokenEnv in AppEnvironment.login(accessTokenEnv) self?.viewModel.inputs.environmentLoggedIn()&#125; The cool thing about Environment is that we can store and retrieve them 123456// Returns the last saved environment from user defaults.public static func fromStorage(ubiquitousStore: KeyValueStoreType, userDefaults: KeyValueStoreType) -&gt; Environment &#123; // retrieval&#125; And we can mock in tests 123456789AppEnvironment.replaceCurrentEnvironment( apiService: MockService( fetchDiscoveryResponse: .template |&gt; DiscoveryEnvelope.lens.projects .~ [ .todayByScottThrift, .cosmicSurgery, .anomalisa ] ))","categories":[],"tags":[]},{"title":"How to debug iOS apps","slug":"How-to-debug-iOS-apps","date":"2017-10-24T11:37:32.000Z","updated":"2019-05-19T16:31:04.000Z","comments":true,"path":"blog/How-to-debug-iOS-apps/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-debug-iOS-apps/","excerpt":"","text":"Issue #95 Hi, here are some projects to help us debugging apps easier https://github.com/krzysztofzablocki/LifetimeTracker https://github.com/fastred/DeallocationChecker https://github.com/Flipboard/FLEX https://github.com/facebook/flipper https://github.com/wojteklu/Watchdog https://github.com/yagiz/Bagel https://github.com/isavynskyi/LayoutInspector https://github.com/kasketis/netfox https://github.com/meitu/MTHawkeye https://github.com/indragiek/InAppViewDebugger","categories":[],"tags":[]},{"title":"Learning from Open Source  Using Playground","slug":"Learning-from-Open-Source-Using-Playground","date":"2017-10-23T12:26:26.000Z","updated":"2017-10-23T12:27:47.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Using-Playground/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Using-Playground/","excerpt":"","text":"Issue #94 One thing I like about kickstarter-ios is how they use Playground to quickly protoyping views. We use Swift Playgrounds for iterative development and styling. Most major screens in the app get a corresponding playground where we can see a wide variety of devices, languages and data in real time. This way we don‚Äôt need Injection or using React Native anymore. Take a look at all the pages https://github.com/kickstarter/ios-oss/tree/master/Kickstarter-iOS.playground/Pages Read more Playground-Driven Development at Kickstarter FrenchKit 2017 - Playground Driven Development Finding Happiness in Functional Programming","categories":[],"tags":[]},{"title":"Indenting Swift code","slug":"Indenting-Swift-code","date":"2017-10-20T08:51:16.000Z","updated":"2017-10-20T09:43:22.000Z","comments":true,"path":"blog/Indenting-Swift-code/","link":"","permalink":"https://onmyway133.github.io/blog/Indenting-Swift-code/","excerpt":"","text":"Issue #93 Hi, here is how I indent my code. Let me know what you think üòâ Using 2 spaces indentationWhen possible, configure your editor to use 2 spaces for tab size. You will love it ‚ù§Ô∏è Move first parameter to new lineIf there are many parameters, move the first parameter to a new line, and align the other parameters. Remember that the last parenthesis ) should align to the function call 1234567let event = NSAppleEventDescriptor( eventClass: UInt32(kASAppleScriptSuite), eventID: UInt32(kASSubroutineEvent), targetDescriptor: target, returnID: Int16(kAutoGenerateReturnID), transactionID: Int32(kAnyTransactionID)) You can do the same for function declaration 123456func collectionView( _ collectionView: UICollectionView, viewForSupplementaryElementOfKind kind: String, at indexPath: IndexPath) -&gt; UICollectionReusableView &#123; // your code goes here&#125; Shouldn‚Äôt use trailing closure if there are more than 2 closuresHere is how to use UIView.animate 12345678910111213UIView.animate( withDuration: 5, delay: 5, usingSpringWithDamping: 1, initialSpringVelocity: 1, options: .curveEaseIn, animations: &#123; self.tableView.alpha = 1 &#125;, completion: &#123; _ in self.view.isHidden = true &#125;) Here is how to use RxSwift subscribe 1234567891011121314friendsObservable.subscribe( onNext: &#123; friends in &#125;, onError: &#123; error in &#125;, onCompleted: &#123; &#125;, onDisposed: &#123; &#125;) Shouldn‚Äôt use trailing closure when chaining methodsAlso, the next method call should start on same line 12345678let items = [1, 2, 3, 4, 5]let results = items.map(&#123; return String($0)&#125;).flatMap(&#123; return Int($0)&#125;).filter(&#123; return $0 &gt; 2&#125;).sorted()","categories":[],"tags":[]},{"title":"Testing keychain in iOS","slug":"Testing-keychain-in-iOS","date":"2017-10-20T08:23:25.000Z","updated":"2019-09-12T06:31:28.000Z","comments":true,"path":"blog/Testing-keychain-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/Testing-keychain-in-iOS/","excerpt":"","text":"Issue #92 Today I was upgrading Keychain to swift 4, and take this opportunity to fix the test. The tests pass on macOS, but on iOS, I get -25300 error for 1var status = SecItemCopyMatching(query as CFDictionary, nil) It is because there is no Keychain entitlement for test target. But this is a framework, how can I add entitlement ü§î The solution is to use a Test Host to host the XCTest tests. See my pull request Create test host target First create an iOS app to act as a test host, you can name it TestHost_iOS Enable Keychain capability Then enable Keychain capability to let Xcode automatically create an entitlement file for you. Note that you can just enter the Keychain group. You don‚Äôt need go to Apple Developer dashboard to configure anything Specify Test Host Then in you test target, specify Test Host by using $(BUILT_PRODUCTS_DIR)/TestHost_iOS.app/TestHost_iOS Now run your test again, it should pass üéâ","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Learning from Open Source  Making macOS app in code","slug":"Learning-from-Open-Source-Making-macOS-app-in-code","date":"2017-10-19T12:20:19.000Z","updated":"2017-10-19T12:20:19.000Z","comments":true,"path":"blog/Learning-from-Open-Source-Making-macOS-app-in-code/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-from-Open-Source-Making-macOS-app-in-code/","excerpt":"","text":"Issue #91 I‚Äôm familiar with the whole app structure that Xcode gives me when I‚Äôm creating new macOS project, together with Storyboard. The other day I was reading touch-bar-simulator and see how it declares app using only code. See this main.swift 123456789let app = NSApplication.sharedlet delegate = AppDelegate()app.delegate = delegateapp.run()final class AppDelegate: NSObject, NSApplicationDelegate, NSWindowDelegate &#123; let controller = IDETouchBarSimulatorHostWindowController.simulatorHostWindowController()! lazy var window: NSWindow = self.controller.window!&#125;","categories":[],"tags":[]},{"title":"Designing for iPhone X","slug":"Designing-for-iPhone-X","date":"2017-10-19T08:58:13.000Z","updated":"2017-10-19T08:58:13.000Z","comments":true,"path":"blog/Designing-for-iPhone-X/","link":"","permalink":"https://onmyway133.github.io/blog/Designing-for-iPhone-X/","excerpt":"","text":"Issue #90 http://blog.maxrudberg.com/post/166045445103/ui-design-for-iphone-x-top-elements-and-the-notch https://designcode.io/ios11-iphone-x https://medium.muz.li/ui-design-tips-for-iphone-x-2652b2b248ce","categories":[],"tags":[]},{"title":"String manipulation in Apple Script","slug":"String-manipulation-in-Apple-Script","date":"2017-10-18T11:13:53.000Z","updated":"2017-10-18T11:15:03.000Z","comments":true,"path":"blog/String-manipulation-in-Apple-Script/","link":"","permalink":"https://onmyway133.github.io/blog/String-manipulation-in-Apple-Script/","excerpt":"","text":"Issue #89 Today I find that AppleScript allows us to import Foundation, with that we have lots of power, including NSString. See my script 123use scripting additionsuse framework &quot;Foundation&quot;property NSString : a reference to current application&apos;s NSString Here is how I can remove last path component from a string 12345on myRemoveLastPath(myPath) set myString to NSString&apos;s stringWithString:myPath set removedLastPathString to myString&apos;s stringByDeletingLastPathComponent removedLastPathString as textend myRemoveLastPath You need to cast to NSString with NSString&#39;s stringWithString: and cast back to Apple Script string with as text. The &#39;s is how you can invoke functions. One more thing is that we can support parameters to function, like this script 12345on remove:remove_string fromString:source_string set s_String to NSString&apos;s stringWithString:source_string set r_String to NSString&apos;s stringWithString:remove_string return s_String&apos;s stringByReplacingOccurrencesOfString:r_String withString:&quot;&quot;end remove:fromString:","categories":[],"tags":[]},{"title":"How to call function inside Apple Script","slug":"How-to-call-function-inside-Apple-Script","date":"2017-10-18T09:26:32.000Z","updated":"2019-05-23T16:07:46.000Z","comments":true,"path":"blog/How-to-call-function-inside-Apple-Script/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-call-function-inside-Apple-Script/","excerpt":"","text":"Issue #88 I ‚Äòve been using Apple Script to for my Finder extension FinderGo. Because of sandboxing, all scripts must lie inside Application Scripts folder. Today, I was rewriting my Xcode extension XcodeWay. Before Xcode 8, we could use Xcode plugin and all kinds of magic to make our dreams come true https://github.com/onmyway133/XcodeWay/blob/1.0/XcodeWay/Helper/FTGEnvironmentManager.m#L50. But then it does not work since Xcode Source Editor Extension was introduced. So I rewrote XcodeWay as an extension https://github.com/onmyway133/XcodeWay/releases/tag/1.1.0 Extension must run inside sandbox. If you switch App Sandbox in your XcodeWayExtensions.entitlements to NO, it won‚Äôt load. So sandbox restricts me a lot in what kinds of things I want to do. And under Xcode 9, I can‚Äôt use NSWorkspace to open Finder. So I think I could use Apple Script too, and it worked like a charm. The only restriction is code reuse, since I only know how to run an entire script. One way is to import other Apple scripts https://stackoverflow.com/questions/2606136/import-applescript-methods-in-another-applescript but I think I will write all the functions inside 1 script, and find out how to call specific function. By function, I also mean handler, procedure. I come across this snippet Scriptinator that pretty much inspires me, thanks to open source. So here is my script that contains lots of functions . And here is ScriptRunner that explains how to build NSAppleEventDescriptor. Note that you need to import Carbon 1234567891011121314151617181920212223import Carbonfunc eventDescriptior(functionName: String) -&gt; NSAppleEventDescriptor &#123; var psn = ProcessSerialNumber(highLongOfPSN: 0, lowLongOfPSN: UInt32(kCurrentProcess)) let target = NSAppleEventDescriptor( descriptorType: typeProcessSerialNumber, bytes: &amp;psn, length: MemoryLayout&lt;ProcessSerialNumber&gt;.size ) let event = NSAppleEventDescriptor( eventClass: UInt32(kASAppleScriptSuite), eventID: UInt32(kASSubroutineEvent), targetDescriptor: target, returnID: Int16(kAutoGenerateReturnID), transactionID: Int32(kAnyTransactionID) ) let function = NSAppleEventDescriptor(string: functionName) event.setParam(function, forKeyword: AEKeyword(keyASSubroutineName)) return event&#125;","categories":[],"tags":[]},{"title":"How to use Input and output container in Swift","slug":"How-to-use-Input-and-output-container-in-Swift","date":"2017-10-17T11:52:37.000Z","updated":"2019-05-23T17:06:06.000Z","comments":true,"path":"blog/How-to-use-Input-and-output-container-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Input-and-output-container-in-Swift/","excerpt":"","text":"Issue #87 This is a very nifty trick from ios-oss which was built around MVVM pattern. It uses protocol to define input and output, and a container protocol to contain them. Take https://github.com/kickstarter/ios-oss/blob/1f5643f6a769995ccd1bb3826699745e64597ab7/Library/ViewModels/LoginViewModel.swift for example public protocol LoginViewModelInputs { } public protocol LoginViewModelOutputs { } public protocol LoginViewModelType { var inputs: LoginViewModelInputs { get } var outputs: LoginViewModelOutputs { get } } public final class LoginViewModel: LoginViewModelType, LoginViewModelInputs, LoginViewModelOutputs { public var inputs: LoginViewModelInputs { return self } public var outputs: LoginViewModelOutputs { return self } } Look how LoginViewModel conforms to 3 protocols. And when you access its input or output properties, you are constrained to only LoginViewModelInputs and LoginViewModelOutputs","categories":[],"tags":[]},{"title":"Fixing login hanging in macOS High Sierra","slug":"Fixing-login-hanging-in-macOS-High-Sierra","date":"2017-10-16T17:22:51.000Z","updated":"2019-09-12T06:33:08.000Z","comments":true,"path":"blog/Fixing-login-hanging-in-macOS-High-Sierra/","link":"","permalink":"https://onmyway133.github.io/blog/Fixing-login-hanging-in-macOS-High-Sierra/","excerpt":"","text":"Issue #86 Today I met a strange problem. After I enter my password, the progress bar runs to the end, and it is stuck there forever. No matter how many times I try to restart. I finally need to go to Recovery mode by pressing Cmd+R at start up. I then select Get Help Online to open Safari. Strangely enough I wasn‚Äôt connected to Internet After select the wifi icon on the status bar to connect internet, I then restart and can login again. It seems that macOS is checking for something before allowing user to login","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"},{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"}]},{"title":"What about performance?","slug":"What-about-performance","date":"2017-10-10T07:53:47.000Z","updated":"2019-09-12T06:32:58.000Z","comments":true,"path":"blog/What-about-performance/","link":"","permalink":"https://onmyway133.github.io/blog/What-about-performance/","excerpt":"","text":"Issue #85 That‚Äôs the question I hear often when people are introduced to a new framework. It‚Äôs a valid concern. But it seems to me that they ask this just for fun. To my surprise, most people just don‚Äôt care, and the frameworks with the most stars often perform the worst. Now take a look back at performance. Here are some benchmarks From https://github.com/ibireme/YYModel, compare different JSON mappers for ObjC From https://github.com/bwhiteley/JSONShootout, compare different JSON mappers for Swift From https://github.com/onmyway133/DeepDiff#among-different-frameworks, compare different diffing frameworks I use it because it has many stars Take a look at the stars, the ones with the most stars often perform the slowest üôÄ I don‚Äôt say that more stars mean better. I don‚Äôt believe in stars. Stars may just be a result of your marketing effort. The same framework, without any code change, but after featured in some newsletters, gets additional thousand stars. The code remains the same, so what do stars really tell here? I‚Äôm not talking about closed source. I like open source. When deciding an open source framework, there are many factors. It can be issues and pull requests that indicate how the community care about it. It can be good code and good tests, that make it easy to maintain. It can be good documentation, that says how much dedication the developers have put in. And here‚Äôs the fact, when you see a project with many stars, you tend to star it too üòâ for the sake of bookmarking. Stars mean little, but they give us some ideas on how popular a project is. I just need to get work done OK. What about performance? Honestly, do you really care?","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Dear SDK developers","slug":"Dear-SDK-developers","date":"2017-10-10T07:45:38.000Z","updated":"2019-09-12T07:10:45.000Z","comments":true,"path":"blog/Dear-SDK-developers/","link":"","permalink":"https://onmyway133.github.io/blog/Dear-SDK-developers/","excerpt":"","text":"Issue #84 Dear SDK developers, Please don‚Äôt do swizzling. Give us instructions on where to call your APIs instead of doing unnecessary swizzling. You‚Äôre making it for developers to use, and they know how to write code. Most of the time, you don‚Äôt know how to do swizzling right ‚ö†Ô∏è Please don‚Äôt use configuration file. If possible, please consider configuration via pure code, instead of the plist file that is more exposable in the app bundle. Please don‚Äôt make assumption about the app. Your assumptions about the app the SDK is going to be integrated are not always correct. Every app has its own use case and view hierarchy. Please provide proper releases. Tag and make releases for new changes in the SDK. If there are major changes, there should be migration guide and affect of that to older apps. Also, please write proper change logs, either in release notes or change log file. Please don‚Äôt leave us with a dump header file. Please add documentations to all the functions. Please improve the README. To avoid all the guessing, please improve the README with detail instructions. Please include a sample demo project. When making a demo project, you possible have chances to deal with potential problems. And developers have a clue on which steps they might be missing. Please open source it. You‚Äôre selling your service, not the code. By open sourcing it, the code is clear to everybody, and they might help you with bug fixing and suggestion. To be honest, I was very scared when asked to integrate the SDK with poor documentation and closed source. It‚Äôs like playing the guessing and praying game. If the service is not important to you, and you‚Äôre doing it for fun, then you can ignore these requests. But if you‚Äôre serious about it, then please consider doing. We know you can do better üí™ Thanks ‚ù§Ô∏è","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"How to migrate Codable object in Swift","slug":"How-to-migrate-Codable-object-in-Swift","date":"2017-10-09T08:51:55.000Z","updated":"2019-05-23T17:05:39.000Z","comments":true,"path":"blog/How-to-migrate-Codable-object-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-migrate-Codable-object-in-Swift/","excerpt":"","text":"Issue #83 As of swift 4 migration, we updated Cache to fully take advantage of Codable. It works for most cases, as we should usually declare our entity as typed safe object instead of array or json dictionary. And by conforming to Codable, it is easily encoded and decoded to and from json data. And persisting them to Cache is as easy as eating cookie. The other day, I saw someone asking on how to migrate if the model changes https://github.com/hyperoslo/Cache/issues/153, and he likes the way Realm does https://realm.io/docs/swift/latest/#migrations 123456789101112131415Realm.Configuration.defaultConfiguration = Realm.Configuration( schemaVersion: 1, migrationBlock: &#123; migration, oldSchemaVersion in if (oldSchemaVersion &lt; 1) &#123; // The enumerateObjects(ofType:_:) method iterates // over every Person object stored in the Realm file migration.enumerateObjects(ofType: Person.className()) &#123; oldObject, newObject in // combine name fields into a single field let firstName = oldObject![\"firstName\"] as! String let lastName = oldObject![\"lastName\"] as! String newObject![\"fullName\"] = \"\\(firstName) \\(lastName)\" &#125; &#125; &#125;) I think we can rely on Codable to the migration. FYI, here is the PR https://github.com/hyperoslo/Cache/pull/154 Class name changeI see Codable is based on json, and the importance of json is its data structure, not the class name. So if you change the class name, it still works. First, we save model of type Person, later we load model of type Alien. It works because the structure stays the same 12345678910111213141516struct Person: Codable &#123; let firstName: String let lastName: String&#125;struct Alien: Codable &#123; let firstName: String let lastName: String&#125;let person = Person(firstName: \"John\", lastName: \"Snow\")try! storage.setObject(person, forKey: \"person\")// As long as it has same properties, it works toolet cachedObject = try! storage.object(ofType: Alien.self, forKey: \"person\")XCTAssertEqual(cachedObject.firstName, \"John\") Property changeIf the property changes, then you need to do a little work of migration. First, we save model of type Person1, it has just fullName. Later we change the model to Person2 with some new properties. To do the migration, we need to load model with old Person1 first, then construct a new model Person2 based on this Person1. Finally, save that to Cache with the same key. 12345678910111213141516171819202122232425struct Person1: Codable &#123; let fullName: String&#125;struct Person2: Codable &#123; let firstName: String let lastName: String&#125;// Firstly, save object of type Person1let person = Person1(fullName: \"John Snow\")try! storage.setObject(person, forKey: \"person\")XCTAssertNil(try? storage.object(ofType: Person2.self, forKey: \"person\"))// Later, convert to Person2, do the migration, then overwritelet tempPerson = try! storage.object(ofType: Person1.self, forKey: \"person\")let parts = tempPerson.fullName.split(separator: \" \")let migratedPerson = Person2(firstName: String(parts[0]), lastName: String(parts[1]))try! storage.setObject(migratedPerson, forKey: \"person\")XCTAssertEqual( try! storage.object(ofType: Person2.self, forKey: \"person\").firstName, \"John\")","categories":[],"tags":[]},{"title":"How to handle alert in UITests in iOS","slug":"How-to-handle-alert-in-UITests-in-iOS","date":"2017-10-02T07:55:28.000Z","updated":"2019-05-23T17:05:28.000Z","comments":true,"path":"blog/How-to-handle-alert-in-UITests-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-alert-in-UITests-in-iOS/","excerpt":"","text":"Issue #82 Usually in an app, you have the onboarding with steps that require push notification and location permission to be turned on. And you want to automate these steps via UITests Firstly, you need to add interruption handler 12345678910111213141516171819202122addUIInterruptionMonitor(withDescription: \"Alert\") &#123; element in do &#123; // Push Notification let button = element.buttons[\"Allow\"] let title = element.staticTexts[\"‚ÄúMyAwesomeApp‚Äù Would Like to Send You Notifications\"] if title.exists &amp;&amp; button.exists &#123; button.tap() &#125; &#125; do &#123; // Location let button = element.buttons[\"Only While Using the App\"] if button.exists &#123; button.tap() &#125; &#125; return true &#125;&#125; Then you need to call tap on XCUIApplication to make the app responsive 12turnOnPushNotificationButton.tap()tap() Sometimes the alert handling is slow and you get Did not receive view did disappear notification within 2.0s. Well, the workaround is to wait for the element on next onboarding step to appear. Starting with Xcode 9, you can use waitForExistence. This is how you can go to last step after user has enabled push notification 12let label = staticTexts[\"Congratulation. You've granted us permission. Now enjoy the app.\"]_ = label.waitForExistence(timeout: 5)","categories":[],"tags":[]},{"title":"How to integrate library via custom podspec","slug":"How-to-integrate-library-via-custom-podspec","date":"2017-09-29T07:24:57.000Z","updated":"2019-05-23T17:05:17.000Z","comments":true,"path":"blog/How-to-integrate-library-via-custom-podspec/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-integrate-library-via-custom-podspec/","excerpt":"","text":"Issue #81 Today I am about to integrate a library that does not support Cocoapods yet. It would be cumbersome to do it manually, because you have to configure xcconfig, framework search path, assets, and these steps are not well documented. You can do this with custom podspec. In my case, I need to install PinchSDK. First, declare a PinchSDK.podspec in your project folder. 12345678910111213141516Pod::Spec.new do |s| s.name = \"PinchSDK\" s.version = \"1.9.14\" s.summary = \"Pinch samler dessuten inn data hver gang en mobilapplikasjon oppdager en Pinch-beacon.\" s.homepage = \"https://bitbucket.org/fluxloop/pinch.installpackage\" s.source = &#123; :http =&gt; \"https://bitbucket.org/fluxloop/pinch.installpackage/raw/master/iOS/PinchSDK.zip\" &#125; s.authors = 'Fluxloop' s.license = &#123; type: 'MIT' &#125; s.platform = :ios, '8.0' s.requires_arc = true s.resource = 'PinchSDK/Pinch.bundle' s.vendored_frameworks = 'PinchSDK/PinchLibrary.framework' s.xcconfig = &#123; 'OTHER_LDFLAGS': '-ObjC' &#125; s.public_header_files = 'PinchSDK/PinchLibrary.framework/Headers/PinchLibrary.h' s.source_files = 'PinchSDK/PinchLibrary.framework/Headers/PinchLibrary.h'end Then, in your Podfile, you can point to this podspec 1pod 'PinchSDK', podspec: 'PinchSDK.podspec' Finally, since this PinchSDK uses objc, you need to declare it in your bridging header 1#import &lt;PinchLibrary/PinchLibrary.h&gt; Now, just pod install and you‚Äôre done üéâ","categories":[],"tags":[]},{"title":"How to handle Swift version with Cocoapods","slug":"How-to-handle-Swift-version-with-Cocoapods","date":"2017-09-25T06:38:57.000Z","updated":"2019-05-23T17:05:08.000Z","comments":true,"path":"blog/How-to-handle-Swift-version-with-Cocoapods/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-Swift-version-with-Cocoapods/","excerpt":"","text":"Issue #80 Today I was migrating Imaginary to Swift 4. But I get 12345- ERROR | [OSX] xcodebuild: Returned an unsuccessful exit code.- ERROR | [OSX] xcodebuild: Cache/Source/Mac/NSImage+Extensions.swift:32:64: error: &apos;png&apos; has been renamed to &apos;PNG&apos;- NOTE | [OSX] xcodebuild: AppKit.NSBitmapImageRep:57:27: note: &apos;png&apos; was introduced in Swift 4- ERROR | [OSX] xcodebuild: Cache/Source/Mac/NSImage+Extensions.swift:32:71: error: &apos;jpeg&apos; has been renamed to &apos;JPEG&apos;- NOTE | [OSX] xcodebuild: AppKit.NSBitmapImageRep:52:27: note: &apos;jpeg&apos; was introduced in Swift 4 The project is configured to use Swift 4 and its dependency Cache correctly uses .png and .jpeg https://github.com/hyperoslo/Cache/blob/master/Source/Mac/NSImage%2BExtensions.swift Why is that ü§î It turns out that the .swift-version is still showing 3.0. Change it to 4.0 fixes the issue. The .swift-version is a hint to specify which Swift version should be used for a pod https://github.com/CocoaPods/CocoaPods/pull/5841","categories":[],"tags":[]},{"title":"Ikigai","slug":"Ikigai","date":"2017-09-21T10:27:01.000Z","updated":"2019-09-12T06:29:17.000Z","comments":true,"path":"blog/Ikigai/","link":"","permalink":"https://onmyway133.github.io/blog/Ikigai/","excerpt":"","text":"Issue #79 I really like the concept of Ikigai Ikigai (Áîü„ÅçÁî≤Êñê, pronounced [iki…°ai]) is a Japanese concept that means ‚Äúa reason for being.‚Äù It is similar to the French phrase Raison d‚Äô√™tre. Everyone, according to Japanese culture, has an ikigai. Finding it requires a deep and often lengthy search of self. Such a search is important to the cultural belief that discovering one‚Äôs ikigai brings satisfaction and meaning to life.[1] The term ikigai compounds two Japanese words: iki (wikt:Áîü„Åç) meaning ‚Äúlife; alive‚Äù and kai (Áî≤Êñê) ‚Äú(an) effect; (a) result; (a) fruit; (a) worth; (a) use; (a) benefit; (no, little) avail‚Äù (sequentially voiced as gai) ‚Äúa reason for living [being alive]; a meaning for [to] life; what [something that] makes life worth living; a raison d‚Äôetre‚Äù.[3] About college degree https://www.youtube.com/watch?v=e8QY0NDWqzk What you learn is more important Surrounded with smart people Safe way College degree is nothing. But without that, you‚Äôre no thing. Visa Read more Dan Buettnet - How to live to be 100+","categories":[],"tags":[{"name":"life","slug":"life","permalink":"https://onmyway133.github.io/tags/life/"}]},{"title":"Reading list","slug":"Reading-list","date":"2017-09-21T10:06:35.000Z","updated":"2019-09-12T06:28:43.000Z","comments":true,"path":"blog/Reading-list/","link":"","permalink":"https://onmyway133.github.io/blog/Reading-list/","excerpt":"","text":"Issue #78 These are my favorite books, screencasts, languages, tech and services that I have been exploring BooksProgramming Clean Code: A Handbook of Agile Software Craftsmanship The Pragmatic Programmer: From Journeyman to Master Code Complete: A Practical Handbook of Software Construction, Second Edition 2nd Edition The Clean Coder: A Code of Conduct for Professional Programmers Refactoring: Improving the Design of Existing Code Agile Principles, Patterns, and Practices in C# Refactoring to Patterns The Art of Unit Testing: with examples in C# Clean Architecture: A Craftsman‚Äôs Guide to Software Structure and Design Head First Design Patterns Clean Architecture: A Craftsman‚Äôs Guide to Software Structure and Design Living by the Code Java Effective Java (3rd Edition) Javascript Eloquent Javascript Mostly adequate guide to Functional Programming in Javascript iOS Effective Objective-C 2.0 Advanced Swift Design Patterns by Tutorials App Architecture Haskell Learn you a Haskell for great good Life Smart and Gets Things Done: Joel Spolsky‚Äôs Concise Guide to Finding the Best Technical Talent The Power of Habit: Why We Do What We Do in Life and Business Hired fast Never Eat Alone The shape of ideas So Good They Can‚Äôt Ignore You: Why Skills Trump Passion in the Quest for Work You Love Screencasts Pointfree Clean coders BaseCode Destroy All Software Can it be done in React Native? Blog Pointfree NSHipster Objc.io Swift by Sundell Khanlou Ole Begemann Matt Diephouse Overreacted kode24 Ben Sandofsky Language C C++ Objective C Swift C# Java Kotlin Javascript Applescript Dart Go Haskell Tech &amp; Service iOS, macOS tvOS, watchOS react.js electron.js Android Flutter React Native Chrome extension Sketch plugin Xcode extension Slack bot Windows Phone Windows Mobile 6 Symbian J2ME Windows Metro ASP.NET XNA Unity node.js Docker Kubernetes Heroku Google Cloud Firebase TravisCI, CircleCI, Bitrise, BuddyBuild, Jenkins GitHub, Bitbucket JIRA, Pivotal, Trello Sketch GRPC Protobuf","categories":[],"tags":[{"name":"tech","slug":"tech","permalink":"https://onmyway133.github.io/tags/tech/"}]},{"title":"What if there is no inheritance?","slug":"What-if-there-is-no-inheritance","date":"2017-09-21T06:56:40.000Z","updated":"2017-09-25T06:55:25.000Z","comments":true,"path":"blog/What-if-there-is-no-inheritance/","link":"","permalink":"https://onmyway133.github.io/blog/What-if-there-is-no-inheritance/","excerpt":"","text":"Issue #77 My question What if there is no inheritance, so that everybody has the same start, does that make life fairer? Hacker News https://news.ycombinator.com/item?id=13857327 Quora https://www.quora.com/What-if-there-is-no-inheritance-so-that-everybody-has-the-same-start-does-that-make-life-fairer","categories":[],"tags":[]},{"title":"Ad Hominem","slug":"Ad-Hominem","date":"2017-09-21T06:51:11.000Z","updated":"2019-09-12T06:33:03.000Z","comments":true,"path":"blog/Ad-Hominem/","link":"","permalink":"https://onmyway133.github.io/blog/Ad-Hominem/","excerpt":"","text":"Issue #76 I use Twitter a lot, mostly to follow people I like. They tweet cool things about tech and life. I learned a lot. Please don‚Äôt show me the evil sides of the world ~ Michael Learn To Rock - How Many Hours But there‚Äôs also bad side of the story. I see many retweets of people saying bad things about others, mostly in form of Ad Hominem Attacking the person making the argument, rather than the argument itself, when the attack on the person is completely irrelevant to the argument the person is making. From Ad Hominem on c2.com An argumentum ad hominem is any kind of argument that criticizes an idea by pointing something out about the people who hold the idea rather than directly addressing the merits of the idea. ‚Äò‚ÄôAd hominem‚Äô‚Äô is Latin for ‚Äúdirected toward the man (as opposed to the issue at hand)‚Äù. An alternative expression is ‚Äúplaying the man and not the ball‚Äù. Most of these people have the Twitter verified badge. They complain that they have so many followers while they themselves follow hundreds of thousands. They say bad things about others‚Äô hair style and appearance while actively supporting equality. They argue who owns the original gif. They follow one person just to be the first to insult them. The blue verified badge on Twitter lets people know that an account of public interest is authentic. Blowing out someone else‚Äôs candle doesn‚Äôt make yours shine any brighter ~ Anonymous The only thing I can do is I don&#39;t like this tweet üòû","categories":[],"tags":[{"name":"life","slug":"life","permalink":"https://onmyway133.github.io/tags/life/"}]},{"title":"Sync and async code in Swift","slug":"Sync-and-async-code-in-Swift","date":"2017-09-14T10:00:58.000Z","updated":"2019-09-10T06:41:41.000Z","comments":true,"path":"blog/Sync-and-async-code-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Sync-and-async-code-in-Swift/","excerpt":"","text":"Issue #75 We should use DispatchQueue to build thread safe code. The idea is to prevent two read and write from happening at the same time from 2 different threads, which cause data corruption and unexpected behaviors. Note that you should try to avoid deadlock https://stackoverflow.com/questions/15381209/how-do-i-create-a-deadlock-in-grand-central-dispatch All syncUse try catch, together with serial queue. Use sync function to block current queue. 1234567891011121314func getUser(id: String) throws -&gt; User &#123; var user: User! try serialQueue.sync &#123; user = try storage.getUser(id) &#125; return user&#125;func setUser(_ user: User) throws &#123; try serialQueue.sync &#123; try storage.setUser(user) &#125;&#125; All asyncUse Result, toget with serial queue. Use async function to return to current queue. 12345678910111213141516171819202122232425262728enum Result&lt;T&gt; &#123; case value(T) case error(Error)&#125;func getUser(id: String, completion: (Result&lt;User&gt;) - Void) &#123; try serialQueue.async &#123; do &#123; user = try storage.getUser(id) completion(.value(user)) &#125; catch &#123; completion(.error(error)) &#125; &#125; return user&#125;func setUser(_ user: User, completion: (Result&lt;()&gt;) -&gt; Void) &#123; try serialQueue.async &#123; do &#123; try storage.setUser(user) completion(.value(()) &#125; catch &#123; completion(.error(error)) &#125; &#125;&#125; Sync read, async writeUse try catch for read, Result for write, together with concurrent queue. Use sync function for read to block current thread, while using async function with barrier flag for write to return to current queue. This is good for when multiple reads is preferred when there is no write. When write with barrier comes into the queue, other operations must wait. 12345678910111213141516171819func getUser(id: String) throws -&gt; User &#123; var user: User! try concurrentQueue.sync &#123; user = try storage.getUser(id) &#125; return user&#125;func setUser(_ user: User, completion: (Result&lt;()&gt;) -&gt; Void) &#123; try concurrentQueue.async(flags: .barrier) &#123; do &#123; try storage.setUser(user) completion(.value(()) &#125; catch &#123; completion(.error(error)) &#125; &#125;&#125; Testing for asynchronyBefore we could use dispatch_apply to submits a block to a dispatch queue for multiple invocations. Starting with Swift, the equivalence is concurrentPerform 1234DispatchQueue.concurrentPerform(iterations: 1000) &#123; index in let last = array.last ?? 0 array.append(last + 1)&#125; Reference http://basememara.com/creating-thread-safe-arrays-in-swift/ https://oleb.net/blog/2013/07/parallelize-for-loops-gcd-dispatch_apply/","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to check generic type in Swift","slug":"How-to-check-generic-type-in-Swift","date":"2017-09-13T11:27:51.000Z","updated":"2019-05-23T17:02:12.000Z","comments":true,"path":"blog/How-to-check-generic-type-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-check-generic-type-in-Swift/","excerpt":"","text":"Issue #74 When dealing with generic, you shouldn‚Äôt care about the types. But if you need, you can 1234567891011 func isPrimitive&lt;T&gt;(type: T.Type) -&gt; Bool &#123; let primitives: [Any.Type] = [ Bool.self, [Bool].self, String.self, [String].self, Int.self, [Int].self, Float.self, [Float].self, Double.self, [Double].self ] return primitives.contains(where: &#123; $0.self == type.self &#125;)&#125;","categories":[],"tags":[]},{"title":"How to use Given When Then in Swift tests","slug":"How-to-use-Given-When-Then-in-Swift-tests","date":"2017-09-13T08:58:16.000Z","updated":"2019-09-12T07:09:50.000Z","comments":true,"path":"blog/How-to-use-Given-When-Then-in-Swift-tests/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Given-When-Then-in-Swift-tests/","excerpt":"","text":"Issue #73 SpecUsing spec testing framework like Quick is nice, which enables BDD style. 1234567891011121314describe(\"the 'Documentation' directory\") &#123; it(\"has everything you need to get started\") &#123; let sections = Directory(\"Documentation\").sections expect(sections).to(contain(\"Organized Tests with Quick Examples and Example Groups\")) expect(sections).to(contain(\"Installing Quick\")) &#125; context(\"if it doesn't have what you're looking for\") &#123; it(\"needs to be updated\") &#123; let you = You(awesome: true) expect&#123;you.submittedAnIssue&#125;.toEventually(beTruthy()) &#125; &#125;&#125; But in case you don‚Äôt want additional frameworks, and want to live closer to Apple SDKs as much as possible, here are few tips. NamingThis is from the book that I really like The Art of Unit Testing. If you don‚Äôt mind the underscore, you can follow UnitOfWork_StateUnderTest_ExpectedBehavior structure 123func testSum_NegativeNumberAs1stParam_ExceptionThrown()func testSum_NegativeNumberAs2ndParam_ExceptionThrown()func testSum_simpleValues_Calculated() Given When ThenThis is from BDD, and practised a lot in Cucumber. You can read more on https://martinfowler.com/bliki/GivenWhenThen.html. First, add some more extensions to XCTestCase 123456789101112131415import XCTestextension XCTestCase &#123; func given(_ description: String, closure: () throws -&gt; Void) throws &#123; try closure() &#125; func when(_ description: String, closure: () throws -&gt; Void) throws &#123; try closure() &#125; func then(_ description: String, closure: () throws -&gt; Void) throws &#123; try closure() &#125;&#125; Then, in order to test, just follow given when then 12345678910111213141516171819func testRemoveObject() throws &#123; try given(\"set to storage\") &#123; try storage.setObject(testObject, forKey: key) &#125; try when(\"remove object from storage\") &#123; try storage.removeObject(forKey: key) &#125; try then(\"there is no object in memory\") &#123; let memoryObject = try? storage.memoryCache.object(forKey: key) as User XCTAssertNil(memoryObject) &#125; try then(\"there is no object on disk\") &#123; let diskObject = try? storage.diskCache.object(forKey: key) as User XCTAssertNil(diskObject) &#125;&#125; I find this more interesting than comments. All are code and descriptive. It can also be developed further to throw the description text.","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"testing","slug":"testing","permalink":"https://onmyway133.github.io/tags/testing/"}]},{"title":"Understanding Instance property vs parameter in Swift","slug":"Understanding-Instance-property-vs-parameter-in-Swift","date":"2017-09-06T12:06:58.000Z","updated":"2019-05-23T17:01:57.000Z","comments":true,"path":"blog/Understanding-Instance-property-vs-parameter-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-Instance-property-vs-parameter-in-Swift/","excerpt":"","text":"Issue #72 The other day I was refactor my code. I have 12345678extension MainController: TabBarViewDelegate &#123; func buttonDidPress index: Int) &#123; let initialIndex = tabBarView.selectedIndex let wholeAppContentView = updateWholeAppContentView() view.addSubview(wholeAppContentView) &#125;&#125; The delegate method does not look right, as it‚Äôs hard to tell between required delegate method, or just instance method. Also it lacks a subject. I like this post API Design, you can read section Rule 19: Always say who‚Äôs talking This is a simple rule, and an equally simple mistake to make. In your delegate methods, always pass the sender as a parameter. Always. Even for singletons. Even for things you cannot conceive would ever be used more than once simultaneously. No exceptions. So I refactor the delegate, and conform to it. 12345678extension MainController: TabBarViewDelegate &#123; func tabBarView(_ view: TabBarView, buttonDidPress index: Int) &#123; let initialIndex = tabBarView.selectedIndex let wholeAppContentView = updateWholeAppContentView() view.addSubview(wholeAppContentView) // This is the culprit ‚ö†Ô∏è &#125;&#125; Even with just 1 line change in MainController.swift, the whole UI breaks, as all the views were added to the tab bar. Strange üò° . It didn‚Äôt take long until I remember that parameter takes precedence over instance property if they have same name. So in this case, the compiler, without warning, assume you‚Äôre dealing with view from TabBarView ‚ö†Ô∏è That‚Äôs why you often use self to disambiguate. 123456789struct User: Codable, Equatable &#123; let firstName: String let lastName: String init(firstName: String, lastName: String) &#123; self.firstName = firstName self.lastName = lastName &#125;&#125; Back to our code. The workaround is to specify self to specify view of MainController 1self.view.addSubview(wholeAppContentView) Well, you may say, who should add view again in case of tab bar changes üò¨ This is a bad example, but the lesson is learned üòá","categories":[],"tags":[]},{"title":"How to push to GitHub gist","slug":"How-to-push-to-GitHub-gist","date":"2017-09-04T06:54:10.000Z","updated":"2019-05-23T17:01:45.000Z","comments":true,"path":"blog/How-to-push-to-GitHub-gist/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-push-to-GitHub-gist/","excerpt":"","text":"Issue #71 Creating a new gist Go to https://gist.github.com/ and create a new gist Note that you need to include filename + extension to enable automatic language markup Click Add file to add more files Cloning the gist If you‚Äôve enabled 2 factor authentication, you need to use personal acccess token with https, or use ssh. If you have enabled two-factor authentication, or if you are accessing an organization that uses SAML single sign-on, you must provide a personal access token instead of entering your password for HTTPS Git. You should enable 2 factor authentication. Read more https://help.github.com/articles/https-cloning-errors/#provide-access-token-if-2fa-enabled For example with my gist https://gist.github.com/onmyway133/c486939f82fc4d3a8ed4be21538fdd32 the ssh url is git@gist.github.com:c486939f82fc4d3a8ed4be21538fdd32.git Run git commands as normal 12git remote add origin git@gist.github.com:c486939f82fc4d3a8ed4be21538fdd32.gitgit clone You have branch master by default 1git push origin master Ignoring directories remote: Gist does not support directories. In my cases I‚Äôm using node, so I need to ignore node_modules directory Also need to untrack if necessary 12git rm --cached -r .git add .","categories":[],"tags":[]},{"title":"How to observe object deinit in Swift","slug":"How-to-observe-object-deinit-in-Swift","date":"2017-08-29T09:59:54.000Z","updated":"2019-05-23T17:01:34.000Z","comments":true,"path":"blog/How-to-observe-object-deinit-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-observe-object-deinit-in-Swift/","excerpt":"","text":"Issue #70 Today I was browsing through Suas-iOS and the subscription links to life cycle of another object 1subscription.linkLifeCycleTo(object: self) It observes the deinit of another job, interesting approach üëç , take a look in https://github.com/zendesk/Suas-iOS/blob/master/Sources/StoreDeinitCallback.swift 123456789101112131415161718192021222324252627282930var deinitCallbackKey = \"DEINITCALLBACK_SUAS\"// MARK: Registartionextension Suas &#123; static func onObjectDeinit(forObject object: NSObject, callbackId: String, callback: @escaping () -&gt; ()) &#123; let rem = deinitCallback(forObject: object) rem.callbacks.append(callback) &#125; static fileprivate func deinitCallback(forObject object: NSObject) -&gt; DeinitCallback &#123; if let deinitCallback = objc_getAssociatedObject(object, &amp;deinitCallbackKey) as? DeinitCallback &#123; return deinitCallback &#125; else &#123; let rem = DeinitCallback() objc_setAssociatedObject(object, &amp;deinitCallbackKey, rem, .OBJC_ASSOCIATION_RETAIN_NONATOMIC) return rem &#125; &#125;&#125;@objc fileprivate class DeinitCallback: NSObject &#123; var callbacks: [() -&gt; ()] = [] deinit &#123; callbacks.forEach(&#123; $0() &#125;) &#125;&#125;","categories":[],"tags":[]},{"title":"How to deal with NODE_MODULE_VERSION in electron","slug":"How-to-deal-with-NODE_MODULE_VERSION-in-electron","date":"2017-08-28T11:00:49.000Z","updated":"2019-05-23T16:57:53.000Z","comments":true,"path":"blog/How-to-deal-with-NODE_MODULE_VERSION-in-electron/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-NODE_MODULE_VERSION-in-electron/","excerpt":"","text":"Issue #69 NODE_MODULE_VERSIONToday I was trying to install sharp with yarn add sharp to work in my electron app, but I get the following error Uncaught Error: The module ‚Äò/Users/khoa/MyElectronApp/node_modules/sharp/build/Release/sharp.node‚Äôwas compiled against a different Node.js version usingNODE_MODULE_VERSION 57. This version of Node.js requiresNODE_MODULE_VERSION 54. Please try re-compiling or re-installingthe module Native node moduleSearching a bit, it was because sharp is a native node module which uses libvips under the hood Node.js Addons are dynamically-linked shared objects, written in C++, that can be loaded into Node.js using the require() function, and used just as if they were an ordinary Node.js module. They are used primarily to provide an interface between JavaScript running in Node.js and C/C++ libraries. More on how to build native node module can be found here https://blog.risingstack.com/writing-native-node-js-modules/ Node versionI‚Äôm using nvm to manage node version, and nvm list shows 8.4.0 as the latest node version I‚Äôm using. 123456v6.10.1v7.8.0v7.9.0v8.0.0-&gt; v8.4.0system Searching on Node releases reveals that Node 8.4.0 has NODE_MODULE_VERSION of 57, so that is the node version npm uses to compile sharp However, I can‚Äôt seem to find the NODE_MODULE_VERSION 54 that sharp is using. I tried node 8.0.0 which is believed to have NODE_MODULE_VERSION 54 but it didn‚Äôt work Electron versionAs the time of this post, electron is at version 7.9.0, you can check here https://github.com/electron/electron/blob/master/.node-version or by running process.versions in Javascript console Using electron-rebuildSo after I read this Using Native Node Modules, I install electron-rebuilder to recompile sharp 123yarn add electron-rebuild --devyarn add sharp./node_modules/.bin/electron-rebuild It works now üéâ Read more https://blog.risingstack.com/writing-native-node-js-modules/","categories":[],"tags":[]},{"title":"Norsk","slug":"Norsk","date":"2017-08-21T19:56:08.000Z","updated":"2019-09-12T06:32:53.000Z","comments":true,"path":"blog/Norsk/","link":"","permalink":"https://onmyway133.github.io/blog/Norsk/","excerpt":"","text":"Issue #68 Ordbok lexin Bok https://mernorsk.portfolio.no/ https://norskna.portfolio.no/ http://praktisknorsk.cappelendamm.no/ https://steinpastein.cappelendamm.no/ http://ord.cappelendamm.no/ http://www.herborvi.cappelendamm.no/ https://klartdet.portfolio.no/ http://jobbisikte.cappelendamm.no/ Informasjon https://www.kompetansenorge.no/ Kurs Norwegian on the web Norwegian on the web 2 Norsk i bruk Norskl√¶rer Karense Lesning http://www.klartale.no/ http://grammatikk.com/ http://www.nyinorge.no/no/ http://www.samfunnskunnskap.no/?lang=no http://www.norgeshistorie.no/ Pr√∏ve https://www.kompetansenorge.no/norskprove/ https://enovate.no/voxdemo/norsk/ üöÄ https://udeoslovo.pameldingssystem.no/samfo-100 Bilder Bilder tema Lytting https://radio.nrk.no/ üöÄ http://www.klartale.no/klartale-podcast https://shifter.no/kategori/podcast/ Se p√• http://kunnskapsfilm.no/series/ https://tv.nrk.no/serie/folkeopplysningen/KMTE50009315/sesong-3/episode-5 NRK Super NRK Skole üöÄ üöÄ http://tekstlab.uio.no/igin/","categories":[],"tags":[{"name":"life","slug":"life","permalink":"https://onmyway133.github.io/tags/life/"}]},{"title":"How to support copy paste in electron","slug":"How-to-support-copy-paste-in-electron","date":"2017-08-21T10:14:39.000Z","updated":"2019-05-23T16:57:59.000Z","comments":true,"path":"blog/How-to-support-copy-paste-in-electron/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-support-copy-paste-in-electron/","excerpt":"","text":"Issue #67 After running electron-packager, the app does not accept copy, paste anymore. This is because the release build does not have menu with key binding to the clipboard by default. We can solve this by manually declaring the menu 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475const &#123;app&#125; = require('electron')const Menu = require('electron').Menuapp.on('ready', () =&gt; &#123; createWindow() createMenu()&#125;)function createMenu() &#123; const application = &#123; label: \"Application\", submenu: [ &#123; label: \"About Application\", selector: \"orderFrontStandardAboutPanel:\" &#125;, &#123; type: \"separator\" &#125;, &#123; label: \"Quit\", accelerator: \"Command+Q\", click: () =&gt; &#123; app.quit() &#125; &#125; ] &#125; const edit = &#123; label: \"Edit\", submenu: [ &#123; label: \"Undo\", accelerator: \"CmdOrCtrl+Z\", selector: \"undo:\" &#125;, &#123; label: \"Redo\", accelerator: \"Shift+CmdOrCtrl+Z\", selector: \"redo:\" &#125;, &#123; type: \"separator\" &#125;, &#123; label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" &#125;, &#123; label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" &#125;, &#123; label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" &#125;, &#123; label: \"Select All\", accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\" &#125; ] &#125; const template = [ application, edit ] Menu.setApplicationMenu(Menu.buildFromTemplate(template))&#125; Reference Electron - Enable copy and paste Paste into input field doesn‚Äôt work after packaging up app","categories":[],"tags":[]},{"title":"How to change app icon in electron","slug":"How-to-change-app-icon-in-electron","date":"2017-08-15T05:03:41.000Z","updated":"2019-05-23T16:58:09.000Z","comments":true,"path":"blog/How-to-change-app-icon-in-electron/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-change-app-icon-in-electron/","excerpt":"","text":"Issue #66 Generate icns Generate .iconset Run iconutil -c icns &quot;Icon.iconset&quot;. Note that icon names must be first letter lowsercased, and use _ instead of - Use icns In main.js, specify icon 12345win = new BrowserWindow(&#123; width: 800, height: 600, icon: __dirname + '/Icon/Icon.icns'&#125;) You can also use helper url methods 12345678const path = require('path')const url = require('url')const iconUrl = url.format(&#123; pathname: path.join(__dirname, 'Icon/Icon.icns'), protocol: 'file:', slashes: true&#125;) If app icon is not updated I get a problem that electron always shows default app icon. I tried using png, NativeImage, different icon sizes but still the problem. When I use electron-packager to make release build, the icon shows correctly, so it must be because of Electron caching or somehow üò† Go to node_modules -&gt; electron -&gt; dist, right click on Electron, choose View Info Drag another icns into the icon on the top left Release with electron-packager icon must be specified with __dirname (we already did) for electron-packager to pick up correct icons","categories":[],"tags":[]},{"title":"Another layer of abstraction","slug":"Another-layer-of-abstraction","date":"2017-08-09T11:57:51.000Z","updated":"2018-12-01T08:11:15.000Z","comments":true,"path":"blog/Another-layer-of-abstraction/","link":"","permalink":"https://onmyway133.github.io/blog/Another-layer-of-abstraction/","excerpt":"","text":"Issue #65 https://sandofsky.com/blog/third-party-libraries.html","categories":[],"tags":[]},{"title":"How to do implement notification in iOS with Firebase","slug":"How-to-do-implement-notification-in-iOS-with-Firebase","date":"2017-08-09T06:29:51.000Z","updated":"2019-09-03T08:18:00.000Z","comments":true,"path":"blog/How-to-do-implement-notification-in-iOS-with-Firebase/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-implement-notification-in-iOS-with-Firebase/","excerpt":"","text":"Issue #64 Note: This applies to Firebase 4.0.4 Preparing push notification certificateGo to Member Center -&gt; Certificates -&gt; Production CertificateYou can now use 1 certificate for both sandbox and production environment Auth Key If you like to use Auth Key, read Provider Authentication Tokens Configure push notification Go to Firebase Console -&gt; Settings -&gt; Project Settings -&gt; Cloud Messaging -&gt; iOS app configuration If you use certificate, use just 1 Apple Push Notification service SSL for both fields If you use Authenticate Key, fill in APNS auth key Adding podIn your Podfile, declare 12pod 'Firebase/Core'pod 'Firebase/Messaging' Disabling app delegate swizzling Read Method swizzling in Firebase Cloud Messaging You should say NO to swizzling. Do this in your Info.plist 12&lt;key&gt;FirebaseAppDelegateProxyEnabled&lt;/key&gt;&lt;false/&gt; Read more on Messaging.messaging().apnsToken This property is used to set the APNS Token received by the application delegate.FIRMessaging uses method swizzling to ensure the APNS token is set automatically. However, if you have disabled swizzling by setting FirebaseAppDelegateProxyEnabled to NO in your app‚Äôs Info.plist, you should manually set the APNS token in your application delegate‚Äôs -application:didRegisterForRemoteNotificationsWithDeviceToken: method.If you would like to set the type of the APNS token, rather than relying on automatic detection, see: -setAPNSToken:type:. Configuring FirebaseYou can and should configure Firebase in code 12345678import Firebaselet options = FirebaseOptions(googleAppID: \"\", gcmSenderID: \"\")options.bundleID = \"\"options.apiKey = \"\"options.projectID = \"\"options.clientID = \"\"FirebaseApp.configure(options: options) Handling device token12345import Firebasefunc application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) &#123; Messaging.messaging().apnsToken = deviceToken&#125; Getting FCM tokenRetrieving FCM tokenRead Access the registration token By default, the FCM SDK generates a registration token for the client app instance on initial startup of your app. Similar to the APNs device token, this token allows you to target notification messages to this particular instance of the app. 1Messaging.messaging().fcmToken Observing for FCM token changeRead Monitor token generation 1234567Messaging.messaging().delegate = self// MARK: - MessagingDelegatefunc messaging(_ messaging: Messaging, didRefreshRegistrationToken fcmToken: String) &#123; print(fcmToken)&#125;","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to use JSON Codable in Swift 4","slug":"How-to-use-JSON-Codable-in-Swift-4","date":"2017-08-06T11:56:28.000Z","updated":"2019-05-23T16:59:39.000Z","comments":true,"path":"blog/How-to-use-JSON-Codable-in-Swift-4/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-JSON-Codable-in-Swift-4/","excerpt":"","text":"Issue #63 Codable in Swift 4 changes the game. It deprecates lots of existing JSON libraries. Generic modelAPI responses is usually in form of an object container with a key. Then it will be either nested array or object. We can deal with it by introducing a data holder. Take a look DataHolder 12345678910&#123; \"data\": [ &#123; \"comment_id\": 1 &#125;, &#123; \"comment_id\": 2 &#125; ]&#125; 123456789101112131415struct ListHolder&lt;T: Codable&gt;: Codable &#123; enum CodingKeys: String, CodingKey &#123; case list = \"data\" &#125; let list: [T]&#125;struct OneHolder&lt;T: Codable&gt;: Codable &#123; enum CodingKeys: String, CodingKey &#123; case one = \"data\" &#125; let one: T&#125; then with Alamofire, we can just parse to data holder 12345678910111213141516func loadComments(mediaId: String, completion: @escaping ([Comment]) -&gt; Void) &#123; request(\"https://api.instagram.com/v1/media/\\(mediaId)/comments\", parameters: parameters) .responseData(completionHandler: &#123; (response) in if let data = response.result.value &#123; do &#123; let holder = try JSONDecoder().decode(ListHolder&lt;Comment&gt;.self, from: data) DispatchQueue.main.async &#123; completion(holder.list) &#125; &#125; catch &#123; print(error) &#125; &#125; &#125;)&#125; Read more http://benscheirman.com/2017/06/ultimate-guide-to-json-parsing-with-swift-4/","categories":[],"tags":[]},{"title":"Learning flexbox","slug":"Learning-flexbox","date":"2017-08-04T09:03:55.000Z","updated":"2019-09-10T06:42:31.000Z","comments":true,"path":"blog/Learning-flexbox/","link":"","permalink":"https://onmyway133.github.io/blog/Learning-flexbox/","excerpt":"","text":"Issue #62 CSS body height https://www.kirupa.com/html5/make_body_take_up_full_browser_height.htm Flexbox Properties of flex https://codepen.io/enxaneta/full/adLPwv Visual guide to flexbox https://scotch.io/tutorials/a-visual-guide-to-css3-flexbox-properties align-items vs align-content https://stackoverflow.com/questions/27539262/whats-the-difference-between-align-content-and-align-items align-items vs justify-content https://stackoverflow.com/questions/35049262/difference-between-justify-content-vs-align-items multiple line https://stackoverflow.com/questions/41789278/first-child-full-width-in-flexbox","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://onmyway133.github.io/tags/javascript/"}]},{"title":"When to use hamburger menu in iOS","slug":"When-to-use-hamburger-menu-in-iOS","date":"2017-07-31T10:10:33.000Z","updated":"2019-05-23T17:01:10.000Z","comments":true,"path":"blog/When-to-use-hamburger-menu-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/When-to-use-hamburger-menu-in-iOS/","excerpt":"","text":"Issue #61 You can read everywhere that hamburger is mostly not recommended. Every navigation structure has their use cases, and for hamburger, I find these posts to have their points As a secondary navigation http://babich.biz/hamburger-good-ux/ When it does not interfere with the existing navigation http://www.ios-coding.com/blog/2015/11/01/maintaining-viewdeck/ Slack app https://slack.com/downloads/ios","categories":[],"tags":[]},{"title":"How to deal with windows-1252 encoding in Node","slug":"How-to-deal-with-windows-1252-encoding-in-Node","date":"2017-07-08T20:18:42.000Z","updated":"2019-05-23T17:00:00.000Z","comments":true,"path":"blog/How-to-deal-with-windows-1252-encoding-in-Node/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-windows-1252-encoding-in-Node/","excerpt":"","text":"Issue #60 Today I use node-fetch and cheerio to fetch a webpage. It looks good in Chrome and Sublime Text when it displays html entities like &amp;#7901 However, it does not render correctly in iTerm, Terminal and Visual Studio Code. It just shows fffd I think the problem is because of my code, so I change to request and try to play with different options in cheerio but still the problem. It didn‚Äôt take me long to figure it out that the format of the html is windows-1252 1&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=windows-1252\"&gt; So I need to use windows-1252, legacy-encoding, iconv-lite FYI https://stackoverflow.com/questions/31834790/node-js-how-to-http-get-and-decode-encode-response-in-custom-format","categories":[],"tags":[]},{"title":"Pixel and point","slug":"Pixel-and-point","date":"2017-06-16T09:13:15.000Z","updated":"2019-09-10T06:42:26.000Z","comments":true,"path":"blog/Pixel-and-point/","link":"","permalink":"https://onmyway133.github.io/blog/Pixel-and-point/","excerpt":"","text":"Issue #59 TL;DR: Don‚Äôt use nativeScale and nativeBounds, unless you‚Äôre doing some very low level stuff What is point and pixelFrom https://developer.apple.com/library/content/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html In iOS there is a distinction between the coordinates you specify in your drawing code and the pixels of the underlying device The purpose of using points (and the logical coordinate system) is to provide a consistent size of output that is device independent. For most purposes, the actual size of a point is irrelevant. The goal of points is to provide a relatively consistent scale that you can use in your code to specify the size and position of views and rendered content On a standard-resolution screen, the scale factor is typically 1.0. On a high-resolution screen, the scale factor is typically 2.0 How about scale and nativeScaleFrom https://developer.apple.com/documentation/uikit/uiscreen var bounds: CGRect: The bounding rectangle of the screen, measured in points. var nativeBounds: CGRect: The bounding rectangle of the physical screen, measured in pixels. var scale: CGFloat: The natural scale factor associated with the screen. var nativeScale: CGFloat: The native scale factor for the physical screen. The scale factor and display modeSee this for a whole list of devices and their scale factors https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions The iPhone 6 and 6+ introduced display mode https://www.cnet.com/how-to/explaining-display-zoom-on-iphone-6-and-6-plus/ You can see that currently the iPhone 6+, 6s+, 7+ phones have scale factor of 2.88 in zoomed mode, and 2.6 in standard mode You can also see that in zoomed mode, iPhone 6 has the same logical size as the iPhone 5 Simulator vs deviceThis is to show you the differences in nativeScale in simulators and devices in zoomed mode, hence differences in nativeBounds. iPhone 6+ simulator 1234567891011121314151617181920212223(lldb) po UIScreen.main.scale3.0(lldb) po UIScreen.main.bounds‚ñø (0.0, 0.0, 414.0, 736.0) ‚ñø origin : (0.0, 0.0) - x : 0.0 - y : 0.0 ‚ñø size : (414.0, 736.0) - width : 414.0 - height : 736.0(lldb) po UIScreen.main.nativeScale3.0(lldb) po UIScreen.main.nativeBounds‚ñø (0.0, 0.0, 1242.0, 2208.0) ‚ñø origin : (0.0, 0.0) - x : 0.0 - y : 0.0 ‚ñø size : (1242.0, 2208.0) - width : 1242.0 - height : 2208.0 iPhone 6+ device 1234567891011121314151617181920212223(lldb) po UIScreen.main.scale3.0(lldb) po UIScreen.main.bounds‚ñø (0.0, 0.0, 375.0, 667.0) ‚ñø origin : (0.0, 0.0) - x : 0.0 - y : 0.0 ‚ñø size : (375.0, 667.0) - width : 375.0 - height : 667.0(lldb) po UIScreen.main.nativeScale2.88(lldb) po UIScreen.main.nativeBounds‚ñø (0.0, 0.0, 1080.0, 1920.0) ‚ñø origin : (0.0, 0.0) - x : 0.0 - y : 0.0 ‚ñø size : (1080.0, 1920.0) - width : 1080.0 - height : 1920.0","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"Optional of optional in Swift","slug":"Optional-of-optional-in-Swift","date":"2017-06-14T04:07:31.000Z","updated":"2019-09-10T06:42:16.000Z","comments":true,"path":"blog/Optional-of-optional-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Optional-of-optional-in-Swift/","excerpt":"","text":"Issue #58 Do you know that an optional can itself contain an optional, that contains another optional? In that case, we need to unwrap multiple times You mostly see it when you try to access window 1let window = UIApplication.shared.delegate?.window // UIWindow?? It is because delegate can be nil, and its window can be nil too. 1window??.backgroundColor = .yellow","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Package node.js application","slug":"Package-node.js-application","date":"2017-06-13T08:36:39.000Z","updated":"2019-09-10T06:41:34.000Z","comments":true,"path":"blog/Package-node.js-application/","link":"","permalink":"https://onmyway133.github.io/blog/Package-node.js-application/","excerpt":"","text":"Issue #57 I like node.js because it has many cool packages. I wish the same goes for macOS. Fortunately, the below solutions provide a way to package node.js modules and use them inside macOS applications. It can be slow, but you save time by using existing node.js modules. Let‚Äôs give it a try. pkg Package your Node.js project into an executable üöÄ nexe create a single executable out of your node.js apps enclose js Compile your Node.js project into an executable http://enclosejs.com","categories":[],"tags":[{"name":"node","slug":"node","permalink":"https://onmyway133.github.io/tags/node/"}]},{"title":"Favorite WWDC 2017 sessions","slug":"Favorite-WWDC-2017-sessions","date":"2017-06-10T09:41:21.000Z","updated":"2017-06-13T08:38:30.000Z","comments":true,"path":"blog/Favorite-WWDC-2017-sessions/","link":"","permalink":"https://onmyway133.github.io/blog/Favorite-WWDC-2017-sessions/","excerpt":"","text":"Issue #56 Source WWDC 2017 Introducing Core ML Core ML Introducing ARKit: Augmented Reality for iOS ARKit What‚Äôs New in Swift String Generic Codable Advanced Animations with UIKit Multiple animation Interactive animation Natural Language Processing and your Apps NSLinguisticTagger What‚Äôs New in Cocoa Touch Large title Drag and drop File management Safe area What‚Äôs New in Foundation KeyPath Observe Codable Debugging with Xcode 9 Wireless debugging View controller debugging Core ML in depth Model Core ML tools Vision Framework: Building on Core ML Detection Track What‚Äôs New in Testing Parallel testing Wait Screenshot Multiple app scenario","categories":[],"tags":[]},{"title":"How to implement a tracker in Swift","slug":"How-to-implement-a-tracker-in-Swift","date":"2017-06-10T09:13:13.000Z","updated":"2019-05-23T16:47:25.000Z","comments":true,"path":"blog/How-to-implement-a-tracker-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-implement-a-tracker-in-Swift/","excerpt":"","text":"Issue #55 I‚Äôm trying to implement a tracker, so the idea is that it can inject subscription upon method calls. It is best suit for logging, analytics, and it leverages RxCocoa Usage1234567891011track(ListController.self) &#123; _ in print(\"\")&#125;track(ListController.self, selector: #selector(ListController.hello)) &#123; _ in print(\"\")&#125;track(DetailController.self) &#123; _ in print(\"\")&#125; The code123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475import UIKitimport RxSwiftimport RxCocoavar mapping: [String: [Item]] = [:]var hasSwizzled = falselet bag = DisposeBag()public func track&lt;T: UIViewController&gt;(_ type: T.Type, selector: Selector? = nil, block: @escaping (T) -&gt; Void) &#123; let typeName = NSStringFromClass(type) if !hasSwizzled &#123; let original = #selector(UIViewController.viewDidLoad) let swizled = #selector(UIViewController.trackers_viewDidLoad) swizzle(kClass: UIViewController.self, originalSelector: original, swizzledSelector: swizled) hasSwizzled = true &#125; let selector = selector ?? #selector(UIViewController.viewDidAppear(_:)) let item = Item(selector: selector, block: &#123; (controller) in if let controller = controller as? T &#123; block(controller) &#125; &#125;) if var items = mapping[typeName] &#123; items.append(item) mapping[typeName] = items &#125; else &#123; mapping[typeName] = [item] &#125;&#125;class Item &#123; let selector: Selector let block: (UIViewController) -&gt; Void init(selector: Selector, block: @escaping (UIViewController) -&gt; Void) &#123; self.selector = selector self.block = block &#125;&#125;extension UIViewController &#123; func trackers_viewDidLoad() &#123; trackers_viewDidLoad() let typeName = NSStringFromClass(type(of: self)) let items = mapping[typeName] items?.forEach(&#123; (item) in self .rx .sentMessage(item.selector) .subscribe(onNext: &#123; _ in item.block(self) &#125;, onCompleted: &#123; print(\"completed\") &#125;) .disposed(by: bag) &#125;) &#125;&#125;func swizzle(kClass: AnyClass, originalSelector: Selector, swizzledSelector: Selector) &#123; let originalMethod = class_getInstanceMethod(kClass, originalSelector) let swizzledMethod = class_getInstanceMethod(kClass, swizzledSelector) let didAddMethod = class_addMethod(kClass, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)) if didAddMethod &#123; class_replaceMethod(kClass, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)) &#125; else &#123; method_exchangeImplementations(originalMethod, swizzledMethod) &#125;&#125;","categories":[],"tags":[]},{"title":"How to change year in Date in Swift","slug":"How-to-change-year-in-Date-in-Swift","date":"2017-06-09T08:53:47.000Z","updated":"2019-09-12T06:21:55.000Z","comments":true,"path":"blog/How-to-change-year-in-Date-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-change-year-in-Date-in-Swift/","excerpt":"","text":"Issue #54 Today I‚Äôm trying to change the year of a Date object to 2000 in Swift. 1let date = Date() Firstly, I tried with date(bySetting:) but it does not work with past year. It simply returns nil 1Calendar.current.date(bySetting: .year, value: 2000, of: date) Secondly, I tried with dateComponents. The component.year has changed, but it calendar still returns the original date, very strange !!. No matter what timezone and calendar I use, it still has this problem 123var component = calendar.dateComponents(in: TimeZone.current, from: base)component.year = yearCalendar.current.date(from: component) Finally, I tried to be more explicit, and it works üéâ 123var component = calendar.dateComponents([.year, .month, .day, .hour, .minute, .second], from: base)component.year = yearCalendar.current.date(from: component)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"WWDC changelog","slug":"WWDC-changelog","date":"2017-06-08T19:50:07.000Z","updated":"2017-06-13T05:41:04.000Z","comments":true,"path":"blog/WWDC-changelog/","link":"","permalink":"https://onmyway133.github.io/blog/WWDC-changelog/","excerpt":"","text":"Issue #53 Every WWDC, Apple introduces new frameworks and workflows. There are many awesome things we overlook or haven‚Äôt had the chance to use. Some frameworks are first introduced on macOS, but I list in the first WWDC it was introduced It‚Äôs something only Apple can do General WWDC Apple Developer Documentation Apple Worldwide Developers Conference ASCII WWDC Searchable full-text transcripts of WWDC sessions An Illustrated History of iOS An Illustrated History of macOS Interesting NSLinguisticTagger Analyze natural language to tag part of speech and lexical class, identify proper names, perform lemmatization, and determine the language and script (orthography) of text. WWDC ‚Ä¶ Core Image Use built-in or custom filters to process still and video images. Core Motion Process accelerometer, gyroscope, pedometer, and environment-related events. Accelerate Make large-scale mathematical computations and image calculations, optimized for high performance. WWDC 2013 iOS 7, macOS Mavericks 10.9 MultipeerConnectivity Support peer-to-peer connectivity and the discovery of nearby devices. SpriteKit Create 2D sprite-based games using an optimized animation system, physics simulation, and event-handling support. ResearchKit ResearchKit makes it easier to enroll participants and conduct studies UIKit Dynamics Apply physics-based animations to your views. WWDC 2014 iOS 8, macOS Yosemite 10.10 Photos Work with image and video assets managed by the Photos app, including those from iCloud Photo Library and Live Photos. Fetch and cache full-sized assets or thumbnails asynchronously, revise content, and sync revisions to multiple devices. Metal Render advanced 3D graphics and perform data-parallel computations using the GPU. SceneKit Create 3D games and add 3D content to apps using high-level scene descriptions. Easily add animations, physics simulation, particle effects, and realistic physically based rendering. HealthKit Share health and fitness data with other apps, while maintaining the user‚Äôs privacy and control over their data. WWDC 2015 iOS 9, macOS El Capitan 10.11, watchOS 2 WatchKit Construct and manage your app‚Äôs user interface for watchOS. Respond to events generated by interface objects, gestures, and the system. GameplayKit Architect and organize your game logic. Incorporate common gameplay behaviors such as random number generation, artificial intelligence, pathfinding, and agent behavior. Contacts Access the user‚Äôs contacts and format and localize contact information. Core Spotlight Index the content in apps that handle persistent user data, such as documents and photos, and let users deep-link to it from Spotlight and Safari search results. Add, update, and delete searchable app content. WWDC 2016 iOS 10, macOS Sierra 10.12, watchOS 3 HomeKit Communicate with, configure, and control home automation accessories, including complex camera-type accessories. ReplayKit Record or stream video from the screen, and audio from the app and microphone SiriKit Handle user requests for your app‚Äôs services that originate from Siri or Maps. UserNotificationsUI Customize the interface used to display local and remote notifications. Speech With the user‚Äôs permission, get recognition of live and prerecorded speech, and receive transcriptions, alternative interpretations, and confidence levels WWDC 2017 iOS 11, macOS High Sierra 10.13, watchOS 4 ARKit üöÄ Integrate iOS device camera and motion features to produce augmented reality experiences in your app or game. Vision üöÄ Apply high-performance image analysis and computer vision techniques to identify faces, detect features, and classify scenes in images and video. Core ML üöÄ Integrate machine learning models into your app. MusicKit MusicKit on iOS lets users play Apple Music and their local music library natively from your apps and games. PDFKit Display and manipulate PDF documents in your applications. Drag and Drop Bring drag and drop to your app by using interaction APIs with your views.","categories":[],"tags":[]},{"title":"How to test for viewDidLoad in iOS","slug":"How-to-test-for-viewDidLoad-in-iOS","date":"2017-06-07T09:58:15.000Z","updated":"2019-07-30T03:05:30.000Z","comments":true,"path":"blog/How-to-test-for-viewDidLoad-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-test-for-viewDidLoad-in-iOS/","excerpt":"","text":"Issue #52 Suppose we have the following view controller 123456class ListController: UIViewController &#123; override func viewDidLoad() &#123; super.viewDidLoad() view.backgroundColor = .white &#125;&#125; Get to know viewDidLoadWe know that viewDidLoad is called when view is created the first time. So in the the Unit Test, if you use viewDidLoad to trigger, you will fall into a trap 1234func testSetup() &#123; let controller = ListController() controller.viewDidLoad()&#125; Why is viewDidLoad called twice? It is called once in your test And in your viewDidLoad method, you access view, which is created the first time, hence it will trigger viewDidLoad again The correct wayThe best practice is not to trigger events yourself, but do something to make event happen. In Unit Test, we just access view to trigger viewDidLoad 1234func testSetup() &#123; let controller = ListController() let _ = controller.view&#125;","categories":[],"tags":[]},{"title":"Structuring apps with RxSwift","slug":"Structuring-apps-with-RxSwift","date":"2017-06-06T09:09:42.000Z","updated":"2018-11-28T07:09:18.000Z","comments":true,"path":"blog/Structuring-apps-with-RxSwift/","link":"","permalink":"https://onmyway133.github.io/blog/Structuring-apps-with-RxSwift/","excerpt":"","text":"Issue #51","categories":[],"tags":[]},{"title":"Developing Sketch plugins","slug":"Developing-Sketch-plugins","date":"2017-06-06T09:08:21.000Z","updated":"2017-06-06T09:08:21.000Z","comments":true,"path":"blog/Developing-Sketch-plugins/","link":"","permalink":"https://onmyway133.github.io/blog/Developing-Sketch-plugins/","excerpt":"","text":"Issue #50","categories":[],"tags":[]},{"title":"How to initialize Enums With Optionals in Swift","slug":"How-to-initialize-Enums-With-Optionals-in-Swift","date":"2017-06-02T11:07:40.000Z","updated":"2019-05-23T16:46:38.000Z","comments":true,"path":"blog/How-to-initialize-Enums-With-Optionals-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-initialize-Enums-With-Optionals-in-Swift/","excerpt":"","text":"Issue #49 Today someone showed me https://medium.com/@_Easy_E/initializing-enums-with-optionals-in-swift-bf246ce20e4c which tries to init enum with optional value. 1234567891011121314151617181920enum Planet: String &#123; case mercury case venus case earth case mars case jupiter case saturn case uranus case neptune&#125;extension RawRepresentable &#123; init?(optionalValue: RawValue?) &#123; guard let value = optionalValue else &#123; return nil &#125; self.init(rawValue: value) &#125;&#125;let name: String? = \"venus\"let planet = Planet(optionalValue: name) One interesting fact about optional, is that it is a monad, so it has map and flatMap. Since enum init(rawValue:) returns an optional, we need to use flatMap. It looks like this 12let name: String? = \"venus\"let planet = name.flatMap(&#123; Planet(rawValue: $0) &#125;) üéâ","categories":[],"tags":[]},{"title":"How to run UI Test with system alert in iOS","slug":"How-to-run-UI-Test-with-system-alert-in-iOS","date":"2017-06-02T10:59:14.000Z","updated":"2019-05-23T16:46:22.000Z","comments":true,"path":"blog/How-to-run-UI-Test-with-system-alert-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-UI-Test-with-system-alert-in-iOS/","excerpt":"","text":"Issue #48 Continue my post https://github.com/onmyway133/blog/issues/45. When you work with features, like map view, you mostly need permissions, and in UITests you need to test for system alerts. Add interruption monitorThis is the code. Note that you need to call app.tap() to interact with the app again, in order for interruption monitor to work 123456addUIInterruptionMonitor(withDescription: \"Location permission\", handler: &#123; alert in alert.buttons[\"Allow\"].tap() return true&#125;)app.tap() Note that you don‚Äôt always need to handle the returned value of addUIInterruptionMonitor Only tap when neededOne problem with this approach is that when there is no system alert (you already touched to allow before), then app.tap() will tap on your main screen. In my app which uses map view, it will tap on some pins, which will present another screen, which is not correct. Since app.alerts does not work, my 2nd attempt is to check for app.windows.count. Unfortunately, it always shows 5 windows whether alert is showing or not. I know 1 is for main window, 1 is for status bar, the other 3 windows I have no idea. The 3rd attempt is to check that underlying elements (behind alert) can‚Äôt be touched, which is to use isHittable. This property does not work, it always returns true Check the contentThis uses the assumption that we only tests for when user hits Allow button. So only if alert is answered with Allow, then we have permission to display our content. For my map view, I check that there are some pins on the map. See https://github.com/onmyway133/blog/issues/45 on how to mock location and identify the pins 123if app.otherElements.matching(identifier: &quot;myPin&quot;).count == 0 &#123; app.tap()&#125; When there is no permissionSo how can we test that user has denied your request? In my map view, if user does not allow location permission, I show a popup asking user to go to Settings and change it, otherwise, they can‚Äôt interact with the map. I don‚Äôt know how to toggle location in Privacy in Settings, maybe XCUISiriService can help. But 1 thing we can do is to mock the application Before you launch the app in UITests, add some arguments 1app.launchArguments.append(&quot;--UITests-mockNoLocationPermission&quot;) and in the app, we need to check for this arguments 12345func checkLocationPermission() &#123; if CommandLine.arguments.contains(\"--UITests-mockNoLocationPermission\") &#123; showNoLocationPopupAndAskUserToEnableInSettings() &#125;&#125; That‚Äôs it. In UITests, we can test whether that no location permission popup appears or not","categories":[],"tags":[]},{"title":"How to master Auto Layout Visual Format Language","slug":"How-to-master-Auto-Layout-Visual-Format-Language","date":"2017-06-02T10:17:14.000Z","updated":"2017-06-02T10:49:02.000Z","comments":true,"path":"blog/How-to-master-Auto-Layout-Visual-Format-Language/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-master-Auto-Layout-Visual-Format-Language/","excerpt":"","text":"Issue #47 No, you don‚Äôt","categories":[],"tags":[]},{"title":"Getting started with Swift","slug":"Getting-started-with-Swift","date":"2017-06-02T05:15:46.000Z","updated":"2017-06-02T05:15:46.000Z","comments":true,"path":"blog/Getting-started-with-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Getting-started-with-Swift/","excerpt":"","text":"Issue #46 Hi, here are some materials I found that are useful for learning Swift and iOS App Development with Swift Hacking with Swift Teaching App Development with Swift CodePath iOS Guides learn-swift About iOS App Architecture Start Developing iOS Apps (Swift)","categories":[],"tags":[]},{"title":"How to run UITests with map view in iOS","slug":"How-to-run-UITests-with-map-view-in-iOS","date":"2017-06-01T07:32:19.000Z","updated":"2019-08-27T10:48:00.000Z","comments":true,"path":"blog/How-to-run-UITests-with-map-view-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-UITests-with-map-view-in-iOS/","excerpt":"","text":"Issue #45 Mock a locationYou should mock a location to ensure reliable test Create the gpx fileGo to Xcode -&gt; File -&gt; New -&gt; GPX File It looks like 1234567891011&lt;?xml version=\"1.0\"?&gt;&lt;gpx version=\"1.1\" creator=\"Xcode\"&gt; &lt;wpt lat=\"59.913590\" lon=\"10.733750\"&gt; &lt;name&gt;Oslo S&lt;/name&gt; &lt;time&gt;2017-05-31T14:55:37Z&lt;/time&gt; &lt;/wpt&gt; &lt;wpt lat=\"59.913590\" lon=\"10.733750\"&gt; &lt;name&gt;Oslo S&lt;/name&gt; &lt;time&gt;2017-05-31T14:55:40Z&lt;/time&gt; &lt;/wpt&gt;&lt;/gpx&gt; The gpx file is very powerful, as it allows you to specify a route with different movement speed. Provide one or more waypoints containing a latitude/longitude pair. If you provide onewaypoint, Xcode will simulate that specific location. If you provide multiple waypoints,Xcode will simulate a route visiting each waypoint. Optionally provide a time element for each waypoint. Xcode will interpolate movementat a rate of speed based on the time elapsed between each waypoint. If you do not providea time element, then Xcode will use a fixed rate of speed. Waypoints must be sorted by time in ascending order. Use the gpx file Declare the gpx file in app target, not UITests target. Go to your app scheme -&gt; Run -&gt; Options Go to Simulator -&gt; Debug -&gt; Location -&gt; Custom Location and select that same location, just to make sure. It does not need to be the same, but I see that without Custom Location, it does not work in UITests Test that you‚Äôre near the initial location1234567let map = app.maps.element(boundBy: 0)let predicate = NSPredicate(format: \"label CONTAINS 'City Hall'\")let cityHall = map.otherElements.matching(predicate).element(boundBy: 0)// wait for the map to finish loading and zoomingwait(for: cityHall, timeout: 2)XCTAssertTrue(cityHall.exists) The wait function is from https://github.com/onmyway133/blog/issues/44 Test that you can interact with your custom pinYou need to specify accessibilityIdentifier, like 1234567class MyPin: MKAnnotationView &#123; override func didMoveToSuperview() &#123; super.didMoveToSuperview() accessibilityIdentifier = \"myPin\" &#125;&#125; and then query for that pin. Not that it is not inside map, it is inside app 12let pin = app.otherElements.matching(identifier: \"myPin\").element(boundBy: 0)XCTAssertTrue(pin.exists) You should use accessibilityIdentifieraccessibilityIdentifier is from UIAccessibilityIdentification protocol. You should not use accessibilityLabel, see https://github.com/kif-framework/KIF/issues/243 Given that accessibilityLabel is an outwardly-facing string that is actually used by accessibility screen readers (and should be localized to the device user‚Äôs language), Apple now provides an alternate property (iOS 5+) that is specifically intended for UI Automation purposes","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to run UI Test with Facebook login","slug":"How-to-run-UI-Test-with-Facebook-login","date":"2017-05-30T13:32:17.000Z","updated":"2019-05-23T16:30:35.000Z","comments":true,"path":"blog/How-to-run-UI-Test-with-Facebook-login/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-run-UI-Test-with-Facebook-login/","excerpt":"","text":"Issue #44 Today I‚Äôm trying to run some UITest on my app, which uses Facebook login. And here are some of my notes on it. Challenges The challenges with Facebook is it uses Safari controller, we we deal mostly with web view for now. Starting from iOS 9+, Facebook decided to use safari instead of native facebook app to avoid app switching. You can read the detail here Building the Best Facebook Login Experience for People on iOS 9 It does not have wanted accessibilityIdentifier or accessibilityLabel The webview content may change in the future üò∏ Create a Facebook test userLuckily, you don‚Äôt have to create your own Facebook user to test. Facebook supports test users that you can manage permissions and friends, very handy When creating the test user, you have the option to select language. That will be the displayed language in Safari web view. I choose Norwegian üá≥üá¥ for now Click the login button and show Facebook loginHere we use the default FBSDKLoginButton 123var showFacebookLoginFormButton: XCUIElement &#123; return buttons[\"Continue with Facebook\"]&#125; And then tap it 1app.showFacebookLoginFormButton.tap() Check login statusWhen going to safari Facebook form, user may have already logged in or not. So we need to handle these 2 cases. When user has logged in, Facebook will say something like ‚Äúyou have already logged in‚Äù or the OK button. The advice here is to put breakpoint and po app.staticTexts, po app.buttons to see which UI elements are at a certain point. You can check for the static text, or simply just the OK button 123var isAlreadyLoggedInSafari: Bool &#123; return buttons[\"OK\"].exists || staticTexts[\"Du har allerede godkjent Blue Sea.\"].exists&#125; Wait and refreshBut Facebook form is a webview, so its content is a bit dynamic. And UITest seems to cache content for fast query, so before checking staticTexts, we need to wait and refresh the cache 1app.clearCachedStaticTexts() This is the wait function 12345678910111213extension XCTestCase &#123; func wait(for duration: TimeInterval) &#123; let waitExpectation = expectation(description: \"Waiting\") let when = DispatchTime.now() + duration DispatchQueue.main.asyncAfter(deadline: when) &#123; waitExpectation.fulfill() &#125; // We use a buffer here to avoid flakiness with Timer on CI waitForExpectations(timeout: duration + 0.5) &#125;&#125; Wait for element to appearBut a more solid approach would be to wait for element to appear. For Facebook login form, they should display a Facebook label after loading. So we should wait for this element 123456789101112extension XCTestCase &#123; /// Wait for element to appear func wait(for element: XCUIElement, timeout duration: TimeInterval) &#123; let predicate = NSPredicate(format: \"exists == true\") let _ = expectation(for: predicate, evaluatedWith: element, handler: nil) // Here we don't need to call `waitExpectation.fulfill()` // We use a buffer here to avoid flakiness with Timer on CI waitForExpectations(timeout: duration + 0.5) &#125;&#125; And call this before you do any further inspection on elements in Facebook login form 1wait(for: app.staticTexts[\"Facebook\"], timeout: 5) If user is logged inAfter login, my app shows the main controller with a map view inside. So a basic test would be to check the existence of that map 1234567if app.isAlreadyLoggedInSafari &#123; app.okButton.tap() handleLocationPermission() // Check for the map XCTAssertTrue(app.maps.element(boundBy: 0).exists)&#125; Handle interruptionYou know that when showing the map with location, Core Location will ask for permission. So we need to handle that interruption as well. You need to ensure to call it early before the alert happens 123456fileprivate func handleLocationPermission() &#123; addUIInterruptionMonitor(withDescription: \"Location permission\", handler: &#123; alert in alert.buttons.element(boundBy: 1).tap() return true &#125;)&#125; There is another problem, this monitor won‚Äôt be called. So the workaround is to call app.tap() again when the alert will happen. In my case, I call app.tap() when my map has been shown for 1,2 seconds, just to make sure app.tap() is called after alert is shown For a more detailed guide, please read https://github.com/onmyway133/blog/issues/48 If user is not logged inIn this case, we need to fill in email and password. You can take a look at the The full source code section below. When things don‚Äôt work or po does not show you the elements you needed, it‚Äôs probably because of caching or you need to wait until dynamic content finishes rendering. You need to wait for element to appear Tap on the text fieldYou may get Neither element nor any descendant has keyboard focus, here are the workaround If you test on Simulator, make sure Simulator -&gt; Hardware -&gt; Keyboard -&gt; Connect Hardware Keyboard is not checked wait a bit after tap 1app.emailTextField.tap() Clear all the textThe idea is to move the caret to the end of the textField, then apply each delete key for each character, then type the next text 12345678910111213extension XCUIElement &#123; func deleteAllText() &#123; guard let string = value as? String else &#123; return &#125; let lowerRightCorner = coordinate(withNormalizedOffset: CGVector(dx: 0.9, dy: 0.9)) lowerRightCorner.tap() let deletes = string.characters.map(&#123; _ in XCUIKeyboardKeyDelete &#125;).joined(separator: \"\") typeText(deletes) &#125;&#125; Change languageFor my case, I want to test in Norwegian, so we need to find the Norwegian option and tap on that. It is identified as static text by UI Test 123var norwegianText: XCUIElement &#123; return staticTexts[\"Norsk (bokm√•l)\"]&#125; 12wait(for: app.norwegianText, timeout: 1)app.norwegianText.tap() The email text fieldLuckily, email text field is detected by UI Test as text field element, so we can query for that. This uses predicate 1234var emailTextField: XCUIElement &#123; let predicate = NSPredicate(format: \"placeholderValue == %@\", \"E-post eller mobil\") return textFields.element(matching: predicate)&#125; The password text fieldUI Test can‚Äôt seem to identify the password text field, so we need to search for it by coordinate 1234var passwordCoordinate: XCUICoordinate &#123; let vector = CGVector(dx: 1, dy: 1.5) return emailTextField.coordinate(withNormalizedOffset: vector)&#125; This is the document for func coordinate(withNormalizedOffset normalizedOffset: CGVector) -&gt; XCUICoordinate Creates and returns a new coordinate with a normalized offset.The coordinate‚Äôs screen point is computed by adding normalizedOffset multiplied by the size of the element‚Äôs frame to the origin of the element‚Äôs frame. Then type the password 12app.passwordCoordinate.tap()app.typeText(\"My password\") We should not use app.passwordCoordinate.referencedElement because it will point to email text field ‚ùóÔ∏è üò¢ Run that test againGo to Xcode -&gt; Product -&gt; Perform Actions -&gt; Test Again to run the previous test again The full source code123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152import XCTestclass LoginTests: XCTestCase &#123; var app: XCUIApplication! func testLogin() &#123; continueAfterFailure = false app = XCUIApplication() app.launch() passLogin() &#125;&#125;extension LoginTests &#123; func passLogin() &#123; // Tap login app.showFacebookLoginFormButton.tap() wait(for: app.staticTexts[\"Facebook\"], timeout: 5) // This requires a high timeout // There may be location permission popup when showing map handleLocationPermission() if app.isAlreadyLoggedInSafari &#123; app.okButton.tap() // Show map let map = app.maps.element(boundBy: 0) wait(for: map, timeout: 2) XCTAssertTrue(map.exists) // Need to interact with the app for interruption monitor to work app.tap() &#125; else &#123; // Choose norsk wait(for: app.norwegianText, timeout: 1) app.norwegianText.tap() app.emailTextField.tap() app.emailTextField.deleteAllText() app.emailTextField.typeText(\"mujyhwhbby_1496155833@tfbnw.net\") app.passwordCoordinate.tap() app.typeText(\"Bob Alageaiecghfb Sharpeman\") // login app.facebookLoginButton.tap() // press OK app.okButton.tap() // Show map let map = app.maps.element(boundBy: 0) wait(for: map, timeout: 2) XCTAssertTrue(map.exists) // Need to interact with the app for interruption monitor to work app.tap() &#125; &#125; fileprivate func handleLocationPermission() &#123; addUIInterruptionMonitor(withDescription: \"Location permission\", handler: &#123; alert in alert.buttons.element(boundBy: 1).tap() return true &#125;) &#125;&#125;fileprivate extension XCUIApplication &#123; var showFacebookLoginFormButton: XCUIElement &#123; return buttons[\"Continue with Facebook\"] &#125; var isAlreadyLoggedInSafari: Bool &#123; return buttons[\"OK\"].exists || staticTexts[\"Du har allerede godkjent Blue Sea.\"].exists &#125; var okButton: XCUIElement &#123; return buttons[\"OK\"] &#125; var norwegianText: XCUIElement &#123; return staticTexts[\"Norsk (bokm√•l)\"] &#125; var emailTextField: XCUIElement &#123; let predicate = NSPredicate(format: \"placeholderValue == %@\", \"E-post eller mobil\") return textFields.element(matching: predicate) &#125; var passwordCoordinate: XCUICoordinate &#123; let vector = CGVector(dx: 1, dy: 1.5) return emailTextField.coordinate(withNormalizedOffset: vector) &#125; var facebookLoginButton: XCUIElement &#123; return buttons[\"Logg inn\"] &#125;&#125;extension XCTestCase &#123; func wait(for duration: TimeInterval) &#123; let waitExpectation = expectation(description: \"Waiting\") let when = DispatchTime.now() + duration DispatchQueue.main.asyncAfter(deadline: when) &#123; waitExpectation.fulfill() &#125; // We use a buffer here to avoid flakiness with Timer on CI waitForExpectations(timeout: duration + 0.5) &#125; /// Wait for element to appear func wait(for element: XCUIElement, timeout duration: TimeInterval) &#123; let predicate = NSPredicate(format: \"exists == true\") let _ = expectation(for: predicate, evaluatedWith: element, handler: nil) // We use a buffer here to avoid flakiness with Timer on CI waitForExpectations(timeout: duration + 0.5) &#125;&#125;extension XCUIApplication &#123; // Because of \"Use cached accessibility hierarchy\" func clearCachedStaticTexts() &#123; let _ = staticTexts.count &#125; func clearCachedTextFields() &#123; let _ = textFields.count &#125; func clearCachedTextViews() &#123; let _ = textViews.count &#125;&#125;extension XCUIElement &#123; func deleteAllText() &#123; guard let string = value as? String else &#123; return &#125; let lowerRightCorner = coordinate(withNormalizedOffset: CGVector(dx: 0.9, dy: 0.9)) lowerRightCorner.tap() let deletes = string.characters.map(&#123; _ in XCUIKeyboardKeyDelete &#125;).joined(separator: \"\") typeText(deletes) &#125;&#125; Read moreI found these guides to cover many aspects of UITests, worth taking a look UI-Testing-Cheat-Sheet Everything About Xcode UI Testing","categories":[],"tags":[]},{"title":"Debugging iOS app","slug":"Debugging-iOS-app","date":"2017-05-29T09:10:45.000Z","updated":"2018-05-14T06:59:25.000Z","comments":true,"path":"blog/Debugging-iOS-app/","link":"","permalink":"https://onmyway133.github.io/blog/Debugging-iOS-app/","excerpt":"","text":"Issue #43 UIDebuggingInformationOverlay FLEX An in-app debugging and exploration tool for iOS","categories":[],"tags":[]},{"title":"Some investment stories","slug":"Some-investment-stories","date":"2017-05-24T09:40:41.000Z","updated":"2017-05-24T09:40:41.000Z","comments":true,"path":"blog/Some-investment-stories/","link":"","permalink":"https://onmyway133.github.io/blog/Some-investment-stories/","excerpt":"","text":"Issue #42 We will never know how life will go Apple at 40: Spare a thought for co-founder Ronald Wayne, Steve Jobs‚Äô pal who threw away $62bn Someone in 2010 bought 2 pizzas with 10,000 bitcoins ‚Äî which today would be worth $20 million Facebook Graffiti Artist Could be Worth $500 Million","categories":[],"tags":[]},{"title":"How to use assertionFailure and Optimization Level in iOS","slug":"How-to-use-assertionFailure-and-Optimization-Level-in-iOS","date":"2017-05-23T11:23:16.000Z","updated":"2019-05-23T16:45:25.000Z","comments":true,"path":"blog/How-to-use-assertionFailure-and-Optimization-Level-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-assertionFailure-and-Optimization-Level-in-iOS/","excerpt":"","text":"Issue #39 We used to use assertionFailure to mark programmer error or something that shouldn‚Äôt happen. From assertionFailure Indicates that an internal sanity check failed. Use this function to stop the program, without impacting the performance of shipping code, when control flow is not expected to reach the call‚Äîfor example, in the default case of a switch where you have knowledge that one of the other cases must be satisfied. To protect code from invalid usage in Release builds, see preconditionFailure(_:file:line:). In playgrounds and -Onone builds (the default for Xcode‚Äôs Debug configuration), stop program execution in a debuggable state after printing message. In -O builds, has no effect. In -Ounchecked builds, the optimizer may assume that this function is never called. Failure to satisfy that assumption is a serious programming error. So go to your target settings, and check Optimization Level, make sure it is not -Onone for release configuration. The difference between debug and release is this SWIFT_OPTIMIZATION_LEVEL. If -Onone then your configuration is considered debug, and assertionFailure will crash your apps Read more http://blog.krzyzanowskim.com/2015/03/09/swift-asserts-the-missing-manual/","categories":[],"tags":[]},{"title":"How to perform platform check with typealias and @available","slug":"How-to-perform-platform-check-with-typealias-and-@available","date":"2017-05-17T20:25:59.000Z","updated":"2019-05-23T16:45:31.000Z","comments":true,"path":"blog/How-to-perform-platform-check-with-typealias-and-@available/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-perform-platform-check-with-typealias-and-@available/","excerpt":"","text":"Issue #38 The other day, I was building Anchors which needs to support iOS and macOS. What‚Äôs clever way to not use #if os(iOS) || os(tvOS) in all files? Use typealias This is the first version. I‚Äôm trying to support iOS 8, macOS 10.10 12345678910#if os(iOS) || os(tvOS) import UIKit public typealias View = UIView public typealias LayoutGuide = UILayoutGuide public typealias EdgeInsets = UIEdgeInsets#elseif os(OSX) import AppKit public typealias View = NSView public typealias LayoutGuide = NSLayoutGuide#endif But then because of LayoutGuide, I need to bump deployment target to iOS 9, macOS 10.11. Which is not what I want. @available to the rescue, but it will affect everything below it. The solution is to split the platform check, the first as normal, the second with @available check 123456789101112131415161718#if os(iOS) || os(tvOS) import UIKit public typealias View = UIView public typealias EdgeInsets = UIEdgeInsets#elseif os(OSX) import AppKit public typealias View = NSView#endif#if os(iOS) || os(tvOS) import UIKit @available(iOS 9.0, *) public typealias LayoutGuide = UILayoutGuide#elseif os(OSX) import AppKit @available(macOS 10.11, *) public typealias LayoutGuide = NSLayoutGuide#endif","categories":[],"tags":[]},{"title":"How to use Controller and View in iOS","slug":"How-to-use-Controller-and-View-in-iOS","date":"2017-05-12T05:37:48.000Z","updated":"2019-05-23T16:45:07.000Z","comments":true,"path":"blog/How-to-use-Controller-and-View-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-Controller-and-View-in-iOS/","excerpt":"","text":"Issue #37 I like to write UI in code, and with Auto Layout, it is an easy task. However that leaves ViewController with a lots of code. One way we can do is to separate V from C in MVC, by using a dedicated view We can do that with generic, that initialises a view and replace the view, let‚Äôs call it root 123456789import UIKitclass BaseController&lt;T: UIView&gt;: UIViewController &#123; let root = T() override func loadView() &#123; view = root &#125;&#125; Now we can have a UIView subclass, like LoginView 123456789101112131415161718192021222324252627282930313233343536final class LoginView: UIView &#123; lazy var textField: UITextField = UITextField().then &#123; $0.textAlignment = .center $0.borderStyle = .roundedRect $0.keyboardType = .phonePad &#125; lazy var button: UIButton = UIButton().then &#123; $0.setTitleColor(.black, for: .normal) $0.backgroundColor = .lightGray &#125; override init(frame: CGRect) &#123; super.init(frame: frame) addSubviews( textField, button ) Constraint.on( textField.centerXAnchor.constraint(equalTo: textField.superview!.centerXAnchor), textField.centerYAnchor.constraint(equalTo: textField.superview!.centerYAnchor), textField.widthAnchor.constraint(equalTo: textField.superview!.widthAnchor, constant: -20), button.topAnchor.constraint(equalTo: textField.bottomAnchor, constant: 20), button.centerXAnchor.constraint(equalTo: button.superview!.centerXAnchor), button.widthAnchor.constraint(equalTo: textField.widthAnchor, multiplier: 0.8), button.heightAnchor.constraint(equalToConstant: 44) ) &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError() &#125;&#125; And then the LoginController 1234567891011121314151617181920final class LoginController: BaseController&lt;LoginView&gt; &#123; override func viewDidLoad() &#123; super.viewDidLoad() view.backgroundColor = .white let gr = UITapGestureRecognizer(target: self, action: #selector(viewTapped)) root.addGestureRecognizer(gr) root.button.setTitle(\"Login\", for: .normal) root.button.addTarget(self, action: #selector(loginButtonTouched), for: .touchUpInside) root.button.isEnabled = false root.button.showsTouchWhenHighlighted = true root.textField.placeholder = \"Phone number\" root.textField.delegate = self root.textField.text = dependencyContainer.phoneService.prefix root.textField.addTarget(self, action: #selector(textFieldDidChange), for: .editingChanged) &#125;&#125; And this is how we declare the LoginController 12let loginController = LoginController()navigationController.viewControllers = [loginController]","categories":[],"tags":[]},{"title":"How to use MainController in iOS","slug":"How-to-use-MainController-in-iOS","date":"2017-05-12T05:37:42.000Z","updated":"2019-05-12T18:57:58.000Z","comments":true,"path":"blog/How-to-use-MainController-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-MainController-in-iOS/","excerpt":"","text":"Issue #36 Usually in an app, we have these flows: onboarding, login, main. And we usually set OnboardingController, LoginController and MainController as the root view controller respectively depending on the state. I find it useful to have the MainController as the container for main flow. It can be a tab controller, swipe menu controller or contains just 1 child view controller. The screens are provided by child view controllers, but the MainController does the following jobs Status bar style We usually need to call preferredStatusBarStyle on the parent controller. See https://stackoverflow.com/questions/19022210/preferredstatusbarstyle-isnt-called App did become active Usually when app is brought to foreground, we need to fetch logged in user profile to see if there‚Äôs changes. We do this by listening to app did become active in MainController. Mock to open This can be anti pattern. But in UI Tests, for laziness, we can just use some launch arguments and check to present some specific screens to test, because MainController is the root for main flow. Logout Because things originate from MainController, things can terminate in MainController. We can handle logout, clear states, and tell MainController to tell AppDelegate to switch to another root controller","categories":[],"tags":[]},{"title":"How to handle Auto Layout with different screen sizes","slug":"How-to-handle-Auto-Layout-with-different-screen-sizes","date":"2017-05-12T04:22:18.000Z","updated":"2019-08-22T09:15:04.000Z","comments":true,"path":"blog/How-to-handle-Auto-Layout-with-different-screen-sizes/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-Auto-Layout-with-different-screen-sizes/","excerpt":"","text":"Issue #35 Auto Layout is awesome. Just declare the constraints and the views are resized accordingly to their parent ‚Äòs bounds changes. But sometimes it does not look good, because we have fixed values for padding, width, height, and even fixed font size. Read more How to make Auto Layout more convenient in iOS This can be solved by some degree using Size Class. The idea of size class is that we have many sets of constraints, and based on the device traits, we enabled some of them. This is more convenient to do in Storyboard (although very hard to reason about), but if we‚Äôre doing in code (my prefer way), then it is a lot of code. And a lot of code means a lot of bugs. If you take a look at iOSRes, we see the ratio 16:9 (height:width) iPhone SE (320 x 568): 1.775 iPhone 6 (375 x 667): 1.778 iPhone 6+ (414 x 736): 1.778 They mostly have the same ratio. So we can have a simple approach, that scale elements based on ratio. Given the fact that the designer usually designs for iPhone 6 size, we can make that a base. In this approach, the content will scale up or down depending on its ratio. You may argue that the idea of bigger phone is to display more, not to show the same content bigger. You may be right, in that case you need to create different constraints and different UIs. But if you want simple solutions that work, this is one of them This is the technique I used when doing Windows Phone development, but it applies to many platforms as well Calculate the ratio12345678class Device &#123; // Base width in point, use iPhone 6 static let base: CGFloat = 375 static var ratio: CGFloat &#123; return UIScreen.main.bounds.width / base &#125;&#125; Extension to make it convenientWe can have a computed property called adjusted that adjusts the size based on the ratio 1234567891011121314151617181920extension CGFloat &#123; var adjusted: CGFloat &#123; return self * Device.ratio &#125;&#125;extension Double &#123; var adjusted: CGFloat &#123; return CGFloat(self) * Device.ratio &#125;&#125;extension Int &#123; var adjusted: CGFloat &#123; return CGFloat(self) * Device.ratio &#125;&#125; Use the ratioYou can adjust as much as you want 123456label.font = UIFont.systemFont(ofSize: 23.adjusted)phoneTextField.leftAnchor.constraint(equalTo: container.leftAnchor, constant: 30.adjusted),phoneTextField.rightAnchor.constraint(equalTo: container.rightAnchor, constant: -30.adjusted),imageView.widthAnchor.constraint(equalToConstant: 80.adjusted), imageView.heightAnchor.constraint(equalToConstant: 90.adjusted),","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"NSApplicationDelegate and notification","slug":"NSApplicationDelegate-and-notification","date":"2017-05-10T20:18:22.000Z","updated":"2019-09-10T06:46:52.000Z","comments":true,"path":"blog/NSApplicationDelegate-and-notification/","link":"","permalink":"https://onmyway133.github.io/blog/NSApplicationDelegate-and-notification/","excerpt":"","text":"Issue #34 In an iOS project, we often see this in AppDelegate 12345678910@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123; var window: UIWindow? func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool &#123; return true &#125;&#125; But in a Cocoa project, we see this instead 12345678910111213@NSApplicationMainclass AppDelegate: NSObject, NSApplicationDelegate &#123; func applicationDidFinishLaunching(aNotification: NSNotification) &#123; // Insert code here to initialize your application &#125; func applicationWillTerminate(aNotification: NSNotification) &#123; // Insert code here to tear down your application &#125;&#125; In this case the param is of type NSNotification Delegate and notificationReading Cocoa Core Competencies - Delegation The delegate of most Cocoa framework classes is automatically registered as an observer of notifications posted by the delegating object. The delegate need only implement a notification method declared by the framework class to receive a particular notification message. Following the example above, a window object posts an NSWindowWillCloseNotification to observers but sends a windowShouldClose: message to its delegate. So the pattern is that the delegate should strip the NS and Notification, like NSWindowWillCloseNotification to windowShouldClose:","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Understanding SDK and Deployment Target in iOS","slug":"Understanding-SDK-and-Deployment-Target-in-iOS","date":"2017-05-10T20:18:05.000Z","updated":"2019-05-23T16:42:02.000Z","comments":true,"path":"blog/Understanding-SDK-and-Deployment-Target-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-SDK-and-Deployment-Target-in-iOS/","excerpt":"","text":"Issue #33 I see that my answer to the question What‚Äôs the meaning of Base SDK, iOS deployment target, Target, and Project in xcode gets lots of views, so I think I need to elaborate more about it Good read iOS 7 TechTalk - Architecting Modern Apps, Part 2 Configuring a Project for SDK-Based Development Base SDK We can‚Äôt configure this anymore, as Xcode will use the latest SDK. For Xcode 7, the SDK is iOS 9 If we upgrade Xcode, it will use the newer version of the SDK. Like Xcode 7.2, the SDK is iOS 9.1 Choosing the latest SDK for your project lets you use the new APIs introduced in the OS update that corresponds to that SDK. When new functionality is added as part of a system update, the system update itself does not typically contain updated header files reflecting the change. The SDKs, however, do contain updated header files. Deployment Target We can set in Xcode -&gt; Target -&gt; Deployment Info -&gt; Deployment Target State that we support this iOS version What does it mean So, a modern App might use iOS 9 as the Target SDK, and iOS 7 as the deployment target. This means that you can run on iOS 7, iOS 8 and iOS 9, and that you have available to you any iOS 9 calls when actually running on iOS 9. . Each .sdk directory resembles the directory hierarchy of the operating system release it represents: It has usr, System, and Developer directories at its top level. OS X .sdk directories also contain a Library directory. Each of these directories in turn contains subdirectories with the headers and libraries that are present in the corresponding version of the operating system with Xcode installed. . The libraries in an iOS or OS X SDK are stubs for linking only; they do not contain executable code but just the exported symbols. SDK support works only with native build targets. So the SDK is just like stub and header only. It means that we can use certain APIs, but on OS that does not have the real symbols for those APIs, it crashes availableSwift 2 introduces available construct that guards against failure when trying to use newer APIs. Note that available is runtime, not compile time. All the code is inside your executable 12345if #available(iOS 9, OSX 10.10, *) &#123; // Code to execute on iOS 9, OS X 10.10&#125; else &#123;&#125; deprecated APIs Finding Instances of Deprecated API Usage Always check to see if you are using deprecated APIs; though still available, deprecated APIs are not guaranteed to be available in the future Compile time vs Runtime Conditionally Compiling for Different SDKs 12345#if (arch(i386) || arch(x86_64)) &amp;&amp; os(iOS) // code inside gets inserted into executable when builds for simulator#else // code inside gets inserted into executable when builds for device#endif 12345#if os(OSX) import Cocoa#elseif os(iOS) import UIKit#endif 123456// All the code gets inserted into executable, but is run depending on the version of the OSif #available(iOS 9, *) &#123; // use UIStackView&#125; else &#123; // show your manual Auto Layout skill&#125; Weakly vs strongly linked Weak Linking and Apple Frameworks What does it mean to ‚Äúweak-link‚Äù a framework? Frameworks and Weak Linking For example, suppose in Xcode you set the deployment target (minimum required version) to ‚ÄúOS X v10.5‚Äù and the base SDK (maximum allowed version) to ‚ÄúOS X v10.6‚Äù. During compilation, the compiler would weakly link interfaces that were introduced in OS X v10.6 while strongly linking interfaces defined in earlier versions of the OS. This would allow your application to run in OS X v10.5 and take advantage of newer features when available. . None of the (platform) frameworks is really ‚Äúincluded in the bundle‚Äù. Instead, your app has a reference (‚Äúlink‚Äù) to a framework once you add it to the ‚ÄúLink Binary with Library‚Äù build phase. The frameworks are pre-installed on the devices. When you run an app, all the app‚Äôs framework references are resolved by the dynamic linker (on the device), which means the framework code is loaded so your app can use it. Reference Checking API Availability With Swift","categories":[],"tags":[]},{"title":"App backed by website in iOS 9","slug":"App-backed-by-website-in-iOS-9","date":"2017-05-10T20:17:28.000Z","updated":"2017-05-10T20:17:28.000Z","comments":true,"path":"blog/App-backed-by-website-in-iOS-9/","link":"","permalink":"https://onmyway133.github.io/blog/App-backed-by-website-in-iOS-9/","excerpt":"","text":"Issue #32 iOS 9 introduces new ways for your app to work better, backed by your websites Smart App Banners Promoting Apps with Smart App Banners If the app is already installed on a user‚Äôs device, the banner intelligently changes its action, and tapping the banner will simply open the app. If the user doesn‚Äôt have your app on his device, tapping on the banner will take him to the app‚Äôs entry in the App Store To add a Smart App Banner to your website, include the following meta tag in the head of each page where you‚Äôd like the banner to appear: 1&lt;meta name=&quot;apple-itunes-app&quot; content=&quot;app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL&quot;&gt; Universal Links Support Universal Links When you support universal links, iOS 9 users can tap a link to your website and get seamlessly redirected to your installed app without going through Safari. If your app isn‚Äôt installed, tapping a link to your website opens your website in Safari. Web Markup Mark Up Web Content If some or all of your app‚Äôs content is also available on your website, you can use web markup to give users access to your content in search results. Using web markup lets the Applebot web crawler index your content in Apple‚Äôs server-side index, which makes it available to all iOS users in Spotlight and Safari search results. Shared Web Credentials Shared Web Credentials Reference Shared web credentials is a programming interface that enables native iOS apps to share credentials with their website counterparts. For example, a user may log in to a website in Safari, entering a user name and password, and save those credentials using the iCloud Keychain. Later, the user may run a native app from the same developer, and instead of the app requiring the user to reenter a user name and password, shared web credentials gives it access to the credentials that were entered earlier in Safari. Reference WWDC 2015 Session 509 Seamless Linking to Your App Integrating your Site and your iOS App","categories":[],"tags":[]},{"title":"Disingenuousness","slug":"Disingenuousness","date":"2017-05-10T20:17:08.000Z","updated":"2017-05-10T20:17:08.000Z","comments":true,"path":"blog/Disingenuousness/","link":"","permalink":"https://onmyway133.github.io/blog/Disingenuousness/","excerpt":"","text":"Issue #31 I‚Äôm very happy to be on open source movement, and it ‚Äòll be great to hear about what people have achieved Open source in 2015: A year of growth Introducing the Open Source Hub Open Source at Apple Emerging Best Practices ‚Ä¢ Ash Furrow And @merowing_ also mentioned in Writing Xcode plugin in Swift Attribution Writing this was much simpler because I was able to look at other people plugins, mostly those related to console, without them being open sourcing it would be more work to figure this stuff out with hopper. Open source helps us move forward, learn and share together The dark side of the Force Star Wars: Episode V - The Empire Strikes Back Luke: Is the dark side stronger? Yoda: No, no, no. Quicker, easier, more seductive. It‚Äôs a pain to see plagiarism around Open Source Plagiarism Imitation is the sincerest form of flattery Restore original licenses Open source softwares are in fact intellectual properties, and the authors should get acknowledgement for the work that they do. It‚Äôs not fair to take the credit of other‚Äôs work and not giving any attribution By its nature, open source software has a unique relationship with intellectual property rights One thing that‚Äôs not up for debate in most circles is that it‚Äôs dishonest and disingenuous to take someone else‚Äôs project, modify it slightly, and call it your own. Further, regardless of whether or not a project crosses that line, it must (by the terms of most open source licenses) acknowledge the original work/author. And the reaction Attribute Original Author Open Source Plagiarism DMCA takedown on repos that rip off Async @theandreamazz It‚Äôs always sad to see blatant plagiarism, and I think it really hurts the community more than the author itself. It gives people a good reason to keep the sources private. Being niceI often hear people say that It is easier to find good developer than developer with good attitude Building Online Communities Being Polite in Open Source MINSWAN for iOS Github also states that We understand and agree that copying others‚Äô work without permission goes against the spirit of the open source community Do the right things Licenses for OSS Code How do I properly credit an original code‚Äôs developer for her open source contribution? Is it MIT ‚Äòs fault? Definitely no @TProphet False choice. Giving up freedom does not lead to more security, just less freedom. Takeaways Don‚Äôt take things personally It‚Äôs hard to be perfect, but we can learn to do the right things We may do the wrong things, but don‚Äôt worry, there ‚Äòll be help via Issues and Pull Requests","categories":[],"tags":[]},{"title":"How to do curry in Swift","slug":"How-to-do-curry-in-Swift","date":"2017-05-10T20:16:51.000Z","updated":"2019-05-23T16:41:47.000Z","comments":true,"path":"blog/How-to-do-curry-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-curry-in-Swift/","excerpt":"","text":"Issue #30 Haskell is notorious for currying, and Swift has currying, too I love ReactiveCocoa, RxSwift and I always take time to dig into it. The other day, I was practise making Signal based on this talk UIKonf 2015 - Jens Ravens: Functional Reactive Programming without Black Magic Take a look at my repo Signal filterI was making a filter for a Signal. The idea of filter is that we should update signal if the Event is Next with right filtered value Signal.swift 12345678910111213public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt;&#123; let signal = Signal&lt;T&gt;() subscribe &#123; result in switch(result) &#123; case let .Success(value): if f(value) &#123; signal.update(result) &#125; case let .Error(error): signal.update(.Error(error)) &#125; &#125; return signal&#125; 2 paramsBut having Event as another monad, I think it should be more encapsulated if that switching logic gets moved into the Event. Here the filter takes 2 params Event.swift 12345678910func filter(f: T -&gt; Bool, callback: (Event&lt;T&gt; -&gt; Void)) &#123; switch self &#123; case let .Next(value) where f(value): callback(self) case .Failed: callback(self) default: break &#125;&#125; Signal.swift 123456789public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; &#123; let signal = Signal&lt;T&gt;() subscribe &#123; event in event.filter(f, callback: signal.update) &#125; return signal&#125; CurryingWith currying, we can make filter a more abstract function, and defer the decision to pass the callback param. It is a little carried away but I find it helpful this way Now filter accepts 1 param, and it returns a function that takes callback as its param Event.swift 123456789101112func filter(f: T -&gt; Bool) -&gt; ((Event&lt;T&gt; -&gt; Void) -&gt; Void) &#123; return &#123; g in switch self &#123; case let .Next(value) where f(value): g(self) case .Failed: g(self) default: break &#125; &#125; &#125; Signal.swift 123456789public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; &#123; let signal = Signal&lt;T&gt;() subscribe &#123; event in event.filter(f)(signal.update) &#125; return signal &#125; Curry syntax in Swift 2Swift 2 supports curry syntax function 1234567func sum(a: Int)(b: Int) -&gt; Int &#123; return a + b&#125;let sumWith5 = sum(5)let result = sumWith5(b: 10) No more curry syntax in Swift 3You may want to find out Bidding farewell to currying Reference Higher order functions What is the advantage of currying? Practical use of curried functions? Introduction to Function Currying in Swift Swift Function Currying","categories":[],"tags":[]},{"title":"How to use push notification in iOS","slug":"How-to-use-push-notification-in-iOS","date":"2017-05-10T20:15:51.000Z","updated":"2019-05-23T16:41:36.000Z","comments":true,"path":"blog/How-to-use-push-notification-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-use-push-notification-in-iOS/","excerpt":"","text":"Issue #29 Here are my notes for working with Push Notification, updated for iOS 9 How to register Register to receive push notification registerForRemoteNotificationTypes is deprecated in iOS 8+ 1UIApplication.sharedApplication().registerForRemoteNotifications() Register to alert user through UI If your app displays alerts, play sounds, or badges its icon, you must call this method during your launch cycle to request permission to alert the user in these ways 12345let types: UIUserNotificationType = [.Badge, .Sound, .Alert]let categories = Set&lt;UIUserNotificationCategory&gt;()let settings = UIUserNotificationSettings(forTypes: types, categories: categories)UIApplication.sharedApplication().registerUserNotificationSettings(settings) You don‚Äôt need to wait for registerUserNotificationSettings to callback before calling registerForRemoteNotifications When to register Registering, Scheduling, and Handling User Notifications Never cache a device token; always get the token from the system whenever you need it. If your app previously registered for remote notifications, calling the registerForRemoteNotifications method again does not incur any additional overhead, and iOS returns the existing device token to your app delegate immediately. In addition, iOS calls your delegate method any time the device token changes, not just in response to your app registering or re-registering The user can change the notification settings for your app at any time using the Settings app. Because settings can change, always call the registerUserNotificationSettings: at launch time and use the application:didRegisterUserNotificationSettings: method to get the response. If the user disallows specific notification types, avoid using those types when configuring local and remote notifications for your app. didReceiveRemoteNotificationAbout application:didReceiveRemoteNotification: Implement the application:didReceiveRemoteNotification:fetchCompletionHandler: method instead of this one whenever possible. If your delegate implements both methods, the app object calls the application:didReceiveRemoteNotification:fetchCompletionHandler: method. If the app is not running when a remote notification arrives, the method launches the app and provides the appropriate information in the launch options dictionary. The app does not call this method to handle that remote notification. Instead, your implementation of the application:willFinishLaunchingWithOptions: or application:didFinishLaunchingWithOptions: method needs to get the remote notification payload data and respond appropriately. About application:didReceiveRemoteNotification:fetchCompletionHandler: This is for silent push notification with content-available Unlike the application:didReceiveRemoteNotification: method, which is called only when your app is running in the foreground, the system calls this method when your app is running in the foreground or background In addition, if you enabled the remote notifications background mode, the system launches your app (or wakes it from the suspended state) and puts it in the background state when a push notification arrives. However, the system does not automatically launch your app if the user has force-quit it. In that situation, the user must relaunch your app or restart the device before the system attempts to launch your app automatically again. If the user opens your app from the system-displayed alert, the system may call this method again when your app is about to enter the foreground so that you can update your user interface and display information pertaining to the notification. How to handleUsually, the use of push notification is to display a specific article, a specific DetailViewController, ‚Ä¶ in your app. So the good practices are When the app is in foreground: Gently display some kind of alert view and ask the user whether he would like to go to that specific page or not When user is brought from background to foreground, or from terminated to foreground: Just navigate to that specific page. For example, if you use UINavigationController, you can set that specific page the top most ViewController, if you use UITabBarController, you can set that specific page the selected tab, something like that 1234567891011- func handlePushNotification(userInfo: NSDictionary) &#123; // Check applicationState if (applicationState == UIApplicationStateActive) &#123; // Application is running in foreground showAlertForPushNotification(userInfo) &#125; else if (applicationState == UIApplicationStateBackground || applicationState == UIApplicationStateInactive) &#123; // Application is brought from background or launched after terminated handlePushNotification(userInfo) &#125;&#125; Here we create another method `handlePushNotification:`` to handle push notification. When you receive push notification, 3 cases can occur Case 1: ForegroundLoud push No system alert application:didReceiveRemoteNotification:fetchCompletionHandler: called Silent push No system alert application:didReceiveRemoteNotification:fetchCompletionHandler: called Case 2: BackgroundLoud push System alert No method called Tap notification and application:didReceiveRemoteNotification:fetchCompletionHandler: called Tap on App Icon and nothing is called Silent push System alert application:didReceiveRemoteNotification:fetchCompletionHandler: called. If app is suspended, its state changed to UIApplicationStateBackground Tap notification and application:didReceiveRemoteNotification:fetchCompletionHandler: called Tap on App Icon and nothing is called Case 3: TerminatedLoud push System alert No method called Tap notification and application:didFinishLaunchingWithOptions: with launchOptions, application:didReceiveRemoteNotification:fetchCompletionHandler: called Tap on App Icon and application:didFinishLaunchingWithOptions: is called with launchOptions set to nil Silent push System alert application:didReceiveRemoteNotification:fetchCompletionHandler: called. If app was not killed by user, it is woke up and state changed to UIApplicationStateInactive. Tap notification and application:didFinishLaunchingWithOptions: with launchOptions, application:didReceiveRemoteNotification:fetchCompletionHandler: called Tap on App Icon and application:didFinishLaunchingWithOptions: is called with launchOptions set to nil System alertSystem alert only show if the payload contains ‚Äúalert‚Äù 123456789101112&#123; \"aps\" : &#123; \"alert\" : &#123; \"title\" : \"Game Request\", \"body\" : \"Bob wants to play poker\", \"action-loc-key\" : \"PLAY\" &#125;, \"badge\" : 5 &#125;, \"param1\" : \"bar\", \"param2\" : [ \"bang\", \"whiz\" ]&#125; Silent push payloadFor now I see that silent push must contain ‚Äúsound‚Äù for application:didReceiveRemoteNotification:fetchCompletionHandler: to be called when app is in background 123456789&#123; \"aps\": &#123; \"content-available\": 1, \"alert\": \"hello\" // include this if we want to show alert \"sound\": \"\" // this does the trick &#125;, \"param1\": 1, \"param2\": \"text\"&#125; Reference Scheduling, Registering, and Handling Notifications Handle push notifications when arrived in ios application How to respond to push notification view if app is already running in the background didReceiveRemoteNotification when in background How to handle remote notification with background mode enabled Remote notification method called twice","categories":[],"tags":[]},{"title":"Understanding push and pull signal in reactive paradigm","slug":"Understanding-push-and-pull-signal-in-reactive-paradigm","date":"2017-05-10T20:15:27.000Z","updated":"2019-05-23T16:41:16.000Z","comments":true,"path":"blog/Understanding-push-and-pull-signal-in-reactive-paradigm/","link":"","permalink":"https://onmyway133.github.io/blog/Understanding-push-and-pull-signal-in-reactive-paradigm/","excerpt":"","text":"Issue #28 The idea of Signal may originate from Elm Reactivity, and it has now been widely adopted in iOS I once asked What are examples of hot and cold signal in ReactiveCocoa? When to use IEnumerable vs IObservable? [ReactiveCocoa Framework Overview](Framework Overview) Rx ‚Äì for beginners (part 9): Hot Vs. Cold observable RxSwift Hot and Cold Observables Whether it is hot vs cold, Signal vs Signal Producer, Observable vs Enumerable, ‚Ä¶ it‚Äôs good to understand how it gets implemented, so that to have a good sense of how they work Monad Understanding Monad Basically, Signal and its Result are just monads, which are thing that can be mapped and chained. Signal makes use of deferred execution callback blocks, and push vs pull is just how the Signal updates its value and the order the callbacks are called Execution callback block is that we pass a function to another function, and it will get called when appropriated Sync vs AsyncMonad can be in either sync or async mode. Sync is easier to understand, but async is somewhat you‚Äôre already familiar and used in practice Basically, Sync: you get the returned value right away via return Aync: you get the returned value via callback block Here is an example of a simple function 123456789101112// Syncfunc sum(a: Int, b: Int) -&gt; Int &#123; return a + b&#125;// Asyncfunc sum(a: Int, b: Int, completion: Int -&gt; Void) &#123; // Assumed it is a very long task to get the result let result = a + b completion(result)&#125; Here is an example of Event 1234567891011121314151617181920212223// Syncpublic func map&lt;U&gt;(@noescape f: T -&gt; U) -&gt; Event&lt;U&gt; &#123; switch self &#123; case let .Next(value): return .Next(value: f(value)) case let .Failed(error): return .Failed(error: error) &#125;&#125;// Asyncpublic func map&lt;U&gt;(f: (T, U -&gt; Void) -&gt; Void) -&gt; ((Event&lt;U&gt; -&gt; Void) -&gt; Void) &#123; return &#123; g in // g: Event&lt;U&gt; -&gt; Void switch self &#123; case let .Next(value): f(value) &#123; transformedValue in // transformedValue: U g(.Next(value: transformedValue)) &#125; case let .Failed(error): g(.Failed(error: error)) &#125; &#125; &#125; Push Signal Signal.swift UIKonf 2015 - Jens Ravens: Functional Reactive Programming without Black Magic Take a look at my Push Signal, called Signal, it is like how Promise A+ Then works Implementation12345678910111213141516171819202122232425262728293031323334353637383940414243public final class Signal&lt;T&gt; &#123; var event: Event&lt;T&gt;? var callbacks: [Event&lt;T&gt; -&gt; Void] = [] func notify() &#123; guard let event = event else &#123; return &#125; callbacks.forEach &#123; callback in callback(event) &#125; &#125; func update(event event: Event&lt;T&gt;) &#123; dispatch_sync(lockQueue) &#123; self.event = event &#125; notify() &#125; public func subscribe(f: Event&lt;T&gt; -&gt; Void) -&gt; Signal&lt;T&gt; &#123; // Callback if let event = event &#123; f(event) &#125; callbacks.append(f) return self &#125; public func map&lt;U&gt;(f: T -&gt; U) -&gt; Signal&lt;U&gt; &#123; let signal = Signal&lt;U&gt;() subscribe &#123; event in signal.update(event: event.map(f)) &#125; return signal &#125;&#125; Usage12345678910111213let signal = Signal&lt;String&gt;()signal.map &#123; value in return value.characters.count &#125;.subscribe &#123; event in if case let .Next(value) = event &#123; XCTAssert(value == 4) &#125; else &#123; XCTAssert(false) &#125;&#125;signal.sendNext(\"test\") CallbacksGiven a chained signals like this A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe) The idea is we send event to the source signal, and it propagates events through via callbacks. Triggered by sending event to the source signal. We must keep A as it keeps the others around We subscribe the last D We send event to the first A A ‚Äòs callback gets called, it it in turn calls callback of B with the result of A ‚Äòs map, then B ‚Äòs callback calls C ‚Äòs callback with the result of B‚Äòs flatMap, ‚Ä¶ Pull Signal Future.swift Swift Sync and Async Error Handling - iOS Conf SG 2015 Take a look at my Pull Signal, called Future ImplementationHere operation is a task, when called and completed, will notify its completion 123456789101112131415161718192021public struct Future&lt;T&gt; &#123; let operation: (Event&lt;T&gt; -&gt; Void) -&gt; Void public init(operation: (Event&lt;T&gt; -&gt; Void) -&gt; Void) &#123; self.operation = operation &#125; public func start(completion: Event&lt;T&gt; -&gt; Void) &#123; operation() &#123; event in completion(event) &#125; &#125; public func map&lt;U&gt;(f: T -&gt; U) -&gt; Future&lt;U&gt; &#123; return Future&lt;U&gt; &#123; completion in self.start &#123; event in completion(event.map(f)) &#125; &#125; &#125;&#125; Usage12345678910111213let _ = Future&lt;String&gt; &#123; completion in // There is some work here completion(Event(value: &quot;test&quot;)) &#125; .map &#123; value in value.characters.count &#125;.start &#123; event in if case let .Next(value) = event &#123; XCTAssert(value == 4) &#125; else &#123; XCTAssert(false) &#125; &#125; CallbacksGiven a chained signals like this A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe) The idea is we subscribe to the final signal D, and it cause the previous signals to action. Triggered by subscribing to the final signal. We must keep D as it keeps the others around We subscribe the last D D ‚Äòs operation actions, and it cause C ‚Äòs operation to action, ‚Ä¶ then A ‚Äòs operation actions. It is in A that the task is performed (like fetching network, retrieving database, file access, heavy computation, ‚Ä¶) to get the result, and A ‚Äòs completion gets called. Then A‚Äôs completion calls B ‚Äòs completion with the result mapped by B ‚Äòs map, ‚Ä¶ all the way to the subscriber ‚Äòs completion block","categories":[],"tags":[]},{"title":"How to make iOS Stretchy Header with Auto Layout","slug":"How-to-make-iOS-Stretchy-Header-with-Auto-Layout","date":"2017-05-10T20:12:10.000Z","updated":"2019-05-23T16:40:54.000Z","comments":true,"path":"blog/How-to-make-iOS-Stretchy-Header-with-Auto-Layout/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-iOS-Stretchy-Header-with-Auto-Layout/","excerpt":"","text":"Issue #27 Stretchy header is cool. People are familiar with changing frames to achieve this, like Design Teardown: Stretchy Headers. But with Auto Layout, we can achieve this with much nicer declarative constraints The demo project is StretchyHeader I use SnapKit to make it clear what constraints we need scrollViewThe scrollView should pin its 4 edges to the ViewController &#39;s view 123456789func setupScrollView() &#123; scrollView = UIScrollView() scrollView.delegate = self view.addSubview(scrollView) scrollView.snp_makeConstraints &#123; make in make.edges.equalTo(view) &#125; &#125; scrollViewContentViewThe scrollViewContentView must pin its 4 edges to the scrollView to help determine scrollView contentSize The height of scrollViewContentView is determined by its subviews. The subviews inside must pin their top and bottom to the scrollViewContentView 123456789func setupScrollViewContentView() &#123; scrollViewContentView = UIView() scrollView.addSubview(scrollViewContentView) scrollViewContentView.snp_makeConstraints &#123; make in make.edges.equalTo(scrollView) make.width.equalTo(view.snp_width) &#125; &#125; headerThe header must pin its top to the scrollView parent, which is the ViewController &#39;s view Read the title section, you ‚Äòll see that in order to make header stretchy, it must be pinned top and bottom But if we scroll up, there will be a constraint conflict between these pinned top and bottom constraints So we must declare headerTopConstraint priority as 999, and headerLessThanTopConstraint 12345678910111213func setupHeader() &#123; header = UIImageView() header.image = UIImage(named: \"onepiece\")! scrollViewContentView.addSubview(header) header.snp_makeConstraints &#123; make in // Pin header to scrollView 's parent, which is now ViewController 's view // When header is moved up, headerTopConstraint is not enough, so make its priority 999, and add another less than or equal constraint make.leading.trailing.equalTo(scrollViewContentView) self.headerTopConstraint = make.top.equalTo(view.snp_top).priority(999).constraint self.headerLessThanTopConstraint = make.top.lessThanOrEqualTo(view.snp_top).constraint &#125; &#125; titleThe title must pin its top to the scrollViewContentView to help determine scrollViewContentView height The title must also pin its top the header bottom in order to make header stretchy 12345678910111213141516func setupTitleLabel() &#123; titleLabel = UILabel() titleLabel.numberOfLines = 0 titleLabel.font = UIFont.preferredFontForTextStyle(UIFontTextStyleTitle1) titleLabel.text = \"One Piece\" scrollViewContentView.addSubview(titleLabel) titleLabel.snp_makeConstraints &#123; make in make.leading.equalTo(scrollViewContentView).offset(20) make.trailing.equalTo(scrollViewContentView).offset(-20) // Pin to the header to make it stretchy make.top.equalTo(header.snp_bottom).offset(20) // Pin to the content view to help determine scrollView contentSize make.top.equalTo(scrollViewContentView.snp_top).offset(headerHeight) &#125; &#125; scrollViewDidScrollThe header is always pinned to the top, unless you adjust it, here in scrollViewDidScroll Here I use Constraint, which is a class from SnapKit, but the idea is to change the constant of the NSLayoutConstraint 12345678910111213func scrollViewDidScroll(scrollView: UIScrollView) &#123; guard let headerTopConstraint = headerTopConstraint, headerLessThanTopConstraint = headerLessThanTopConstraint else &#123; return &#125; let y = scrollView.contentOffset.y let offset = y &gt; 0 ? -y : 0 headerLessThanTopConstraint.updateOffset(offset) headerTopConstraint.updateOffset(offset) &#125; By the way, did you just learn the story of One Piece :] Reference Creating parallax effect on UIScrollView using constraints ScrollviewParallax","categories":[],"tags":[]},{"title":"How to group digits in Swift","slug":"How-to-group-digits-in-Swift","date":"2017-05-10T20:10:30.000Z","updated":"2019-10-31T11:23:30.000Z","comments":true,"path":"blog/How-to-group-digits-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-group-digits-in-Swift/","excerpt":"","text":"Issue #26 When working on Scale I think it‚Äôs good to have a way to group the digit so that it is easier to reason Luckily, Swift already supports this. See The Swift Programming Language - Numeric Literals Numeric literals can contain extra formatting to make them easier to read. Both integers and floats can be padded with extra zeros and can contain underscores to help with readability. Neither type of formatting affects the underlying value of the literal 123let paddedDouble = 000123.456let oneMillion = 1_000_000let justOverOneMillion = 1_000_000.000_000_1 Talking about grouping digits after the decimal point, it is interesting too Convention of digit grouping after decimal point So now we have 12345678910111213141516171819public enum MetricUnit: Double &#123; case nano = 0.000_000_001 case micro = 0.000_001 case milli = 0.001 case centi = 0.01 case deci = 0.1 case base = 1 case deka = 10 case hecto = 100 case kilo = 1_000 case mega = 1_000_000 case giga = 1_000_000_000 case tera = 1_000_000_000_000 case peta = 1_000_000_000_000_000 static var defaultScale: Double &#123; return MetricUnit.base.rawValue &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"How to make a simple resolver in Swift","slug":"How-to-make-a-simple-resolver-in-Swift","date":"2017-05-10T20:09:27.000Z","updated":"2019-05-23T16:40:30.000Z","comments":true,"path":"blog/How-to-make-a-simple-resolver-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-a-simple-resolver-in-Swift/","excerpt":"","text":"Issue #25 The Marvel worldAnt ManWe know Ant Man is Hank Pym 1234567891011121314struct AntManSuit &#123; let name: String&#125;struct HankPym &#123; let suit = AntManSuit(name: \"Ant Man ID #101\") func fight() &#123; print(\"Fighting with the suit named \" + suit.name) &#125;&#125;let hankPym = HankPym()hankPym.fight() Everytime HankPym is created, he always uses the Ant Man suit. This time he is so coupled to the role Ant Man More suitsWell, he does not have to be too dependent on the Ant Man suit. We know Hank Pym is a genius scientist, he has more suits to use. Let‚Äôs make it decoupled Using Dependency Injection 1234567891011121314151617181920212223protocol Suit &#123; var name: String &#123; get &#125;&#125;struct AntManSuit: Suit &#123; let name: String&#125;struct YellowJacketSuit: Suit &#123; let name: String&#125;struct HankPym &#123; let suit: Suit func fight() &#123; print(\"Fighting with the suit named \" + suit.name) &#125;&#125;let suit = YellowJacketSuit(name: \"Yellow Jacket ID #33\")let hankPym = HankPym(suit: suit)hankPym.fight() Now Hank Pym can be more flexible on which suit to use. Dependency InjectionThe technique we just saw is called Dependency Injection, in which Hank Pym does not need to create the Suit, it will be provided through constructor or property. Dependency Inversion PrincipleIn the first example, Hank Pym is dependent on the concrete implementation of the Suit In the second example, both Hank Pym and the suits are dependent on the Suit protocol. This way Hank Pym only knows about the Suit protocol, and future suits must be crafted to that it conforms to the Suit protocol This way the dependency is inverted High level modules should not depend upon low level modules. Both should depend upon abstractions. What is the high level policy? It is the abstractions that underlie the application, thetruths that do not vary when the details are changed Inversion of Control ContainerYou may ask yourself Why is Inversion of Control named that way? Framework vs libraryPeople said ‚Äúthe framework calls you but you call the library‚Äù Command line vs GUISee What is Inversion of Control? For example, in an old school menu, you might have: 123456print &quot;enter your name&quot;read nameprint &quot;enter your address&quot;read addressetc...store in database thereby controlling the flow of user interaction. In a GUI program or some such, instead we say 123when the user types in field a, store it in NAMEwhen the user types in field b, store it in ADDRESSwhen the user clicks the save button, call StoreInDatabase You how have a brief understanding of how IoC means IoC containerIn the 2nd example of the Suit protocol, you can see how there is a inversion of control. What if there is a container that contains all the Suit conformances? Let‚Äôs use my Resolver 1234567let resolver = Resolver()resolver.register &#123; YellowJacketSuit(name: \"YellowJacket ID #404\") as Suit&#125;let suit = try! resolver.resolve() as Suitlet hankPym = HankPym(suit: suit) Quite helpful, right? :] FeaturesActually, IoC container helps you more than that. Circular Dependency Injection Auto Injection Object Scope ‚Ä¶ There are some IoC containers in Swift Swinject12345let container = Container()container.register(AnimalType.self) &#123; _ in Cat(name: \"Mimi\") &#125;container.register(PersonType.self) &#123; r in PetOwner(pet: r.resolve(AnimalType.self)!)&#125; Swinject requires explicit type declaration. It has SwinjectStoryboard, which helps configuring the dependency for your view controller DipDip leverages generic and encourage protocols 12container.register &#123; ServiceImp() as Service &#125;let service = try! container.resolve() as Service You ‚Äòll learn a lot just by reading Dip source code, on how factory and factory type are stored and checked using generic 1234567891011public func resolve&lt;T, F&gt;(tag tag: Tag? = nil, builder: F-&gt;T) throws -&gt; T &#123; let key = DefinitionKey(protocolType: T.self, factoryType: F.self, associatedTag: tag) let nilTagKey = tag.map &#123; _ in DefinitionKey(protocolType: T.self, factoryType: F.self, associatedTag: nil) &#125; guard let definition = (self.definitions[key] ?? self.definitions[nilTagKey]) as? DefinitionOf&lt;T, F&gt; else &#123; throw DipError.DefinitionNotFound(key) &#125; let usingKey: DefinitionKey? = definition.scope == .ObjectGraph ? key : nil return _resolve(tag, key: usingKey, definition: definition, builder: builder) &#125; Build your own simple IoC containerYou may have discovered, that the idea of all those framework is to use closure as factory method 12345let factory = &#123; YellowJacketSuit(name: \"YellowJacket ID #007\") as Suit&#125;let suit = factory() All we have to do is to store these factories closure Take a look at my gist SimpleResolver.swift 1234567891011121314151617181920212223242526class SimpleResolver &#123; var factories = [String: Any]() func factory&lt;T&gt;(factory: () -&gt; T) &#123; let key = String(T.self) factories[key] = factory &#125; func resolve&lt;T&gt;() -&gt; T &#123; let key = String(T.self) if let factory = factories[key] as? () -&gt; T &#123; return factory() &#125; else &#123; fatalError(\"Registration not found\") &#125; &#125;&#125;let resolver = SimpleResolver()resolver.factory &#123; YellowJacketSuit(name: \"YellowJacket IS #009\") as Suit&#125;let suit = resolver.resolve() as Suitprint(suit.name) Reference Dependency Injection Framework for Swift - Introduction to Swinject IoC container in Swift swift-ioc Dip Typhoon","categories":[],"tags":[]},{"title":"How to make lighter AppDelegate in iOS","slug":"How-to-make-lighter-AppDelegate-in-iOS","date":"2017-05-10T20:08:46.000Z","updated":"2019-09-13T08:17:19.000Z","comments":true,"path":"blog/How-to-make-lighter-AppDelegate-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-make-lighter-AppDelegate-in-iOS/","excerpt":"","text":"Issue #24 There is Lighter View Controllers, and there is Lighter AppDelegate, too Since working with iOS, I really like the delegate pattern, in which it helps us defer the decision to another party. The iOS application delegates its event to AppDelegate, which over time will be a big mess. Usually, the AppDelegate is where you put your root view controller setup, crash tracking, push notification, debugging, ‚Ä¶ and we just somehow violent the Single Responsibility principle. Moreover, it makes us hard to reason about code in AppDelegate ServiceI like to think of each task in AppDelegate as a service. And the AppDelegate distributes the events into each service via ServiceDispatcher. Simple plain old composition and looping I tend to have RootService as a place to setup root view controllers It looks like this ServiceDispatcher.swift 1234567891011121314151617181920212223242526272829303132333435363738394041class ServiceDispatcher : NSObject, UIApplicationDelegate &#123; let services: [UIApplicationDelegate] init(services: [UIApplicationDelegate]) &#123; self.services = services &#125; func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject : AnyObject]?) -&gt; Bool &#123; services.forEach &#123; service in service.application?(application, didFinishLaunchingWithOptions: launchOptions) &#125; return true &#125; func applicationDidBecomeActive(application: UIApplication) &#123; services.forEach &#123; service in service.applicationDidBecomeActive?(application) &#125; &#125; func applicationWillResignActive(application: UIApplication) &#123; services.forEach &#123; service in service.applicationWillResignActive?(application) &#125; &#125; func applicationWillEnterForeground(application: UIApplication) &#123; services.forEach &#123; service in service.applicationWillEnterForeground?(application) &#125; &#125; func applicationDidEnterBackground(application: UIApplication) &#123; services.forEach &#123; service in service.applicationDidEnterBackground?(application) &#125; &#125;&#125; RootService.swift 12345678910111213141516171819202122232425class RootService : NSObject, UIApplicationDelegate &#123; func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject : AnyObject]?) -&gt; Bool &#123; appDelegate().window = UIWindow(frame: UIScreen.mainScreen().bounds) showHome() appDelegate().window?.makeKeyAndVisible() return true &#125;&#125;extension RootService &#123; func showHome() &#123; let home = HomeWireframe().makeHome() let navC = UINavigationController(rootViewController: home!) appDelegate().window?.rootViewController = navC &#125;&#125;extension RootService &#123; func appDelegate() -&gt; AppDelegate &#123; return UIApplication.sharedApplication().delegate as! AppDelegate &#125;&#125; AppDelegate.swift 123456789101112131415161718192021222324252627282930@UIApplicationMainclass AppDelegate: UIResponder, UIApplicationDelegate &#123; var window: UIWindow? let serviceDispatcher = ServiceDispatcher(services: [RootService()]) func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool &#123; serviceDispatcher.application(application, didFinishLaunchingWithOptions: launchOptions) return true &#125; func applicationWillResignActive(application: UIApplication) &#123; serviceDispatcher.applicationWillResignActive(application) &#125; func applicationDidEnterBackground(application: UIApplication) &#123; serviceDispatcher.applicationDidEnterBackground(application) &#125; func applicationWillEnterForeground(application: UIApplication) &#123; serviceDispatcher.applicationWillEnterForeground(application) &#125; func applicationDidBecomeActive(application: UIApplication) &#123; serviceDispatcher.applicationDidBecomeActive(application) &#125;&#125; I have more services like DebugService, PushNotificationService, CrashTrackingService, ‚Ä¶ The downside to this approach is that in real life, there will be dependencies between those services, like that UserService must be called before RootService? In this case, I have to use comment to explain why I have that decision, which is hard for newcomers to understand at first. Take a look at How to Move Bootstrapping Code Out of AppDelegate for how dependencies are managed JSDecoupledAppDelegate comes with another approach, in which service events are named according to the functions, like appStateDelegate, appDefaultOrientationDelegate, watchInteractionDelegate, ‚Ä¶ But for me, Service and ServiceDispatcher suit my need Reference SERVICE-ORIENTED APPDELEGATE JSDecoupledAppDelegate How to Move Bootstrapping Code Out of AppDelegate","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to debug Auto Layout","slug":"How-to-debug-Auto-Layout","date":"2017-05-10T20:08:13.000Z","updated":"2019-06-28T07:09:41.000Z","comments":true,"path":"blog/How-to-debug-Auto-Layout/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-debug-Auto-Layout/","excerpt":"","text":"Issue #23 hasAmbiguousLayout Returns whether the constraints impacting the layout of the view incompletely specify the location of the view. exerciseAmbiguityInLayout This method randomly changes the frame of a view with an ambiguous layout between its different valid values, causing the view to move in the interface. This makes it easy to visually identify what the valid frames are and may enable the developer to discern what constraints need to be added to the layout to fully specify a location for the view. _autolayoutTrace This returns a string describing the whole view tree which tells you when a view has an ambiguous layout. NSLayoutConstraint identifier The name that identifies the constraint. UIViewAlertForUnsatisfiableConstraints https://medium.com/@karthikkeyan/debugging-uiviewalertforunsatisfiableconstraints-47697696c7c DETECTED_MISSING_CONSTRAINTShttps://forums.developer.apple.com/thread/63811 View Debugger search by addressRead more Debugging Tricks and Tips Advanced Auto Layout Toolbox Mysteries of Auto Layout, Part 2","categories":[],"tags":[{"name":"macOS","slug":"macOS","permalink":"https://onmyway133.github.io/tags/macOS/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to create a piano using iOS 9 Auto Layout","slug":"How-to-create-a-piano-using-iOS-9-Auto-Layout","date":"2017-05-10T20:06:09.000Z","updated":"2019-05-04T17:42:25.000Z","comments":true,"path":"blog/How-to-create-a-piano-using-iOS-9-Auto-Layout/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-create-a-piano-using-iOS-9-Auto-Layout/","excerpt":"","text":"Issue #22 In the beginning, people use frame and Autoresizing Mask, then they use Auto Layout, then iOS 9 encourages them to use NSLayoutAnchor, UILayoutGuide and UIStackView For more convenient Auto Layout, check How to make Auto Layout more convenient in iOS and Anchors NSLayoutAnchor The NSLayoutAnchor class is a factory class for creating NSLayoutConstraint objects using a fluent API. Use these constraints to programmatically define your layout using Auto Layout. It has 3 subclasses NSLayoutDimension func constraintEqualToConstant(_ c: CGFloat) -&gt; NSLayoutConstraint! NSLayoutXAxisAnchor Allows working with horizontal constraints Prevent these 12// This constraint generates an incompatible pointer type warningcancelButton.leadingAnchor.constraintEqualToAnchor(saveButton.topAnchor, constant: 8.0).active = true NSLayoutYAxisAnchor Allows working with vertical constraints Prevent these 12// This constraint generates an incompatible pointer type warningcancelButton.topAnchor.constraintEqualToAnchor(saveButton.trailingAnchor, constant: 8.0).active = true UILayoutGuidePreviously, we used dummy views to aid constraints. Now we use UILayoutGuide Define an equal spacing between a series of views See full gist 1234567891011121314let space1 = UILayoutGuide()view.addLayoutGuide(space1)let space2 = UILayoutGuide()view.addLayoutGuide(space2)space1.widthAnchor.constraintEqualToAnchor(space2.widthAnchor).active = truesaveButton.trailingAnchor.constraintEqualToAnchor(space1.leadingAnchor).active = truecancelButton.leadingAnchor.constraintEqualToAnchor(space1.trailingAnchor).active = truecancelButton.trailingAnchor.constraintEqualToAnchor(space2.leadingAnchor).active = trueclearButton.leadingAnchor.constraintEqualToAnchor(space2.trailingAnchor).active = true Layout guides can also act as a black box, containing a number of other views and controls See the full gist 12345678910111213141516171819202122232425262728let container = UILayoutGuide()view.addLayoutGuide(container)// Set interior constraintslabel.lastBaselineAnchor.constraintEqualToAnchor(textField.lastBaselineAnchor).active = truelabel.leadingAnchor.constraintEqualToAnchor(container.leadingAnchor).active = truetextField.leadingAnchor.constraintEqualToAnchor(label.trailingAnchor, constant: 8.0).active = truetextField.trailingAnchor.constraintEqualToAnchor(container.trailingAnchor).active = truetextField.topAnchor.constraintEqualToAnchor(container.topAnchor).active = truetextField.bottomAnchor.constraintEqualToAnchor(container.bottomAnchor).active = true// Set exterior constraints// The contents of the container can be treated as a black boxlet margins = view.layoutMarginsGuidecontainer.leadingAnchor.constraintEqualToAnchor(margins.leadingAnchor).active = truecontainer.trailingAnchor.constraintEqualToAnchor(margins.trailingAnchor).active = true// Must use NSLayoutConstraint with the scene's top and bottom layout guides.NSLayoutConstraint(item: container, attribute: .Top, relatedBy: .Equal, toItem: topLayoutGuide, attribute: .Bottom, multiplier: 1.0, constant: 20.0).active = true layoutMarginsGuideMargins are now represented as layoutMarginsGuide, a subclass of UILayoutGuide topLayoutGuide and bottomLayoutGuideIn the container example, we saw how we must use NSLayoutConstraint with the topLayoutGuide. topLayoutGuide and bottomLayoutGuide are object conforming to UILayoutSupport protocol layoutFrame The layout guide defines a rectangular space in its owning view‚Äôs coordinate system. This property contains a valid CGRect value by the time its owning view‚Äôs layoutSubviews method is called. In the above container example, the container layout guide frame is 1(16.0, 40.0, 343.0, 21.0) Piano See Piano on Github on how to create a Piano using UILayoutGuide, NSLayoutAnchor and UIStackView","categories":[],"tags":[]},{"title":"A set of NSObject","slug":"A-set-of-NSObject","date":"2017-05-05T08:01:49.000Z","updated":"2017-05-05T08:01:49.000Z","comments":true,"path":"blog/A-set-of-NSObject/","link":"","permalink":"https://onmyway133.github.io/blog/A-set-of-NSObject/","excerpt":"","text":"Issue #21 The other day I was trying t http://mgrebenets.github.io/swift/2015/06/21/equatable-nsobject-with-swift-2 http://stackoverflow.com/questions/33319959/nsobject-subclass-in-swift-hash-vs-hashvalue-isequal-vs https://useyourloaf.com/blog/swift-hashable/","categories":[],"tags":[]},{"title":"How to handle RefreshControl in iOS","slug":"How-to-handle-RefreshControl-in-iOS","date":"2017-05-04T07:03:46.000Z","updated":"2019-06-25T08:21:36.000Z","comments":true,"path":"blog/How-to-handle-RefreshControl-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-handle-RefreshControl-in-iOS/","excerpt":"","text":"Issue #20 The other day I was doing refresh control, and I saw this Swift Protocols with Default Implementations as UI Mixins 1234567891011121314151617181920extension Refreshable where Self: UIViewController&#123; /// Install the refresh control on the table view func installRefreshControl() &#123; let refreshControl = UIRefreshControl() refreshControl.tintColor = .primaryColor refreshControl.addTarget(self, action: #selector(handleRefresh(_:)), for: .valueChanged) self.refreshControl = refreshControl if #available(iOS 10.0, *) &#123; tableView.refreshControl = refreshControl &#125; else &#123; tableView.backgroundView = refreshControl &#125; &#125;&#125; Protocol extension is cool but somehow I‚Äôm not a fan of it. I always consider composition first, to extract the specific task to one entity that does that well. It looks like this 1234567891011121314151617181920class RefreshHandler: NSObject &#123; let refresh = PublishSubject&lt;Void&gt;() let refreshControl = UIRefreshControl() init(view: UIScrollView) &#123; super.init() view.addSubview(refreshControl) refreshControl.addTarget(self, action: #selector(refreshControlDidRefresh(_: )), for: .valueChanged) &#125; // MARK: - Action func refreshControlDidRefresh(_ control: UIRefreshControl) &#123; refresh.onNext(()) &#125; func end() &#123; refreshControl.endRefreshing() &#125;&#125; It is a bit Rx, we can use block if we like, but the idea is we can declare this RefreshHandler and use it everywhere we want 123456refreshHandler = RefreshHandler(view: scrollView)refreshHandler.refresh .startWith(()) .bindTo(viewModel.input.fetch) .addDisposableTo(bag)","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"},{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to hack iOS apps","slug":"How-to-hack-iOS-apps","date":"2017-05-03T08:34:31.000Z","updated":"2019-09-26T05:26:43.000Z","comments":true,"path":"blog/How-to-hack-iOS-apps/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-hack-iOS-apps/","excerpt":"","text":"Issue #19 We need to care about security nowadays, here are some links I find useful to read more about this matter https://github.com/Naituw/IPAPatch https://github.com/cyanzhong/Retriever https://github.com/KJCracks/Clutch https://github.com/pjebs/Obfuscator-iOS https://github.com/UrbanApps/UAObfuscatedString https://www.raywenderlich.com/46223/ios-app-security-analysis-part-2 http://www.splinter.com.au/2014/09/16/storing-secret-keys/ Anastasiia Voitova: Keys from the castle: ancient art of managing keys and trust https://www.hopperapp.com/ https://github.com/iosre/iOSAppReverseEngineering CocoaPods, Exposed Analysis of the Facebook.app for iOS [v. 87.0] http://quellish.tumblr.com/post/126712999812/how-on-earth-the-facebook-ios-application-is-so https://www.objc.io/issues/19-debugging/ https://github.com/felixgr/secure-ios-app-dev App Security in Swift Securing Communications on iOS How I discovered Instagram‚Äôs upcoming video calling feature on iOS https://blog.superhuman.com/advanced-swift-debugging-for-uikit-e154d1c28aaf http://blog.zats.io/2017/12/27/iPhone-X-home-button/ https://medium.com/@nathangitter/exploring-apps-without-jailbreaking-e932904f9863 https://academy.realm.io/posts/conrad-kramer-reverse-engineering-ios-apps-lyft/ https://github.com/BishopFox/iSpy https://github.com/Polidea/SiriusObfuscator https://oleb.net/2018/photos-data-model/ The art of spelunking https://vimeo.com/290322018 https://briancoyner.github.io/xcode/2017/05/14/xcode-attach-debugger-to-apple-apps.html https://medium.com/@vixentael/popular-note-taking-apps-share-these-security-flaws-security-tips-for-developers-326180e41329 https://medium.com/@kennethpoon/lets-write-swift-code-to-intercept-ssl-pinning-https-requests-12446303cc9d https://medium.com/@kennethpoon/how-to-perform-ios-code-injection-on-ipa-files-1ba91d9438db https://github.com/armadsen/analyze_apps https://github.com/rockbruno/swiftshield https://rambo.codes/ios/2019/01/11/hacking-with-private-apis-on-ipad.html https://github.com/MichaelMKenny/ios-13-light-dark-wallpaper-app Private frameworks https://github.com/jenghis/nshift/blob/master/nshift/CBBlueLightClient.h Hack macOS apps Xcode, the ultimate debugging and cracking tool REVERSE ENGINEERING STICKIES.APP https://github.com/OWASP/owasp-mstg Private frameworks https://github.com/sindresorhus/touch-bar-simulator Hack Android apps Reverse Engineering The Medium App (and making all stories in it free)","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://onmyway133.github.io/tags/iOS/"}]},{"title":"How to deal with singleton in iOS","slug":"How-to-deal-with-singleton-in-iOS","date":"2017-05-02T19:40:10.000Z","updated":"2019-05-23T16:38:19.000Z","comments":true,"path":"blog/How-to-deal-with-singleton-in-iOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-deal-with-singleton-in-iOS/","excerpt":"","text":"Issue #18 A single singletonThere are many classes that designed to be used as singleton, like UserDefaults.standard, FileManager.default, NotificationCenter.default or even our own classes like UserManager, Storage, ‚Ä¶ Singleton is a design patter and has its own use case, sometimes we still need to use it. But if we are to use singleton, we should just use 1, and group all other singleton under this single singleton. Thanks to Vadym for showing this to me Swift makes it extremely easy to make singleton, let name it App then we have a single point of control for all the singletons 1234567891011121314151617181920212223242526272829303132struct App &#123; static let model = AppModel() static let realmProvider = RealmProvider() static let networkingProvider = NetworkingProvider() static var navigator = Navigator() static let config = AppConfig() static let pushNotificationCenter = PushNotificationCenter() static let lifeCycle = LifeCycle()&#125;``` These are use cases where a single instance is needed### AppModelThis is where we store model for an app, that can be- is onboarding shown- organization name- `Session` that encapsulates token, current profile### LifeCycleThis is where we listen to app life cycle, I use `rx` to make it easy, see https://github.com/onmyway133/blog/issues/12### RealmProviderI prefer `Realm` for storing and caching, usually 1 `Realm` is enough. This is where we return the a certain `Realm` instance```swiftclass RealmProvider &#123; static func realm() -&gt; Realm &#123; let configuration = Realm.Configuration(schemaVersion: App.config.schemaVersion) return try! Realm(configuration: configuration) &#125;&#125; AppConfigThis is where we have configurations for staging and production environment, those can be client key, Firebase configuration, analytics keys, ‚Ä¶ NavigatorI use Compass to do central navigation, and there should be 1 Navigator that does the job Inject a singletonSometime we rely on a singleton to do our job, to make dependencies clear and testing easier, we need to inject this singleton, and leverage Swift default parameter, thanks to John for showing this to me Here is an example of a ViewModel that relies on networking 12345678910111213class ProfileViewModel &#123; let networking: Networking&lt;APIEndpoint&gt; init(networking: Networking&lt;APIEndpoint&gt; = App.networking) &#123; self.networking = networking networking.rxRequest(APIEndpoint.profile) .bindNext(&#123; profile in print(profile) &#125;) &#125;&#125;","categories":[],"tags":[]},{"title":"Swift snippets","slug":"Swift-snippets","date":"2017-05-02T19:17:49.000Z","updated":"2019-09-10T06:42:10.000Z","comments":true,"path":"blog/Swift-snippets/","link":"","permalink":"https://onmyway133.github.io/blog/Swift-snippets/","excerpt":"","text":"Issue #17 I always forget how to write correct #available( or #if swift(&gt;=3.0) or just lazy to write required init?(coder aDecoder: NSCoder) every time I make a subclass. That‚Äôs why I made SwiftSnippets to save time for these tedious tasks. Installation is easy with script, so you should give it a try. I can‚Äôt recommend this enough, it saves me tons of time","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"A dream is not a dream anymore when you don't have time for it","slug":"A-dream-is-not-a-dream-anymore-when-you-don't-have-time-for-it","date":"2017-05-02T19:13:26.000Z","updated":"2018-11-28T07:09:18.000Z","comments":true,"path":"blog/A-dream-is-not-a-dream-anymore-when-you-don't-have-time-for-it/","link":"","permalink":"https://onmyway133.github.io/blog/A-dream-is-not-a-dream-anymore-when-you-don't-have-time-for-it/","excerpt":"","text":"Issue #16","categories":[],"tags":[]},{"title":"The luxury of free time","slug":"The-luxury-of-free-time","date":"2017-05-02T19:13:11.000Z","updated":"2019-09-12T06:31:18.000Z","comments":true,"path":"blog/The-luxury-of-free-time/","link":"","permalink":"https://onmyway133.github.io/blog/The-luxury-of-free-time/","excerpt":"","text":"Issue #15 What to see https://feedly.com/i/latest https://news.ycombinator.com/ https://medium.com/ https://github.com/onmyway133/fantastic-design#inspiration CS Dojo How https://www.raywenderlich.com/167015/learning-techniques-programmers","categories":[],"tags":[{"name":"life","slug":"life","permalink":"https://onmyway133.github.io/tags/life/"}]},{"title":"What you don't know is what you haven't learned","slug":"What-you-don't-know-is-what-you-haven't-learned","date":"2017-05-02T19:13:03.000Z","updated":"2017-09-03T08:12:48.000Z","comments":true,"path":"blog/What-you-don't-know-is-what-you-haven't-learned/","link":"","permalink":"https://onmyway133.github.io/blog/What-you-don't-know-is-what-you-haven't-learned/","excerpt":"","text":"Issue #14 Some of my sayings that I like üòâ Mine There are so many many many things to learn The opportunities are endless Everybody has access to the internet. Everybody has nearly the same chances. Your future is yours to decide A dream is not a dream anymore when you don‚Äôt have time for it Being single means free time. Being coupled means memorable time You learn less with the happy path I don‚Äôt like to be at the centre, nor being abandoned Even sense of humour can be trained Youth is your strength. Take advantage of it Easy to please. Hard to impress Don‚Äôt show me the evil sides of the world Please don‚Äôt confuse peace vs boredom What matters is your passion, not your ability The ones that are likely to fail are the ones having the fewest friends. And the ones that have the fewest friends are the ones having the most boring life Life is like a marathon. People run. Some are lucky enough to have support. Some are even luckier, they already crossed the finish line when they were born. Running, however, has its own fun Life is predestined. But you can of course change it Losers are easily the most hot tempered. It is the consequence, not the cause What if there is no inheritance. Will that make everybody the same? Some people become Norwegian when they were born. Others have to apply for the citizenship https://www.udi.no/en/word-definitions/norwegian-by-birth/ Every deck has a chance to win, as long as you believe in the heart of the cards Life is a game. People play on different difficulty levels. ‚ÄúBut mine is much harder‚Äù, said everybody What you don‚Äôt know is what you haven‚Äôt learned Others I don‚Äôt know the key to success. But the key to failure is trying to please everybody ~ Bill Cosby","categories":[],"tags":[]},{"title":"Composition in Realm","slug":"Composition-in-Realm","date":"2017-05-02T19:11:39.000Z","updated":"2017-05-02T19:11:39.000Z","comments":true,"path":"blog/Composition-in-Realm/","link":"","permalink":"https://onmyway133.github.io/blog/Composition-in-Realm/","excerpt":"","text":"Issue #13 There is time we have models that have some kind of inheritance, like Dog, Cat, Mouse can be Animal. We can use composition to imitate inheritance, we just need to make sure it has unique primary key Cat and DogThese are pretty much basic Realm objects 1234567891011121314151617class Dog: Object &#123; dynamic var id: Int = 0 required convenience init(json: [String: Any]) &#123; self.init() id &lt;- json.integer(key: \"id\") &#125;&#125;class Cat: Object &#123; dynamic var id: Int = 0 required convenience init(json: [String: Any]) &#123; self.init() id &lt;- json.integer(key: \"id\") &#125;&#125; AnimalHere Animal can contain either dog or cat, we can add more if there are many other ‚Äúinheritance‚Äù of Animal. The required init makes sure Animal can only be init with 1 type of child class 123456789101112131415161718class Animal: Object &#123; dynamic var id: Int = 0 dynamic var cat: Cat? dynamic var dog: Dog? required convenience init(cat: Cat) &#123; self.init() self.cat = cat self.id = cat.id &#125; required convenience init(dog: Dog) &#123; self.init() self.dog = dog self.id = dog.id &#125;&#125;","categories":[],"tags":[]},{"title":"How to do delegate with RxSwift","slug":"How-to-do-delegate-with-RxSwift","date":"2017-05-02T18:58:45.000Z","updated":"2019-05-23T16:37:35.000Z","comments":true,"path":"blog/How-to-do-delegate-with-RxSwift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-do-delegate-with-RxSwift/","excerpt":"","text":"Issue #12 We can use DelegateProxy and DelegateProxyType to make beautiful delegate with RxSwift. But in some other cases, we can just create a custom class with PublishSubject. This is how we can make rx out of UIApplication life cycle events 12345678910111213141516171819202122232425262728293031class LifeCycle &#123; let didEnterBackground = PublishSubject&lt;Void&gt;() let willEnterForeground = PublishSubject&lt;Void&gt;() let didBecomeActive = PublishSubject&lt;Void&gt;() let willResignActive = PublishSubject&lt;Void&gt;() init() &#123; let center = NotificationCenter.default let app = UIApplication.shared center.addObserver(forName: Notification.Name.UIApplicationDidEnterBackground, object: app, queue: .main, using: &#123; [weak self] _ in self?.didEnterBackground.onNext(()) &#125;) center.addObserver(forName: Notification.Name.UIApplicationWillEnterForeground, object: app, queue: .main, using: &#123; [weak self] _ in self?.willEnterForeground.onNext(()) &#125;) center.addObserver(forName: Notification.Name.UIApplicationDidBecomeActive, object: app, queue: .main, using: &#123; [weak self] _ in self?.didBecomeActive.onNext(()) &#125;) center.addObserver(forName: Notification.Name.UIApplicationWillResignActive, object: app, queue: .main, using: &#123; [weak self] _ in self?.willResignActive.onNext(()) &#125;) &#125;&#125; Usage123456let lifeCycle = LifeCycle()lifeCycle.didBecomeActive .bindNext(&#123; [weak self] in self?.viewModel.reloadProfile() &#125;) .disposed(by: bag)","categories":[],"tags":[]},{"title":"How to group extension methods in Swift","slug":"How-to-group-extension-methods-in-Swift","date":"2017-05-02T18:53:05.000Z","updated":"2019-05-23T16:37:24.000Z","comments":true,"path":"blog/How-to-group-extension-methods-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-group-extension-methods-in-Swift/","excerpt":"","text":"Issue #11 Swift allows us to define more methods on existing class using extension. 1234567891011121314extension UIView &#123; func shake() &#123; &#125; func fade() &#123; &#125; func centerIn(anotherView: UIView) &#123; &#125;&#125; If you ‚Äòre afraid of the naming conflict, you can prefix your methods, like 123view.abc_shake()view.abc_fade()view.abc_centerIn(anotherView: containerView) Or a better way, reverse it üíÉ , like 123view.animation.shake()view.animation.fade()view.layout.centerIn(anotherView) This way, no more conflict and we make it clear that shake() and fade() belongs to animation categoryActually, animation and layout are properties in UIView extension. This may cause naming conflict, but the number of them is reduced This is how it works 123456789101112131415161718192021222324252627282930extension UIView &#123; struct Animation &#123; let view: UIView func shake() &#123; // Shake the view &#125; func fade() &#123; PowerfulAnimationEngine.fade(view) &#125; &#125; var animation: Animation &#123; return Animation(view: self) &#125; struct Layout &#123; let view: UIView func centerIn(anotherView: UIView) &#123; &#125; &#125; var layout: Layout &#123; return Layout(view: self) &#125;&#125;","categories":[],"tags":[]},{"title":"How to execute an action only once in Swift","slug":"How-to-execute-an-action-only-once-in-Swift","date":"2017-05-02T18:47:33.000Z","updated":"2019-08-09T10:29:08.000Z","comments":true,"path":"blog/How-to-execute-an-action-only-once-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-execute-an-action-only-once-in-Swift/","excerpt":"","text":"Issue #10 There is time we want to execute an action only once. We can surely introduce a flag, but it will be nicer if we abstract that out using composition. Then we have 12345678910111213class Once &#123; var already: Bool = false func run(@noescape block: () -&gt; Void) &#123; guard !already else &#123; return &#125; block() already = true &#125;&#125; Usage1234567891011class ViewController: UIViewController &#123; let once = Once() override func viewDidAppear(animated: Bool) &#123; super.viewDidAppear(animated) once.run &#123; cameraMan.setup() &#125; &#125;&#125; In the same way, we can check to run a closure when a value changes 1234567891011121314final class WhenChange&lt;T: Equatable&gt; &#123; private(set) var value: T init(value: T) &#123; self.value = value &#125; func run(newValue: T, closure: (T) -&gt; Void) &#123; if newValue != value &#123; value = newValue closure(value) &#125; &#125;&#125;","categories":[],"tags":[{"name":"swift","slug":"swift","permalink":"https://onmyway133.github.io/tags/swift/"}]},{"title":"Law of Jante","slug":"Law-of-Jante","date":"2017-05-02T18:33:33.000Z","updated":"2017-05-02T18:33:50.000Z","comments":true,"path":"blog/Law-of-Jante/","link":"","permalink":"https://onmyway133.github.io/blog/Law-of-Jante/","excerpt":"","text":"Issue #9 The other day I was watching Inside Sweden‚Äôs Silicon Valley, and he mentions Law of Jante It is pretty much this You‚Äôre not to think you are anything special. You‚Äôre not to think you are as good as we are. You‚Äôre not to think you are smarter than we are. You‚Äôre not to convince yourself that you are better than we are. You‚Äôre not to think you know more than we do. You‚Äôre not to think you are more important than we are. You‚Äôre not to think you are good at anything. You‚Äôre not to laugh at us. You‚Äôre not to think anyone cares about you. You‚Äôre not to think you can teach us anything. This is controversial, there are many discussions about this http://www.ibtimes.com/law-jante-how-swedish-cultural-principle-drives-ikea-ericsson-volvo-beat-financial-1397589 https://www.quora.com/Is-answering-publicly-on-Quora-incompatible-with-the-Law-of-Jante https://www.quora.com/Would-global-application-of-Jantes-laws-be-beneficial http://www.lifeinnorway.net/2015/06/what-exactly-is-janteloven/ Putting on your black hat, it sounds negative. Putting on your yellow hat, it sounds positiveBut what I learn about it is the team work. No one lives alone, everyone lives among the others. It is about to be humble and learn collaboration","categories":[],"tags":[]},{"title":"Advices to students","slug":"Advices-to-students","date":"2017-05-02T18:30:38.000Z","updated":"2017-05-02T18:30:38.000Z","comments":true,"path":"blog/Advices-to-students/","link":"","permalink":"https://onmyway133.github.io/blog/Advices-to-students/","excerpt":"","text":"Issue #8 Some say these are from the book Dumbing Down America of Charles Sykes, some say they are from Bill Gates ‚Äòs speech to high school students. I don‚Äôt know the origin, but they are cool enough, so I tend to share it again and again Life is not fair. Get used to it ‚≠êÔ∏è The world won‚Äôt care about your self-esteem. The world will expect you to accomplish something BEFORE you feel good about yourself You will NOT make 40 thousand dollars a year right out of high school. You won‚Äôt be a vice president with car phone, until you earn both. If you think your teacher is tough, wait till you get a boss. He doesn‚Äôt have tenure. If you mess up, it‚Äôs not your parents‚Äô fault, so don‚Äôt whine about your mistakes, learn from them. Your school may have done away with winners and losers, but life may not. In some schools they have abolished failing grades and they‚Äôll give you as many times as you want to get the right answer. This doesn‚Äôt bear the slightest resemblance to ANYTHING in real life. Life is not divided into semesters. You don‚Äôt get summers off and very few employers are interested in helping you find yourself. Do that on your own time. Television is NOT real life. In real life people actually have to leave the coffee shop and go to jobs. Be nice to nerds. Chances are you‚Äôll end up working for one. Before you were born your parents weren‚Äôt as boring as they are now. They got that way paying your bills, cleaning up your room and listening to you tell them how idealistic you are. And by the way, before you save the rain forest from the blood-sucking parasites of your parents‚Äô generation, try delousing the closet in your bedroom ‚≠êÔ∏è Reference https://www.se.rit.edu/~jrv/personal/RulesForStudents.html","categories":[],"tags":[]},{"title":"Check before you commit","slug":"Check-before-you-commit","date":"2017-05-02T07:36:59.000Z","updated":"2019-06-12T11:00:51.000Z","comments":true,"path":"blog/Check-before-you-commit/","link":"","permalink":"https://onmyway133.github.io/blog/Check-before-you-commit/","excerpt":"","text":"Issue #7 Original post https://medium.com/@onmyway133/check-before-you-commit-5a7601cffc87 We usually have some experiment code that we don‚Äôt want they to step into our commit. I usually mark my experiment with // but sometimes forget to unstage thatStarting with 2.9, Git has improvement on its commit hook which makes it globally using hooksPath Create pre-commit fileCreate a file called pre-commit, and place it into, for example /Users/khoa/hooks 1234567891011121314151617181920212223242526#!/bin/sh# https://appventure.me/2016/04/04/prevent-accidental-test-code-commits/if git rev-parse --verify HEAD &gt;/dev/null 2&gt;&amp;1then against=HEADelse # Initial commit: diff against an empty tree object against=4b825dc642cb6eb9a060e54bf8d69288fbee4904fi# The special marker tag to mark things which we still need to changemarker=\"&lt;TEST&gt;\"# Redirect output to stderr.exec 1&gt;&amp;2if test $(git diff --cached -z $against | grep $marker | wc -c) != 0 then cat &lt;&lt;\\EOF Error: Still has invalid debug markers in code:EOF echo `git diff --cached -z $against -G $marker` exit 1fi Apply the hookIn your project, run git config core.hooksPath /Users/khoa/hooksThat‚Äôs it. Whenever you commit a file with that pattern, it won‚Äôt let you commit How to useTry 12// &lt;TEST&gt;UserManager.shared.isActive = true and git commit -m &quot;my commit message&quot; will assert with Error: Still has invalid debug markers in code: Reference http://pre-commit.com/ https://appventure.me/2016/04/04/prevent-accidental-test-code-commits/ http://merowing.info/2016/08/setting-up-pre-commit-hook-for-ios/","categories":[],"tags":[]},{"title":"Markdown editor","slug":"Markdown-editor","date":"2017-04-30T09:06:02.000Z","updated":"2017-05-01T07:12:42.000Z","comments":true,"path":"blog/Markdown-editor/","link":"","permalink":"https://onmyway133.github.io/blog/Markdown-editor/","excerpt":"","text":"Issue #6 I like writing with markdown, it gives me comfortable experience with complete control over what I want to write. I recommend vmd which renders exactly as GitHub. vmd is for rendering only, you need an editor to write, I use Sublime Text because it opens very fast I also recommend using spectacle to easily split and organize windows","categories":[],"tags":[]},{"title":"Open Source","slug":"Open-Source","date":"2017-04-29T11:09:13.000Z","updated":"2019-05-21T19:21:57.000Z","comments":true,"path":"blog/Open-Source/","link":"","permalink":"https://onmyway133.github.io/blog/Open-Source/","excerpt":"","text":"Issue #5 https://onmyway133.github.io/opensource/","categories":[],"tags":[]},{"title":"Primary key in Realm","slug":"Primary-key-in-Realm","date":"2017-04-26T18:19:29.000Z","updated":"2017-04-26T18:19:55.000Z","comments":true,"path":"blog/Primary-key-in-Realm/","link":"","permalink":"https://onmyway133.github.io/blog/Primary-key-in-Realm/","excerpt":"","text":"Issue #4 Realm is great. But without primary key, it will duplicate the record, like https://github.com/realm/realm-java/issues/2730, http://stackoverflow.com/questions/32322460/should-i-define-the-primary-key-for-each-entity-in-realm, ‚Ä¶ So to force ourselves into the good habit of declaring primary key, we can leverage Swift protocol Create primary constrain protocol like this 1234protocol PrimaryKeyAware &#123; var id: Int &#123; get &#125; static func primaryKey() -&gt; String?&#125; and conform it in out Realm object 12345678910class Profile: Object, PrimaryKeyAware &#123; dynamic var firstName: String = \"\" dynamic var lastName: String = \"\" dynamic var id: Int = 0 override static func primaryKey() -&gt; String? &#123; return \"id\" &#125;&#125; This way, when using that object in out RealmStorage, we are safe to say that it has a primary key 12345678910111213class RealmStorage&lt;T: Object&gt; where T: PrimaryKeyAware &#123; let realm: Realm init(realm: Realm = RealmProvider.realm()) &#123; self.realm = realm &#125; func save(_ objects: [T]) &#123; try? realm.write &#123; realm.add(objects, update: true) &#125; &#125;&#125; The usage is like this 123let profile = Profile()let storage = RealmStorage&lt;Profile&gt;()storage.save([profile])","categories":[],"tags":[]},{"title":"How to take an app from a private framework in macOS","slug":"How-to-take-an-app-from-a-private-framework-in-macOS","date":"2017-04-26T18:12:27.000Z","updated":"2019-05-23T16:56:12.000Z","comments":true,"path":"blog/How-to-take-an-app-from-a-private-framework-in-macOS/","link":"","permalink":"https://onmyway133.github.io/blog/How-to-take-an-app-from-a-private-framework-in-macOS/","excerpt":"","text":"Issue #3 The other day I was browsing through https://github.com/sindresorhus/touch-bar-simulator, it was very brilliant of him to pull IDETouchBarSimulatorHostWindowController from DFRSupportKit.framework. This is worth checking out","categories":[],"tags":[]},{"title":"Configuration closure in Swift","slug":"Configuration-closure-in-Swift","date":"2017-04-26T17:42:44.000Z","updated":"2017-04-26T17:42:44.000Z","comments":true,"path":"blog/Configuration-closure-in-Swift/","link":"","permalink":"https://onmyway133.github.io/blog/Configuration-closure-in-Swift/","excerpt":"","text":"Issue #2 When I was reading through Swinject, I found something interesting https://github.com/Swinject/Swinject/blob/master/Sources/Container.swift 1234public convenience init(parent: Container? = nil, registeringClosure: (Container) -&gt; Void) &#123; self.init(parent: parent) registeringClosure(self)&#125; The init has a closure that makes configuration easy, much like a Builder pattern. So I think we can learn from that and make a Configurable protocol 12345678910protocol Configurable: class &#123;&#125;extension Configurable &#123; func config(block: (Self) -&gt; Void) -&gt; Self &#123; block(self) return self &#125;&#125;extension NSObject : Configurable &#123;&#125; With this, we can init some class with less hassle 1234let view = UIView().config &#123; $0.backgroundColor = .white $0.layer.cornerRadius = 2&#125;","categories":[],"tags":[]},{"title":"Hello world, again","slug":"Hello-world-again","date":"2017-04-26T17:25:15.000Z","updated":"2019-04-03T16:19:32.000Z","comments":true,"path":"blog/Hello-world-again/","link":"","permalink":"https://onmyway133.github.io/blog/Hello-world-again/","excerpt":"","text":"Issue #1 I‚Äôve used Wordpress, then moved to GitHub Pages with Jekyll, Octopress, Hexo, Hugo. You can view my page here http://fantageek.com/. It was good with all the custom themes and Disqus But then I was a bit lazy with all the commands generate, commit, deploy, it hinders me from writing, so I moved to Medium. The only thing I like about Medium is its discovery, your posts have high chanced of finding and viewing by people. What‚Äôs the point of writing if no one read it? But then I miss all the awesome markdown features of GitHub Pages. Medium is easy to use, but it seems it‚Äôs not for hackers, and I find it really uncomfortable when adding code block and headings. Medium also lists my comments as stories, which is kind of üò≤ I like to write fast, and with good comments system, and I love Markdown. I like GitHub. I use GitHub for my notes, so I think I will use it for my blog as well. Hope all these GitHub convenience will encourage me to write more often. This will, of course, be less discoverable by people. So if you by any chance visit this blog, ohayou from me üëã","categories":[],"tags":[]}]}