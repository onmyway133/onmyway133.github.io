<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>onmyway133</title><meta description="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:type" content="blog"><meta property="og:title" content="onmyway133"><meta property="og:url" content="https://onmyway133.github.io/"><meta property="og:site_name" content="onmyway133"><meta property="og:description" content="What you don&amp;#39;t know is what you haven&amp;#39;t learned"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://onmyway133.github.io/img/og_image.png"><meta property="article:author" content="Khoa Pham"><meta property="article:tag" content="ios"><meta property="article:tag" content=" android"><meta property="article:tag" content="javascript"><meta property="article:tag" content=" react"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@onmyway133"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://onmyway133.github.io"},"headline":"onmyway133","image":["https://onmyway133.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Khoa Pham"},"description":"What you don&#39;t know is what you haven&#39;t learned"}</script><link rel="alternative" href="/atom.xml" title="onmyway133" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-40119591-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-40119591-5');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3656459401405265" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/apps">Apps</a><a class="navbar-item" href="/gumroad">Gumroad</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/opensource">Open Source</a><a class="navbar-item" href="/writing">Writing</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/speaking">Speaking</a><a class="navbar-item" href="/news">News</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-20T15:58:30.000Z" title="2017-12-20T15:58:30.000Z">2017-12-20</time><span class="level-item">a minute read (About 172 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/UnsafePointer-in-Swift/">UnsafePointer in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/130">#130</a></strong></p>
<p>Code is in Swift 4</p>
<h3 id="Constructing-UnsafeMutablePointer"><a href="#Constructing-UnsafeMutablePointer" class="headerlink" title="Constructing UnsafeMutablePointer"></a>Constructing UnsafeMutablePointer</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> byteCount = <span class="number">32</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">UInt8</span>&gt;.allocate(capacity: byteCount)</span><br></pre></td></tr></table></figure>

<h3 id="Data-to-UnsafePointer"><a href="#Data-to-UnsafePointer" class="headerlink" title="Data to UnsafePointer"></a>Data to UnsafePointer</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Data</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">toPointer</span><span class="params">()</span></span> -&gt; <span class="type">UnsafePointer</span>&lt;<span class="type">UInt8</span>&gt;? &#123;</span><br><span class="line">    <span class="keyword">let</span> buffer = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">UInt8</span>&gt;.allocate(capacity: <span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">let</span> stream = <span class="type">OutputStream</span>(toBuffer: buffer, capacity: <span class="built_in">count</span>)</span><br><span class="line"></span><br><span class="line">    stream.<span class="keyword">open</span>()</span><br><span class="line">    withUnsafeBytes(&#123; (p: <span class="type">UnsafePointer</span>&lt;<span class="type">UInt8</span>&gt;) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">      stream.write(p, maxLength: <span class="built_in">count</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    stream.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UnsafePointer</span>&lt;<span class="type">UInt8</span>&gt;(buffer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UnsafePointer-to-Data"><a href="#UnsafePointer-to-Data" class="headerlink" title="UnsafePointer to Data"></a>UnsafePointer to Data</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UnsafePointer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">toData</span><span class="params">()</span></span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(<span class="keyword">self</span>), <span class="built_in">count</span>: <span class="number">32</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dealing-with-C-API"><a href="#Dealing-with-C-API" class="headerlink" title="Dealing with C API"></a>Dealing with C API</h3><p>This is how to do keccak hash using C API from <a href="https://github.com/ethereum/ethash/blob/master/src/libethash/sha3.c">https://github.com/ethereum/ethash/blob/master/src/libethash/sha3.c</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeccakHash</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">hash</span><span class="params">(data: Data)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> dataPointer = data.toPointer() <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="type">InteralError</span>.invalid</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> byteCount = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">UInt8</span>&gt;.allocate(capacity: byteCount)</span><br><span class="line">    sha3_256(result, byteCount, dataPointer, data.<span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">return</span> result.toData()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li>See <a href="https://github.com/onmyway133/Reindeers/blob/master/Sources/Extensions.swift">https://github.com/onmyway133/Reindeers/blob/master/Sources/Extensions.swift</a></li>
<li><a href="https://oleb.net/blog/2017/12/importing-c-library-into-swift/"><br>How to import a C library in Swift using the Swift Package Manager</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-20T09:40:35.000Z" title="2017-12-20T09:40:35.000Z">2017-12-20</time><span class="level-item">3 minutes read (About 478 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-prevent-UIVisualEffectView-crash/">How to prevent UIVisualEffectView crash</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/124">#124</a></strong></p>
<p>We all know that there‚Äôs a potential crash with <code>UIVisualEffectView</code> on iOS 11. The fix is to not add sub views directly to <code>UIVisualEffectView</code>, but to its <code>contentView</code>. So we should change</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effectView.addSubview(button)</span><br></pre></td></tr></table></figure>

<p>to </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effectView.contentView.addubView(button)</span><br></pre></td></tr></table></figure>

<p>Here we don‚Äôt need to perform iOS version check, because <code>effectView.contentView</code> works for any iOS versions.</p>
<h3 id="Potential-cases-for-crashes"><a href="#Potential-cases-for-crashes" class="headerlink" title="Potential cases for crashes"></a>Potential cases for crashes</h3><p>Here are some cases you can potentially cause the crashes</p>
<p><strong><em>Strange namings</em></strong></p>
<p>Normally we name our <code>UIVisualEffectView</code> as <code>blurView</code>, <code>effectView</code>. But there‚Äôs times we name it differently like <code>navigationView</code>, <code>containerView</code>, <code>boxView</code>, ‚Ä¶ This way we may completely forget that it‚Äôs a <code>UIVisualEffectView</code> üôÄ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">containerView.addSubview(button)</span><br><span class="line">boxView.insertSubview(label, at: <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong><em>Custom loadView</em></strong></p>
<p>Sometimes it‚Äôs convenient to have our <code>UIViewController &#39;s view</code> as a whole blur view, so that all things inside have a nice blur effect background</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OverlayController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> blurView = <span class="type">UIVisualEffectView</span>(effect: <span class="type">UIBlurEffect</span>(style: .dark))</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.loadView()</span><br><span class="line">    <span class="keyword">self</span>.view = blurView</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    view.addSubview(button)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By setting our <code>blurView</code> as <code>view</code> in <code>loadView</code>, we have no idea afterwards that <code>view</code> is actually a <code>UIVisualEffectView</code> üôÄ </p>
<p><strong><em>Inheritance</em></strong></p>
<p>What happen if we have another <code>UIViewController</code> that inherits from our <code>OverlayController</code>, all it knows about <code>view</code> is <code>UIView</code>, it does not know that it is a disguising <code>UIVisualEffectView</code> üôÄ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClocksController</span>: <span class="title">OverlayController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    view.addSubview(timeLabel)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>Superclass type</em></strong></p>
<p>Sometimes declare our things but with protocol or superclass types. Consumers of our API have no clue to know that it is <code>UIVisualEffectView</code> üôÄ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> view: <span class="type">UIView</span> = <span class="type">UIVisualEffectView</span>(effect: <span class="type">UIBlurEffect</span>(style: .dark))</span><br></pre></td></tr></table></figure>

<p>Here it appears to us that <code>view</code> is of type <code>UIView</code></p>
<p><strong><em>Legacy codebase</em></strong></p>
<p>Now imagine you ‚Äòve handled a legacy codebase to deal with. Perform finding and replacing all those things related to <code>UIVisualEffectView</code> is very hard task. Especially since we tend to write less tests for UI</p>
<h3 id="Making-it-impossible-to-crash"><a href="#Making-it-impossible-to-crash" class="headerlink" title="Making it impossible to crash"></a>Making it impossible to crash</h3><p>I like concept like <a href="https://wiki.haskell.org/Phantom_type">Phantom type</a> to limit interface. Here we‚Äôre not using type but a wrapper </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BlurView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> effectView: <span class="type">UIVisualEffectView</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(style: <span class="type">UIBlurEffectStyle</span>, backgroundColor: <span class="type">UIColor?</span> = <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.effectView = <span class="type">UIVisualEffectView</span>(effect: <span class="type">UIBlurEffect</span>(style: style))</span><br><span class="line">    <span class="keyword">self</span>.effectView.backgroundColor = backgroundColor</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(frame: .zero)</span><br><span class="line">    insertSubview(effectView, at: <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">addSubview</span><span class="params">(<span class="number">_</span> view: UIView)</span></span> &#123;</span><br><span class="line">    effectView.contentView.addSubview(view)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.layoutSubviews()</span><br><span class="line"></span><br><span class="line">    effectView.frame = bounds</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here we override <code>addSubview</code> to always add views to <code>effectView.contentView</code>. In the <code>init</code> method, we need to call <code>insertSubview</code> instead because of our overriden <code>addSubview</code></p>
<p>Now <code>BlurView</code> has a blur effect thanks to is underlying <code>UIVisualEffectView</code>, but expose only <code>addSubview</code> because of its <code>UIView</code> interface. This way it is impossible to cause crashes üòé </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blurView = <span class="type">BlurView</span>(style: .dark)</span><br><span class="line">blurView.addSubview(button(</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-18T14:41:21.000Z" title="2017-12-18T14:41:21.000Z">2017-12-18</time><span class="level-item">7 minutes read (About 1122 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Understanding-suspend-function-in-Kotlin-Coroutine-in-Android/">Understanding suspend function in Kotlin Coroutine in Android</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/123">#123</a></strong></p>
<h2 id="Getting-to-know-Coroutine"><a href="#Getting-to-know-Coroutine" class="headerlink" title="Getting to know Coroutine"></a>Getting to know Coroutine</h2><p>From <a href="https://kotlinlang.org/docs/reference/coroutines.html">https://kotlinlang.org/docs/reference/coroutines.html</a></p>
<blockquote>
<p>To continue the analogy, await() can be a suspending function (hence also callable from within an async {} block) that suspends a coroutine until some computation is done and returns its result:</p>
</blockquote>
<p>From <a href="https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html">https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html</a></p>
<blockquote>
<p>We are using the delay() function that‚Äôs like Thread.sleep(), but better: it doesn‚Äôt block a thread, but only suspends the coroutine itself. The thread is returned to the pool while the coroutine is waiting, and when the waiting is done, the coroutine resumes on a free thread in the pool.</p>
</blockquote>
<blockquote>
<p>await() can not be called outside a coroutine, because it needs to suspend until the computation finishes, and only coroutines can suspend in a non-blocking way</p>
</blockquote>
<h2 id="What-does-suspend-function-mean-in-Kotlin-Coroutine-ü§î"><a href="#What-does-suspend-function-mean-in-Kotlin-Coroutine-ü§î" class="headerlink" title="What does suspend function mean in Kotlin Coroutine ü§î"></a>What does suspend function mean in Kotlin Coroutine ü§î</h2><p><a href="https://stackoverflow.com/questions/47871868/what-does-suspend-function-mean-in-kotlin-coroutine">https://stackoverflow.com/questions/47871868/what-does-suspend-function-mean-in-kotlin-coroutine</a></p>
<p>I‚Äôm reading Kotlin Coroutine and know that it is based on suspend function. But what does suspend mean?</p>
<p>Coroutine or function gets suspended?</p>
<p>From <a href="https://kotlinlang.org/docs/reference/coroutines.html">https://kotlinlang.org/docs/reference/coroutines.html</a></p>
<p>Basically, coroutines are computations that can be suspended without blocking a thread</p>
<p>I heard people often say ‚Äúsuspend function‚Äù. But I think it is the coroutine who gets suspended because it is waiting for the function to finished? ‚Äúsuspend‚Äù usually means ‚Äúcease operation‚Äù, in this case the coroutine is idle.</p>
<p>Should we say the coroutine is suspended ?</p>
<p>Which coroutine gets suspended?</p>
<p>From <a href="https://kotlinlang.org/docs/reference/coroutines.html">https://kotlinlang.org/docs/reference/coroutines.html</a></p>
<p>To continue the analogy, await() can be a suspending function (hence also callable from within an async {} block) that suspends a coroutine until some computation is done and returns its result:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">async &#123; <span class="comment">// Here I call it the outer async coroutine</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// Here I call computation the inner coroutine</span></span><br><span class="line">    <span class="keyword">val</span> result = computation.await()</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ü§î It says ‚Äúthat suspends a coroutine until some computation is done‚Äù, but coroutine is like a lightweight thread. So if the coroutine is suspended, how can the computation is done ?</p>
<p>We see await is called on computation, so it might be async that returns Deferred, which means it can start another coroutine</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">computation</span><span class="params">()</span></span>: Deferred&lt;<span class="built_in">Boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> async &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ü§î The quote say that suspends a coroutine. Does it mean suspend the outer async coroutine, or suspend the inner computation coroutine?</p>
<p>Does suspend mean that while outer async coroutine is waiting (await) for the inner computation coroutine to finish, it (the outer async coroutine) idles (hence the name suspend) and returns thread to the thread pool, and when the child computation coroutine finishes, it (the outer async coroutine) wakes up, takes another thread from the pool and continues?</p>
<p>The reason I mention the thread is because of <a href="https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html">https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html</a></p>
<p>The thread is returned to the pool while the coroutine is waiting, and when the waiting is done, the coroutine resumes on a free thread in the pool</p>
<h2 id="Understanding-async"><a href="#Understanding-async" class="headerlink" title="Understanding async"></a>Understanding async</h2><p>From <a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md">https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md</a></p>
<blockquote>
<p>Conceptually, async is just like launch. It starts a separate coroutine which is a light-weight thread that works concurrently with all the other coroutines. The difference is that launch returns a Job and does not carry any resulting value, while async returns a Deferred ‚Äì a light-weight non-blocking future that represents a promise to provide a result later. You can use .await() on a deferred value to get its eventual result, but Deferred is also a Job, so you can cancel it if needed.</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = async &#123; doSomethingUsefulOne() &#125;</span><br><span class="line">        <span class="keyword">val</span> two = async &#123; doSomethingUsefulTwo() &#125;</span><br><span class="line">        println(<span class="string">"The answer is <span class="subst">$&#123;one.await() + two.await()&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Completed in <span class="variable">$time</span> ms"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>There is a laziness option to async using an optional start parameter with a value of CoroutineStart.LAZY. It starts coroutine only when its result is needed by some await or if a start function is invoked. Run the following example that differs from the previous one only by this option:</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulOne() &#125;</span><br><span class="line">        <span class="keyword">val</span> two = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulTwo() &#125;</span><br><span class="line">        println(<span class="string">"The answer is <span class="subst">$&#123;one.await() + two.await()&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Completed in <span class="variable">$time</span> ms"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="What-is-the-difference-between-launch-join-and-async-await-in-Kotlin-coroutines"><a href="#What-is-the-difference-between-launch-join-and-async-await-in-Kotlin-coroutines" class="headerlink" title="What is the difference between launch/join and async/await in Kotlin coroutines"></a>What is the difference between launch/join and async/await in Kotlin coroutines</h2><p><a href="https://stackoverflow.com/a/48079738/1418457">https://stackoverflow.com/a/48079738/1418457</a></p>
<p>I find this guide <a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md">https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md</a> to be useful. I will quote the essential parts</p>
<p>ü¶Ñ coroutine</p>
<p>Essentially, coroutines are light-weight threads.</p>
<p>So you can think of coroutine as something that manages thread in a very efficient way.</p>
<p>üê§ launch</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    launch &#123; <span class="comment">// launch new coroutine in background and continue</span></span><br><span class="line">        delay(<span class="number">1000L</span>) <span class="comment">// non-blocking delay for 1 second (default time unit is ms)</span></span><br><span class="line">        println(<span class="string">"World!"</span>) <span class="comment">// print after delay</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>) <span class="comment">// main thread continues while coroutine is delayed</span></span><br><span class="line">    Thread.sleep(<span class="number">2000L</span>) <span class="comment">// block main thread for 2 seconds to keep JVM alive</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So launch starts a background thread, does something, and returns a token immediately as Job. You can call join on this Job to block until this launch thread completes</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> job = launch &#123; <span class="comment">// launch new coroutine and keep a reference to its Job</span></span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">"World!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Hello,"</span>)</span><br><span class="line">    job.join() <span class="comment">// wait until child coroutine completes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ü¶Ü async</p>
<p>Conceptually, async is just like launch. It starts a separate coroutine which is a light-weight thread that works concurrently with all the other coroutines. The difference is that launch returns a Job and does not carry any resulting value, while async returns a Deferred ‚Äì a light-weight non-blocking future that represents a promise to provide a result later.</p>
<p>So async starts a background thread, does something, and returns a token immediately as Deferred.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = async &#123; doSomethingUsefulOne() &#125;</span><br><span class="line">        <span class="keyword">val</span> two = async &#123; doSomethingUsefulTwo() &#125;</span><br><span class="line">        println(<span class="string">"The answer is <span class="subst">$&#123;one.await() + two.await()&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"Completed in <span class="variable">$time</span> ms"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can use .await() on a deferred value to get its eventual result, but Deferred is also a Job, so you can cancel it if needed.</p>
<p>So Deferred is actually a Job. See <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-deferred/index.html">https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-deferred/index.html</a></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Deferred</span>&lt;<span class="type">out T</span>&gt; : <span class="type">Job </span></span>(source)</span><br></pre></td></tr></table></figure>

<p>ü¶ã async is eager by default</p>
<p>There is a laziness option to async using an optional start parameter with a value of CoroutineStart.LAZY. It starts coroutine only when its result is needed by some await or if a start function is invoked.</p>
<h2 id="Understand-Kotlin-Coroutines-on-Android-Google-I-O‚Äô19"><a href="#Understand-Kotlin-Coroutines-on-Android-Google-I-O‚Äô19" class="headerlink" title="Understand Kotlin Coroutines on Android (Google I/O‚Äô19)"></a>Understand Kotlin Coroutines on Android (Google I/O‚Äô19)</h2><p><a href="https://www.youtube.com/watch?v=BOHK_w09pVA">https://www.youtube.com/watch?v=BOHK_w09pVA</a></p>
<img width="1176" alt="cor" src="https://user-images.githubusercontent.com/2284279/57587873-6836f400-750c-11e9-9944-2c00b8d83a87.png">
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-13T14:10:40.000Z" title="2017-12-13T14:10:40.000Z">2017-12-13</time><span class="level-item">a minute read (About 140 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Hashable-and-Set-in-Swift/">Hashable and Set in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/122">#122</a></strong></p>
<p>From <a href="https://developer.apple.com/documentation/swift/set">Set</a></p>
<blockquote>
<p>You can create a set with any element type that conforms to the Hashable protocol. By default, most types in the standard library are hashable, including strings, numeric and Boolean types, enumeration cases without associated values, and even sets themselves.</p>
</blockquote>
<p>From <a href="https://developer.apple.com/documentation/swift/hashable">Hashable</a></p>
<blockquote>
<p>The Hashable protocol inherits from the Equatable protocol, so you must also add an equal-to operator (==) function for your custom type.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Hashable</span> : <span class="title">Equatable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The hash value.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Hash values are not guaranteed to be equal across different executions of</span></span><br><span class="line">    <span class="comment">/// your program. Do not save hash values to use during a future execution.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://useyourloaf.com/blog/swift-hashable/">https://useyourloaf.com/blog/swift-hashable/</a></li>
<li><a href="http://kelan.io/2015/swift-hashable-for-sets/">http://kelan.io/2015/swift-hashable-for-sets/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-13T11:53:23.000Z" title="2017-12-13T11:53:23.000Z">2017-12-13</time><span class="level-item">a few seconds read (About 16 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Generic-declaration-in-Swift/">Generic declaration in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/121">#121</a></strong></p>
<p>These are different</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiffService</span>&lt;<span class="title">T</span>: <span class="title">MKAnnotation</span> &amp; <span class="title">Equatable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiffService</span>&lt;<span class="title">T</span>: <span class="title">MKAnnotation</span>, <span class="title">Equatable</span>&gt;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-07T16:41:32.000Z" title="2017-12-07T16:41:32.000Z">2017-12-07</time><span class="level-item">22 minutes read (About 3334 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/A-taste-of-MVVM-and-Reactive-paradigm/">A taste of MVVM and Reactive paradigm</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/120">#120</a></strong></p>
<p>Original post <a href="https://medium.com/flawless-app-stories/a-taste-of-mvvm-and-reactive-paradigm-5288a819cca1">https://medium.com/flawless-app-stories/a-taste-of-mvvm-and-reactive-paradigm-5288a819cca1</a></p>
<hr>
<h2 id="A-taste-of-MVVM-and-Reactive-paradigm"><a href="#A-taste-of-MVVM-and-Reactive-paradigm" class="headerlink" title="A taste of MVVM and Reactive paradigm"></a>A taste of MVVM and Reactive paradigm</h2><p>I like Swift, like many other object oriented programming languages. Swift allows you to represent real world objects that have some characteristics and can perform some action.</p>
<p>I tend to think of an app as a world where each object is a person. They work and communicate. If a person can‚Äôt do the work alone, he needs to ask for help. Take a project, for example, if the manager has to do all of the work by himself, he will go crazy. So there is a need to organise and delegate tasks, and for many persons to collaborate on the project: designer, tester, scrum master, developer. After the task is done, the manager needs to be informed.</p>
<p>This may not a good example. But at least you get the importance of communication and delegation in OOP. I was very intrigued by the word ‚Äúarchitecture‚Äù when I started iOS programming. But after doing for a while, it all comes down to identifying and splitting responsibilities. This article tells a bit about MVC and simple <a href="https://refactoring.com/catalog/extractClass.html">Extract Class</a>refactoring to MVVM, and how to go further with Rx. You are free to create your own architecture, but whatever you do, consistence is key as to not confuse or surprise your teammates.</p>
<h2 id="Model-View-Controller"><a href="#Model-View-Controller" class="headerlink" title="Model View Controller"></a>Model View Controller</h2><p>Take a look at the architecture you know the best, MVC, short for Model View Controller. You always get one when you create a new iOS project. View is where you present your data, using UIView, UIButton, UILabel. Model is just a fancy word for data. It can be your entity, data from networking, object from database, or from cache. The controller is the thing that mediates between the model and the view.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*ETgFfqjBaD8SdQBd.png" alt=""></p>
<h2 id="UIViewController-is-the-center-of-the-universe"><a href="#UIViewController-is-the-center-of-the-universe" class="headerlink" title="UIViewController is the center of the universe"></a>UIViewController is the center of the universe</h2><p>The problem with ViewController is that it tends to be huge. Apple puts it as the center of the universe, where it has lots of properties and responsibilities. There are many things that you can only do with a UIViewController. Things like interacting with storyboard, managing the view, configuring view rotation, state restoration. UIViewController is designed with lots of hooks for you to override and customize.</p>
<p>Take a look at the many sections in UIViewController <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller">documentation</a>, you can‚Äôt do the following without a UIViewController.</p>
<pre><code>func viewDidLoad()
var preferredStatusBarStyle: UIStatusBarStyle { get }
UITableViewDataSource
var presentationController: UIPresentationController? { get }
func childViewControllerForScreenEdgesDeferringSystemGestures() -&gt; UIViewController?
func didMove(toParentViewController parent: UIViewController?)
var systemMinimumLayoutMargins: NSDirectionalEdgeInsets
var edgesForExtendedLayout: UIRectEdge
var previewActionItems: [UIPreviewActionItem]
var navigationItem: UINavigationItem
var shouldAutorotate: Bool</code></pre><p>As your app grows, we need to add more code for other logic. Such as networking, data source, handling multiple delegates, presenting child view controllers. We can, of course, put all the stuff on the view controller, but that results in big view controller and improvement in your scrolling skill. This is where you lose the big picture of responsibilities because all stuff stays in the mega view controller. You tend to introduce code duplication and bugs are hard to fix because they are all over the places.</p>
<p>The same goes with Page in Windows Phone or Activity in Android. They are intended for a screen or partial screen of functionality. There are certain actions that can only be done through them like <a href="https://msdn.microsoft.com/en-us/library/system.windows.controls.page.onnavigatedto%28v=vs.105%29.aspx">Page.OnNavigatedTo</a>, <a href="https://developer.android.com/guide/components/activities/activity-lifecycle#oncreate">Activity.onCreate</a>.</p>
<p><img src="https://cdn-images-1.medium.com/max/3000/0*FegPo70Zxmid6brv.png" alt=""></p>
<h2 id="The-buzzwords-of-architecture"><a href="#The-buzzwords-of-architecture" class="headerlink" title="The buzzwords of architecture"></a>The buzzwords of architecture</h2><p>What do you do when the ViewController is doing a lot? You offset the work to other components. By the way, if you want another object to do the user input handling, you can use the Presenter. If the Presenter is doing too much, then it can offset the business logic to the Interactor. Also, there are more buzzwords that can be used.</p>
<pre><code>let buzzWords = [
  &quot;Model&quot;, &quot;View&quot;, &quot;Controller&quot;, &quot;Entity&quot;, &quot;Router&quot;, &quot;Clean&quot;, &quot;Reactive&quot;, 
  &quot;Presenter&quot;, &quot;Interactor&quot;, &quot;Megatron&quot;, &quot;Coordinator&quot;, &quot;Flow&quot;, &quot;Manager&quot;
]
let architecture = buzzWords.shuffled().takeRandom()
let acronym = architecture.makeAcronym()</code></pre><p><img src="https://cdn-images-1.medium.com/max/2000/0*N785wG7eDrflu_OT.jpeg" alt=""></p>
<p>After all the buzzwords are assembled, we get an architecture. There are <a href="https://github.com/onmyway133/fantastic-ios-architecture">many</a> of them, ranging from simple extract class refactoring, embracing MVC or taking inspiration from Clean Code, Rx, EventBus or Redux. The choice depends on project, and some teams prefer one architecture over the other.</p>
<h2 id="The-pragmatic-programmer"><a href="#The-pragmatic-programmer" class="headerlink" title="The pragmatic programmer"></a>The pragmatic programmer</h2><p>People have different opinion about what is good architecture. For me, it is about clear separation of concern, good communication pattern and being comfortable to use. Each component in the architecture should be identifiable and have a specific role. The communication must be clear so that we know which object is talking to each other. This together with good dependency injection will make testing easier.</p>
<p>Things that sound good in theory may not work well in practice. Separated domain objects are cool, protocol extensions are cool, multiple layers of abstraction are cool. But too many of them can be a problem.</p>
<p>If you read enough about design patterns, you know they all come down to these simple principles:</p>
<ul>
<li><p>Encapsulate what varies: identify the aspects of your application that vary and separate them from what stays the same.</p>
</li>
<li><p>Program to an interface, not an implementation</p>
</li>
<li><p>Prefer composition over inheritance</p>
</li>
</ul>
<p>If there‚Äôs one thing we should master, it‚Äôs <strong>composition</strong>. The key is to identify responsibility and compose them in a reasonable and consistent way. Consult with your team mates on what suits the most. Always writing code with the thought that you will also be the future maintainer. Then you will write it differently.</p>
<h2 id="Don‚Äôt-fight-against-the-system"><a href="#Don‚Äôt-fight-against-the-system" class="headerlink" title="Don‚Äôt fight against the system"></a>Don‚Äôt fight against the system</h2><p>Some architectures introduce completely new paradigm. Some of them are cumbersome that there people write scripts to generate boiler plate code. It‚Äôs good that there are many approaches to a problem. But for me sometimes it feels they are fighting the system. Some tasks are made easy while some trivial tasks become extremely hard. We should not constrain ourselves to one architecture simply because it are trendy. Be pragmatic, not dogmatic.</p>
<p>In iOS, we should embrace MVC. UIViewController is not meant for a full screen of content. They can contain and be composed to split the functionalities. We can use <a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a> and <a href="https://github.com/onmyway133/blog/issues/106">FlowController</a> to manage dependencies and handle flow. <a href="https://www.swiftbysundell.com/posts/custom-container-view-controllers-in-swift">Container</a>for state transition, embedded logic <a href="https://www.swiftbysundell.com/posts/logic-controllers-in-swift">controller</a>, <a href="https://davedelong.com/blog/2017/11/06/a-better-mvc-part-3-fixing-massive-view-controller/">part</a> of full screen content. This embracing ViewController approach play nicely with MVC in iOS and is my preferable way of doing.</p>
<h2 id="Model-View-ViewModel"><a href="#Model-View-ViewModel" class="headerlink" title="Model View ViewModel"></a>Model View ViewModel</h2><p><img src="https://cdn-images-1.medium.com/max/2000/0*oRX6izHOCsHdhDoW.png" alt=""></p>
<p>Another good-enough way is to offload some of the tasks to another object, let‚Äôs call it ViewModel. The name does not matter, you can name it Reactor, Maestro, Dinosaur. The important thing is your team get an agreed name. ViewModel takes some tasks from the ViewController and reports when it‚Äôs done. There are <a href="https://www.objc.io/issues/7-foundation/communication-patterns/">communication patterns</a> in Cocoa Touch such as delegate, closures to use.</p>
<p>ViewModel is self-contained, has no reference to UIKit, and has just input and output. We can put <a href="https://ashfurrow.com/blog/mvvm-is-exceptionally-ok/">a lot of things</a> into ViewModel like calculation, formatting, networking, business logic. Also, if you don‚Äôt like the ViewModel to become massive, you surely need to create some dedicated objects. ViewModel is the first step to get a slim ViewController.</p>
<h2 id="Synchronously"><a href="#Synchronously" class="headerlink" title="Synchronously"></a>Synchronously</h2><p>Below is a very simple ViewModel, which formats data based on User model. This is done synchronously.</p>
<pre><code>class ProfileController: UIViewController {
  override func viewDidLoad() {
    super.viewDidLoad()
    let viewModel = ViewModel(user: user)
    nameLabel.text = viewModel.name
    birthdayLabel.text = viewModel.birthdayString
    salaryLabel.text = viewModel.salary
    piLabel.text = viewModel.millionthDigitOfPi
  }
}</code></pre><h2 id="Asynchronously"><a href="#Asynchronously" class="headerlink" title="Asynchronously"></a>Asynchronously</h2><p>We work with asynchronous API all the time. What if we want to show the user‚Äôs number of Facebook friends? For this to work we need to call Facebook API and this operation takes time. The ViewModel can report back via closure.</p>
<pre><code>viewModel.getFacebookFriends { friends in
  self.friendCountLabel.text = &quot;\(friends.count)&quot;
}</code></pre><p>Internally, the ViewModel may offload the task to a dedicated Facebook API client object.</p>
<pre><code>class ViewModel {
  func getFacebookFriends(completion: [User] -&gt; Void) {
    let client = APIClient()
    client.getFacebookFriends(for: user) { friends in
      DispatchQueue.main.async {
        completion(friends)
      }
    }
  }
}</code></pre><h2 id="Jetpack-in-Android"><a href="#Jetpack-in-Android" class="headerlink" title="Jetpack in Android"></a>Jetpack in Android</h2><p><img src="https://cdn-images-1.medium.com/max/2000/0*ORC4mswaenJBZOwP.png" alt=""></p>
<p>Google introduced Android Architecture Component, now part of Jetpack, at Google IO 2017. It has ViewModel and LiveData, which is also a type of MVVM applied in Android. ViewModel survives through configuration changes, and notify results in terms of LiveData for Activity to consume.</p>
<pre><code>class MyActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?, persistentState: PersistableBundle?) {
        super.onCreate(savedInstanceState, persistentState)

        val model = ViewModelProviders.of(this).get(MyViewModel::class.java)
        model.getUsers().observe(this, { users -&gt;
            // update UI
        })
    }
}</code></pre><p>This is one of the reason I like ViewModel. If we follow ViewModel like this, then code structures between iOS and Android become similar. There should be no need for some random Javascript cross platform solutions. You learn the concept once, and apply it on both iOS and Android. I learn ViewModel, RxSwift on iOS and feel right at home when I work with RxJava and RxBinding on Android. The Kickstarter project also proves that this works well in their <a href="https://github.com/kickstarter/ios-oss">iOS</a> and <a href="https://github.com/kickstarter/android-oss">Android</a> apps.</p>
<h2 id="Binding"><a href="#Binding" class="headerlink" title="Binding"></a>Binding</h2><p>To encapsulate the closure, we can create a class called Binding, which can notify one or multiple listeners. It takes advantage of didSet, and the observable property becomes clear.</p>
<pre><code>class Binding&lt;T&gt; {
  var value: T {
    didSet {
      listener?(value)
    }
  }
  private var listener: ((T) -&gt; Void)?
  init(value: T) {
    self.value = value
  }
  func bind(_ closure: @escaping (T) -&gt; Void) {
    closure(value)
    listener = closure
  }
}</code></pre><p>Here is how to use it inside ViewModel:</p>
<pre><code>class ViewModel {
  let friends = Binding&lt;[User]&gt;(value: [])
  init() {
    getFacebookFriends {
      friends.value = $0
    }
  }
  func getFacebookFriends(completion: ([User]) -&gt; Void) {
      // Do the work
  }
}</code></pre><p>When ever friends are fetched, or changed, the ViewController is updated accordingly. This is called reaction to changes.</p>
<pre><code>override func viewDidLoad() {
  super.viewDidLoad()
  viewModel.friends.bind { friends in
    self.friendsCountLabel.text = &quot;\(friends.count)&quot;
  }
}</code></pre><p>You often see MVVM introduction with reactive frameworks, and it is for a reason. They offer many chaining operators and make reactive programming easier and more declarative.</p>
<h2 id="RxSwift"><a href="#RxSwift" class="headerlink" title="RxSwift"></a>RxSwift</h2><p>Perhaps the most common reactive framework in Swift is <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a>. The thing I like about it is that it follows <a href="http://reactivex.io/">ReactiveX</a> pattern. So you will feel more familiar if you already use <a href="https://github.com/ReactiveX/RxJava">RxJava</a>, <a href="https://github.com/ReactiveX/rxjs">RxJs</a>, or <a href="https://github.com/ReactiveX/RxKotlin">RxKotlin</a>.</p>
<h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h2><p><img src="https://cdn-images-1.medium.com/max/2000/0*GXJMWsuz8LvgkEXb.png" alt=""></p>
<p>RxSwift unifies sync and async operations through Observable. This is how you make one.</p>
<pre><code>class ViewModel {
  let friends: Observable&lt;[User]&gt;
  init() {
    let client = APIClient()
    friends = Observable&lt;[User]&gt;.create({ subscriber in
      client.getFacebookFriends(completion: { friends in
        subscriber.onNext(friends)
        subscriber.onCompleted()
      })
      return Disposables.create()
    })
  }
}</code></pre><p>The power of RxSwift lies in its numerous operators, which help you chain Observables. Here you can call 2 network requests, wait for both of them to finish, then sum up the friends. This is very streamlined and saves you lots of time. Here you can just subscribe to the Observable, it will be triggered when the request completes:</p>
<pre><code>override func viewDidLoad() {
  super.viewDidLoad()
  viewModel.friends.subscribe(onNext: { friends in
    self.friendsCountLabel.text = &quot;\(friends.count)&quot;
  })
}</code></pre><h2 id="Input-and-output"><a href="#Input-and-output" class="headerlink" title="Input and output"></a>Input and output</h2><p>One thing that is nice about ViewModel and Rx is that we can separate input and output using Observable, which gives a clear interface. Read more at <a href="https://github.com/onmyway133/blog/issues/87">Learning from Open Source: Input and output container</a>.</p>
<p>Below it is clear that we fetch is an input, and friends is the viable output.</p>
<pre><code>class ViewModel {
  class Input {
    let fetch = PublishSubject&lt;()&gt;()
  }
  class Output {
    let friends: Driver&lt;[User]&gt;
  }
  let apiClient: APIClient
  let input: Input
  let output: Output
  init(apiClient: APIClient) {
    self.apiClient = apiClient
    // Connect input and output
  }
}

class ProfileViewController: BaseViewController&lt;ProfileView&gt; {
  let viewModel: ProfileViewModelType
  init(viewModel: ProfileViewModelType) {
    self.viewModel = viewModel
  }
  override func viewDidLoad() {
    super.viewDidLoad()
    // Input
    viewModel.input.fetch.onNext(())
    // Output
    viewModel.output.friends.subscribe(onNext: { friends in
      self.friendsCountLabel.text = &quot;\(friends.count)&quot;
    })
  }
}</code></pre><h2 id="How-reactive-works"><a href="#How-reactive-works" class="headerlink" title="How reactive works"></a>How reactive works</h2><p>If you feel like Rx, it‚Äôs good to get an understanding of them after using some frameworks for a while. There are some concepts like Signal, SignalProducer, Observable, Promise, Future, Task, Job, Launcher, Async and some people can have a very distinction about them. Here I simply call it Signal, which is something that can signal values.</p>
<h2 id="Monad"><a href="#Monad" class="headerlink" title="Monad"></a>Monad</h2><p>Signal and its <a href="https://en.wikipedia.org/wiki/Result_type">Result</a> are just <a href="https://en.wikipedia.org/wiki/Monad_%28functional_programming%29">monads</a>, which are thing that can be mapped and chained.</p>
<p>Signal makes use of deferred execution callback closures. It can be pushed or pulled. Which is just how the Signal updates its value and the order the callbacks are called.</p>
<p>Execution callback closure means that we pass a function to another function. And the passed in function will get called when appropriated.</p>
<h2 id="Sync-vs-Async"><a href="#Sync-vs-Async" class="headerlink" title="Sync vs Async"></a>Sync vs Async</h2><p>Monad can be in either sync or async mode. Sync is easier to understand, but async is somewhat you‚Äôre already familiar and used in practice.</p>
<p>Basically,</p>
<ul>
<li><p>Sync: you get the returned value right away via return</p>
</li>
<li><p>Async: you get the returned value via callback block</p>
</li>
</ul>
<p>Here is an example of simple sync and async free functions:</p>
<pre><code>// Sync
func sum(a: Int, b: Int) -&gt; Int {
    return a + b
}

// Async
func sum(a: Int, b: Int, completion: Int -&gt; Void) {
    // Assumed it is a very long task to get the result
    let result = a + b

    completion(result)
}</code></pre><p>And how sync and async apply to Result type. Notice the async version, we get the transformed value in a completion closure instead of immediate return from function.</p>
<pre><code>enum Result&lt;T&gt; {
  case value(value: T)
  case failure(error: Error)

  // Sync
  public func map&lt;U&gt;(f: (T) -&gt; U) -&gt; Result&lt;U&gt; {
    switch self {
    case let .value(value):
      return .value(value: f(value))
    case let .failure(error):
      return .failure(error: error)
    }
  }

  // Async
  public func map&lt;U&gt;(f: @escaping ((T), (U) -&gt; Void) -&gt; Void) -&gt; (((Result&lt;U&gt;) -&gt; Void) -&gt; Void) {
    return { g in   // g: Result&lt;U&gt; -&gt; Void
      switch self {
      case let .value(value):
        f(value) { transformedValue in  // transformedValue: U
          g(.value(value: transformedValue))
        }
      case let .failure(error):
        g(.failure(error: error))
      }
    }
  }
}</code></pre><h2 id="Push-Signal"><a href="#Push-Signal" class="headerlink" title="Push Signal"></a>Push Signal</h2><p>Given a chained signals like this:</p>
<p>A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe)</p>
<p>Push Signal, means that when the source signal A is sent an event, it propagates that event via callbacks. PushSignal is similar to PublishSubject in RxSwift.</p>
<ul>
<li><p>Triggered by sending event to the source signal.</p>
</li>
<li><p>We must keep A as it keeps the others around</p>
</li>
<li><p>We subscribe the last D</p>
</li>
<li><p>We send event to the first A</p>
</li>
<li><p>A ‚Äòs callback gets called, it it in turn calls callback of B with the result of A ‚Äòs map, then B ‚Äòs callback calls C ‚Äòs callback with the result of B‚Äòs flatMap, and so on.</p>
</li>
</ul>
<p>It is similar to <a href="https://promisesaplus.com/">Promise A+</a>, you can see my Swift implementation of Promise A+ <a href="https://github.com/onmyway133/Then/blob/master/Pod/Classes/Promise.swift">in my Then framework</a>. For now, here is the Swift 4 implementation of a simple PushSignal.</p>
<pre><code>public final class PushSignal&lt;T&gt; {
  var event: Result&lt;T&gt;?
  var callbacks: [(Result&lt;T&gt;) -&gt; Void] = []
  let lockQueue = DispatchQueue(label: &quot;Serial Queue&quot;)

  func notify() {
    guard let event = event else {
      return
    }

    callbacks.forEach { callback in
      callback(event)
    }
  }

  func update(event: Result&lt;T&gt;) {
    lockQueue.sync {
      self.event = event
    }

    notify()
  }

  public func subscribe(f: @escaping (Result&lt;T&gt;) -&gt; Void) -&gt; Signal&lt;T&gt; {
    // Callback
    if let event = event {
      f(event)
    }

    callbacks.append(f)

    return self
  }

  public func map&lt;U&gt;(f: @escaping (T) -&gt; U) -&gt; Signal&lt;U&gt; {
    let signal = Signal&lt;U&gt;()

    _ = subscribe { event in
      signal.update(event: event.map(f: f))
    }

    return signal
  }
}</code></pre><p>Below is how a PushSignal is used to transform a chain from string to its length, you should see 4, the length of the string ‚Äútest‚Äù printed.</p>
<pre><code>let signal = PushSignal&lt;String&gt;()

_ = signal.map { value in
  return value.count
}.subscribe { event in
  if case let .value(value) = event {
    print(value)
  } else {
    print(&quot;error&quot;)
  }
}

signal.update(event: .value(value: &quot;test&quot;))</code></pre><h2 id="Pull-Signal"><a href="#Pull-Signal" class="headerlink" title="Pull Signal"></a>Pull Signal</h2><p>Given a chained signals like this:</p>
<p>A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe)</p>
<p>Pull Signal, sometimes called Future, means when we subscribe to the final signal D, it causes the previous signals to action:</p>
<ul>
<li><p>Triggered by subscribing to the final signal D;</p>
</li>
<li><p>We must keep D as it keeps the others around;</p>
</li>
<li><p>We subscribe the last D;</p>
</li>
<li><p>D ‚Äòs operation runs, and it cause C ‚Äòs operation to runs, ‚Ä¶ then A ‚Äòs operation runs. It is in A that the task is performed (like fetching network, retrieving database, file access, heavy computation, ‚Ä¶) to get the result, and A ‚Äòs completion gets called. Then A‚Äôs completion calls B ‚Äòs completion with the result mapped by B ‚Äòs map, ‚Ä¶ all the way to the subscriber ‚Äòs completion block.</p>
</li>
</ul>
<p>Here is a Swift 4 implementation of PullSignal. PullSignal is similar to Observablein RxSwift and SignalProducer in ReactiveSwift.</p>
<pre><code>public struct PullSignal&lt;T&gt; {
  let operation: ((Result&lt;T&gt;) -&gt; Void) -&gt; Void

  public init(operation: @escaping ((Result&lt;T&gt;) -&gt; Void) -&gt; Void) {
    self.operation = operation
  }

  public func start(completion: (Result&lt;T&gt;) -&gt; Void) {
    operation() { event in
      completion(event)
    }
  }

  public func map&lt;U&gt;(f: @escaping (T) -&gt; U) -&gt; PullSignal&lt;U&gt; {
    return PullSignal&lt;U&gt; { completion in
      self.start { event in
        completion(event.map(f: f))
      }
    }
  }
}</code></pre><p>The chain is inactive until you call start at the last signal in the chain, which triggers operation flow all over to the first signal. Run this snippet and you should see 4, the length of the string ‚Äútest‚Äù printed on the console.</p>
<pre><code>let signal = PullSignal&lt;String&gt; { completion in
  // There should be some long running operation here
  completion(Result.value(value: &quot;test&quot;))
}

signal.map { value in
  value.count
}.start { event in
  if case let .value(value) = event {
    print(value)
  } else {
    print(&quot;error&quot;)
  }
}</code></pre><p>I hope those snippets are simple enough to help you understand how signal works under the hood, and how to differentiate hot and cold signals. To get a fully working Signal framework, you need to implement more operations. Such as retry, rebounce, throttle, queue, flatten, filter, delay, combine and add support for UIKit like RxCocoa does. Find out how to implement in my <a href="https://github.com/onmyway133/archives/tree/master/Signal/Pod/Classes">Signal</a> repo.</p>
<h2 id="Where-to-go-from-here"><a href="#Where-to-go-from-here" class="headerlink" title="Where to go from here"></a>Where to go from here</h2><p>Architecture is a very opinionated topic. Hopefully this article gives you some ideas to add into your decision points. MVC is dominant in iOS, MVVM is a good friend and Rx is a powerful tool. Here are some more interesting readings:</p>
<ul>
<li><a href="https://ashfurrow.com/blog/mvvm-is-exceptionally-ok/">MVVM is Exceptionally OK</a></li>
<li><a href="https://academy.realm.io/posts/krzysztof-zablocki-mDevCamp-ios-architecture-mvvm-mvc-viper/">Good iOS Application Architecture: MVVM vs. MVC vs. VIPER</a></li>
<li><a href="https://www.youtube.com/watch?v=YWVzCd5FYbs">A Better MVC</a></li>
<li><a href="https://blog.uptech.team/taming-great-complexity-mvvm-coordinators-and-rxswift-8daf8a76e7fd">Taming Great Complexity: MVVM, Coordinators and RxSwift</a></li>
<li><a href="http://blogs.microsoft.co.il/bnaya/2010/03/13/rx-for-beginners-part-9-hot-vs-cold-observable/">Rx ‚Äî for beginners (part 9): Hot Vs. Cold observable</a></li>
<li><a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/HotAndColdObservables.md">Hot and Cold Observables</a></li>
<li><a href="https://stackoverflow.com/questions/17082255/when-to-use-ienumerable-vs-iobservable">When to use IEnumerable vs IObservable?</a></li>
<li><a href="https://www.youtube.com/watch?v=AcDaWe3S75c">Functional Reactive Programming without Black Magic</a></li>
<li><a href="https://www.youtube.com/watch?v=mbd6g7NfR-8">Swift Sync and Async Error Handling</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-07T15:22:39.000Z" title="2017-12-07T15:22:39.000Z">2017-12-07</time><span class="level-item">13 minutes read (About 1974 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Collection-Update/">Collection Update</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/119">#119</a></strong></p>
<p>This is about collection update, how to provide correct IndexPath and a simple diffing algorithm</p>
<ul>
<li>Excerpt from my talk at CocoaHeads, Oslo <a href="https://www.meetup.com/CocoaHeads-Oslo/events/244892347/">https://www.meetup.com/CocoaHeads-Oslo/events/244892347/</a></li>
<li>Slide <a href="https://speakerdeck.com/onmyway133/collection-update">https://speakerdeck.com/onmyway133/collection-update</a></li>
</ul>
<h2 id="CollectionView"><a href="#CollectionView" class="headerlink" title="CollectionView"></a>CollectionView</h2><p>It‚Äôs hard to imagine of any apps that don‚Äôt use Table View or CollectionView. And by CollectionView, I actually mean UICollectionView üòâ  . Most of the time, we show something with response from backend, then potentially update and insert new items as data changed.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/34838146-55461fbc-f6fd-11e7-928f-b5461a51893f.png" alt="collectionview"></p>
<p>We can totally call <code>reloadData</code> to reflect the changes, but an animation is better here as it gives user better understanding of what‚Äôs going on, and to not surprise them. </p>
<p>This talks about <code>UICollectionView</code>, but <code>UITableView</code> behaves the same</p>
<h2 id="Drag-and-Drop"><a href="#Drag-and-Drop" class="headerlink" title="Drag and Drop"></a>Drag and Drop</h2><p>Let‚Äôs imagine an app where user are allowed to customise their experience by moving items from one collection to another.</p>
<p>You can take a look at the example <a href="https://github.com/onmyway133/CollectionUpdateExample/tree/master/DragAndDrop">DragAndDrop</a> which is using the new <a href="https://developer.apple.com/ios/drag-and-drop/">drag and drop API</a> in iOS 11.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33726942-d084fa74-db76-11e7-95e0-6580f4c5fc9d.png" alt="ipad"></p>
<p>You must ensure that your data is changed before calling update methods on <code>UICollectionView</code>. And then we call <code>deleteItems</code> and <code>insertItems</code> to reflect data changes. <code>UICollectionView</code> performs a nice animation for you</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, performDropWith coordinator: UICollectionViewDropCoordinator)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> destinationIndexPath = coordinator.destinationIndexPath</span><br><span class="line">  <span class="keyword">let</span> sourceIndexPath = coordinator.items.last?.dragItem.localObject <span class="keyword">as</span>! <span class="type">IndexPath</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// remove</span></span><br><span class="line">  sourceItems.remove(at: sourceIndexPath.item)</span><br><span class="line">  sourceCollectionView.deleteItems(at: [sourceIndexPath])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// insert</span></span><br><span class="line">  destinationItems.insert(draggedItem, at: destinationIndexPath.item)</span><br><span class="line">  destinationCollectionView.insertItems(at: [destinationIndexPath])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NSInternalInconsistencyException"><a href="#NSInternalInconsistencyException" class="headerlink" title="NSInternalInconsistencyException"></a>NSInternalInconsistencyException</h2><p>If you have large number of items with many insertions and deletions from backend response, you need to calculate the correct IndexPath to call, which are not easy thing. Most the time you will get the following crashes</p>
<blockquote>
<p>Terminating app due to uncaught exception ‚ÄòNSInternalInconsistencyException‚Äô,<br>reason: ‚ÄòInvalid update: invalid number of items in section 0.<br>The number of items contained in an existing section after the update (213)<br>must be equal to the number of items contained in that section before<br>the update (154), plus or minus the number of items inserted or<br>deleted from that section (40 inserted, 0 deleted) and plus<br>or minus the number of items moved into or out of<br>that section (0 moved in, 0 moved out).‚Äô</p>
</blockquote>
<p>In my experience it happened randomly because everyone has different data. Although the message is very descriptive, it may take a while to figure it out.</p>
<h2 id="Game-of-IndexPath"><a href="#Game-of-IndexPath" class="headerlink" title="Game of IndexPath"></a>Game of IndexPath</h2><p>Let‚Äôs refine our knowledge of <code>IndexPath</code> by going through some examples. With a collection of 6 items, we perform some update operations and figure out what <code>IndexPath</code> should be. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>]</span><br></pre></td></tr></table></figure>

<p>Take a look at my example here <a href="https://github.com/onmyway133/CollectionUpdateExample/tree/master/CollectionUpdateExample">CollectionUpdateExample</a>, there are many more examples</p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33727113-647cfe34-db77-11e7-8533-4dd84657e718.png" height="400" />
<img src="https://user-images.githubusercontent.com/2284279/33727115-6499e350-db77-11e7-8030-971bd9a29040.png" height="400" />
</div>

<h2 id="index-vs-offset"><a href="#index-vs-offset" class="headerlink" title="index vs offset"></a>index vs offset</h2><p>Before we go any further, I just want to mention that, by <code>index</code> I actually mean <code>offset from the start</code>. If you take a look at the <a href="https://developer.apple.com/documentation/swift/array/1687832-enumerated">enumerated</a> function, it suggests the name as <code>offset</code> instead of <code>index</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Array</span>(<span class="number">0</span>..&lt;<span class="number">10</span>).enumerated().forEach &#123; (offset, element) <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This <a href="https://en.wikipedia.org/wiki/Zero-based_numbering">zero based numbering</a> could shed some light on this matter</p>
<blockquote>
<p>Particularly in C, where arrays are closely tied to pointer arithmetic, this makes for a simpler implementation: the subscript refers to an offset from the starting position of an array, so the first element has an offset of zero.</p>
</blockquote>
<h3 id="1-Insert-3-items-at-the-end"><a href="#1-Insert-3-items-at-the-end" class="headerlink" title="1.  Insert 3 items at the end"></a>1.  Insert 3 items at the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, c, d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPaths = <span class="type">Array</span>(<span class="number">6</span>...<span class="number">8</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">collectionView.insertItems(at: indexPaths)</span><br></pre></td></tr></table></figure>

<h3 id="2-Delete-3-items-at-the-end"><a href="#2-Delete-3-items-at-the-end" class="headerlink" title="2. Delete 3 items at the end"></a>2. Delete 3 items at the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">items.removeLast()</span><br><span class="line">items.removeLast()</span><br><span class="line">items.removeLast()</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">collectionView.deleteItems(at: indexPaths)</span><br></pre></td></tr></table></figure>

<h3 id="3-Update-item-at-index-2"><a href="#3-Update-item-at-index-2" class="headerlink" title="3. Update item at index 2"></a>3. Update item at index 2</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items[<span class="number">2</span>] = <span class="string">"üëª"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, üëª, d, e, f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: <span class="number">2</span>, section: <span class="number">0</span>)</span><br><span class="line">collectionView.reloadItems(at: [indexPath])</span><br></pre></td></tr></table></figure>

<h3 id="4-Move-item-‚Äúc‚Äù-to-the-end"><a href="#4-Move-item-‚Äúc‚Äù-to-the-end" class="headerlink" title="4. Move item ‚Äúc‚Äù to the end"></a>4. Move item ‚Äúc‚Äù to the end</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">items.remove(at: <span class="number">2</span>)</span><br><span class="line">items.append(<span class="string">"c"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// a, b, d, e, f, c</span></span><br><span class="line"></span><br><span class="line">collectionView.moveItem(</span><br><span class="line">  at: <span class="type">IndexPath</span>(item: <span class="number">2</span>, section: <span class="number">0</span>),</span><br><span class="line">  to: <span class="type">IndexPath</span>(item: <span class="number">5</span>, section :<span class="number">0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end"><a href="#5-Delete-3-items-at-the-beginning-then-insert-3-items-at-the-end" class="headerlink" title="5. Delete 3 items at the beginning, then insert 3 items at the end"></a>5. Delete 3 items at the beginning, then insert 3 items at the end</h3><p>With multiple different operations, we should use <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1618045-performbatchupdates">performBatchUpdates</a></p>
<blockquote>
<p>You can use this method in cases where you want to make multiple changes to the collection view in one single animated operation, as opposed to in several separate animations. You might use this method to insert, delete, reload, or move cells or use it to change the layout parameters associated with one or more cells</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-Insert-3-items-at-the-end-then-delete-3-items-beginning"><a href="#6-Insert-3-items-at-the-end-then-delete-3-items-beginning" class="headerlink" title="6. Insert 3 items at the end, then delete 3 items beginning"></a>6. Insert 3 items at the end, then delete 3 items beginning</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">6</span>...<span class="number">8</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h2 id="üôÄ"><a href="#üôÄ" class="headerlink" title="üôÄ"></a>üôÄ</h2><p>If you run the example 6, you will get a crash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Terminating app due to uncaught exception </span><br><span class="line">&#39;NSInternalInconsistencyException&#39;, </span><br><span class="line">reason: &#39;attempt to insert item 6 into section 0, </span><br><span class="line">but there are only 6 items in section 0 after the update&#39;</span><br></pre></td></tr></table></figure>

<h2 id="performBatchUpdates"><a href="#performBatchUpdates" class="headerlink" title="performBatchUpdates"></a>performBatchUpdates</h2><p>It is because the way <code>performBatchUpdates</code> works. If you take a look at the <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1618045-performbatchupdates">documentation</a></p>
<blockquote>
<p>Deletes are processed before inserts in batch operations. This means the indexes for the deletions are processed relative to the indexes of the collection view‚Äôs state before the batch operation, and the indexes for the insertions are processed relative to the indexes of the state after all the deletions in the batch operation.</p>
</blockquote>
<p>No matter how we call insert or delete, <code>performBatchUpdates</code> always performs deletions first. So we need to call <code>deleteItems</code> and <code>insertItems</code> as if the deletions occur first.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">items.append(contentsOf: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>])</span><br><span class="line"></span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line">items.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// d, e, f, g, h, i</span></span><br><span class="line"></span><br><span class="line">collectionView.performBatchUpdates(&#123;</span><br><span class="line">  <span class="keyword">let</span> deleteIndexPaths = <span class="type">Array</span>(<span class="number">0</span>...<span class="number">2</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.deleteItems(at: deleteIndexPaths)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> insertIndexPaths = <span class="type">Array</span>(<span class="number">3</span>...<span class="number">5</span>).<span class="built_in">map</span> &#123; <span class="type">IndexPath</span>(item: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;</span><br><span class="line">  collectionView.insertItems(at: insertIndexPaths)</span><br><span class="line">&#125;, completion: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Operations"><a href="#Operations" class="headerlink" title="Operations"></a>Operations</h2><p>There are many operations on <code>UICollectionView</code>, and there are operations to update whole section as well. Take a look <a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/ManageInsertDeleteRow/ManageInsertDeleteRow.html">Ordering of Operations and Index Paths</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insertItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">deleteItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">reloadItems(at indexPaths: [<span class="type">IndexPath</span>])</span><br><span class="line">moveItem(at indexPath: <span class="type">IndexPath</span>, to newIndexPath: <span class="type">IndexPath</span>)</span><br><span class="line">performBatchUpdates(<span class="number">_</span> updates, completion)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insertSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">deleteSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">reloadSections(<span class="number">_</span> sections: <span class="type">IndexSet</span>)</span><br><span class="line">moveSection(<span class="number">_</span> section: <span class="type">Int</span>, toSection newSection: <span class="type">Int</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/TableView_iPhone/Art/batch_insert_delete.jpg" alt="inline"></p>
<h2 id="Edit-distance"><a href="#Edit-distance" class="headerlink" title="Edit distance"></a>Edit distance</h2><p>Doing these calculations by hand is quite tedious and error prone. We can build our own abstraction using some algorithms. The naive one is <a href="https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm">Wagner‚ÄìFischer algorithm</a> which uses <a href="https://en.wikipedia.org/wiki/Dynamic_programming">Dynamic Programming</a> to tell the edit distance between two strings of characters.</p>
<p>Edit distance means the number of steps needed to change from one string to another. String is just a collection of characters, so we can generalise this concept to make it work for any collection of items. Instead of comparing character, we require items to conform to <code>Equatable</code></p>
<h2 id="‚Äúkit‚Äù-gt-‚Äúkat‚Äù"><a href="#‚Äúkit‚Äù-gt-‚Äúkat‚Äù" class="headerlink" title="‚Äúkit‚Äù -&gt; ‚Äúkat‚Äù"></a>‚Äúkit‚Äù -&gt; ‚Äúkat‚Äù</h2><p>How can we transform form the word ‚Äúkit‚Äù to ‚Äúkat‚Äù? What kinds of operations do we nede to perform? You may tell ‚Äújust change the i to a‚Äù, but this trivial example helps you understand the algorithm. Let‚Äôs get started.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278613-5dc25c70-d39c-11e7-8a5c-2e8e6946ae36.jpg" alt="inline"></p>
<h3 id="Deletions"><a href="#Deletions" class="headerlink" title="Deletions"></a>Deletions</h3><p>If we go from ‚Äúkit‚Äù to an empty string ‚Äú‚Äù, we need 3 deletions </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243688-2bade616-d2eb-11e7-8463-f913695818ef.png" alt="inline"></p>
<p>‚Äúk‚Äù -&gt; ‚Äú‚Äù  üëâ 1 deletion<br>‚Äúki‚Äù -&gt; ‚Äú‚Äù üëâ 2 deletions<br>‚Äúkit‚Äù -&gt; ‚Äú‚Äù üëâ    3 deletions</p>
<h3 id="Insertions"><a href="#Insertions" class="headerlink" title="Insertions"></a>Insertions</h3><p>If we go from an empty string ‚Äú‚Äù to ‚Äúkat‚Äù, we need 3 insertions</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243726-c078ee3a-d2eb-11e7-918f-8bba30be0c0e.png" alt="inline"></p>
<p>‚Äú‚Äù -&gt; ‚Äúk‚Äù  üëâ    1 insertion<br>‚Äú‚Äù -&gt; ‚Äúka‚Äù  üëâ    2 insertions<br>‚Äú‚Äù -&gt; ‚Äúkat‚Äù  üëâ    3 insertions</p>
<h3 id="If-equal-take-value-from-the-top-left"><a href="#If-equal-take-value-from-the-top-left" class="headerlink" title="If equal, take value from the top left"></a>If equal, take value from the top left</h3><p>You can think of the algorithm as if we go from source string, to empty string, to destination string. We try to find the minimum steps to update. Going horizontally means insertions, vertically means deletions and diagonally means substitutions</p>
<p>This way we can build our matrix, iterate from row to row, column by column. First, the letter ‚Äúk‚Äù from source collection is the same with letter ‚Äúk‚Äù from destination collection, we simply take value from the top left, which is 0 substituion</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243911-9f1e87d8-d2ee-11e7-8dde-bb2f02593eca.png" alt="inline"></p>
<h3 id="If-not-equal"><a href="#If-not-equal" class="headerlink" title="If not equal"></a>If not equal</h3><p>We continue with the next letter from the destination collection. Here ‚Äúk‚Äù and ‚Äúa‚Äù are not the same. We take minimum value from left, top, top left. Then increase by one</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243912-9f371230-d2ee-11e7-8386-85ed3f9f4bcf.png" alt="inline"></p>
<p>Here we take value from left, which is horizontally, so we increase by 1 insertion</p>
<h3 id="‚Äúk‚Äù-gt-‚Äúkat‚Äù-üëâ-2-insertions"><a href="#‚Äúk‚Äù-gt-‚Äúkat‚Äù-üëâ-2-insertions" class="headerlink" title="‚Äúk‚Äù -&gt; ‚Äúkat‚Äù üëâ 2 insertions"></a>‚Äúk‚Äù -&gt; ‚Äúkat‚Äù üëâ 2 insertions</h3><p>Continue, they are not the same, so we take value from left horizontally. Here you can see it kind makes sense, as to go from ‚Äúk‚Äù to ‚Äúkat‚Äù, we need 2 insertions, which is to insert letters ‚Äúa‚Äù and ‚Äút‚Äù</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33243913-9f4ed1ea-d2ee-11e7-9fae-71693ec1844d.png" alt="inline"></p>
<h3 id="The-bottom-right-value"><a href="#The-bottom-right-value" class="headerlink" title="The bottom right value"></a>The bottom right value</h3><p>Continue with the next row, and next row until we  got to the bottom right value, which gives you the edit distance. Here 1 substitution means that we need to perform 1 substitution to go from ‚Äúkit‚Äù to ‚Äúkat‚Äù, which is update ‚Äúi‚Äù with ‚Äúa‚Äô</p>
<p><img src="https://user-images.githubusercontent.com/2284279/35505204-a7b5f0f6-04e5-11e8-8124-4e8868f2ea8d.png" alt="final"></p>
<p>You can easily see that we need to update index 1. But how do we know that it is index 1 ü§î </p>
<h2 id="Edit-steps"><a href="#Edit-steps" class="headerlink" title="Edit steps"></a>Edit steps</h2><p>In each step, we need to associate the index of item in source and destination collection. You can take a look at my implementation <a href="https://github.com/onmyway133/DeepDiff">DeepDiff</a></p>
<p><img src="https://github.com/onmyway133/DeepDiff/raw/master/Screenshots/collection.gif" alt="inline"></p>
<h2 id="Complexity"><a href="#Complexity" class="headerlink" title="Complexity"></a>Complexity</h2><p>We iterate through the matrix, with <code>m</code> and <code>n</code> are the length of source and destination collection respectively, we can see that the complexity of this algorithm is 0(mn).</p>
<p>Also the performance greatly depends on the size of the collection and how complex the item is. The more complex and how deep you want to perform <code>Equatable</code> can greatly affect your performance.</p>
<h2 id="Improving-performance"><a href="#Improving-performance" class="headerlink" title="Improving performance"></a>Improving performance</h2><p>The section <a href="https://github.com/onmyway133/DeepDiff#how-does-it-work">How does it work</a> shows several ways we can improve performance.</p>
<p>Firstly, instead of building a matrix, which costs memory <code>m*n</code>, we can just use temporary arrays as holder. </p>
<p>Secondly, to quickly compare 2 items, we can use <code>Hashable</code>, as 2 identical items will always have the same hash.</p>
<h2 id="More-performance"><a href="#More-performance" class="headerlink" title="More performance"></a>More performance</h2><p>If you want better performance, then algorithms with linear complexity may be interested to you. Take a look at <a href="https://github.com/onmyway133/blog/issues/99">Diff algorithm</a></p>
<ul>
<li><a href="http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf">Heckel</a></li>
<li><a href="https://publications.mpi-cbg.de/Wu_1990_6334.pdf">Wu</a></li>
<li><a href="http://www.xmailserver.org/diff2.pdf">Myers</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-07T15:19:40.000Z" title="2017-12-07T15:19:40.000Z">2017-12-07</time><span class="level-item">a few seconds read (About 69 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Commit-as-another-user-on-GitHub/">Commit as another user on GitHub</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/118">#118</a></strong></p>
<p>GitHub identifies users by email, so you can totally commit using someone ‚Äòs email. This is how to configure in SourceTree</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33725599-e8fb350e-db72-11e7-959a-4d8eca6f5a9a.png" alt="sourcetree"></p>
<ul>
<li><a href="https://help.github.com/articles/signing-commits-using-gpg/">https://help.github.com/articles/signing-commits-using-gpg/</a></li>
<li><a href="https://help.github.com/articles/why-are-my-commits-linked-to-the-wrong-user/">https://help.github.com/articles/why-are-my-commits-linked-to-the-wrong-user/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-07T15:17:57.000Z" title="2017-12-07T15:17:57.000Z">2017-12-07</time><span class="level-item">a minute read (About 210 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Badge-in-GitHub/">Badge in GitHub</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/117">#117</a></strong></p>
<p>GitHub is so awesome. It is where people around the world collaborate with each other.<br>It is more awesome to show more about you in your GitHub profile. How about a badge? a welcome text?<br>It is doable with organization. GitHub takes time and name of the organiazations you joined to determined how it displays on your profile</p>
<p>This used to be what shown on my GitHub profile <a href="https://github.com/onmyway133">https://github.com/onmyway133</a></p>
<p><img src="https://user-images.githubusercontent.com/2284279/33725489-8d4994a8-db72-11e7-9dd8-e5cfc83a0975.png" alt="1_61enfsc61onicous7vdwkw"></p>
<p>For me, I display the text ‚ÄúHello World‚Äù, so I have to create organizations for ‚Äúh‚Äù, ‚Äúe‚Äù, ‚Äúl‚Äù, ‚Äúl‚Äù, ‚Äúo‚Äù, ‚Äúw‚Äù, ‚Äúo‚Äù, ‚Äúr‚Äù, ‚Äúl‚Äù, ‚Äúd‚Äù<br>To ensure the order, you can name your organization like ‚Äúorg-h‚Äù, ‚Äúorg-he‚Äù, ‚Äúorg-hel‚Äù, ‚Äúorg-hell‚Äù, ‚Äúorg-hello‚Äù, ‚Ä¶ and you must join the organization in the correct order<br>I create another GitHub account called <a href="https://github.com/fantabot">https://github.com/fantabot</a> to manage my organizations<br>Your imaginary is your limit. May your code continue to compile :grin:</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-06T13:59:24.000Z" title="2017-12-06T13:59:24.000Z">2017-12-06</time><span class="level-item">a minute read (About 191 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Case-sensitivity-in-HTTP/">Case sensitivity in HTTP</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/115">#115</a></strong></p>
<h2 id="Is-URL-case-sensitive"><a href="#Is-URL-case-sensitive" class="headerlink" title="Is URL case sensitive ?"></a>Is URL case sensitive ?</h2><p>According to <a href="https://www.w3.org/TR/WD-html40-970708/htmlweb.html">HTML and URLs </a></p>
<blockquote>
<p>URLs in general are case-sensitive (with the exception of machine names). There may be URLs, or parts of URLs, where case doesn‚Äôt matter, but identifying these may not be easy. Users should always consider that URLs are case-sensitive.</p>
</blockquote>
<h2 id="Is-header-case-sensitive"><a href="#Is-header-case-sensitive" class="headerlink" title="Is header case sensitive?"></a>Is header case sensitive?</h2><p>According to <a href="https://tools.ietf.org/html/rfc7230#section-3.2">RFC 7230</a></p>
<blockquote>
<p>Each header field consists of a case-insensitive field name followed by a colon (‚Äú:‚Äù), optional leading whitespace, the field value, and optional trailing whitespace.</p>
</blockquote>
<h2 id="Is-method-case-sensitive"><a href="#Is-method-case-sensitive" class="headerlink" title="Is method case sensitive?"></a>Is method case sensitive?</h2><p>Using <code>URLSession</code>, mostly we will get <code>200</code> with <code>request.httpMethod = &quot;GET&quot;</code> and <code>400</code> with <code>request.httpMethod = &quot;get&quot;</code>. Generally speaking, you should use some popular wrappers <a href="https://github.com/Alamofire/Alamofire">Alamofire</a> or <a href="https://github.com/hyperoslo/Malibu">Malibu</a> as they are mature enough. Spend your precious time solving more important problems instead.</p>
<p>According to <a href="https://tools.ietf.org/html/rfc7231#page-24">RFC 7231</a></p>
<blockquote>
<p>The method token is case-sensitive because it might be used as a gateway to object-based systems with case-sensitive method names.</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-05T07:33:40.000Z" title="2017-12-05T07:33:40.000Z">2017-12-05</time><span class="level-item">2 minutes read (About 244 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Understanding-let-apply-with-run-in-Kotlin/">Understanding let, apply, with, run in Kotlin</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/114">#114</a></strong></p>
<p>Picture worths thousand words. Code worths thousand pictures. I don‚Äôt understand much until I take a look at <a href="https://github.com/JetBrains/kotlin/blob/master/libraries/stdlib/src/kotlin/util/Standard.kt">Standard.kt</a> in Kotlin standard library.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the specified function [block] with `this` value as its receiver and returns `this` value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.InlineOnly</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    block()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the specified function [block] with `this` value as its argument and returns its result.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@kotlin</span>.<span class="keyword">internal</span>.InlineOnly</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">let</span><span class="params">(block: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>apply</code> returns T  and accepts a block of type <code>T.() -&gt; Unit</code>. This is called <a href="https://kotlinlang.org/docs/reference/lambdas.html#function-literals-with-receiver">Function Literals with Receiver</a></li>
</ul>
<blockquote>
<p>Kotlin provides the ability to call a function literal with a specified receiver object. Inside the body of the function literal, you can call methods on that receiver object without any additional qualifiers. This is similar to extension functions, which allow you to access members of the receiver object inside the body of the function</p>
</blockquote>
<ul>
<li><code>let</code> returns R and accepts a block of type <code>T -&gt; R</code>. Inside the block, you can access <code>it</code> which is <a href="https://kotlinlang.org/docs/reference/lambdas.html#it-implicit-name-of-a-single-parameter">it: implicit name of a single parameter</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-01T12:41:58.000Z" title="2017-12-01T12:41:58.000Z">2017-12-01</time><span class="level-item">3 minutes read (About 468 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Using-Playground-with-CocoaPods/">Using Playground with CocoaPods</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/113">#113</a></strong></p>
<p>This is a follow up from my post <a href="https://github.com/onmyway133/blog/issues/94">Learning from Open Source: Using Playground</a> on how to actually add a playground to your production project.</p>
<p>The idea is simple: create a framework so that Playground can access the code. This demo an iOS project with CocoaPods. See the demo <a href="https://github.com/onmyway133/UsingPlayground">https://github.com/onmyway133/UsingPlayground</a></p>
<p>This is also my question to this question <a href="https://stackoverflow.com/questions/47589855/how-to-expose-your-project-code-to-a-xcode-playground-when-using-cocoapods/47595120#47595120">https://stackoverflow.com/questions/47589855/how-to-expose-your-project-code-to-a-xcode-playground-when-using-cocoapods/47595120#47595120</a></p>
<h3 id="1-Add-a-pod"><a href="#1-Add-a-pod" class="headerlink" title="1. Add a pod"></a>1. Add a pod</h3><p>Create a new project called <code>UsingPlayground</code>. Create a <code>Podfile</code> with a pod <a href="https://github.com/hyperoslo/Cheers">Cheers</a> because we want something fun üòÑ </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">platform <span class="symbol">:ios</span>, <span class="string">'9.0'</span></span><br><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">pod <span class="string">'Cheers'</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'UsingPlayground'</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Use-the-pod-in-your-project"><a href="#2-Use-the-pod-in-your-project" class="headerlink" title="2. Use the pod in your project"></a>2. Use the pod in your project</h3><p>This is very straightforward. Just to make sure the pod work</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Cheers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> cheerView = <span class="type">CheerView</span>()</span><br><span class="line">    view.addSubview(cheerView)</span><br><span class="line">    cheerView.frame = view.bounds</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Configure</span></span><br><span class="line">    cheerView.config.particle = .confetti</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start</span></span><br><span class="line">    cheerView.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Build and run the project to enjoy a very fascinating confetti üéä </p>
<h3 id="3-Add-a-CocoaTouch-framework"><a href="#3-Add-a-CocoaTouch-framework" class="headerlink" title="3. Add a CocoaTouch framework"></a>3. Add a CocoaTouch framework</h3><p>In your workspace, select the <code>UsingPlayground</code> project, add new CocoaTouch framework. Let‚Äôs call it <code>AppFramework</code>. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485759-e6a9779a-d6a7-11e7-850d-05aceec69e37.png" alt="framework"></p>
<p>Then add source files to this framework. For now, just check file <code>ViewController.swift</code> add add it to the <code>AppFramework</code> target too.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485764-e9ebf3f6-d6a7-11e7-8b61-b97c3a8774aa.png" alt="targets"></p>
<h3 id="4-Public"><a href="#4-Public" class="headerlink" title="4. Public"></a>4. Public</h3><p>Swift types and methods are internal by default. So in order for them to be visible in the Playground, we need to declare them as public.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class ViewController: UIViewController &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-Add-pod-to-AppFramework"><a href="#5-Add-pod-to-AppFramework" class="headerlink" title="5. Add pod to AppFramework"></a>5. Add pod to AppFramework</h3><p>In order for AppFramework to use our pods, we need to add those pods into framework target as well. Add <code>target &#39;AppFramework&#39;</code> to your Podfile</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">platform <span class="symbol">:ios</span>, <span class="string">'9.0'</span></span><br><span class="line"></span><br><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">pod <span class="string">'Cheers'</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'UsingPlayground'</span></span><br><span class="line">target <span class="string">'AppFramework'</span></span><br></pre></td></tr></table></figure>

<p>Now run <code>pod install</code> again. In some rare cases, you need to run <code>pod deintegrate</code> and <code>pod install</code> to start from a clean slate</p>
<h3 id="6-Add-a-Playground"><a href="#6-Add-a-Playground" class="headerlink" title="6. Add a Playground"></a>6. Add a Playground</h3><p>Add a Playground and drag that to our workspace. Let‚Äôs call it <code>MyPlayground</code></p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485907-6a88a4a0-d6a8-11e7-8f03-dec00122601d.png" alt="play"></p>
<h3 id="6-Enjoy"><a href="#6-Enjoy" class="headerlink" title="6. Enjoy"></a>6. Enjoy</h3><p>Now edit our <code>MyPlayground</code>. You can import frameworks from pod and our <code>AppFramework</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Cheers</span><br><span class="line"><span class="keyword">import</span> AppFramework</span><br><span class="line"><span class="keyword">import</span> PlaygroundSupport</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cheerView = <span class="type">CheerView</span>()</span><br><span class="line">cheerView.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">50</span>, width: <span class="number">200</span>, height: <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configure</span></span><br><span class="line">cheerView.config.particle = .confetti</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start</span></span><br><span class="line">cheerView.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myController = <span class="type">ViewController</span>()</span><br><span class="line"></span><br><span class="line"><span class="type">PlaygroundPage</span>.current.liveView = myController.view</span><br></pre></td></tr></table></figure>

<p>Remember to toggle Editor Mode so you can see Playground result</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33485980-b221c1ac-d6a8-11e7-9214-15dbbc123380.png" alt="enjoy"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-30T13:46:09.000Z" title="2017-11-30T13:46:09.000Z">2017-11-30</time><span class="level-item">a few seconds read (About 46 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Using-assembly/">Using assembly</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/112">#112</a></strong></p>
<p>I‚Äôm very fascinated when people use assembly to perform investigation, that‚Äôs just mind blowing üí• . Here are some of the favorite use cases</p>
<ul>
<li><a href="https://objective-see.com/blog/blog_0x24.html">Why blank Gets You Root</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-27T16:07:53.000Z" title="2017-11-27T16:07:53.000Z">2017-11-27</time><span class="level-item">a few seconds read (About 14 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Talks/">Talks</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/111">#111</a></strong></p>
<p>Please visit <a href="https://onmyway133.github.io/speaking">https://onmyway133.github.io/speaking</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-27T15:20:15.000Z" title="2017-11-27T15:20:15.000Z">2017-11-27</time><span class="level-item">27 minutes read (About 4118 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/URL-Routing-with-Compass/">URL Routing with Compass</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/110">#110</a></strong></p>
<p>Medium version <a href="https://medium.com/@onmyway133/url-routing-with-compass-d59c0061e7e2">https://medium.com/@onmyway133/url-routing-with-compass-d59c0061e7e2</a></p>
<hr>
<p>Apps often have many screens, and <code>UIViewController</code> works well as the basis for a screen, together with presentation and navigation APIs. Things are fine until you get lost in the forest of flows, and code becomes hard to maintain. </p>
<p>One way to avoid this is the <code>central URL routing</code> approach. Think of it as a network router that handles and resolves all routing requests. This way, the code becomes declarative and decoupled, so that the list component does not need to know what it‚Äôs presenting. URL routing also makes logging and tracking easy along with ease of handling external requests such as deep linking. </p>
<p>There are various frameworks that perform URL routing. In this tutorial you‚Äôll use <a href="https://github.com/hyperoslo/Compass">Compass</a> for its simplicity. You‚Äôll refactor an existing app, which is a simplified Instagram app named <code>PhotoFeed</code>. When you‚Äôve finished this tutorial, you‚Äôll know how to declare and use routers with Compass and handle deep linking. </p>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><p>Download the <a href="https://github.com/onmyway133/PhotoFeed/tree/start">starter project</a> and unzip it. Go to the <code>PhotoFeed</code> folder and run <code>pod install</code> to install the particular dependencies for this project. Open <code>PhotoFeed.xcworkspace</code> and run the project. Tap <code>Login</code> to go to the Instagram login page and enter your Instagram credentials, then have a look around the app. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277373-a808bf8a-d398-11e7-9b27-9ddc4549ffdc.png" alt="artboard"></p>
<p>The main app is made of a <code>UITabBarController</code> that shows the feed, the currently logged-in user profile and a menu. This is a typical <code>Model View Controller</code> project where <code>UIViewController</code> handles <code>Cell</code> delegates and takes responsibility for the navigation. For simplicity, all view controllers inherit from <code>TableController</code> and <code>CollectionController</code> that know how to manage list of a particular model and cell. All models conform to the new Swift 4 <code>Codable</code> protocol.</p>
<h2 id="Registering-Your-App-on-Instagram"><a href="#Registering-Your-App-on-Instagram" class="headerlink" title="Registering Your App on Instagram"></a>Registering Your App on Instagram</h2><p>In order to use the Instagram API, you‚Äôll need to register your app at <a href="https://www.instagram.com/developer/">Instagram Developer</a>. After obtaining your <em>client id</em>, switch back to the project. Go to <code>APIClient.swift</code> and modify your <code>clientId</code>. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277396-b40a3bec-d398-11e7-9f1d-3033870e0738.png" alt="artboard 2"></p>
<p><strong>Note</strong>: The project comes with a default app with limited permissions. The app can‚Äôt access following or follower APIs, and you can only see your own posts and comments</p>
<h1 id="Compass-101"><a href="#Compass-101" class="headerlink" title="Compass 101"></a>Compass 101</h1><p>The concept of Compass is very simple: you have a set of routes and central place for handling these routes. Think of a route as a navigation request to a specific screen within the app. The idea behind URL routing is borrowed from the modern web server. When user enters a URL into the browser, such as <code>https://flawlessapp.io/category/ios</code>, that request is sent from the browser to the web server. The server parses the URL and returns the requested content, such as HTML or JSON. Most web server frameworks have URL routing support, including <a href="https://expressjs.com/en/guide/routing.html">ASP.NET</a>, <a href="https://expressjs.com/en/guide/routing.html">Express.js</a>, and others. For example, here is how you handle a URL route in express.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/api/category/:categoryTag'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> page = getCategoryPageFor(req.params.categoryTag)</span><br><span class="line">  res.send(page)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Users or apps request a specific URL that express an intent about what should be returned or displayed. But instead of returning web pages, Compass constructs screens in terms of <code>UIViewController</code> and presents them.</p>
<h2 id="Route-Patterns"><a href="#Route-Patterns" class="headerlink" title="Route Patterns"></a>Route Patterns</h2><p>This is how you declare a routing schema in Compass:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Navigator</span>.routes = [<span class="string">"profile:&#123;userId&#125;"</span>, <span class="string">"post:&#123;postId&#125;"</span>, <span class="string">"logout"</span>]</span><br></pre></td></tr></table></figure>

<p>This is simply as array of patterns you register on the <code>Navigator</code>. This is the central place where you define all your routes. Since they are in one place, all your navigations are kept in one place and can easily be understood. Looking at the example above, <code>{userId}, {postId}</code> are placeholders that will be resolved to actual parameters. For example with <code>post:BYOkwgXnwr3</code>, you get <code>userId</code> of <code>BYOkwgXnwr3</code>. Compass also performs pattern matching, in that <code>post:BYOkwgXnwr3</code> matches <code>post:{postId}</code>, not <code>comment:{postId}</code>, <code>blogpost:{postId}</code>, ‚Ä¶This will become to make sense in following sections. </p>
<h2 id="The-Navigator"><a href="#The-Navigator" class="headerlink" title="The Navigator"></a>The Navigator</h2><p>The <code>Navigator</code> is a the central place for routes registration, navigating and handling.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277861-1855fa40-d39a-11e7-8449-0d10608d2501.png" alt="artboard 3"></p>
<p> The next step is to trigger a routing request. You can do that via the <code>Navigator</code>. For example, this is how you do  in the feed to request opening a specific post:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Navigator</span>.navigate(urn: <span class="string">"post:BYOkwgXnwr3"</span>)</span><br></pre></td></tr></table></figure>

<p>Compass uses the user-friendly <code>urn</code>, short for <a href="https://no.wikipedia.org/wiki/Uniform_Resource_Name">Uniform Resource Name</a> to make itwork seamlessly with <a href="https://en.wikipedia.org/wiki/Mobile_deep_linking">Deep Linking</a>. This <code>urn</code> matches the routing schema <code>post:{postId}</code>. Compass uses <code>{param}</code> as the special token to identifier the parameter and <code>:</code> as the delimiter. You can change the delimiter to something else by configuring <code>Navigator.delimiter</code>. You have learned how to register routes and navigate in Compass. Next, you will learn how to customize the handling code to your need.</p>
<h2 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h2><p><code>Navigator</code> parses and works with <code>Location</code> under the hood. Given the <code>URN</code> of <code>post:BYOkwgXnwr3</code>, you get a <code>Location</code> where <code>path</code> is the route pattern, and <code>arguments</code> contain the resolved parameters.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">"post:&#123;postId&#125;"</span></span><br><span class="line">arguments = [</span><br><span class="line">  <span class="string">"postId"</span>: <span class="string">"BYOkwgXnwr3"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>To actually perform the navigation, you assign a closure that takes a <code>Location</code> to <code>Navigator.handle</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Navigator</span>.handle = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] location <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> `<span class="keyword">self</span>` = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> arguments = location.arguments</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> location.path &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"post:&#123;postId&#125;"</span>:</span><br><span class="line">      <span class="keyword">let</span> postController = <span class="type">PostController</span>(postId: postID)</span><br><span class="line">      <span class="keyword">self</span>.rootController.pushViewController(postController, animated: <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>let</code>self<code>= self</code> dance is to ensure <code>self</code> isn‚Äôt released by the time this closure is executed. If it is released, the routing it‚Äôs about to perform is likely invalid, and you return without doing anything instead. You should typically do the above  in the components that own the root controller, such as <code>AppDelegate</code> as seen above.  That‚Äôs the basic of Compass. Astute readers may have noticed that it does not scale, as the number of <code>switch</code> statements will grow as the number of routes and endpoints increase in your app. This is where the <code>Routable</code> protocol comes in.  Anything conforming to <code>Routable</code> knows how to handle a specific route. Apps may have many modular sections, and each section may have a set of routes. Compass handles these scenario by using a composite <code>Routable</code> named <code>Router</code> that groups them . You can have a router for a pre-login module, a post-login module, premium features module, and so on. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277894-2eff78de-d39a-11e7-8554-bf064b621921.png" alt="untitled 2 2017-08-30 09-53-58"></p>
<p>In the next section, you‚Äôll change PhotoFeed to use <code>Router</code> and <code>Routable</code>.</p>
<h1 id="Router-to-the-Rescue"><a href="#Router-to-the-Rescue" class="headerlink" title="Router to the Rescue"></a>Router to the Rescue</h1><p>The first step is to include Compass in your project. Using <code>CocoaPods</code>, this is an easy task. Edit the <code>Podfile</code> with the project and type <code>pod &#39;Compass&#39;, &#39;~&gt; 5.0&#39;</code> just before the <code>end</code> statement. Then open Terminal and execute the following:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure>

<p>The version of Compass used in this tutorial is <code>5.1.0</code>.</p>
<h2 id="Registering-a-Router"><a href="#Registering-a-Router" class="headerlink" title="Registering a Router"></a>Registering a Router</h2><p><img src="https://user-images.githubusercontent.com/2284279/33277916-3da628f6-d39a-11e7-9652-b45ea4a935fd.png" alt="untitled 2 2017-08-30 10-04-50"></p>
<p>To start, you‚Äôll create a simple router to handle all post-login routes. Open <em>AppDelegate.swift</em>, and import Compass at the top of the file:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Next, add the following router declaration under the <code>var mainController: MainController?</code> declaration:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postLoginRouter = <span class="type">Router</span>()</span><br></pre></td></tr></table></figure>

<p>Then declare a function called <code>setupRouting</code>, you ‚Äòll do this in an extension to separate the routing setup from the main code in <code>AppDelegate</code>. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">setupRouting</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// [1] Register scheme</span></span><br><span class="line">    <span class="type">Navigator</span>.scheme = <span class="string">"photofeed"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [2] Configure routes for Router</span></span><br><span class="line">    postLoginRouter.routes = [:]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [3] Register routes you 'd like to support</span></span><br><span class="line">    <span class="type">Navigator</span>.routes = <span class="type">Array</span>(postLoginRouter.routes.keys)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [4] Do the handling</span></span><br><span class="line">    <span class="type">Navigator</span>.handle = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] location <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> selectedController = <span class="keyword">self</span>?.mainController?.selectedViewController <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// [5] Choose the current visible controller</span></span><br><span class="line">      <span class="keyword">let</span> currentController = (selectedController <span class="keyword">as</span>? <span class="type">UINavigationController</span>)?.topViewController</span><br><span class="line">        ?? selectedController</span><br><span class="line"></span><br><span class="line">      <span class="comment">// [6] Navigate</span></span><br><span class="line">      <span class="keyword">self</span>?.postLoginRouter.navigate(to: location, from: currentController)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here‚Äôs what you do in the above method:</p>
<ol>
<li>Declare a scheme for Compass to work. This is your application URL scheme. This shines when you wish to support deep linking .</li>
<li>Register all the routes in your app. <code>Router</code> accepts a mapping of route and <code>Routable</code> conformers. This is empty for now, but you will add several routes in a moment.</li>
<li>A <code>Navigator</code> can manage multiple routers. In this case, you only register one router.</li>
<li>This is where you supply the handling closure. <code>Navigator</code> uses this to handle a resolved location request.</li>
<li>Screens in one modular section originate from one root or parent view controller. In order to show something from the route, you should try to push or present it from the selected most-visible view controller. In this project, the root is a <code>UITabBarController</code>, so you try to get the top controller from the current selected navigation. The selection of <code>current controller</code> depends on the module and your app use cases, so Compass let you decide it.  If you use the side menu drawer, then you can just change the selected view controller.</li>
<li>Finally, since <code>Router</code> is a composite <code>Routable</code>, you dispatch to it the <code>Location</code>.</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/2284279/33277961-531e6342-d39a-11e7-9199-158a469a3709.png" alt="main storyboard 2017-08-30 10-37-16"></p>
<p>Finally, you need to call this newly added function. Add the following line right above <code>window?.makeKeyAndVisible()</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setupRouting()</span><br></pre></td></tr></table></figure>

<p>Build and run. Nothing seems to work yet! To make things happen, you‚Äôll need to add all the route handlers. You‚Äôll do this in the next section.</p>
<h2 id="Implementing-the-Route-Handlers"><a href="#Implementing-the-Route-Handlers" class="headerlink" title="Implementing the Route Handlers"></a>Implementing the Route Handlers</h2><p>First, create a new file and name it <code>Routers.swift</code>. This is where you‚Äôll declare all of your route handlers. At the beginning of the file, add <code>import Compass</code>. Compass declares a simple protocol ‚Äî <code>Routable</code> ‚Äî that decides what to do with a given <code>Location</code> request from a <code>Current Controller</code>. If a request can‚Äôt be handled, it will throw with <code>RouteError</code>. Its implementation looks like this: </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It‚Äôs an incredibly simple protocol. Any routes you create only need to implement that single method. Now create your first handler to deal with user info request. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// [1] Examine arguments</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> userId = location.arguments[<span class="string">"userId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [2] Create the controller</span></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"UserController"</span>) <span class="keyword">as</span>! <span class="type">UserController</span></span><br><span class="line">    controller.userId = userId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is called when you touch the post author on the feed. Here‚Äôs what‚Äôs happening:</p>
<ol>
<li><code>UserRoute</code> deals with <code>user:{userId} urn</code>, so <code>location.arguments[&quot;userId&quot;]</code> should contain the correct <code>userId</code> to inject into <code>UserController</code>.</li>
<li>This app uses storyboards to make the UI, so get the correct view controller based on its identifier. Remember tha <code>currentController</code> is the current visible controller in the navigation stack. So you ask for its <code>UINavigationController</code> to push a new view controller.</li>
</ol>
<p>Right below this router, add one more route for the screen shown when the user wants to see who likes a particular post:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LikesRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> mediaId = location.arguments[<span class="string">"mediaId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"LikesController"</span>) <span class="keyword">as</span>! <span class="type">LikesController</span></span><br><span class="line">    controller.mediaId = mediaId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="The-remaining-Route"><a href="#The-remaining-Route" class="headerlink" title="The remaining Route"></a>The remaining Route</h3><p>Now it‚Äôs your turn to write the other route handlers: <code>CommentsRoute, FollowingRoute, FollowerRoute</code>. See if you can figure it out first, you can find the solution below. Here‚Äôs what you should have:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CommentsRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> mediaId = location.arguments[<span class="string">"mediaId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"CommentsController"</span>) <span class="keyword">as</span>! <span class="type">CommentsController</span></span><br><span class="line">    controller.mediaId = mediaId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FollowingRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> userId = location.arguments[<span class="string">"userId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"FollowingController"</span>) <span class="keyword">as</span>! <span class="type">FollowingController</span></span><br><span class="line">    controller.userId = userId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FollowerRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> userId = location.arguments[<span class="string">"userId"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> controller = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"FollowerController"</span>) <span class="keyword">as</span>! <span class="type">FollowerController</span></span><br><span class="line">    controller.userId = userId</span><br><span class="line">    currentController.navigationController?.pushViewController(controller, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="The-LogoutRoute"><a href="#The-LogoutRoute" class="headerlink" title="The LogoutRoute"></a>The LogoutRoute</h3><p>There is one more route to add: the one you‚Äôll use for logout. <code>LogoutRoute</code> is quite tricky, as it usually involves changing the current root view controller. Who knows this better than the app delegate? Open <em>AppDelegate.swift</em> and add the following code at the very bottom:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LogoutRoute</span>: <span class="title">Routable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigate</span><span class="params">(to location: Location, from currentController: CurrentController)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="type">APIClient</span>.shared.accessToken = <span class="literal">nil</span></span><br><span class="line">    (<span class="type">UIApplication</span>.shared.delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).showLogin()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now that you‚Äôve implemented all of the route handlers, you will have to tell <code>Navigator</code> which route is used for which URN. Still in <em>AppDelegate.swift</em>, find <code>postLoginRouter.routes = [:]</code> and replace it with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">postLoginRouter.routes = [</span><br><span class="line">  <span class="string">"user:&#123;userId&#125;"</span>: <span class="type">UserRoute</span>(),</span><br><span class="line">  <span class="string">"comments:&#123;mediaId&#125;"</span>: <span class="type">CommentsRoute</span>(),</span><br><span class="line">  <span class="string">"likes:&#123;mediaId&#125;"</span>: <span class="type">LikesRoute</span>(),</span><br><span class="line">  <span class="string">"following:&#123;userId&#125;"</span>: <span class="type">FollowingRoute</span>(),</span><br><span class="line">  <span class="string">"follower:&#123;userId&#125;"</span>: <span class="type">FollowerRoute</span>(),</span><br><span class="line">  <span class="string">"logout"</span>: <span class="type">LogoutRoute</span>()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>Build the app and everything should compile. Now all that‚Äôs left is to actually <em>all</em> all of the code you‚Äôve written!</p>
<h2 id="Refactoring-Time"><a href="#Refactoring-Time" class="headerlink" title="Refactoring Time"></a>Refactoring Time</h2><p>It‚Äôs time to refactor all the code in <code>UIViewController</code> by replacing all the navigation code with your new routing instructions. Start by freeing the <code>FeedController</code> from the unnecessary tasks of navigation. Open <em>FeedController.swift</em> and add the following import to the top of the file:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Next, look for <code>// MARK: - MediaCellDelegate</code> and replace the three <code>MediaCell</code> delegate methods with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mediaCell</span><span class="params">(<span class="number">_</span> cell: MediaCell, didViewLikes mediaId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"likes:\(mediaId)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mediaCell</span><span class="params">(<span class="number">_</span> cell: MediaCell, didViewComments mediaId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"comments:\(mediaId)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mediaCell</span><span class="params">(<span class="number">_</span> cell: MediaCell, didSelectUserName userId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"user:\(userId)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For these three cases, you simply want to navigate to another screen. Therefore, all you need to do is tell the <code>Navigator</code> where you want to go. For simplicity, you use <code>try?</code> to deal with any code that throws. Build and run the app. Search for your favorite post in the feed, and tap on the author, the post comments or likes to go to the target screen. The app behaves the same as it did before, but the code is now clean and declarative. Now do the same with <em>UserController.swift</em>. Add the following import to the top of the file:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Replace the code after <code>// MARK: - UserViewDelegate</code> with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userView</span><span class="params">(<span class="number">_</span> view: UserView, didViewFollower userId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"follower:\(userId)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userView</span><span class="params">(<span class="number">_</span> view: UserView, didViewFollowing userId: String)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"following:\(userId)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your task now is to refactor with the last route <code>LogoutRoute</code>. Open <em>MenuController.swift</em> and add the following to the top:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compass</span><br></pre></td></tr></table></figure>

<p>Remove the <code>logout</code> method altogether. Find the following:</p>
<figure class="highlight plain"><figcaption><span>indexPath.section </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  logout()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‚Ä¶and replace it with:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> indexPath.section == <span class="type">Section</span>.account.rawValue, indexPath.row == <span class="number">0</span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: <span class="string">"logout"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Build and run the app, navigate to the menu and tap <em>Logout</em>. You should be taken to the login screen.</p>
<h1 id="Handling-Deep-Linking"><a href="#Handling-Deep-Linking" class="headerlink" title="Handling Deep Linking"></a>Handling Deep Linking</h1><p><a href="https://en.wikipedia.org/wiki/Mobile_deep_linking">Deep linking</a> allows your apps to be opened via a predefined URN. The system identifies each app via its <a href="https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html">URL scheme</a>. For web pages, the scheme is usually <code>http</code>, <code>https</code>. For <em>Instagram</em> it is, quite handily, <code>instagram</code>. Use cases for this are inter-app navigation and app advertisements. For examples, the Messenger app uses this to open the user profile in the Facebook app, and Twitter uses this to open the App Store to install another app from an advertisement. In order for user to be redirected back to PhotoFeed, you need to specify a custom URL scheme for your app. Remember where you declared <code>Navigator.scheme = &quot;photofeed&quot;</code>? PhotoFeed just so happens to conform to this URL scheme, so deep links already worked ‚Äî and you didn‚Äôt even know it! Build and run the app, then switch to Safari. Type <code>photofeed://</code> in the address bar, then tap Go. That will trigger your app to open. The app opens, but PhotoFeed doesn‚Äôt parse any parameters in the URL to go anywhere useful. Time to change that! Your app responds to the URL scheme opening by implementing a <code>UIApplicationDelegate</code> method. Add the following after <code>setupRouting</code> in <code>AppDelegate.swift</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> app: UIApplication, <span class="keyword">open</span> url: URL, options: [UIApplicationOpenURLOptionsKey : <span class="keyword">Any</span>] = [:])</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(url: url)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Navigator</code> parses and handles this for you. Build and run again. Go to Safari app, type <code>photofeed://user:self</code> and tap Go. Photofeed will open and show the currently logged in users‚Äô profile. Because you already had <code>UserRoute</code>, the requested URL was handled gracefully. Your app may already be presenting a particular screen when a routing request comes, but you‚Äôve anticipated this by resetting the navigation controller or presentation stack to show the requested screen. This simple solution works for most cases. Again, it‚Äôs recommended you pick the topmost visible view controller as the current controller in <code>Navigator.handle</code>.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33277990-709ae7c4-d39a-11e7-99b2-27acb7a1c5d0.png" alt="artboard 5"></p>
<p>Deep linking is usually considered external navigation, in that the routing requests come from outside your app. Thanks to the central routing system that you developed, the code to handle external and internal routing requests is very much the same and involves no code duplication at all.</p>
<h1 id="Routing-with-Push-Notifications"><a href="#Routing-with-Push-Notifications" class="headerlink" title="Routing with Push Notifications"></a>Routing with Push Notifications</h1><p>Push notifications help engage users with your app. You may have received messages like ‚ÄúHey, checkout today ‚Äòs most popular stories‚Äù on <em>Medium</em>, ‚ÄúYour friend has a birthday today‚Äù on Facebook, ‚Ä¶ and when you tap those banners, you are taken straight to that particular screen. How cool is that? This is achievable with your URL routing approach. Imagine users tapping a push notification banner saying ‚ÄúYou‚Äôre a celebrity on PhotoFeed ‚Äî check out your profile now!‚Äù and being sent directly to their profile screen. To accomplish this, you simply have to embed the URN info into the push payload and handle that in your app.</p>
<h2 id="Setting-up"><a href="#Setting-up" class="headerlink" title="Setting up"></a>Setting up</h2><p>To start, you‚Äôll need to specify your bundle ID. Go to <code>Target Settings\General</code> to change your bundle ID as push notification requires a unique bundle ID to work. Your project uses <code>com.fantageek.PhotoFeed</code> by default.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278026-8e1fe01a-d39a-11e7-982f-854ab7056aca.png" alt="step1_bundleid"> </p>
<p>Next, you‚Äôll need to register your <em>App ID</em>. Go to <a href="https://developer.apple.com/account/ios/certificate">Member Center</a> and register your App ID. Remember your <em>Team ID</em>, as you will need it in the final step. Also tick the <em>Push Notification</em> checkbox under <em>Application Services</em>. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278038-94947866-d39a-11e7-9386-8fffcd5bf9cf.png" alt="step1_appid"></p>
<p>Now you‚Äôll need to generate your <em>Authentication Key</em>. Apple provides <a href="https://developer.apple.com/news/?id=09222016a">Token Authentication</a> as a new authentication mechanism for push notifications. The token is easy to generate, works for all your apps, and mostly, it never expires. Still in <a href="https://developer.apple.com/account/ios/authkey/">Member Center</a>, create a new <em>Key</em> and download it as a <code>.p8</code> file. Remember your <em>Key ID</em> as you will need it in the final step. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278050-9bb3ccc8-d39a-11e7-99b8-076138e5b559.png" alt="step2_key"></p>
<p>Next up: enabling push notification capability. Back in Xcode, go to <code>Target Settings\Capabilities</code> and enable <em>Push Notifications</em>, which will add <code>PhotoFeed.entitlements</code> to your project. </p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278054-a21dde8c-d39a-11e7-907b-b1ec620050b4.png" alt="step3_capability"></p>
<p>The next step is to register for push notifications. Open <code>MainController.swift</code> and add the following import to the top of <em>MainController.swift</em>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UserNotifications</span><br></pre></td></tr></table></figure>

<p>You want to enable push notification only after login, so <code>MainController</code> is the perfect place. <a href="https://developer.apple.com/documentation/usernotifications">UserNotifications</a> is recommended for app targeting iOS 10 and above.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [1] Register to get device token for remote notifications</span></span><br><span class="line">  <span class="type">UIApplication</span>.shared.registerForRemoteNotifications()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [2] Register to handle push notification UI</span></span><br><span class="line">  <span class="keyword">let</span> options: <span class="type">UNAuthorizationOptions</span> = [.alert, .sound, .badge]</span><br><span class="line">  <span class="type">UNUserNotificationCenter</span>.current().requestAuthorization(options: options) &#123; (granted, error) <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(error <span class="keyword">as</span> <span class="type">Any</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The permission dialog is shown once, so make sure you accept it. It‚Äôs time to handle the device token. Open <code>AppDelegate.swift</code>, and add the following to the end of <code>extension AppDelegate</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data)</span></span> &#123;</span><br><span class="line">  <span class="comment">// [1] Parse to token string</span></span><br><span class="line">  <span class="keyword">let</span> token = deviceToken.<span class="built_in">map</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(format: <span class="string">"%02.2hhx"</span>, $<span class="number">0</span>)</span><br><span class="line">  &#125;.joined()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [2] Log it</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"Your device token is \(token)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is where you get device token if your app successfully connects to APNs. Normally, you would send this device token to the backend so they can organize , but in this tutorial we just log it. It is required in the tool to be able to target a particular device.</p>
<h2 id="Handling-payload"><a href="#Handling-payload" class="headerlink" title="Handling payload"></a>Handling payload</h2><p>Open <code>AppDelegate.swift</code> and add the following to th end of <code>extension AppDelegate</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable : <span class="keyword">Any</span>], fetchCompletionHandler completionHandler: @escaping <span class="params">(UIBackgroundFetchResult)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="comment">// [1] Always call the completion handler</span></span><br><span class="line">  <span class="keyword">defer</span> &#123;</span><br><span class="line">    completionHandler(.newData)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [2] Convert into JSON dictionary</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> json = userInfo <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [3] Parse to aps</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> aps = json[<span class="string">"aps"</span>] <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [4] Parse to urn</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> urn = aps[<span class="string">"urn"</span>] <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span>? <span class="type">Navigator</span>.navigate(urn: urn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This method is called when your app receives push notification payload and is running. The above code is relatively straightforward: it first tries to parse the <code>urn</code> information from the payload, then tells <code>Navigator</code> to do the job . Build and run the app on the device, since push notifications won‚Äôt work on the simulator. Log in to the app if prompted. Once on the main screen, grant push notification permissions to the app in order to receive alerts. You should see the <code>device token</code> logged to your Xcode console. </p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33278064-abbe6592-d39a-11e7-81cd-b3affc3ee4b6.PNG" height="500" />
</div>

<h2 id="Testing-Push-Notifications"><a href="#Testing-Push-Notifications" class="headerlink" title="Testing Push Notifications"></a>Testing Push Notifications</h2><p>In this tutorial, you‚Äôll use a tool called <a href="https://github.com/onmyway133/PushNotifications">PushNotifications</a> to help you easily create push notifications for your app. Download the tool <code>PushNotifications</code> from <a href="https://github.com/onmyway133/PushNotifications/releases">here</a>. This tool sends payloads directly to APNs.</p>
<p><img src="https://user-images.githubusercontent.com/2284279/33278070-b3094632-d39a-11e7-81f6-62f1ed04130b.png" alt="step4_test"></p>
<p>Choose <code>iOS\Token</code> to use <code>Token Authentication</code>, you get that by creating and downloading your <code>Key</code> from <a href="https://developer.apple.com/account/ios/authkey/">Certificates, Identifiers &amp; Profiles</a>. Browse for the <code>.p8</code> auth key file that you downloaded earlier. Enter <code>Team ID</code>, you can check it by going to <a href="https://developer.apple.com/account/#/membership">Membership Details</a> Enter <code>Key ID</code>, this is the ID associated with the <code>Key</code> from the first step. Enter <code>Bundle ID</code> and <code>device token</code>. Paste the following into as. It is a traditional payload associated with the URN.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"aps"</span>:&#123;</span><br><span class="line">      <span class="attr">"alert"</span>:<span class="string">"You become a celebrity on PhotoFeed, checkout your profile now"</span>,</span><br><span class="line">      <span class="attr">"urn"</span>: <span class="string">"user:self"</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since you‚Äôre debugging with Xcode, select <code>Sandbox</code> as environment.</p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/33278079-baef3ece-d39a-11e7-8818-56b54ed01a1d.PNG" height="500" />
</div>


<p>Tap <code>Send</code> now. If your app is in the background, an alert will appear. Tapping it will take you to your app and show you your user profile. Bravo! You just implemented deep linking in push notification, thanks again to the URL routing.</p>
<h1 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h1><p>Here is the <a href="https://github.com/onmyway133/PhotoFeed/tree/finish">final project</a> with all the code from this tutorial. You now understand central routing patterns, have mastered Compass and even refactored a real-world app. However, there is no silver bullet that works well for all apps. You need to understand your requirements and adjust accordingly. If you want to learn more about other navigation patterns, here are a few suggestions: </p>
<ul>
<li><a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a></li>
<li><a href="http://albertodebortoli.com/blog/2014/09/03/flow-controllers-on-ios-for-a-better-navigation-control/">Flow controller</a></li>
<li><a href="https://www.objc.io/issues/13-architecture/viper/">Routing in VIPER</a></li>
</ul>
<p>Remember, it‚Äôs not only about the code, but also about the user experience that your app provides. So please make sure you conform to the guidelines <a href="https://developer.apple.com/ios/human-interface-guidelines/interaction/navigation">Navigation in Human Interface Guidelines iOS</a>.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-23T09:37:59.000Z" title="2017-11-23T09:37:59.000Z">2017-11-23</time><span class="level-item">2 minutes read (About 303 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/BuddyBuild-and-gradle.properties/">BuddyBuild and gradle.properties</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/109">#109</a></strong></p>
<p>People advise against storing keys inside <code>build.gradles</code>. We should store them on 1Password and populate our <code>gradle.properties</code>, so don‚Äôt track this file in git. Here is <code>.gitignore</code> file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*.iml</span><br><span class="line"></span><br><span class="line">&#x2F;build</span><br><span class="line">&#x2F;gradle.properties</span><br><span class="line">&#x2F;local.properties</span><br><span class="line"></span><br><span class="line">.gradle</span><br><span class="line">.idea</span><br></pre></td></tr></table></figure>

<p>There are several ways to help <code>BuddyBuild</code> know about our <code>gradle.properties</code></p>
<h2 id="1-Using-Environment-variables"><a href="#1-Using-Environment-variables" class="headerlink" title="1. Using Environment variables"></a>1. Using Environment variables</h2><p>But when configuring the project on <code>BuddyBuild</code>, it complains about key not found. The solution is to use <code>Environment variables</code></p>
<p><img src="https://user-images.githubusercontent.com/2284279/33169496-36f92542-d045-11e7-8435-9a1f5d5dd24d.png" alt="key"></p>
<p>Then in your <code>build.gradle</code>, you can </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildConfigField &#39;String&#39;, &#39;MY_KEY&#39;, System.getenv(&quot;MY_KEY&quot;) ?: MY_KEY</span><br></pre></td></tr></table></figure>

<p>This is because gradle does not know about environment variables. The <code>System.getenv(&quot;MY_KEY&quot;)</code> is for BuddyBuild, and the default <code>MY_KEY</code> is for <code>gradle.properties</code>. </p>
<p>Next is to remove this duplication. We can use Groovy <a href="http://docs.groovy-lang.org/latest/html/api/groovy/lang/Binding.html">Binding</a>. <code>build.gradle</code> does the import <code>import groovy.lang.Binding</code> automatically for us</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String environmentKey(variable) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Object <span class="string">var :</span> binding.variables) &#123;</span><br><span class="line">        <span class="keyword">if</span> (var.value == variable) &#123;</span><br><span class="line">            <span class="keyword">return</span> System.getenv(var.key) ?: variable</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildConfigField &#39;String&#39;, &#39;MY_KEY&#39;, environmentKey(MY_KEY)</span><br></pre></td></tr></table></figure>

<h2 id="2-Using-Secured-File-üëç"><a href="#2-Using-Secured-File-üëç" class="headerlink" title="2. Using Secured File üëç"></a>2. Using Secured File üëç</h2><p>BuddyBuild allows us to define Secured File, here we can upload our <code>gradle.properties</code></p>
<p><img src="https://user-images.githubusercontent.com/2284279/33172691-69e83392-d051-11e7-87a9-6c1afc4b544e.png" alt="secure files"></p>
<p>And we can use <a href="https://docs.buddybuild.com/builds/custom_build_steps.html#prebuild">Prebuild script</a> to copy this secured file to our project. BuddyBuild suggests using <code>buddybuild_prebuild.sh</code> but then build fails in <code>Build file &#39;/tmp/sandbox/workspace/app/build.gradle&#39;</code></p>
<p>So, create a script called <code>buddybuild_postclone.sh</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">cp <span class="variable">$BUDDYBUILD_SECURE_FILES</span>/gradle.properties <span class="variable">$BUDDYBUILD_WORKSPACE</span>/gradle.properties</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-21T13:24:04.000Z" title="2017-11-21T13:24:04.000Z">2017-11-21</time><span class="level-item">4 minutes read (About 644 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Communication-between-Fragment-and-Activity/">Communication between Fragment and Activity</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/108">#108</a></strong></p>
<p>There‚Äôs always need for communication, right üòâ Suppose we have <code>OnboardingActivity</code> that has several <code>OnboardingFragment</code>. Each <code>Fragment</code> has a <code>startButton</code> telling that the onboarding flow has finished, and only the last <code>Fragment</code> shows this button.</p>
<p>Here are several ways you can do that</p>
<h2 id="1-EventBus-üôÑ"><a href="#1-EventBus-üôÑ" class="headerlink" title="1. EventBus üôÑ"></a>1. EventBus üôÑ</h2><p>Nearly all articles I found propose this <a href="https://github.com/greenrobot/EventBus">https://github.com/greenrobot/EventBus</a>, but I personally don‚Äôt like this idea because components are loosely coupled, every component and broadcast can listen to event from a singleton, which makes it very hard to reason when the project scales</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">OnboardingFinishEvent</span></span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingActivity</span>: <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStart</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart()</span><br><span class="line"></span><br><span class="line">        EventBus.getDefault().register(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStop</span><span class="params">()</span></span> &#123;</span><br><span class="line">        EventBus.getDefault().unregister(<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">super</span>.onStop()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Subscribe(threadMode = ThreadMode.MAIN)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onOnboardingFinishEvent</span><span class="params">(event: <span class="type">OnboardingFinishEvent</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// finish</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingFragment</span>: <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>?, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line"></span><br><span class="line">        startButton.onClick &#123;</span><br><span class="line">            EventBus.getDefault().post(OnboardingFinishEvent())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Read more</p>
<ul>
<li><a href="https://gunhansancar.com/ease-communication-between-activities-fragments-services/">https://gunhansancar.com/ease-communication-between-activities-fragments-services/</a></li>
</ul>
<h2 id="2-Otto-üôÑ"><a href="#2-Otto-üôÑ" class="headerlink" title="2. Otto üôÑ"></a>2. Otto üôÑ</h2><p>This <a href="https://github.com/square/otto">https://github.com/square/otto</a> was deprecated in favor of RxJava and RxAndroid</p>
<h2 id="3-RxJava-üôÑ"><a href="#3-RxJava-üôÑ" class="headerlink" title="3. RxJava üôÑ"></a>3. RxJava üôÑ</h2><p>We can use simple <code>PublishSubject</code> to create our own <a href="https://android.jlelse.eu/super-simple-event-bus-with-rxjava-and-kotlin-f1f969b21003">RxBus</a></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.reactivex.Observable</span><br><span class="line"><span class="keyword">import</span> io.reactivex.subjects.PublishSubject</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use object so we have a singleton instance</span></span><br><span class="line"><span class="keyword">object</span> RxBus &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> publisher = PublishSubject.create&lt;Any&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">publish</span><span class="params">(event: <span class="type">Any</span>)</span></span> &#123;</span><br><span class="line">        publisher.onNext(event)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Listen should return an Observable and not the publisher</span></span><br><span class="line">    <span class="comment">// Using ofType we filter only events that match that class type</span></span><br><span class="line">    fun &lt;T&gt; listen(eventType: Class&lt;T&gt;): Observable&lt;T&gt; = publisher.ofType(eventType)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OnboardingFragment.kt</span></span><br><span class="line">startButton.onClick &#123;</span><br><span class="line">    RxBus.publish(OnboardingFinishEvent())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OnboardingActivity.kt</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        </span><br><span class="line">    RxBus.listen(OnboardingFinishEvent::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">subscribe</span></span>(&#123;</span><br><span class="line">        <span class="comment">// finish</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Interface"><a href="#4-Interface" class="headerlink" title="4. Interface"></a>4. Interface</h2><p>This is advised here <a href="https://developer.android.com/training/basics/fragments/communicating.html#DefineInterface">Communicating with Other Fragments</a>. Basically you define an interface <code>OnboardingFragmentDelegate</code> that whoever conforms to that, can be informed by the <code>Fragment</code> of events. This is similar to <code>Delegate</code> pattern in iOS üòâ </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">OnboardingFragmentDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onboardingFragmentDidClickStartButton</span><span class="params">(fragment: <span class="type">OnboardingFragment</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingFragment</span>: <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> delegate: OnboardingFragmentDelegate? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttach</span><span class="params">(context: <span class="type">Context</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttach(context)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (context <span class="keyword">is</span> OnboardingFragmentDelegate) &#123;</span><br><span class="line">            delegate = context</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>?, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line"></span><br><span class="line">        startButton.onClick &#123;</span><br><span class="line">            delegate?.onboardingFragmentDidClickStartButton(<span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingActivity</span>: <span class="type">AppCompatActivity</span></span>(), OnboardingFragmentDelegate &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onboardingFragmentDidClickStartButton</span><span class="params">(fragment: <span class="type">OnboardingFragment</span>)</span></span> &#123;</span><br><span class="line">        onboardingService.hasShown = <span class="literal">true</span></span><br><span class="line">        startActivity&lt;LoginActivity&gt;()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-ViewModel"><a href="#5-ViewModel" class="headerlink" title="5. ViewModel"></a>5. ViewModel</h2><p>We can learn from <a href="https://developer.android.com/topic/libraries/architecture/viewmodel.html">Share data between fragments</a> to to communication between Fragment and Activity, by using a shared <code>ViewModel</code> that is scoped to the activity. This is a bit overkill</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingSharedViewModel</span>: <span class="type">ViewModel</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> finish = MutableLiveData&lt;<span class="built_in">Unit</span>&gt;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingActivity</span>: <span class="type">AppCompatActivity</span></span>(), OnboardingFragmentDelegate &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        <span class="keyword">val</span> viewModel = ViewModelProviders.of(<span class="keyword">this</span>).<span class="keyword">get</span>(OnboardingSharedViewModel::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line"></span><br><span class="line">        viewModel.finish.observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">            startActivity&lt;LoginActivity&gt;()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that we need to call <code>ViewModelProviders.of(activity)</code> to get the same <code>ViewModel</code> with the <code>activity</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingFragment</span>: <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>?, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> viewModel = ViewModelProviders.of(activity).<span class="keyword">get</span>(OnboardingSharedViewModel::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">        startButton.onClick(&#123;</span><br><span class="line">            viewModel.finish.value = <span class="built_in">Unit</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-Lambda"><a href="#7-Lambda" class="headerlink" title="7. Lambda"></a>7. Lambda</h2><p>Create a lambda in <code>Fragment</code>, then set it on <code>onAttachFragment</code>. It does not work for now as there is no <code>OnboardingFragment</code> in <code>onAttachFragment</code> üò¢ </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingFragment</span>: <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> didClickStartButton: (() -&gt; <span class="built_in">Unit</span>)? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>?, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line"></span><br><span class="line">        startButton.onClick &#123;</span><br><span class="line">            didClickStartButton?.invoke()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingActivity</span>: <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttachFragment</span><span class="params">(fragment: <span class="type">Fragment</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttachFragment(fragment)</span><br><span class="line"></span><br><span class="line">        (fragment <span class="keyword">as</span>? OnboardingFragment).let &#123;</span><br><span class="line">            it?.didClickStartButton = &#123;</span><br><span class="line">                <span class="comment">// finish</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-Listener-in-Bundle-üôÑ"><a href="#8-Listener-in-Bundle-üôÑ" class="headerlink" title="8. Listener in Bundle üôÑ"></a>8. Listener in Bundle üôÑ</h2><p>Read more</p>
<ul>
<li><a href="https://medium.com/groupon-eng/from-fragments-to-activity-the-lambda-way-32c768c72aa9">https://medium.com/groupon-eng/from-fragments-to-activity-the-lambda-way-32c768c72aa9</a></li>
<li><a href="https://medium.com/mindorks/how-to-communicate-between-fragments-and-activity-using-viewmodel-ca733233a51c">How to communicate between fragments and activity using ViewModel</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-14T13:40:31.000Z" title="2017-11-14T13:40:31.000Z">2017-11-14</time><span class="level-item">15 minutes read (About 2300 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Coordinator-and-FlowController/">Coordinator and FlowController</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/106">#106</a></strong></p>
<p>Every new architecture that comes out, either <a href="https://github.com/onmyway133/fantastic-ios-architecture">iOS</a> or <a href="https://github.com/onmyway133/fantastic-android-architecture">Android</a>, makes me very excited. I‚Äôm always looking for ways to structure apps in a better way. But after some times, I see that we‚Äôre too creative in creating architecture, aka constraint, that is too far away from the platform that we‚Äôre building. I often think ‚ÄúIf we‚Äôre going too far from the system, then it‚Äôs very hard to go back‚Äù</p>
<p>I like things that embrace the system. One of them is <a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a> which helps in encapsulation and navigation. Thanks to my friend <a href="https://github.com/vadymmarkov/">Vadym</a> for showing me <code>Coordinator</code> in action.</p>
<p>The below screenshot from @khanlou ‚Äòs <a href="https://www.youtube.com/watch?v=a1g3k3NObkE">talk</a> at CocoaHeads Stockholm clearly says many things about <code>Coordinator</code></p>
<div align="center">
<img src="https://user-images.githubusercontent.com/2284279/32828592-d03ad9a0-c9ef-11e7-8759-cb0292d668df.png" />
<br />
</div>

<p>But after reading <a href="https://davedelong.com/blog/2017/11/06/a-better-mvc-part-3-fixing-massive-view-controller/">A Better MVC</a>, I think we can leverage view controller containment to do navigation using <code>UIViewController</code> only.</p>
<p>Since I tend to call view controllers as <code>LoginController, ProfileController, ...</code> and the term <code>flow</code> to group those related screens, what should we call a <code>Coordinator</code> that inherits from <code>UIViewController</code> ü§î Let‚Äôs call it <code>FlowController</code> üòé . </p>
<p>The name is not that important, but the concept is simple. <code>FlowController</code> was also inspired by this <a href="http://albertodebortoli.com/blog/2014/09/03/flow-controllers-on-ios-for-a-better-navigation-control/">Flow Controllers on iOS for a Better Navigation Control</a> back in 2014. The idea is from awesome iOS people, this is just a sum up from my experience üòá </p>
<p>So <code>FlowController</code> can just a <code>UIViewController</code> friendly version of <code>Coordinator</code>. Let see how <code>FlowController</code> fits better into <code>MVC</code></p>
<blockquote class="twitter-tweet" data-lang="no"><p lang="en" dir="ltr">¬´UIViewController is the center of the universe.¬ª<br><br>‚Äî <a href="https://twitter.com/onmyway133?ref_src=twsrc%5Etfw">@onmyway133</a></p>&mdash; Elvis Nu√±ez (@3lvis) <a href="https://twitter.com/3lvis/status/916234962357153792?ref_src=twsrc%5Etfw">6. oktober 2017</a></blockquote>

<h2 id="1-FlowController-and-AppDelegate"><a href="#1-FlowController-and-AppDelegate" class="headerlink" title="1. FlowController and AppDelegate"></a>1. FlowController and AppDelegate</h2><p>Your application starts from <code>AppDelegate</code>, in that you setup <code>UIWindow</code>. So we should follow the same ‚Äútop down‚Äù approach for <code>FlowController</code>, starting with <code>AppFlowController</code>. You can construct all dependencies that your app need for <code>AppFlowController</code>, so that it can pass to other child <code>FlowController</code>.</p>
<p><code>AppDelegate</code> is also considered <a href="http://blog.ploeh.dk/2011/07/28/CompositionRoot/">Composition Root</a></p>
<p>Here is how to declare <code>AppFlowController</code> in <code>AppDelegate</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DependencyContainer</span>: <span class="title">AuthServiceContainer</span>, <span class="title">PhoneServiceContainer</span>, <span class="title">NetworkingServiceContainer</span>,</span></span><br><span class="line"><span class="class">  <span class="title">LocationServiceContainer</span>, <span class="title">MapServiceContainer</span>, <span class="title">HealthServiceContainer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> authService: <span class="type">AuthServiceProtocol</span></span><br><span class="line">  <span class="keyword">let</span> phoneService: <span class="type">PhoneService</span></span><br><span class="line">  <span class="keyword">let</span> networkingService: <span class="type">NetworkingService</span></span><br><span class="line">  <span class="keyword">let</span> locationService: <span class="type">LocationService</span></span><br><span class="line">  <span class="keyword">let</span> mapService: <span class="type">MapService</span></span><br><span class="line">  <span class="keyword">let</span> healthService: <span class="type">HealthService</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">()</span></span> -&gt; <span class="type">DependencyContainer</span> &#123;</span><br><span class="line">    <span class="comment">// Configure and make DependencyContainer here</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> window: <span class="type">UIWindow?</span></span><br><span class="line">  <span class="keyword">var</span> appFlowController: <span class="type">AppFlowController!</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication,</span></span></span><br><span class="line"><span class="function"><span class="params">                   didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    appFlowController = <span class="type">AppFlowController</span>(</span><br><span class="line">      dependencyContainer: <span class="type">DependencyContainer</span>.make()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">    window?.rootViewController = appFlowController</span><br><span class="line">    window?.makeKeyAndVisible()</span><br><span class="line"></span><br><span class="line">    appFlowController.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are some hypothetical <code>FlowController</code> that you may encounter</p>
<ul>
<li>AppFlowController: manages UIWindow and check whether to show onboarding, login or main depending on authentication state<ul>
<li>OnboardingFlowController: manages <code>UIPageViewController</code> and maybe ask for some permissions</li>
<li>LoginFlowController: manages <code>UINavigationController</code> to show login, sms verification, forget password, and optionally start <code>SignUpFlowController</code></li>
<li>MainFlowController: manages <code>UITabBarController</code> with each tab serving main features<ul>
<li>FeedFlowController: show feed with list of items</li>
<li>ProfileFlowController: show profile</li>
<li>SettingsFlowController: show settings, and maybe call logout, this will delegates up the <code>FlowController</code> chain.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The cool thing about <code>FlowController</code> is it makes your code very self contained, and grouped by features. So it‚Äôs easy to move all related things to its own package if you like.</p>
<h2 id="2-FlowController-as-container-view-controller"><a href="#2-FlowController-as-container-view-controller" class="headerlink" title="2. FlowController as container view controller"></a>2. FlowController as container view controller</h2><blockquote>
<p>In general, a view controller should manage either sequence or UI, but not both.</p>
</blockquote>
<p>Basically, <code>FlowController</code> is just a container view controller to solve the <code>sequence</code>, based on a simple concept called <code>composition</code>. It manages many child view controllers in its flow. Let‚Äô say we have a <code>ProductFlowController</code> that groups together flow related to displaying products, <code>ProductListController</code>, <code>ProductDetailController</code>, <code>ProductAuthorController</code>, <code>ProductMapController</code>, ‚Ä¶ Each can delegate to the <code>ProductFlowController</code> to express its intent, like <code>ProductListController</code> can delegate to say ‚Äúproduct did tap‚Äù, so that <code>ProductFlowController</code> can construct and present the next screen in the flow, based on the embedded <code>UINavigationController</code> inside it.</p>
<p>Normally, a <code>FlowController</code> just displays 1 child <code>FlowController</code> at a time, so normally we can just update its frame</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line"></span><br><span class="line">    childViewControllers.first?.view.frame = view.bounds</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-FlowController-as-dependency-container"><a href="#3-FlowController-as-dependency-container" class="headerlink" title="3. FlowController as dependency container"></a>3. FlowController as dependency container</h2><p>Each view controller inside the flow can have different dependencies, so it‚Äôs not fair if the first view controller needs to carry all the stuff just to be able to pass down to the next view controllers. Here are some dependencies</p>
<ul>
<li>ProductListController: ProductNetworkingService</li>
<li>ProductDetailController: ProductNetworkingService, ImageDowloaderService, ProductEditService</li>
<li>ProductAuthorController: AuthorNetworkingService, ImageDowloaderService</li>
<li>ProductMapController: LocationService, MapService</li>
</ul>
<p>Instead the <code>FlowController</code> can carry all the dependencies needed for that whole flow, so it can pass down to the view controller if needed.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProductDependencyContainer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> productNetworkingService: <span class="type">ProductNetworkingService</span></span><br><span class="line">  <span class="keyword">let</span> imageDownloaderService: <span class="type">ImageDownloaderService</span></span><br><span class="line">  <span class="keyword">let</span> productEditService: <span class="type">ProductEditService</span></span><br><span class="line">  <span class="keyword">let</span> authorNetworkingService: <span class="type">AuthorNetworkingService</span></span><br><span class="line">  <span class="keyword">let</span> locationService: <span class="type">LocationService</span></span><br><span class="line">  <span class="keyword">let</span> mapService: <span class="type">MapService</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductFlowController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> dependencyContainer: <span class="type">ProductDependencyContainer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dependencyContainer: <span class="type">ProductDependencyContainer</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyContainer = dependencyContainer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ProductFlowController</span>: <span class="title">ProductListControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">productListController</span><span class="params">(<span class="number">_</span> controller: ProductListController, didSelect product: Product)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> productDetailController = <span class="type">ProductDetailController</span>(</span><br><span class="line">      productNetworkingService: dependencyContainer.productNetworkingService,</span><br><span class="line">      productEditService: dependencyContainer.productEditService,</span><br><span class="line">      imageDownloaderService: dependencyContainer.imageDownloaderService</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    productDetailController.delegate = <span class="keyword">self</span></span><br><span class="line">    embeddedNavigationController.pushViewController(productDetailController, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are some ways that you can use to pass dependencies into <code>FlowController</code></p>
<ul>
<li><a href="http://merowing.info/2017/04/using-protocol-compositon-for-dependency-injection/">Using protocol compositon for dependency injection</a></li>
<li><a href="https://www.swiftbysundell.com/posts/dependency-injection-using-factories-in-swift">Dependency injection using factories in Swift</a></li>
</ul>
<h2 id="4-Adding-or-removing-child-FlowController"><a href="#4-Adding-or-removing-child-FlowController" class="headerlink" title="4. Adding or removing child FlowController"></a>4. Adding or removing child FlowController</h2><p><strong>Coordinator</strong></p>
<p>With <code>Coordinator</code>, you need to keep an array of child <code>Coordinators</code>, and maybe use address (<code>===</code> operator) to identify them</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> children: [<span class="type">Coordinator</span>] = []</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(child: Coordinator)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> !children.<span class="built_in">contains</span>(<span class="keyword">where</span>: &#123; $<span class="number">0</span> === child &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    children.append(child)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(child: Coordinator)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> index = children.index(<span class="keyword">where</span>: &#123; $<span class="number">0</span> === child &#125;) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    children.remove(at: index)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">removeAll</span><span class="params">()</span></span> &#123;</span><br><span class="line">    children.removeAll()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>With <code>FlowController</code>, since it is <code>UIViewController</code> subclass, it has <code>viewControllers</code> to hold all those child <code>FlowController</code>. Just add these extensions to simplify your adding or removing of child <code>UIViewController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(childController: UIViewController)</span></span> &#123;</span><br><span class="line">    addChildViewController(childController)</span><br><span class="line">    view.addSubview(childController.view)</span><br><span class="line">    childController.didMove(toParentViewController: <span class="keyword">self</span>)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(childController: UIViewController)</span></span> &#123;</span><br><span class="line">    childController.willMove(toParentViewController: <span class="literal">nil</span>)</span><br><span class="line">    childController.view.removeFromSuperview()</span><br><span class="line">    childController.removeFromParentViewController()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And see in action how <code>AppFlowController</code> work with adding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> authService.isAuthenticated &#123;</span><br><span class="line">      startMain()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      startLogin()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginFlowController = <span class="type">LoginFlowController</span>(</span><br><span class="line">    loginFlowController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: loginFlowController)</span><br><span class="line">    loginFlowController.start()</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">startMain</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> mainFlowController = <span class="type">MainFlowController</span>()</span><br><span class="line">    mainFlowController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: mainFlowController)</span><br><span class="line">    mainFlowController.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and with removing when the child <code>FlowController</code> finishes</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppFlowController</span>: <span class="title">LoginFlowControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">loginFlowControllerDidFinish</span><span class="params">(<span class="number">_</span> flowController: LoginFlowController)</span></span> &#123;</span><br><span class="line">    remove(childController: flowController)</span><br><span class="line">    startMain()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-AppFlowController-does-not-need-to-know-about-UIWindow"><a href="#5-AppFlowController-does-not-need-to-know-about-UIWindow" class="headerlink" title="5. AppFlowController does not need to know about UIWindow"></a>5. AppFlowController does not need to know about UIWindow</h2><p><strong>Coordinator</strong></p>
<p>Usually you have an <code>AppCoordinator</code>, which is held by <code>AppDelegate</code>, as the root of your <code>Coordinator</code> chain. Based on login status, it will determine which <code>LoginController</code> or <code>MainController</code> will be set as the <code>rootViewController</code>, in order to do that, it needs to be injected a <code>UIWindow</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">appCoordinator = <span class="type">AppCoordinator</span>(window: window!)</span><br><span class="line">appCoordinator.start()</span><br><span class="line">window?.makeKeyAndVisible()</span><br></pre></td></tr></table></figure>

<p>You can guess that in the <code>start</code> method of <code>AppCoordinator</code>, it must set <code>rootViewController</code> before <code>window?.makeKeyAndVisible()</code> is called.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> window: <span class="type">UIWindow</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">init</span>(window: <span class="type">UIWindow</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.window = window</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> dependencyContainer.authService.isAuthenticated &#123;</span><br><span class="line">      startMain()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      startLogin()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>But with <code>AppFlowController</code>, you can treat it like a normal <code>UIViewController</code>, so just setting it as the <code>rootViewController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appFlowController = <span class="type">AppFlowController</span>(</span><br><span class="line">window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">window?.rootViewController = appFlowController</span><br><span class="line">window?.makeKeyAndVisible()</span><br><span class="line"></span><br><span class="line">appFlowController.start()</span><br></pre></td></tr></table></figure>

<h2 id="6-LoginFlowController-can-manage-its-own-flow"><a href="#6-LoginFlowController-can-manage-its-own-flow" class="headerlink" title="6. LoginFlowController can manage its own flow"></a>6. LoginFlowController can manage its own flow</h2><p>Supposed we have login flow based on <code>UINavigationController</code> that can display <code>LoginController</code>, <code>ForgetPasswordController</code>, <code>SignUpController</code></p>
<p><strong>Coordinator</strong></p>
<p>What should we do in the <code>start</code> method of <code>LoginCoordinator</code>? Construct the initial controller <code>LoginController</code> and set it as the <code>rootViewController</code> of the <code>UINavigationController</code>? <code>LoginCoordinator</code> can create this embedded <code>UINavigationController</code> internally, but then it is not attached to the <code>rootViewController</code> of <code>UIWindow</code>, because <code>UIWindow</code> is kept privately inside the parent <code>AppCoordinator</code>.</p>
<p>We can pass <code>UIWindow</code> to <code>LoginCoordinator</code> but then it knows too much. One way is to construct <code>UINavigationController</code> from <code>AppCoordinator</code> and pass that to <code>LoginCoordinator</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> window: <span class="type">UIWindow</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> navigationController = <span class="type">UINavigationController</span>()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> loginCoordinator = <span class="type">LoginCoordinator</span>(navigationController: navigationController)</span><br><span class="line"> </span><br><span class="line">    loginCoordinator.delegate = <span class="keyword">self</span></span><br><span class="line">    add(child: loginCoordinator)</span><br><span class="line">    window.rootViewController = navigationController</span><br><span class="line">    loginCoordinator.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">init</span>(navigationController: <span class="type">UINavigationController</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController = navigationController</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginController = <span class="type">LoginController</span>(dependencyContainer: dependencyContainer)</span><br><span class="line">    loginController.delegate = <span class="keyword">self</span></span><br><span class="line"> </span><br><span class="line">    navigationController.viewControllers = [loginController]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p><code>LoginFlowController</code> leverages <code>container view controller</code> so it fits nicely with the way <code>UIKit</code> works. Here <code>AppFlowController</code> can just add <code>LoginFlowController</code> and <code>LoginFlowController</code> can just create its own <code>embeddedNavigationController</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">startLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginFlowController = <span class="type">LoginFlowController</span>(</span><br><span class="line">      dependencyContainer: dependencyContainer</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    loginFlowController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: loginFlowController)</span><br><span class="line">    loginFlowController.start()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dependencyContainer: <span class="type">DependencyContainer</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> embeddedNavigationController: <span class="type">UINavigationController!</span></span><br><span class="line">  <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">LoginFlowControllerDelegate?</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dependencyContainer: <span class="type">DependencyContainer</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyContainer = dependencyContainer</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    embeddedNavigationController = <span class="type">UINavigationController</span>()</span><br><span class="line">    add(childController: embeddedNavigationController)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> loginController = <span class="type">LoginController</span>(dependencyContainer: dependencyContainer)</span><br><span class="line">    loginController.delegate = <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">    embeddedNavigationController.viewControllers = [loginController]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-FlowController-and-responder-chain"><a href="#7-FlowController-and-responder-chain" class="headerlink" title="7. FlowController and responder chain"></a>7. FlowController and responder chain</h2><p><strong>Coordinator</strong></p>
<p>Sometimes we want a quick way to bubble up message to parent <code>Coordinator</code>, one way to do that is to replicate <code>UIResponder</code> chain using <code>associated object</code> and protocol extensions, like <a href="http://aplus.rs/2017/highly-maintainable-app-architecture/">Inter-connect with Coordinator</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKeys</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">var</span> <span class="type">ParentCoordinator</span> = <span class="string">"ParentCoordinator"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">var</span> parentCoordinator: <span class="type">Any?</span> &#123;</span><br><span class="line">		<span class="keyword">get</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.<span class="type">ParentCoordinator</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">set</span> &#123;</span><br><span class="line">			objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.<span class="type">ParentCoordinator</span>, newValue, .<span class="type">OBJC_ASSOCIATION_ASSIGN</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinator</span>&lt;<span class="title">T</span>: <span class="title">UIViewController</span>&gt;: <span class="title">UIResponder</span>, <span class="title">Coordinating</span> </span>&#123;</span><br><span class="line">	<span class="keyword">open</span> <span class="keyword">var</span> parent: <span class="type">Coordinating?</span>	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">override</span> <span class="keyword">open</span> <span class="keyword">var</span> coordinatingResponder: <span class="type">UIResponder?</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> parent <span class="keyword">as</span>? <span class="type">UIResponder</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>Since <code>FlowController</code> is <code>UIViewController</code>, which inherits from <code>UIResponder</code>, responder chain happens out of the box</p>
<blockquote>
<p>Responder objects‚Äîthat is, instances of UIResponder‚Äîconstitute the event-handling backbone of a UIKit app. Many key objects are also responders, including the UIApplication object, UIViewController objects, and all UIView objects (which includes UIWindow). As events occur, UIKit dispatches them to your app‚Äôs responder objects for handling.</p>
</blockquote>
<h2 id="8-FlowController-and-trait-collection"><a href="#8-FlowController-and-trait-collection" class="headerlink" title="8. FlowController and trait collection"></a>8. FlowController and trait collection</h2><p><strong>FlowController</strong></p>
<p>I very much like how <a href="https://github.com/kickstarter/ios-oss/blob/master/Kickstarter-iOS.playground/Sources/playgroundController.swift#L43">Kickstarter</a> uses trait collection in testing. Well, since <code>FlowController</code> is a parent view controller, we can just override its trait collection, and that will affect the size classes of all view controllers inside that flow.</p>
<p>As in <a href="https://davedelong.com/blog/2017/11/06/a-better-mvc-part-2-fixing-encapsulation/">A Better MVC, Part 2: Fixing Encapsulation</a></p>
<blockquote>
<p>The huge advantage of this approach is that system features come free. Trait collection propagation is free. View lifecycle callbacks are free. Safe area layout margins are generally free. The responder chain and preferred UI state callbacks are free. And future additions to UIViewController are also free.</p>
</blockquote>
<p>From <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621406-setoverridetraitcollection">setOverrideTraitCollection</a></p>
<blockquote>
<p>When implementing a custom container view controller, you can use this method to change the traits of any embedded child view controllers to something more appropriate for your layout. Making such a change alters other view controller behaviors associated with that child</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> trait = <span class="type">UITraitCollection</span>(traitsFrom: [</span><br><span class="line">  .<span class="keyword">init</span>(horizontalSizeClass: .compact),</span><br><span class="line">  .<span class="keyword">init</span>(verticalSizeClass: .regular),</span><br><span class="line">  .<span class="keyword">init</span>(userInterfaceIdiom: .phone)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">appFlowController.setOverrideTraitCollection(trait, forChildViewController: loginFlowController)</span><br></pre></td></tr></table></figure>

<h2 id="9-FlowController-and-back-button"><a href="#9-FlowController-and-back-button" class="headerlink" title="9. FlowController and back button"></a>9. FlowController and back button</h2><p><strong>Coordinator</strong></p>
<p>One problem with <code>UINavigationController</code> is that clicking on the default <code>back button</code> pops the view controller out of the navigation stack, so <code>Coordinator</code> is not aware of that. With <code>Coordinator</code> you needs to keep <code>Coordinator</code> and <code>UIViewController</code> in sync, add try to hook up <code>UINavigationControllerDelegate</code> in order to clean up. Like in <a href="http://khanlou.com/2017/05/back-buttons-and-coordinators/">Back Buttons and Coordinators</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span>: <span class="title">UINavigationControllerDelegate</span> </span>&#123;    </span><br><span class="line">	<span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(navigationController: UINavigationController,</span></span></span><br><span class="line"><span class="function"><span class="params">		didShowViewController viewController: UIViewController, animated: Bool)</span></span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// ensure the view controller is popping</span></span><br><span class="line">		<span class="keyword">guard</span></span><br><span class="line">		  <span class="keyword">let</span> fromViewController = navigationController.transitionCoordinator?.viewController(forKey: .from),</span><br><span class="line">		  !navigationController.viewControllers.<span class="built_in">contains</span>(fromViewController) <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">    	&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// and it's the right type</span></span><br><span class="line">		<span class="keyword">if</span> fromViewController <span class="keyword">is</span> <span class="type">FirstViewControllerInCoordinator</span>) &#123;</span><br><span class="line">			<span class="comment">//deallocate the relevant coordinator</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Or creating a class called <code>NavigationController</code> that inside manages a list of child coordinators. Like in <a href="http://irace.me/navigation-coordinators">Navigation coordinators</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NavigationController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="comment">// MARK: - Inputs</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> rootViewController: <span class="type">UIViewController</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Mutable state</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> viewControllersToChildCoordinators: [<span class="type">UIViewController</span>: <span class="type">Coordinator</span>] = [:]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Lazy views</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> childNavigationController: <span class="type">UINavigationController</span> =</span><br><span class="line">      <span class="type">UINavigationController</span>(rootViewController: <span class="keyword">self</span>.rootViewController)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: - Initialization</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(rootViewController: <span class="type">UIViewController</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.rootViewController = rootViewController</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FlowController</strong></p>
<p>Since <code>FlowController</code> is just plain <code>UIViewController</code>, you don‚Äôt need to manually manage child <code>FlowController</code>. The child <code>FlowController</code> is gone when you pop or dismiss. If we want to listen to <code>UINavigationController</code> events, we can just handle that inside the <code>FlowController</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFlowController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dependencyContainer: <span class="type">DependencyContainer</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> embeddedNavigationController: <span class="type">UINavigationController!</span></span><br><span class="line">  <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">LoginFlowControllerDelegate?</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dependencyContainer: <span class="type">DependencyContainer</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dependencyContainer = dependencyContainer</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    embeddedNavigationController = <span class="type">UINavigationController</span>()</span><br><span class="line">    embeddedNavigationController.delegate = <span class="keyword">self</span></span><br><span class="line">    add(childController: embeddedNavigationController)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LoginFlowController</span>: <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">navigationController</span><span class="params">(<span class="number">_</span> navigationController: UINavigationController, willShow viewController: UIViewController, animated: Bool)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-FlowController-and-callback"><a href="#10-FlowController-and-callback" class="headerlink" title="10. FlowController and callback"></a>10. FlowController and callback</h2><p>We can use <code>delegate</code> pattern to notify <code>FlowController</code> to show another view controller in the flow</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ProductFlowController</span>: <span class="title">ProductListControllerDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">productListController</span><span class="params">(<span class="number">_</span> controller: ProductListController, didSelect product: Product)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> productDetailController = <span class="type">ProductDetailController</span>(</span><br><span class="line">      productNetworkingService: dependencyContainer.productNetworkingService,</span><br><span class="line">      productEditService: dependencyContainer.productEditService,</span><br><span class="line">      imageDownloaderService: dependencyContainer.imageDownloaderService</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    productDetailController.delegate = <span class="keyword">self</span></span><br><span class="line">    embeddedNavigationController.pushViewController(productDetailController, animated: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another approach is to use <code>closure</code> as callback, as proposed by <a href="https://twitter.com/merowing_/status/930755494502981632">@merowing_</a>, and also in his post <a href="http://merowing.info/2016/01/improve-your-ios-architecture-with-flowcontrollers/">Improve your iOS Architecture with FlowControllers</a></p>
<blockquote>
<p>Using closures as triggers rather than delegate allows for more readable and specialized implementation, and multiple contexts</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductFlowController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> productListController = <span class="type">ProductListController</span>(</span><br><span class="line">      productNetworkingService: dependencyContainer.productNetworkingService</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    productListController.didSelectProduct = &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] product <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.showDetail(<span class="keyword">for</span>: product)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    embeddedNavigationController.viewControllers = [productListController]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-FlowController-and-deep-linking"><a href="#11-FlowController-and-deep-linking" class="headerlink" title="11. FlowController and deep linking"></a>11. FlowController and deep linking</h2><p>TBD. In the mean while, here are some readings about the UX</p>
<ul>
<li><a href="https://developer.android.com/design/patterns/navigation.html">Navigation with Back and Up</a></li>
<li><a href="https://developer.apple.com/documentation/usernotifications/unusernotificationcenterdelegate/1649518-usernotificationcenter">UserNotification</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-10T11:43:26.000Z" title="2017-11-10T11:43:26.000Z">2017-11-10</time><span class="level-item">5 minutes read (About 816 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Please-reconsidering-your-choice-of-libraries/">Please reconsidering your choice of libraries</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/105">#105</a></strong></p>
<p>Are you willing to take vaccines you don‚Äôt know about?</p>
<p>I like open source. I ‚Äòve made some and contributed to some. I also use other people ‚Äòs open source libraries and <a href="https://github.com/onmyway133/blog/issues?utf8=%E2%9C%93&q=Learning%20from%20Open%20Source">learn</a> a lot from them üòá </p>
<p>Open source can help us build better, faster and maybe more <a href="https://github.com/onmyway133/blog/issues/85">performant</a> software by basing on other people ‚Äòs hard work. We can also collaborate and make it better. But it‚Äôs also a double edges sword if you‚Äôre not judging carefully. </p>
<h3 id="Putting-a-little-bit-more-dedication"><a href="#Putting-a-little-bit-more-dedication" class="headerlink" title="Putting a little bit more dedication"></a>Putting a little bit more dedication</h3><p>You can skip this post if your project is just for fun, and you don‚Äôt care about future maintenance. If you‚Äôre making client or product projects, you should care and put a little more dedication into it. The company and your teammates trust you to do the good work. </p>
<p>I‚Äôve admitted that I ‚Äòve done <code>node.js</code> and <code>electron.js</code>. The choice is because it‚Äôs just a utility that I want to make quickly, and there ‚Äòs many <code>node.js</code> packages that I can use immediately. I have little experience in <code>node.js</code>, so I accept the risk do get the work done. But if you‚Äôre experienced developer in your platform, and it‚Äôs your important project, then it‚Äôs a different story üí• </p>
<p>I‚Äôm kind of experimental person, so I always want to try new things. But I also learn the hard way to not over engineer, and to live as close to the system as possible. I just read <a href="http://aplus.rs/2017/much-ado-about-ios-app-architecture/">Much ado about iOS app architecture</a> and I agree with most of the points, that we shouldn‚Äôt fight the SDK and replace system frameworks.</p>
<p>To me, using 3rd libraries is like giving your life to someone else ‚Äòs hands, that you can‚Äôt make any decision for your future. Please don‚Äôt just <code>pod install</code> and consider it done üôè </p>
<h3 id="What-about-the-stars"><a href="#What-about-the-stars" class="headerlink" title="What about the stars"></a>What about the stars</h3><p>People tend to follow those that have lots of followers, and to star a project with lots of stars. Don‚Äôt trust the stars. It means nearly nothing. The star is just the result of some marketing effort. Being featured or not in a newsletter can make 1k stars difference. Just because it was featured in a newsletter does not necessarily mean that it is good üò¨ </p>
<p>You should judge it yourself by checking how good the source code is, how many documentation are available, and whether there is unit tests or not. The author is just human, so he can‚Äôt help maintain the library forever. You‚Äôre taking a big risk if you don‚Äôt have good picture of the library.</p>
<p>The system, especially iOS, changes very often. There are some libraries that try to ‚Äúreplicate‚Äù system APIs or perform type checking for every possible types. It can be that the author pick the most common use cases, or just trying to provide a cleaner APIs to the user. But if things change, will that author be willing to fix that? Will you be stuck there and making another issue asking for help? We‚Äôre making life better, not traps for everyone to fall into üôÄ </p>
<p>Here I don‚Äôt try to blame anyone, ‚Äúyou is not your work‚Äù. I just say that you should check it more thoroughly. You can consult your colleagues and discuss if it‚Äôs good to integrate. Most of the time, pulling a huge library just for some tiny syntactic sugar does not worth it</p>
<details> 
  <summary>I just put some random links here and you can determine if you like or not</summary>

<ul>
<li><a href="https://github.com/radex/SwiftyUserDefaults/blob/master/Sources/SwiftyUserDefaults.swift#L145">https://github.com/radex/SwiftyUserDefaults/blob/master/Sources/SwiftyUserDefaults.swift#L145</a><ul>
<li><a href="https://github.com/jiecao-fm/SwiftTheme/blob/master/Source/UIKit%2BTheme.swift#L183">https://github.com/jiecao-fm/SwiftTheme/blob/master/Source/UIKit%2BTheme.swift#L183</a></li>
<li><a href="https://github.com/erichoracek/Motif/blob/7ec2dfce45cd93cb5ae22f4f512a41a499138fd5/Examples/ButtonsExample/ThemeThemeSymbols.m#L10">https://github.com/erichoracek/Motif/blob/7ec2dfce45cd93cb5ae22f4f512a41a499138fd5/Examples/ButtonsExample/ThemeThemeSymbols.m#L10</a></li>
<li><a href="https://github.com/vhesener/Closures/blob/master/Xcode/Closures/Source/UITableView.swift#L251">https://github.com/vhesener/Closures/blob/master/Xcode/Closures/Source/UITableView.swift#L251</a></li>
<li><a href="https://github.com/Draveness/DKNightVersion/blob/master/DKNightVersion/UIKit/UITableView%2BNight.m#L29">https://github.com/Draveness/DKNightVersion/blob/master/DKNightVersion/UIKit/UITableView%2BNight.m#L29</a></li>
<li><a href="https://github.com/tombenner/nui/blob/master/NUI/Core/NUISwizzler.m#L15">https://github.com/tombenner/nui/blob/master/NUI/Core/NUISwizzler.m#L15</a></li>
<li><a href="https://github.com/square/SuperDelegate/blob/master/Sources/SuperDelegate%2BLocalNotifications.swift#L53">https://github.com/square/SuperDelegate/blob/master/Sources/SuperDelegate%2BLocalNotifications.swift#L53</a></li>
<li><a href="https://github.com/orta/ARAnalytics/blob/master/ARDSL.m#L113">https://github.com/orta/ARAnalytics/blob/master/ARDSL.m#L113</a></li>
<li><a href="https://github.com/SnapKit/SnapKit/blob/develop/Source/ConstraintMakerRelatable.swift#L43">https://github.com/SnapKit/SnapKit/blob/develop/Source/ConstraintMakerRelatable.swift#L43</a>  </li>
<li><a href="https://github.com/saoudrizwan/DynamicJSON/blob/master/Sources/DynamicJSON.swift#L54">https://github.com/saoudrizwan/DynamicJSON/blob/master/Sources/DynamicJSON.swift#L54</a></details>

</li>
</ul>
</li>
</ul>
<h3 id="Please"><a href="#Please" class="headerlink" title="Please"></a>Please</h3><p>Would you take a very big risk for so little return ? Always implement and imagine that you will be the next maintainer for the project, then you will act differently.</p>
<p>So the next time, please reconsider your choice of libraries. Take 1 step back and analyse a bit ‚ù§Ô∏è </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-10T09:37:54.000Z" title="2017-11-10T09:37:54.000Z">2017-11-10</time><span class="level-item">3 minutes read (About 405 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-generic-extension-with-associatedtype-protocol-in-Swift/">How to make generic extension with associatedtype protocol in Swift</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/104">#104</a></strong></p>
<p>I like extensions, and I like to group them under 1 common property to easily access. This also makes it clear that these all belong to the same feature and not to confuse with Apple properties.</p>
<h3 id="Grouping-all-related-extensions"><a href="#Grouping-all-related-extensions" class="headerlink" title="Grouping all related extensions"></a>Grouping all related extensions</h3><p>This is how I do it in <a href="https://github.com/onmyway133/Anchors">Anchor</a> and <a href="https://github.com/onmyway133/On">On</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">activate(</span><br><span class="line">  a.anchor.top.<span class="keyword">left</span>,</span><br><span class="line">  b.anchor.top.<span class="keyword">right</span>,</span><br><span class="line">  <span class="built_in">c</span>.anchor.bottom.<span class="keyword">left</span>,</span><br><span class="line">  d.anchor.bottom.<span class="keyword">right</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">textField.on.text &#123; text <span class="keyword">in</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"textField text has changed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">textField.on.didEndEditing &#123; text <span class="keyword">in</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"texField has ended editing"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Generic-extension"><a href="#Generic-extension" class="headerlink" title="Generic extension"></a>Generic extension</h3><p>For <code>On</code>, it is a bit tricky as it needs to adapt to different <code>NSObject</code> subclasses. And to make auto completion work, meaning that each type of subclass gets its own function hint, we need to use generic and <code>associatedtype</code> protocol.</p>
<p>You can take a look at <a href="https://github.com/onmyway133/On/blob/master/Sources/Shared/Core/Container.swift">Container</a> and <a href="https://github.com/onmyway133/On/blob/master/Sources/Shared/Core/OnAware.swift">OnAware</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Container</span>&lt;<span class="title">Host</span>: <span class="title">AnyObject</span>&gt;: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unowned</span> <span class="keyword">let</span> host: <span class="type">Host</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(host: <span class="type">Host</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.host = host</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">OnAware</span>: <span class="title">class</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">OnAwareHostType</span>: <span class="type">AnyObject</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> on: <span class="type">Container</span>&lt;<span class="type">OnAwareHostType</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RxCocoa"><a href="#RxCocoa" class="headerlink" title="RxCocoa"></a>RxCocoa</h3><p><a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> has its <code>RxCocoa</code> that does this trick too, so that you can just declare</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">button.rx.tap</span><br><span class="line">textField.rx.text</span><br><span class="line">alertAction.rx.isEnabled</span><br></pre></td></tr></table></figure>

<p>The power lies in the struct <a href="https://github.com/ReactiveX/RxSwift/blob/0b66f666ba6955a51cba1ad530311b030fa4db9c/RxSwift/Reactive.swift">Reactive</a> and <code>ReactiveCompatible</code> protocol</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Reactive</span>&lt;<span class="title">Base</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/// Base object to extend.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> base: <span class="type">Base</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates extensions with base object.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - parameter base: Base object.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> base: <span class="type">Base</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.base = base</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">ReactiveCompatible</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Extended type</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">CompatibleType</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Reactive extensions.</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> rx: <span class="type">Reactive</span>&lt;<span class="type">CompatibleType</span>&gt;.<span class="type">Type</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Reactive extensions.</span></span><br><span class="line">    <span class="keyword">var</span> rx: <span class="type">Reactive</span>&lt;<span class="type">CompatibleType</span>&gt; &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ReactiveCompatible</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Reactive extensions.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> rx: <span class="type">Reactive</span>&lt;<span class="type">Self</span>&gt;.<span class="type">Type</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Reactive</span>&lt;<span class="type">Self</span>&gt;.<span class="keyword">self</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// this enables using Reactive to "mutate" base type</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Reactive extensions.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> rx: <span class="type">Reactive</span>&lt;<span class="type">Self</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Reactive</span>(<span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// this enables using Reactive to "mutate" base object</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here <a href="https://github.com/ReactiveX/RxSwift/blob/master/RxCocoa/iOS/UIButton%2BRx.swift">UIButton+Rx</a> you can see how it can be applied to <code>UIButton</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Reactive</span> <span class="title">where</span> <span class="title">Base</span>: <span class="title">UIButton</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Reactive wrapper for `TouchUpInside` control event.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> tap: <span class="type">ControlEvent</span>&lt;<span class="type">Void</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> controlEvent(.touchUpInside)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-10T09:22:19.000Z" title="2017-11-10T09:22:19.000Z">2017-11-10</time><span class="level-item">a minute read (About 143 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-make-simple-Binding-in-MVVM-in-iOS/">How to make simple Binding in MVVM in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/103">#103</a></strong></p>
<p>If you use <code>MVVM</code> or any other kinds of helper classes, then there‚Äôs need to report back the result to the caller. In simple cases, without asynchronous chaining, <code>RxSwift</code> is a bit overkill, you can just implement your own <code>Binding</code>. Basically, it is just observer pattern, or closure in its simplest form.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Binding</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value: <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span> &#123;</span><br><span class="line">      listener?(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> listener: ((<span class="type">T</span>) -&gt; <span class="type">Void</span>)?</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(value: <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.value = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">bind</span><span class="params">(<span class="number">_</span> closure: @escaping <span class="params">(T)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    closure(value)</span><br><span class="line">    listener = closure</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then you can declare it like</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> friends = <span class="type">Binding</span>&lt;[<span class="type">User</span>]&gt;(value: [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>() &#123;</span><br><span class="line">    getFacebookFriends &#123;</span><br><span class="line">      friends.value = $<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">getFacebookFriends</span><span class="params">(completion: <span class="params">([User])</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  	<span class="comment">// Do the work</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, this is how you listen to the result via callback</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">  viewModel.friends.bind &#123; friends <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">self</span>.friendsCountLabel.text = <span class="string">"\(friends.count)"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-08T11:09:04.000Z" title="2017-11-08T11:09:04.000Z">2017-11-08</time><span class="level-item">a few seconds read (About 80 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-custom-UINavigationBar-in-iOS/">How to use custom UINavigationBar in iOS</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/102">#102</a></strong></p>
<p>Today I was reading the project in <a href="https://www.raywenderlich.com/147162/iglistkit-tutorial-better-uicollectionviews">IGListKit Tutorial: Better UICollectionViews</a>, I encounter something I often overlook</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nav = <span class="type">UINavigationController</span>(navigationBarClass: <span class="type">CustomNavigationBar</span>.<span class="keyword">self</span>, toolbarClass: <span class="literal">nil</span>)</span><br><span class="line">nav.pushViewController(<span class="type">FeedViewController</span>(), animated: <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>So we can provide custom <code>navigationBarClass</code> and <code>toolbarClass</code> for <code>UINavigationController</code>. This <a href="https://github.com/remirobert/RRMaterialNavigationBar">RRMaterialNavigationBar</a> also has cool implementation of a material <code>UINavigationBar</code>.</p>
<p>Together with <code>UINavigationBarDelegate</code> we can do some cool things</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-02T09:42:34.000Z" title="2017-11-02T09:42:34.000Z">2017-11-02</time><span class="level-item">3 minutes read (About 515 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/It&#039;s-good-to-have-a-CI/">It&#039;s good to have a CI</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/101">#101</a></strong></p>
<p>I have Unit tests and UI tests pass on my simulator and device, locally. But when I make the build on Buddybuild, it fails with the reason <code>Activity cannot be used after its scope has completed</code>. People seem to have <a href="https://forums.developer.apple.com/thread/87463">the</a> <a href="https://stackoverflow.com/questions/46318833/how-can-i-avoid-nsinternalinconsistencyexception-when-tapping-on-ui-elements-wit">same</a> issue too.</p>
<p>Taking a look at the log in Buddybuild </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> t &#x3D;     8.89s     Staging: UIStatusBarWindow</span><br><span class="line">t &#x3D;     8.95s     Staging: (CoreFoundation) Sending Updated Preferences to System CFPrefsD</span><br><span class="line">t &#x3D;     8.95s     Staging: Setup BuddybuildSDK</span><br><span class="line">t &#x3D;     8.98s     Staging: [BuddyBuildSDK] In app store - Instant Replay Disabled</span><br><span class="line">t &#x3D;     8.98s     Staging: Setting up the remote notifications for UI Tests video recording</span><br><span class="line">t &#x3D;     9.07s     CL: CLLocationManager</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;CLLocationManager&quot;, &quot;event&quot;:activity, &quot;_cmd&quot;:initWithEffectiveBundleIdentifier:bundle:, &quot;self&quot;:&quot;0x600000205140&quot;, &quot;identifier&quot;:(null), &quot;bundle&quot;:(null)&#125;</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Core] &#123;&quot;msg&quot;:&quot;state transition&quot;, &quot;event&quot;:state_transition, &quot;state&quot;:LocationManager, &quot;id&quot;:&quot;0x600000205140&quot;, &quot;property&quot;:init, &quot;new&quot;:&#39;00 00 00 00 00 00 F0 BF 00 00 00 00 00 00 F0 BF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 F0 3F 01 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00&#39;&#125;</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Core] &#123;&quot;msg&quot;:&quot;state transition&quot;, &quot;event&quot;:state_transition, &quot;state&quot;:LocationManager, &quot;id&quot;:&quot;0x600000205140&quot;, &quot;property&quot;:lifecycle, &quot;old&quot;:&quot;0x0&quot;, &quot;new&quot;:&quot;0x6040000ddd50&quot;&#125;</span><br><span class="line">t &#x3D;     9.07s     CL: _CLClientCreateWithBundleIdentifierAndPath</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;_CLClientCreateWithBundleIdentifierAndPath&quot;, &quot;event&quot;:activity, &quot;effectiveBundleIdentifier&quot;:(null), &quot;effectiveBundlePath&quot;:(null)&#125;</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;client allocated&quot;, &quot;client&quot;:&quot;0x7f84c64e0990&quot;&#125;</span><br><span class="line">t &#x3D;     9.07s     CL: _CLClientCreateConnection</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;_CLClientCreateConnection&quot;, &quot;event&quot;:activity, &quot;client&quot;:&quot;0x7f84c64e0990&quot;&#125;</span><br><span class="line">t &#x3D;     9.07s     CL: Sending cached messages to daemon</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;Sending cached messages to daemon&quot;, &quot;event&quot;:activity&#125;</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] #Warning No cached registration message</span><br><span class="line">t &#x3D;     9.07s     Staging: (CoreLocation) [com.apple.locationd.Core.Core] &#123;&quot;msg&quot;:&quot;state transition&quot;, &quot;event&quot;:state_transition, &quot;state&quot;:LocationManager, &quot;id&quot;:&quot;0x600000205140&quot;, &quot;property&quot;:pausesLocationUpdatesAutomatically, &quot;old&quot;:0, &quot;new&quot;:1&#125;</span><br><span class="line">t &#x3D;     9.10s     CL: CLLocationManager</span><br><span class="line">t &#x3D;     9.11s     Staging: (CoreLocation) [com.apple.locationd.Core.Client] &#123;&quot;msg&quot;:&quot;CLLocationManager&quot;, &quot;event&quot;:activity, &quot;_cmd&quot;:setDelegate:, &quot;self&quot;:&quot;0x600000205140&quot;, &quot;delegate&quot;:&quot;0x60400028bef0&quot;&#125;</span><br><span class="line">t &#x3D;     9.12s     error: unexpectedly found nil while unwrapping an Optional value</span><br><span class="line">t &#x3D;     9.12s             Unable to monitor event loop</span><br><span class="line">t &#x3D;    10.13s Tap &quot;Onboarding.Continue&quot; Button</span><br><span class="line">t &#x3D;    10.13s     Wait for no.hyper.MyApp-Staging to idle</span><br><span class="line">t &#x3D;    10.16s     Find the &quot;Onboarding.Continue&quot; Button</span><br><span class="line">t &#x3D;    11.28s         Assertion Failure: &lt;unknown&gt;:0: no.hyper.MyApp-Staging crashed in MyApp_Staging.AppDelegate.(makeDependencyContainer in _5D394B3D7D393F9C3C550E61780517BB)() -&gt; MyApp_Staging.DependencyContainer</span><br><span class="line">t &#x3D;    11.33s Wait for com.apple.springboard to idle</span><br></pre></td></tr></table></figure>

<p>Did you see <code>unexpectedly found nil while unwrapping an Optional value</code>?  It crashed in <code>CLLocationManager</code>. It is because when location changes, <code>CLLocationManager</code> needs to report it via <code>didUpdateLocations</code> function, but we haven‚Äôt implemented it. Strangely that it didn‚Äôt happen when testing locally.</p>
<p>The proposed fix is to implement a dummy method with no operation</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">locationManager</span><span class="params">(<span class="number">_</span> manager: CLLocationManager, didUpdateLocations locations: [CLLocation])</span></span> &#123;</span><br><span class="line">  <span class="comment">// No op</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But it is not the solution. It appears that <code>BuddyBuild</code> is doing some hacks with how <code>push notification</code> and <code>UIWindow</code>, hence causing the issue.  </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-11-01T08:09:59.000Z" title="2017-11-01T08:09:59.000Z">2017-11-01</time><span class="level-item">a minute read (About 174 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Why-native/">Why native?</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/100">#100</a></strong></p>
<p>For now, I still believe in native. Here are some interesting links</p>
<ul>
<li><a href="https://android.jlelse.eu/why-we-are-not-cross-platform-developers-fd7ef70e976d">Why we are not cross-platform developers</a></li>
<li><a href="https://arielelkin.github.io/articles/why-im-not-a-react-native-developer.html">Why I‚Äôm not a React Native Developer</a></li>
<li><a href="https://2016.mobileera.rocks/schedule/#session-203">We are ditching Xamarin. Why?</a></li>
<li><a href="https://en.wikipedia.org/wiki/Leaky_abstraction">https://en.wikipedia.org/wiki/Leaky_abstraction</a></li>
<li><a href="https://hackernoon.com/im-harvesting-credit-card-numbers-and-passwords-from-your-site-here-s-how-9a8cb347c5b5">I‚Äôm harvesting credit card numbers and passwords from your site. Here‚Äôs how.</a></li>
<li><a href="https://www.theregister.co.uk/2016/03/23/npm_left_pad_chaos/">How one developer just broke Node, Babel and thousands of projects in 11 lines of JavaScript</a></li>
</ul>
<p>React Native</p>
<ul>
<li><a href="https://medium.com/snipe-gg/should-you-use-react-native-to-build-your-startups-mobile-app-c0baf9f4d9ad">https://medium.com/snipe-gg/should-you-use-react-native-to-build-your-startups-mobile-app-c0baf9f4d9ad</a></li>
<li><a href="https://blog.discordapp.com/using-react-native-one-year-later-91fd5e949933">https://blog.discordapp.com/using-react-native-one-year-later-91fd5e949933</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-31T12:56:13.000Z" title="2017-10-31T12:56:13.000Z">2017-10-31</time><span class="level-item">2 minutes read (About 322 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Diff-algorithm/">Diff algorithm</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/99">#99</a></strong></p>
<p>I‚Äôve been searching for efficient ways to diff collections, here are some interesting papers that I find</p>
<p><strong>Myers</strong> </p>
<ul>
<li><a href="http://www.xmailserver.org/diff2.pdf">An O(ND) Difference Algorithm and Its Variations</a></li>
<li><a href="https://github.com/wokalski/Diff.swift">https://github.com/wokalski/Diff.swift</a></li>
<li><a href="https://github.com/kpdecker/jsdiff">https://github.com/kpdecker/jsdiff</a></li>
<li><a href="https://github.com/raywenderlich/swift-algorithm-club/pull/693/files">https://github.com/raywenderlich/swift-algorithm-club/pull/693/files</a></li>
</ul>
<p><strong>Wu</strong> </p>
<ul>
<li><a href="https://publications.mpi-cbg.de/Wu_1990_6334.pdf">An O(NP) Sequence Comparison Algorithm</a></li>
<li><a href="https://github.com/kazuhiro4949/EditDistance">https://github.com/kazuhiro4949/EditDistance</a></li>
<li><a href="https://github.com/cubicdaiya/onp">https://github.com/cubicdaiya/onp</a></li>
<li><a href="https://github.com/hattya/go.diff/blob/master/diff.go">https://github.com/hattya/go.diff/blob/master/diff.go</a></li>
<li><a href="https://gist.github.com/tociyuki/acedd33ca4913f1ab8e9">https://gist.github.com/tociyuki/acedd33ca4913f1ab8e9</a></li>
<li><a href="http://t2y.hatenablog.jp/entry/20090802/1249146010">http://t2y.hatenablog.jp/entry/20090802/1249146010</a></li>
</ul>
<p><strong>Wagner‚ÄìFischer</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm">https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm</a>)</li>
<li><a href="http://davedelong.tumblr.com/post/134367865668/edit-distance-and-edit-steps">http://davedelong.tumblr.com/post/134367865668/edit-distance-and-edit-steps</a></li>
<li><a href="https://github.com/osteslag/Changeset">https://github.com/osteslag/Changeset</a></li>
<li><a href="https://github.com/onmyway133/DeepDiff">https://github.com/onmyway133/DeepDiff</a></li>
</ul>
<p><strong>Common Longest Subsequence</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Longest_common_subsequence_problem">https://en.wikipedia.org/wiki/Longest_common_subsequence_problem</a></li>
<li><a href="https://github.com/jflinter/Dwifft">https://github.com/jflinter/Dwifft</a></li>
<li><a href="https://github.com/Frugghi/SwiftLCS">https://github.com/Frugghi/SwiftLCS</a></li>
</ul>
<p><strong>Heckel</strong></p>
<ul>
<li><a href="http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf">http://documents.scribd.com/docs/10ro9oowpo1h81pgh1as.pdf</a></li>
<li><a href="https://dl.acm.org/citation.cfm?id=359467">A technique for isolating differences between files</a></li>
<li><a href="https://github.com/mcudich/HeckelDiff">https://github.com/mcudich/HeckelDiff</a></li>
<li><a href="https://github.com/Instagram/IGListKit/blob/40625f8ff960cc1fd73400bf57a7a367470d1ef3/Source/Common/IGListDiff.mm">IGListDiff</a></li>
<li><a href="https://github.com/andre-alves/PHDiff">https://github.com/andre-alves/PHDiff</a></li>
<li><a href="https://gist.github.com/ndarville/3166060">https://gist.github.com/ndarville/3166060</a></li>
<li><a href="https://github.com/myndzi/heckel-diff">https://github.com/myndzi/heckel-diff</a></li>
<li><a href="https://johnresig.com/projects/javascript-diff-algorithm/">https://johnresig.com/projects/javascript-diff-algorithm/</a></li>
<li><a href="https://stackoverflow.com/questions/42755035/difficulty-understanding-paul-heckels-diff-algorithm">https://stackoverflow.com/questions/42755035/difficulty-understanding-paul-heckels-diff-algorithm</a></li>
<li><a href="https://github.com/RACCommunity/FlexibleDiff/blob/diffing/FlexibleDiff/Changeset.swift">https://github.com/RACCommunity/FlexibleDiff/blob/diffing/FlexibleDiff/Changeset.swift</a></li>
<li><a href="https://github.com/onmyway133/DeepDiff">https://github.com/onmyway133/DeepDiff</a></li>
<li><a href="https://github.com/ra1028/DifferenceKit">https://github.com/ra1028/DifferenceKit</a></li>
</ul>
<p><strong>Hunt-Szymanski</strong></p>
<ul>
<li><a href="http://www.imada.sdu.dk/~rolf/Edu/DM823/E16/HuntSzymanski.pdf">The Hunt-Szymanski Algorithm for LCS</a></li>
</ul>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="http://wiki.c2.com/?DiffAlgorithm">http://wiki.c2.com/?DiffAlgorithm</a></li>
<li><a href="https://stackoverflow.com/questions/9065536/text-comparison-algorithm">https://stackoverflow.com/questions/9065536/text-comparison-algorithm</a></li>
<li><a href="https://neil.fraser.name/writing/diff/">https://neil.fraser.name/writing/diff/</a></li>
<li><a href="https://github.com/davedelong/SE-0240">https://github.com/davedelong/SE-0240</a></li>
<li><a href="https://forums.swift.org/t/se-0240-ordered-collection-diffing/19514">https://forums.swift.org/t/se-0240-ordered-collection-diffing/19514</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-31T10:46:53.000Z" title="2017-10-31T10:46:53.000Z">2017-10-31</time><span class="level-item">a minute read (About 206 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-use-safeAreaLayoutGuide-in-iOS-10/">How to use safeAreaLayoutGuide in iOS 10</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/98">#98</a></strong></p>
<p>The <a href="https://developer.apple.com/documentation/uikit/uiview/2891102-safearealayoutguide">safeAreaLayoutGuide</a> was introduced in iOS 11. And it is advised to stop using <code>topLayoutGuide</code> <code>bottomLayoutGuide</code> as these are deprecated.</p>
<p>To use <code>safeAreaLayoutGuide</code>, you need to do iOS version check</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">  headerView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor, constant: <span class="number">20</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  headerView.topAnchor.constraint(equalTo: view.topAnchor, constant: <span class="number">20</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Maybe we can introduce a common property that can be used across many iOS versions, let‚Äôs call it <code>compatibleSafeAreaLayoutGuide</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Use safeAreaLayoutGuide on iOS 11+, otherwise default to dummy layout guide</span></span><br><span class="line">  <span class="keyword">var</span> compatibleSafeAreaLayoutGuide: <span class="type">UILayoutGuide</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> #available(iOS <span class="number">11</span>, *) &#123;</span><br><span class="line">      <span class="keyword">return</span> safeAreaLayoutGuide</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> layoutGuide = <span class="keyword">self</span>.associatedLayoutGuide &#123;</span><br><span class="line">        <span class="keyword">return</span> layoutGuide</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> layoutGuide = <span class="type">UILayoutGuide</span>()</span><br><span class="line">        <span class="type">Constraint</span>.on(</span><br><span class="line">          layoutGuide.topAnchor.constraint(equalTo: topAnchor),</span><br><span class="line">          layoutGuide.bottomAnchor.constraint(equalTo: bottomAnchor),</span><br><span class="line">          layoutGuide.leftAnchor.constraint(equalTo: leftAnchor),</span><br><span class="line">          layoutGuide.rightAnchor.constraint(equalTo: rightAnchor)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.associatedLayoutGuide = layoutGuide</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> layoutGuide</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKeys</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> layoutGuide = <span class="string">"layoutGuide"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> associatedLayoutGuide: <span class="type">UILayoutGuide?</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.layoutGuide) <span class="keyword">as</span>? <span class="type">UILayoutGuide</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</span><br><span class="line">        objc_setAssociatedObject(</span><br><span class="line">          <span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.layoutGuide,</span><br><span class="line">          newValue <span class="keyword">as</span> <span class="type">UILayoutGuide?</span>,</span><br><span class="line">         .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This way we can simply do</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">headerView.topAnchor.constraint(equalTo: view.compatibleSafeAreaLayoutGuide.topAnchor, constant: <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://useyourloaf.com/blog/safe-area-layout-guide/">https://useyourloaf.com/blog/safe-area-layout-guide/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-25T10:19:33.000Z" title="2017-10-25T10:19:33.000Z">2017-10-25</time><span class="level-item">a minute read (About 192 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learning-from-Open-Source-Using-Coordinator/">Learning from Open Source  Using Coordinator</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/97">#97</a></strong></p>
<p>The <a href="http://khanlou.com/2015/10/coordinators-redux/">Coordinator</a> pattern can be useful to manage dependencies and handle navigation for your view controllers. It can be seen from <a href="https://github.com/backchannel/BackchannelSDK-iOS">BackchannelSDK-iOS</a>, take a look at <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/611de61611a9609d708920e2b602b2edbcc26b20/Source/Authentication/BAKCreateProfileCoordinator.m">BAKCreateProfileCoordinator</a> for example</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BAKCreateProfileCoordinator</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithUser:(BAKUser *)user navigationController:(<span class="built_in">UINavigationController</span> *)navigationController configuration:(BAKRemoteConfiguration *)configuration &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    _navigationController = navigationController;</span><br><span class="line">    _user = user;</span><br><span class="line">    _profileViewController = [[BAKProfileFormViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span> configureProfileForm];</span><br><span class="line">    _configuration = configuration;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    [<span class="keyword">self</span>.profileViewController updateDisplayName:<span class="keyword">self</span>.user.displayName];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:<span class="keyword">self</span>.profileViewController animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)profileViewControllerDidTapAvatarButton:(BAKProfileFormViewController *)profileViewController &#123;</span><br><span class="line">    BAKChooseImageCoordinator *imageChooser = [[BAKChooseImageCoordinator alloc] initWithViewController:<span class="keyword">self</span>.navigationController];</span><br><span class="line">    imageChooser.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.childCoordinators addObject:imageChooser];</span><br><span class="line">    [imageChooser start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)imageChooserDidCancel:(BAKChooseImageCoordinator *)imageChooser &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childCoordinators removeObject:imageChooser];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Look how it holds <code>navigationController</code> as root element to do navigation, and how it manages <code>childCoordinators</code></p>
<p><img src="https://user-images.githubusercontent.com/2284279/32437135-a56f3294-c2e6-11e7-8a65-801d542fed4e.png" alt="coordinator"></p>
<h3 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h3><ul>
<li><a href="https://www.youtube.com/watch?v=a1g3k3NObkE">Coordinators ‚Äì Soroush Khanlou</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-25T09:54:22.000Z" title="2017-10-25T09:54:22.000Z">2017-10-25</time><span class="level-item">3 minutes read (About 471 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learning-from-Open-Source-Managing-dependencies/">Learning from Open Source  Managing dependencies</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/96">#96</a></strong></p>
<p>Another cool thing about <a href="https://github.com/kickstarter/ios-oss">ios-oss</a> is how it manages dependencies. Usually you have a lot of dependencies, and it‚Äôs good to keep them in one place, and inject it to the objects that need.</p>
<p>The <a href="https://github.com/kickstarter/ios-oss/blob/master/Library/Environment.swift">Environment</a> is simply a struct that holds all dependencies throughout the app</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> A collection of **all** global variables and singletons that the app wants access to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Environment</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// A type that exposes endpoints for fetching Kickstarter data.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">let</span> apiService: <span class="type">ServiceType</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// The amount of time to delay API requests by. Used primarily for testing. Default value is `0.0`.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">let</span> apiDelayInterval: <span class="type">DispatchTimeInterval</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that exposes how to extract a still image from an AVAsset.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">let</span> assetImageGeneratorType: <span class="type">AssetImageGeneratorType</span>.<span class="type">Type</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that stores a cached dictionary.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">let</span> cache: <span class="type">KSCache</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then there‚Äôs global object called <a href="https://github.com/kickstarter/ios-oss/blob/master/Library/AppEnvironment.swift">AppEnvironment</a> that manages all these <code>Environment</code> in a stack</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">AppEnvironment</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   A global stack of environments.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">static</span> <span class="keyword">var</span> stack: [<span class="type">Environment</span>] = [<span class="type">Environment</span>()]</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   Invoke when an access token has been acquired and you want to log the user in. Replaces the current</span></span><br><span class="line"><span class="comment">   environment with a new one that has the authenticated api service and current user model.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   - parameter envelope: An access token envelope with the api access token and user.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(<span class="number">_</span> envelope: AccessTokenEnvelope)</span></span> &#123;</span><br><span class="line">    replaceCurrentEnvironment(</span><br><span class="line">      apiService: current.apiService.login(<span class="type">OauthToken</span>(token: envelope.accessToken)),</span><br><span class="line">      currentUser: envelope.user,</span><br><span class="line">      koala: current.koala |&gt; <span class="type">Koala</span>.lens.loggedInUser .~ envelope.user</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   Invoke when we have acquired a fresh current user and you want to replace the current environment's</span></span><br><span class="line"><span class="comment">   current user with the fresh one.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   - parameter user: A user model.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">updateCurrentUser</span><span class="params">(<span class="number">_</span> user: User)</span></span> &#123;</span><br><span class="line">    replaceCurrentEnvironment(</span><br><span class="line">      currentUser: user,</span><br><span class="line">      koala: current.koala |&gt; <span class="type">Koala</span>.lens.loggedInUser .~ user</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">updateConfig</span><span class="params">(<span class="number">_</span> config: Config)</span></span> &#123;</span><br><span class="line">    replaceCurrentEnvironment(</span><br><span class="line">      config: config,</span><br><span class="line">      koala: <span class="type">AppEnvironment</span>.current.koala |&gt; <span class="type">Koala</span>.lens.config .~ config</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Invoke when you want to end the user's session.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">logout</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> storage = <span class="type">AppEnvironment</span>.current.cookieStorage</span><br><span class="line">    storage.cookies?.forEach(storage.deleteCookie)</span><br><span class="line"></span><br><span class="line">    replaceCurrentEnvironment(</span><br><span class="line">      apiService: <span class="type">AppEnvironment</span>.current.apiService.logout(),</span><br><span class="line">      cache: type(of: <span class="type">AppEnvironment</span>.current.cache).<span class="keyword">init</span>(),</span><br><span class="line">      currentUser: <span class="literal">nil</span>,</span><br><span class="line">      koala: current.koala |&gt; <span class="type">Koala</span>.lens.loggedInUser .~ <span class="literal">nil</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The most recent environment on the stack.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> current: <span class="type">Environment!</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> stack.last</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then whenever there‚Äôs event that triggers dependencies update, we call it like </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.viewModel.outputs.logIntoEnvironment</span><br><span class="line">  .observeValues &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] accessTokenEnv <span class="keyword">in</span></span><br><span class="line">    <span class="type">AppEnvironment</span>.login(accessTokenEnv)</span><br><span class="line">    <span class="keyword">self</span>?.viewModel.inputs.environmentLoggedIn()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The cool thing about <code>Environment</code> is that we can store and retrieve them</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns the last saved environment from user defaults.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">fromStorage</span><span class="params">(ubiquitousStore: KeyValueStoreType,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 userDefaults: KeyValueStoreType)</span></span> -&gt; <span class="type">Environment</span> &#123;</span><br><span class="line">  <span class="comment">// retrieval</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And we can mock in tests</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AppEnvironment</span>.replaceCurrentEnvironment(</span><br><span class="line">  apiService: <span class="type">MockService</span>(</span><br><span class="line">    fetchDiscoveryResponse: .template |&gt; <span class="type">DiscoveryEnvelope</span>.lens.projects .~ [</span><br><span class="line">      .todayByScottThrift,</span><br><span class="line">      .cosmicSurgery,</span><br><span class="line">      .anomalisa</span><br><span class="line">    ]</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-24T11:37:32.000Z" title="2017-10-24T11:37:32.000Z">2017-10-24</time><span class="level-item">a few seconds read (About 68 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/How-to-debug-iOS-apps/">How to debug iOS apps</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/95">#95</a></strong></p>
<p>Hi, here are some projects to help us debugging apps easier</p>
<ul>
<li><a href="https://github.com/krzysztofzablocki/LifetimeTracker">https://github.com/krzysztofzablocki/LifetimeTracker</a></li>
<li><a href="https://github.com/fastred/DeallocationChecker">https://github.com/fastred/DeallocationChecker</a></li>
<li><a href="https://github.com/Flipboard/FLEX">https://github.com/Flipboard/FLEX</a></li>
<li><a href="https://github.com/facebook/flipper">https://github.com/facebook/flipper</a></li>
<li><a href="https://github.com/wojteklu/Watchdog">https://github.com/wojteklu/Watchdog</a></li>
<li><a href="https://github.com/yagiz/Bagel">https://github.com/yagiz/Bagel</a></li>
<li><a href="https://github.com/isavynskyi/LayoutInspector">https://github.com/isavynskyi/LayoutInspector</a></li>
<li><a href="https://github.com/kasketis/netfox">https://github.com/kasketis/netfox</a></li>
<li><a href="https://github.com/meitu/MTHawkeye">https://github.com/meitu/MTHawkeye</a></li>
<li><a href="https://github.com/indragiek/InAppViewDebugger">https://github.com/indragiek/InAppViewDebugger</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-23T12:26:26.000Z" title="2017-10-23T12:26:26.000Z">2017-10-23</time><span class="level-item">a minute read (About 144 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/Learning-from-Open-Source-Using-Playground/">Learning from Open Source  Using Playground</a></h1><div class="content"><p><strong>Issue <a href="https://github.com/onmyway133/blog/issues/94">#94</a></strong></p>
<p>One thing I like about <a href="https://github.com/kickstarter/ios-oss">kickstarter-ios</a> is how they use <code>Playground</code> to quickly protoyping views.</p>
<blockquote>
<p>We use Swift Playgrounds for iterative development and styling. Most major screens in the app get a corresponding playground where we can see a wide variety of devices, languages and data in real time. </p>
</blockquote>
<p>This way we don‚Äôt need <a href="http://johnholdsworth.com/injection.html">Injection</a> or using React Native anymore. Take a look at all the pages <a href="https://github.com/kickstarter/ios-oss/tree/master/Kickstarter-iOS.playground/Pages">https://github.com/kickstarter/ios-oss/tree/master/Kickstarter-iOS.playground/Pages</a></p>
<h2 id="Read-more"><a href="#Read-more" class="headerlink" title="Read more"></a>Read more</h2><ul>
<li><a href="https://talk.objc.io/episodes/S01E51-playground-driven-development-at-kickstarter">Playground-Driven Development at Kickstarter</a></li>
<li><a href="https://www.youtube.com/watch?v=DrdxSNG-_DE">FrenchKit 2017 - Playground Driven Development</a></li>
<li><a href="https://www.youtube.com/watch?v=A0VaIKK2ijM">Finding Happiness in Functional Programming</a></li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/18/">Previous</a></div><div class="pagination-next"><a href="/page/20/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/18/">18</a></li><li><a class="pagination-link is-current" href="/page/19/">19</a></li><li><a class="pagination-link" href="/page/20/">20</a></li><li><a class="pagination-link" href="/page/21/">21</a></li><li><a class="pagination-link" href="/page/22/">22</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/2284279?s=460&amp;v=4" alt="onmyway133"></figure><p class="title is-size-4 is-block line-height-inherit">onmyway133</p><p class="is-size-6 is-block">iOS, macOS, Android, React. Serial maker. Writer. Speaker.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Oslo, Norway</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">656</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">52</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/onmyway133" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/onmyway133"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://onmyway133.com/apps" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Apps</span></span><span class="level-right"><span class="level-item tag">onmyway133.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://learntalks.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Learn Talks</span></span><span class="level-right"><span class="level-item tag">learntalks.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-13T18:01:59.000Z">2020-12-13</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-show-sidebar-in-SwiftUi-for-macOS/">How to show sidebar in SwiftUi for macOS</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-07T10:24:19.000Z">2020-12-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-mock-UNNotificationResponse-in-unit-tests/">How to mock UNNotificationResponse in unit tests</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-07T05:16:58.000Z">2020-12-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-support-right-click-menu-to-NSStatusItem/">How to support right click menu to NSStatusItem</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-07T05:04:21.000Z">2020-12-07</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-convert-struct-to-Core-Data-NSManagedObject/">How to convert struct to Core Data NSManagedObject</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-05T05:00:44.000Z">2020-12-05</time></p><p class="title is-6"><a class="link-muted" href="/blog/How-to-format-ISO-date-string-in-Javascript/">How to format ISO date string in Javascript</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/06/"><span class="level-start"><span class="level-item">June 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apple-script/"><span class="tag">apple script</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/catalyst/"><span class="tag">catalyst</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ci/"><span class="tag">ci</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cloud/"><span class="tag">cloud</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cocoapods/"><span class="tag">cocoapods</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/combine/"><span class="tag">combine</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/core-data/"><span class="tag">core data</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csharp/"><span class="tag">csharp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/css/"><span class="tag">css</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dart/"><span class="tag">dart</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design/"><span class="tag">design</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/electron/"><span class="tag">electron</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firebase/"><span class="tag">firebase</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flutter/"><span class="tag">flutter</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/google/"><span class="tag">google</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iOS/"><span class="tag">iOS</span><span class="tag is-grey-lightest">166</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag is-grey-lightest">50</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kotlin/"><span class="tag">kotlin</span><span class="tag is-grey-lightest">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/layout/"><span class="tag">layout</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/links/"><span class="tag">links</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag is-grey-lightest">109</span></a></div><div class="control"><a class="tags has-addons" href="/tags/machine-learning/"><span class="tag">machine learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maps/"><span class="tag">maps</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/networking/"><span class="tag">networking</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node/"><span class="tag">node</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/objc/"><span class="tag">objc</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react-native/"><span class="tag">react native</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/realm/"><span class="tag">realm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rx/"><span class="tag">rx</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/script/"><span class="tag">script</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spm/"><span class="tag">spm</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swift/"><span class="tag">swift</span><span class="tag is-grey-lightest">305</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swiftUI/"><span class="tag">swiftUI</span><span class="tag is-grey-lightest">67</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tech/"><span class="tag">tech</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unity/"><span class="tag">unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/voip/"><span class="tag">voip</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/watchOS/"><span class="tag">watchOS</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wwdc/"><span class="tag">wwdc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xcode/"><span class="tag">xcode</span><span class="tag is-grey-lightest">24</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=c2r59mmt2n5k0o5dt5vv3nq4u4&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="c2r59mmt2n5k0o5dt5vv3nq4u4" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/z.png" alt="onmyway133" height="28"></a><p class="size-small"><span>&copy; 2020 Khoa Pham</span>¬†¬†Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>¬†&amp;¬†<a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/onmyway133"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://onmyway133.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">√ó</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>